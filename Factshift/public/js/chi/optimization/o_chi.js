
/*! jQuery v2.1.4 | (c) 2005, 2015 jQuery Foundation, Inc. | jquery.org/license */

/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   3.0.2
 */

//Underscore.js 1.8.3//http://underscorejs.org//(c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors//Underscore may be freely distributed under the MIT license.

//# sourceMappingURL=backbone-min.map;
//     (c) 2012 Onsi Fakhouri
//     Cocktail.js may be freely distributed under the MIT license.
//     http://github.com/onsi/cocktail

/*!
 * Select2 4.0.3
 * https://select2.github.io
 *
 * Released under the MIT license
 * https://github.com/select2/select2/blob/master/LICENSE.md
 */

/**
					     * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
					     * Available via the MIT or new BSD license.
					     * see: http://github.com/jrburke/almond for details
					     */

//  Underscore.inflection.js
//  (c) 2014 Jeremy Ruppel
//  Underscore.inflection is freely distributable under the MIT license.
//  Portions of Underscore.inflection are inspired or borrowed from ActiveSupport
//  Version 1.0.0

!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function i(e){var t="length"in e&&e.length,i=Z.type(e);return"function"===i||Z.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e}function n(e,t,i){if(Z.isFunction(t))return Z.grep(e,function(e,n){return!!t.call(e,n,e)!==i});if(t.nodeType)return Z.grep(e,function(e){return e===t!==i});if("string"==typeof t){if(ae.test(t))return Z.filter(t,e,i);t=Z.filter(t,e)}return Z.grep(e,function(e){return W.call(t,e)>=0!==i})}function r(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function o(e){var t=fe[e]={};return Z.each(e.match(he)||[],function(e,i){t[i]=!0}),t}function s(){J.removeEventListener("DOMContentLoaded",s,!1),e.removeEventListener("load",s,!1),Z.ready()}function a(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=Z.expando+a.uid++}function l(e,t,i){var n;if(void 0===i&&1===e.nodeType)if(n="data-"+t.replace(be,"-$1").toLowerCase(),i=e.getAttribute(n),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:ye.test(i)?Z.parseJSON(i):i}catch(r){}ge.set(e,t,i)}else i=void 0;return i}function c(){return!0}function d(){return!1}function u(){try{return J.activeElement}catch(e){}}function p(e,t){return Z.nodeName(e,"table")&&Z.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function h(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function f(e){var t=je.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function m(e,t){for(var i=0,n=e.length;n>i;i++)ve.set(e[i],"globalEval",!t||ve.get(t[i],"globalEval"))}function _(e,t){var i,n,r,o,s,a,l,c;if(1===t.nodeType){if(ve.hasData(e)&&(o=ve.access(e),s=ve.set(t,o),c=o.events)){delete s.handle,s.events={};for(r in c)for(i=0,n=c[r].length;n>i;i++)Z.event.add(t,r,c[r][i])}ge.hasData(e)&&(a=ge.access(e),l=Z.extend({},a),ge.set(t,l))}}function v(e,t){var i=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&Z.nodeName(e,t)?Z.merge([e],i):i}function g(e,t){var i=t.nodeName.toLowerCase();"input"===i&&xe.test(e.type)?t.checked=e.checked:("input"===i||"textarea"===i)&&(t.defaultValue=e.defaultValue)}function y(t,i){var n,r=Z(i.createElement(t)).appendTo(i.body),o=e.getDefaultComputedStyle&&(n=e.getDefaultComputedStyle(r[0]))?n.display:Z.css(r[0],"display");return r.detach(),o}function b(e){var t=J,i=qe[e];return i||(i=y(e,t),"none"!==i&&i||(Le=(Le||Z("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=Le[0].contentDocument,t.write(),t.close(),i=y(e,t),Le.detach()),qe[e]=i),i}function w(e,t,i){var n,r,o,s,a=e.style;return i=i||Fe(e),i&&(s=i.getPropertyValue(t)||i[t]),i&&(""!==s||Z.contains(e.ownerDocument,e)||(s=Z.style(e,t)),Ue.test(s)&&Ge.test(t)&&(n=a.width,r=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=i.width,a.width=n,a.minWidth=r,a.maxWidth=o)),void 0!==s?s+"":s}function S(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function C(e,t){if(t in e)return t;for(var i=t[0].toUpperCase()+t.slice(1),n=t,r=Xe.length;r--;)if(t=Xe[r]+i,t in e)return t;return n}function x(e,t,i){var n=Be.exec(t);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):t}function E(e,t,i,n,r){for(var o=i===(n?"border":"content")?4:"width"===t?1:0,s=0;4>o;o+=2)"margin"===i&&(s+=Z.css(e,i+Se[o],!0,r)),n?("content"===i&&(s-=Z.css(e,"padding"+Se[o],!0,r)),"margin"!==i&&(s-=Z.css(e,"border"+Se[o]+"Width",!0,r))):(s+=Z.css(e,"padding"+Se[o],!0,r),"padding"!==i&&(s+=Z.css(e,"border"+Se[o]+"Width",!0,r)));return s}function M(e,t,i){var n=!0,r="width"===t?e.offsetWidth:e.offsetHeight,o=Fe(e),s="border-box"===Z.css(e,"boxSizing",!1,o);if(0>=r||null==r){if(r=w(e,t,o),(0>r||null==r)&&(r=e.style[t]),Ue.test(r))return r;n=s&&(K.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+E(e,t,i||(s?"border":"content"),n,o)+"px"}function O(e,t){for(var i,n,r,o=[],s=0,a=e.length;a>s;s++)n=e[s],n.style&&(o[s]=ve.get(n,"olddisplay"),i=n.style.display,t?(o[s]||"none"!==i||(n.style.display=""),""===n.style.display&&Ce(n)&&(o[s]=ve.access(n,"olddisplay",b(n.nodeName)))):(r=Ce(n),"none"===i&&r||ve.set(n,"olddisplay",r?i:Z.css(n,"display"))));for(s=0;a>s;s++)n=e[s],n.style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?o[s]||"":"none"));return e}function T(e,t,i,n,r){return new T.prototype.init(e,t,i,n,r)}function $(){return setTimeout(function(){Ke=void 0}),Ke=Z.now()}function A(e,t){var i,n=0,r={height:e};for(t=t?1:0;4>n;n+=2-t)i=Se[n],r["margin"+i]=r["padding"+i]=e;return t&&(r.opacity=r.width=e),r}function I(e,t,i){for(var n,r=(it[t]||[]).concat(it["*"]),o=0,s=r.length;s>o;o++)if(n=r[o].call(i,t,e))return n}function N(e,t,i){var n,r,o,s,a,l,c,d,u=this,p={},h=e.style,f=e.nodeType&&Ce(e),m=ve.get(e,"fxshow");i.queue||(a=Z._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,u.always(function(){u.always(function(){a.unqueued--,Z.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(i.overflow=[h.overflow,h.overflowX,h.overflowY],c=Z.css(e,"display"),d="none"===c?ve.get(e,"olddisplay")||b(e.nodeName):c,"inline"===d&&"none"===Z.css(e,"float")&&(h.display="inline-block")),i.overflow&&(h.overflow="hidden",u.always(function(){h.overflow=i.overflow[0],h.overflowX=i.overflow[1],h.overflowY=i.overflow[2]}));for(n in t)if(r=t[n],Qe.exec(r)){if(delete t[n],o=o||"toggle"===r,r===(f?"hide":"show")){if("show"!==r||!m||void 0===m[n])continue;f=!0}p[n]=m&&m[n]||Z.style(e,n)}else c=void 0;if(Z.isEmptyObject(p))"inline"===("none"===c?b(e.nodeName):c)&&(h.display=c);else{m?"hidden"in m&&(f=m.hidden):m=ve.access(e,"fxshow",{}),o&&(m.hidden=!f),f?Z(e).show():u.done(function(){Z(e).hide()}),u.done(function(){var t;ve.remove(e,"fxshow");for(t in p)Z.style(e,t,p[t])});for(n in p)s=I(f?m[n]:0,n,u),n in m||(m[n]=s.start,f&&(s.end=s.start,s.start="width"===n||"height"===n?1:0))}}function D(e,t){var i,n,r,o,s;for(i in e)if(n=Z.camelCase(i),r=t[n],o=e[i],Z.isArray(o)&&(r=o[1],o=e[i]=o[0]),i!==n&&(e[n]=o,delete e[i]),s=Z.cssHooks[n],s&&"expand"in s){o=s.expand(o),delete e[n];for(i in o)i in e||(e[i]=o[i],t[i]=r)}else t[n]=r}function k(e,t,i){var n,r,o=0,s=tt.length,a=Z.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var t=Ke||$(),i=Math.max(0,c.startTime+c.duration-t),n=i/c.duration||0,o=1-n,s=0,l=c.tweens.length;l>s;s++)c.tweens[s].run(o);return a.notifyWith(e,[c,o,i]),1>o&&l?i:(a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:Z.extend({},t),opts:Z.extend(!0,{specialEasing:{}},i),originalProperties:t,originalOptions:i,startTime:Ke||$(),duration:i.duration,tweens:[],createTween:function(t,i){var n=Z.Tween(e,c.opts,t,i,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(n),n},stop:function(t){var i=0,n=t?c.tweens.length:0;if(r)return this;for(r=!0;n>i;i++)c.tweens[i].run(1);return t?a.resolveWith(e,[c,t]):a.rejectWith(e,[c,t]),this}}),d=c.props;for(D(d,c.opts.specialEasing);s>o;o++)if(n=tt[o].call(c,e,d,c.opts))return n;return Z.map(d,I,c),Z.isFunction(c.opts.start)&&c.opts.start.call(e,c),Z.fx.timer(Z.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function P(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,r=0,o=t.toLowerCase().match(he)||[];if(Z.isFunction(i))for(;n=o[r++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(i)):(e[n]=e[n]||[]).push(i)}}function j(e,t,i,n){function r(a){var l;return o[a]=!0,Z.each(e[a]||[],function(e,a){var c=a(t,i,n);return"string"!=typeof c||s||o[c]?s?!(l=c):void 0:(t.dataTypes.unshift(c),r(c),!1)}),l}var o={},s=e===yt;return r(t.dataTypes[0])||!o["*"]&&r("*")}function V(e,t){var i,n,r=Z.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((r[i]?e:n||(n={}))[i]=t[i]);return n&&Z.extend(!0,e,n),e}function R(e,t,i){for(var n,r,o,s,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(r in a)if(a[r]&&a[r].test(n)){l.unshift(r);break}if(l[0]in i)o=l[0];else{for(r in i){if(!l[0]||e.converters[r+" "+l[0]]){o=r;break}s||(s=r)}o=o||s}return o?(o!==l[0]&&l.unshift(o),i[o]):void 0}function L(e,t,i,n){var r,o,s,a,l,c={},d=e.dataTypes.slice();if(d[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];for(o=d.shift();o;)if(e.responseFields[o]&&(i[e.responseFields[o]]=t),!l&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=d.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(s=c[l+" "+o]||c["* "+o],!s)for(r in c)if(a=r.split(" "),a[1]===o&&(s=c[l+" "+a[0]]||c["* "+a[0]])){s===!0?s=c[r]:c[r]!==!0&&(o=a[0],d.unshift(a[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(u){return{state:"parsererror",error:s?u:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}function q(e,t,i,n){var r;if(Z.isArray(t))Z.each(t,function(t,r){i||xt.test(e)?n(e,r):q(e+"["+("object"==typeof r?t:"")+"]",r,i,n)});else if(i||"object"!==Z.type(t))n(e,t);else for(r in t)q(e+"["+r+"]",t[r],i,n)}function G(e){return Z.isWindow(e)?e:9===e.nodeType&&e.defaultView}var U=[],F=U.slice,H=U.concat,B=U.push,W=U.indexOf,z={},Y=z.toString,X=z.hasOwnProperty,K={},J=e.document,Q="2.1.4",Z=function(e,t){return new Z.fn.init(e,t)},ee=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,te=/^-ms-/,ie=/-([\da-z])/gi,ne=function(e,t){return t.toUpperCase()};Z.fn=Z.prototype={jquery:Q,constructor:Z,selector:"",length:0,toArray:function(){return F.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:F.call(this)},pushStack:function(e){var t=Z.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return Z.each(this,e,t)},map:function(e){return this.pushStack(Z.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(F.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(0>e?t:0);return this.pushStack(i>=0&&t>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:B,sort:U.sort,splice:U.splice},Z.extend=Z.fn.extend=function(){var e,t,i,n,r,o,s=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||Z.isFunction(s)||(s={}),a===l&&(s=this,a--);l>a;a++)if(null!=(e=arguments[a]))for(t in e)i=s[t],n=e[t],s!==n&&(c&&n&&(Z.isPlainObject(n)||(r=Z.isArray(n)))?(r?(r=!1,o=i&&Z.isArray(i)?i:[]):o=i&&Z.isPlainObject(i)?i:{},s[t]=Z.extend(c,o,n)):void 0!==n&&(s[t]=n));return s},Z.extend({expando:"jQuery"+(Q+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===Z.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!Z.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return"object"!==Z.type(e)||e.nodeType||Z.isWindow(e)?!1:e.constructor&&!X.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?z[Y.call(e)]||"object":typeof e},globalEval:function(e){var t,i=eval;e=Z.trim(e),e&&(1===e.indexOf("use strict")?(t=J.createElement("script"),t.text=e,J.head.appendChild(t).parentNode.removeChild(t)):i(e))},camelCase:function(e){return e.replace(te,"ms-").replace(ie,ne)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,o=0,s=e.length,a=i(e);if(n){if(a)for(;s>o&&(r=t.apply(e[o],n),r!==!1);o++);else for(o in e)if(r=t.apply(e[o],n),r===!1)break}else if(a)for(;s>o&&(r=t.call(e[o],o,e[o]),r!==!1);o++);else for(o in e)if(r=t.call(e[o],o,e[o]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(ee,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(i(Object(e))?Z.merge(n,"string"==typeof e?[e]:e):B.call(n,e)),n},inArray:function(e,t,i){return null==t?-1:W.call(t,e,i)},merge:function(e,t){for(var i=+t.length,n=0,r=e.length;i>n;n++)e[r++]=t[n];return e.length=r,e},grep:function(e,t,i){for(var n,r=[],o=0,s=e.length,a=!i;s>o;o++)n=!t(e[o],o),n!==a&&r.push(e[o]);return r},map:function(e,t,n){var r,o=0,s=e.length,a=i(e),l=[];if(a)for(;s>o;o++)r=t(e[o],o,n),null!=r&&l.push(r);else for(o in e)r=t(e[o],o,n),null!=r&&l.push(r);return H.apply([],l)},guid:1,proxy:function(e,t){var i,n,r;return"string"==typeof t&&(i=e[t],t=e,e=i),Z.isFunction(e)?(n=F.call(arguments,2),r=function(){return e.apply(t||this,n.concat(F.call(arguments)))},r.guid=e.guid=e.guid||Z.guid++,r):void 0},now:Date.now,support:K}),Z.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){z["[object "+t+"]"]=t.toLowerCase()});var re=function(e){function t(e,t,i,n){var r,o,s,a,l,c,u,h,f,m;if((t?t.ownerDocument||t:q)!==N&&I(t),t=t||N,i=i||[],a=t.nodeType,"string"!=typeof e||!e||1!==a&&9!==a&&11!==a)return i;if(!n&&k){if(11!==a&&(r=ge.exec(e)))if(s=r[1]){if(9===a){if(o=t.getElementById(s),!o||!o.parentNode)return i;if(o.id===s)return i.push(o),i}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(s))&&R(t,o)&&o.id===s)return i.push(o),i}else{if(r[2])return Q.apply(i,t.getElementsByTagName(e)),i;if((s=r[3])&&w.getElementsByClassName)return Q.apply(i,t.getElementsByClassName(s)),i}if(w.qsa&&(!P||!P.test(e))){if(h=u=L,f=t,m=1!==a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(c=E(e),(u=t.getAttribute("id"))?h=u.replace(be,"\\$&"):t.setAttribute("id",h),h="[id='"+h+"'] ",l=c.length;l--;)c[l]=h+p(c[l]);f=ye.test(e)&&d(t.parentNode)||t,m=c.join(",")}if(m)try{return Q.apply(i,f.querySelectorAll(m)),i}catch(_){}finally{u||t.removeAttribute("id")}}}return O(e.replace(le,"$1"),t,i,n)}function i(){function e(i,n){return t.push(i+" ")>S.cacheLength&&delete e[t.shift()],e[i+" "]=n}var t=[];return e}function n(e){return e[L]=!0,e}function r(e){var t=N.createElement("div");try{return!!e(t)}catch(i){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var i=e.split("|"),n=e.length;n--;)S.attrHandle[i[n]]=t}function s(e,t){var i=t&&e,n=i&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||z)-(~e.sourceIndex||z);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function a(e){return function(t){var i=t.nodeName.toLowerCase();return"input"===i&&t.type===e}}function l(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function c(e){return n(function(t){return t=+t,n(function(i,n){for(var r,o=e([],i.length,t),s=o.length;s--;)i[r=o[s]]&&(i[r]=!(n[r]=i[r]))})})}function d(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function u(){}function p(e){for(var t=0,i=e.length,n="";i>t;t++)n+=e[t].value;return n}function h(e,t,i){var n=t.dir,r=i&&"parentNode"===n,o=U++;return t.first?function(t,i,o){for(;t=t[n];)if(1===t.nodeType||r)return e(t,i,o)}:function(t,i,s){var a,l,c=[G,o];if(s){for(;t=t[n];)if((1===t.nodeType||r)&&e(t,i,s))return!0}else for(;t=t[n];)if(1===t.nodeType||r){if(l=t[L]||(t[L]={}),(a=l[n])&&a[0]===G&&a[1]===o)return c[2]=a[2];if(l[n]=c,c[2]=e(t,i,s))return!0}}}function f(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function m(e,i,n){for(var r=0,o=i.length;o>r;r++)t(e,i[r],n);return n}function _(e,t,i,n,r){for(var o,s=[],a=0,l=e.length,c=null!=t;l>a;a++)(o=e[a])&&(!i||i(o,n,r))&&(s.push(o),c&&t.push(a));return s}function v(e,t,i,r,o,s){return r&&!r[L]&&(r=v(r)),o&&!o[L]&&(o=v(o,s)),n(function(n,s,a,l){var c,d,u,p=[],h=[],f=s.length,v=n||m(t||"*",a.nodeType?[a]:a,[]),g=!e||!n&&t?v:_(v,p,e,a,l),y=i?o||(n?e:f||r)?[]:s:g;if(i&&i(g,y,a,l),r)for(c=_(y,h),r(c,[],a,l),d=c.length;d--;)(u=c[d])&&(y[h[d]]=!(g[h[d]]=u));if(n){if(o||e){if(o){for(c=[],d=y.length;d--;)(u=y[d])&&c.push(g[d]=u);o(null,y=[],c,l)}for(d=y.length;d--;)(u=y[d])&&(c=o?ee(n,u):p[d])>-1&&(n[c]=!(s[c]=u))}}else y=_(y===s?y.splice(f,y.length):y),o?o(null,s,y,l):Q.apply(s,y)})}function g(e){for(var t,i,n,r=e.length,o=S.relative[e[0].type],s=o||S.relative[" "],a=o?1:0,l=h(function(e){return e===t},s,!0),c=h(function(e){return ee(t,e)>-1},s,!0),d=[function(e,i,n){var r=!o&&(n||i!==T)||((t=i).nodeType?l(e,i,n):c(e,i,n));return t=null,r}];r>a;a++)if(i=S.relative[e[a].type])d=[h(f(d),i)];else{if(i=S.filter[e[a].type].apply(null,e[a].matches),i[L]){for(n=++a;r>n&&!S.relative[e[n].type];n++);return v(a>1&&f(d),a>1&&p(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(le,"$1"),i,n>a&&g(e.slice(a,n)),r>n&&g(e=e.slice(n)),r>n&&p(e))}d.push(i)}return f(d)}function y(e,i){var r=i.length>0,o=e.length>0,s=function(n,s,a,l,c){var d,u,p,h=0,f="0",m=n&&[],v=[],g=T,y=n||o&&S.find.TAG("*",c),b=G+=null==g?1:Math.random()||.1,w=y.length;for(c&&(T=s!==N&&s);f!==w&&null!=(d=y[f]);f++){if(o&&d){for(u=0;p=e[u++];)if(p(d,s,a)){l.push(d);break}c&&(G=b)}r&&((d=!p&&d)&&h--,n&&m.push(d))}if(h+=f,r&&f!==h){for(u=0;p=i[u++];)p(m,v,s,a);if(n){if(h>0)for(;f--;)m[f]||v[f]||(v[f]=K.call(l));v=_(v)}Q.apply(l,v),c&&!n&&v.length>0&&h+i.length>1&&t.uniqueSort(l)}return c&&(G=b,T=g),m};return r?n(s):s}var b,w,S,C,x,E,M,O,T,$,A,I,N,D,k,P,j,V,R,L="sizzle"+1*new Date,q=e.document,G=0,U=0,F=i(),H=i(),B=i(),W=function(e,t){return e===t&&(A=!0),0},z=1<<31,Y={}.hasOwnProperty,X=[],K=X.pop,J=X.push,Q=X.push,Z=X.slice,ee=function(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return i;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",ne="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",re=ne.replace("w","w#"),oe="\\["+ie+"*("+ne+")(?:"+ie+"*([*^$|!~]?=)"+ie+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+ie+"*\\]",se=":("+ne+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+oe+")*)|.*)\\)|)",ae=new RegExp(ie+"+","g"),le=new RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),ce=new RegExp("^"+ie+"*,"+ie+"*"),de=new RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),ue=new RegExp("="+ie+"*([^\\]'\"]*?)"+ie+"*\\]","g"),pe=new RegExp(se),he=new RegExp("^"+re+"$"),fe={ID:new RegExp("^#("+ne+")"),CLASS:new RegExp("^\\.("+ne+")"),TAG:new RegExp("^("+ne.replace("w","w*")+")"),ATTR:new RegExp("^"+oe),PSEUDO:new RegExp("^"+se),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},me=/^(?:input|select|textarea|button)$/i,_e=/^h\d$/i,ve=/^[^{]+\{\s*\[native \w/,ge=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,be=/'|\\/g,we=new RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),Se=function(e,t,i){var n="0x"+t-65536;return n!==n||i?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},Ce=function(){I()};try{Q.apply(X=Z.call(q.childNodes),q.childNodes),X[q.childNodes.length].nodeType}catch(xe){Q={apply:X.length?function(e,t){J.apply(e,Z.call(t))}:function(e,t){for(var i=e.length,n=0;e[i++]=t[n++];);e.length=i-1}}}w=t.support={},x=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},I=t.setDocument=function(e){var t,i,n=e?e.ownerDocument||e:q;return n!==N&&9===n.nodeType&&n.documentElement?(N=n,D=n.documentElement,i=n.defaultView,i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",Ce,!1):i.attachEvent&&i.attachEvent("onunload",Ce)),k=!x(n),w.attributes=r(function(e){return e.className="i",!e.getAttribute("className")}),w.getElementsByTagName=r(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),w.getElementsByClassName=ve.test(n.getElementsByClassName),w.getById=r(function(e){return D.appendChild(e).id=L,!n.getElementsByName||!n.getElementsByName(L).length}),w.getById?(S.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&k){var i=t.getElementById(e);return i&&i.parentNode?[i]:[]}},S.filter.ID=function(e){var t=e.replace(we,Se);return function(e){return e.getAttribute("id")===t}}):(delete S.find.ID,S.filter.ID=function(e){var t=e.replace(we,Se);return function(e){var i="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}}),S.find.TAG=w.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):w.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,n=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},S.find.CLASS=w.getElementsByClassName&&function(e,t){return k?t.getElementsByClassName(e):void 0},j=[],P=[],(w.qsa=ve.test(n.querySelectorAll))&&(r(function(e){D.appendChild(e).innerHTML="<a id='"+L+"'></a><select id='"+L+"-\f]' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&P.push("[*^$]="+ie+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||P.push("\\["+ie+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+L+"-]").length||P.push("~="),e.querySelectorAll(":checked").length||P.push(":checked"),e.querySelectorAll("a#"+L+"+*").length||P.push(".#.+[+~]")}),r(function(e){var t=n.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&P.push("name"+ie+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||P.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),P.push(",.*:")})),(w.matchesSelector=ve.test(V=D.matches||D.webkitMatchesSelector||D.mozMatchesSelector||D.oMatchesSelector||D.msMatchesSelector))&&r(function(e){w.disconnectedMatch=V.call(e,"div"),V.call(e,"[s!='']:x"),j.push("!=",se)}),P=P.length&&new RegExp(P.join("|")),j=j.length&&new RegExp(j.join("|")),t=ve.test(D.compareDocumentPosition),R=t||ve.test(D.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},W=t?function(e,t){if(e===t)return A=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i?i:(i=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&i||!w.sortDetached&&t.compareDocumentPosition(e)===i?e===n||e.ownerDocument===q&&R(q,e)?-1:t===n||t.ownerDocument===q&&R(q,t)?1:$?ee($,e)-ee($,t):0:4&i?-1:1)}:function(e,t){if(e===t)return A=!0,0;var i,r=0,o=e.parentNode,a=t.parentNode,l=[e],c=[t];if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:$?ee($,e)-ee($,t):0;if(o===a)return s(e,t);for(i=e;i=i.parentNode;)l.unshift(i);for(i=t;i=i.parentNode;)c.unshift(i);for(;l[r]===c[r];)r++;return r?s(l[r],c[r]):l[r]===q?-1:c[r]===q?1:0},n):N},t.matches=function(e,i){return t(e,null,null,i)},t.matchesSelector=function(e,i){if((e.ownerDocument||e)!==N&&I(e),i=i.replace(ue,"='$1']"),!(!w.matchesSelector||!k||j&&j.test(i)||P&&P.test(i)))try{var n=V.call(e,i);if(n||w.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return t(i,N,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==N&&I(e),R(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==N&&I(e);var i=S.attrHandle[t.toLowerCase()],n=i&&Y.call(S.attrHandle,t.toLowerCase())?i(e,t,!k):void 0;return void 0!==n?n:w.attributes||!k?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,i=[],n=0,r=0;if(A=!w.detectDuplicates,$=!w.sortStable&&e.slice(0),e.sort(W),A){for(;t=e[r++];)t===e[r]&&(n=i.push(r));for(;n--;)e.splice(i[n],1)}return $=null,e},C=t.getText=function(e){var t,i="",n=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=C(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[n++];)i+=C(t);return i},S=t.selectors={cacheLength:50,createPseudo:n,match:fe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(we,Se),e[3]=(e[3]||e[4]||e[5]||"").replace(we,Se),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return fe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&pe.test(i)&&(t=E(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(we,Se).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=F[e+" "];return t||(t=new RegExp("(^|"+ie+")"+e+"("+ie+"|$)"))&&F(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,i,n){return function(r){var o=t.attr(r,e);return null==o?"!="===i:i?(o+="","="===i?o===n:"!="===i?o!==n:"^="===i?n&&0===o.indexOf(n):"*="===i?n&&o.indexOf(n)>-1:"$="===i?n&&o.slice(-n.length)===n:"~="===i?(" "+o.replace(ae," ")+" ").indexOf(n)>-1:"|="===i?o===n||o.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,i,n,r){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,l){var c,d,u,p,h,f,m=o!==s?"nextSibling":"previousSibling",_=t.parentNode,v=a&&t.nodeName.toLowerCase(),g=!l&&!a;if(_){if(o){for(;m;){for(u=t;u=u[m];)if(a?u.nodeName.toLowerCase()===v:1===u.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?_.firstChild:_.lastChild],s&&g){for(d=_[L]||(_[L]={}),c=d[e]||[],h=c[0]===G&&c[1],p=c[0]===G&&c[2],u=h&&_.childNodes[h];u=++h&&u&&u[m]||(p=h=0)||f.pop();)if(1===u.nodeType&&++p&&u===t){d[e]=[G,h,p];break}}else if(g&&(c=(t[L]||(t[L]={}))[e])&&c[0]===G)p=c[1];else for(;(u=++h&&u&&u[m]||(p=h=0)||f.pop())&&((a?u.nodeName.toLowerCase()!==v:1!==u.nodeType)||!++p||(g&&((u[L]||(u[L]={}))[e]=[G,p]),u!==t)););return p-=r,p===n||p%n===0&&p/n>=0}}},PSEUDO:function(e,i){var r,o=S.pseudos[e]||S.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[L]?o(i):o.length>1?(r=[e,e,"",i],S.setFilters.hasOwnProperty(e.toLowerCase())?n(function(e,t){for(var n,r=o(e,i),s=r.length;s--;)n=ee(e,r[s]),e[n]=!(t[n]=r[s])}):function(e){return o(e,0,r)}):o}},pseudos:{not:n(function(e){var t=[],i=[],r=M(e.replace(le,"$1"));return r[L]?n(function(e,t,i,n){for(var o,s=r(e,null,n,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,n,o){return t[0]=e,r(t,null,o,i),t[0]=null,!i.pop()}}),has:n(function(e){return function(i){return t(e,i).length>0}}),contains:n(function(e){return e=e.replace(we,Se),function(t){return(t.textContent||t.innerText||C(t)).indexOf(e)>-1}}),lang:n(function(e){return he.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(we,Se).toLowerCase(),function(t){var i;do if(i=k?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return i=i.toLowerCase(),i===e||0===i.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===D},focus:function(e){return e===N.activeElement&&(!N.hasFocus||N.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!S.pseudos.empty(e)},header:function(e){return _e.test(e.nodeName)},input:function(e){return me.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,i){return[0>i?i+t:i]}),even:c(function(e,t){for(var i=0;t>i;i+=2)e.push(i);return e}),odd:c(function(e,t){for(var i=1;t>i;i+=2)e.push(i);return e}),lt:c(function(e,t,i){for(var n=0>i?i+t:i;--n>=0;)e.push(n);return e}),gt:c(function(e,t,i){for(var n=0>i?i+t:i;++n<t;)e.push(n);return e})}},S.pseudos.nth=S.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})S.pseudos[b]=a(b);for(b in{submit:!0,reset:!0})S.pseudos[b]=l(b);return u.prototype=S.filters=S.pseudos,S.setFilters=new u,E=t.tokenize=function(e,i){var n,r,o,s,a,l,c,d=H[e+" "];if(d)return i?0:d.slice(0);for(a=e,l=[],c=S.preFilter;a;){(!n||(r=ce.exec(a)))&&(r&&(a=a.slice(r[0].length)||a),l.push(o=[])),n=!1,(r=de.exec(a))&&(n=r.shift(),o.push({value:n,type:r[0].replace(le," ")}),a=a.slice(n.length));for(s in S.filter)!(r=fe[s].exec(a))||c[s]&&!(r=c[s](r))||(n=r.shift(),o.push({value:n,type:s,matches:r}),a=a.slice(n.length));if(!n)break}return i?a.length:a?t.error(e):H(e,l).slice(0)},M=t.compile=function(e,t){var i,n=[],r=[],o=B[e+" "];if(!o){for(t||(t=E(e)),i=t.length;i--;)o=g(t[i]),o[L]?n.push(o):r.push(o);o=B(e,y(r,n)),o.selector=e}return o},O=t.select=function(e,t,i,n){var r,o,s,a,l,c="function"==typeof e&&e,u=!n&&E(e=c.selector||e);if(i=i||[],1===u.length){if(o=u[0]=u[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&w.getById&&9===t.nodeType&&k&&S.relative[o[1].type]){if(t=(S.find.ID(s.matches[0].replace(we,Se),t)||[])[0],!t)return i;c&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(r=fe.needsContext.test(e)?0:o.length;r--&&(s=o[r],!S.relative[a=s.type]);)if((l=S.find[a])&&(n=l(s.matches[0].replace(we,Se),ye.test(o[0].type)&&d(t.parentNode)||t))){if(o.splice(r,1),e=n.length&&p(o),!e)return Q.apply(i,n),i;break}}return(c||M(e,u))(n,t,!k,i,ye.test(e)&&d(t.parentNode)||t),i},w.sortStable=L.split("").sort(W).join("")===L,w.detectDuplicates=!!A,I(),w.sortDetached=r(function(e){return 1&e.compareDocumentPosition(N.createElement("div"))}),r(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,i){return i?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),w.attributes&&r(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,i){return i||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),r(function(e){return null==e.getAttribute("disabled")})||o(te,function(e,t,i){var n;return i?void 0:e[t]===!0?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}),t}(e);Z.find=re,Z.expr=re.selectors,Z.expr[":"]=Z.expr.pseudos,Z.unique=re.uniqueSort,Z.text=re.getText,Z.isXMLDoc=re.isXML,Z.contains=re.contains;var oe=Z.expr.match.needsContext,se=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ae=/^.[^:#\[\.,]*$/;Z.filter=function(e,t,i){var n=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?Z.find.matchesSelector(n,e)?[n]:[]:Z.find.matches(e,Z.grep(t,function(e){return 1===e.nodeType}))},Z.fn.extend({find:function(e){var t,i=this.length,n=[],r=this;
if("string"!=typeof e)return this.pushStack(Z(e).filter(function(){for(t=0;i>t;t++)if(Z.contains(r[t],this))return!0}));for(t=0;i>t;t++)Z.find(e,r[t],n);return n=this.pushStack(i>1?Z.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(n(this,e||[],!1))},not:function(e){return this.pushStack(n(this,e||[],!0))},is:function(e){return!!n(this,"string"==typeof e&&oe.test(e)?Z(e):e||[],!1).length}});var le,ce=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,de=Z.fn.init=function(e,t){var i,n;if(!e)return this;if("string"==typeof e){if(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:ce.exec(e),!i||!i[1]&&t)return!t||t.jquery?(t||le).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof Z?t[0]:t,Z.merge(this,Z.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:J,!0)),se.test(i[1])&&Z.isPlainObject(t))for(i in t)Z.isFunction(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return n=J.getElementById(i[2]),n&&n.parentNode&&(this.length=1,this[0]=n),this.context=J,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):Z.isFunction(e)?"undefined"!=typeof le.ready?le.ready(e):e(Z):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),Z.makeArray(e,this))};de.prototype=Z.fn,le=Z(J);var ue=/^(?:parents|prev(?:Until|All))/,pe={children:!0,contents:!0,next:!0,prev:!0};Z.extend({dir:function(e,t,i){for(var n=[],r=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(r&&Z(e).is(i))break;n.push(e)}return n},sibling:function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i}}),Z.fn.extend({has:function(e){var t=Z(e,this),i=t.length;return this.filter(function(){for(var e=0;i>e;e++)if(Z.contains(this,t[e]))return!0})},closest:function(e,t){for(var i,n=0,r=this.length,o=[],s=oe.test(e)||"string"!=typeof e?Z(e,t||this.context):0;r>n;n++)for(i=this[n];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&Z.find.matchesSelector(i,e))){o.push(i);break}return this.pushStack(o.length>1?Z.unique(o):o)},index:function(e){return e?"string"==typeof e?W.call(Z(e),this[0]):W.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(Z.unique(Z.merge(this.get(),Z(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),Z.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return Z.dir(e,"parentNode")},parentsUntil:function(e,t,i){return Z.dir(e,"parentNode",i)},next:function(e){return r(e,"nextSibling")},prev:function(e){return r(e,"previousSibling")},nextAll:function(e){return Z.dir(e,"nextSibling")},prevAll:function(e){return Z.dir(e,"previousSibling")},nextUntil:function(e,t,i){return Z.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return Z.dir(e,"previousSibling",i)},siblings:function(e){return Z.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return Z.sibling(e.firstChild)},contents:function(e){return e.contentDocument||Z.merge([],e.childNodes)}},function(e,t){Z.fn[e]=function(i,n){var r=Z.map(this,t,i);return"Until"!==e.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=Z.filter(n,r)),this.length>1&&(pe[e]||Z.unique(r),ue.test(e)&&r.reverse()),this.pushStack(r)}});var he=/\S+/g,fe={};Z.Callbacks=function(e){e="string"==typeof e?fe[e]||o(e):Z.extend({},e);var t,i,n,r,s,a,l=[],c=!e.once&&[],d=function(o){for(t=e.memory&&o,i=!0,a=r||0,r=0,s=l.length,n=!0;l&&s>a;a++)if(l[a].apply(o[0],o[1])===!1&&e.stopOnFalse){t=!1;break}n=!1,l&&(c?c.length&&d(c.shift()):t?l=[]:u.disable())},u={add:function(){if(l){var i=l.length;!function o(t){Z.each(t,function(t,i){var n=Z.type(i);"function"===n?e.unique&&u.has(i)||l.push(i):i&&i.length&&"string"!==n&&o(i)})}(arguments),n?s=l.length:t&&(r=i,d(t))}return this},remove:function(){return l&&Z.each(arguments,function(e,t){for(var i;(i=Z.inArray(t,l,i))>-1;)l.splice(i,1),n&&(s>=i&&s--,a>=i&&a--)}),this},has:function(e){return e?Z.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],s=0,this},disable:function(){return l=c=t=void 0,this},disabled:function(){return!l},lock:function(){return c=void 0,t||u.disable(),this},locked:function(){return!c},fireWith:function(e,t){return!l||i&&!c||(t=t||[],t=[e,t.slice?t.slice():t],n?c.push(t):d(t)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!i}};return u},Z.extend({Deferred:function(e){var t=[["resolve","done",Z.Callbacks("once memory"),"resolved"],["reject","fail",Z.Callbacks("once memory"),"rejected"],["notify","progress",Z.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return Z.Deferred(function(i){Z.each(t,function(t,o){var s=Z.isFunction(e[t])&&e[t];r[o[1]](function(){var e=s&&s.apply(this,arguments);e&&Z.isFunction(e.promise)?e.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[o[0]+"With"](this===n?i.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?Z.extend(e,n):n}},r={};return n.pipe=n.then,Z.each(t,function(e,o){var s=o[2],a=o[3];n[o[1]]=s.add,a&&s.add(function(){i=a},t[1^e][2].disable,t[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?n:this,arguments),this},r[o[0]+"With"]=s.fireWith}),n.promise(r),e&&e.call(r,r),r},when:function(e){var t,i,n,r=0,o=F.call(arguments),s=o.length,a=1!==s||e&&Z.isFunction(e.promise)?s:0,l=1===a?e:Z.Deferred(),c=function(e,i,n){return function(r){i[e]=this,n[e]=arguments.length>1?F.call(arguments):r,n===t?l.notifyWith(i,n):--a||l.resolveWith(i,n)}};if(s>1)for(t=new Array(s),i=new Array(s),n=new Array(s);s>r;r++)o[r]&&Z.isFunction(o[r].promise)?o[r].promise().done(c(r,n,o)).fail(l.reject).progress(c(r,i,t)):--a;return a||l.resolveWith(n,o),l.promise()}});var me;Z.fn.ready=function(e){return Z.ready.promise().done(e),this},Z.extend({isReady:!1,readyWait:1,holdReady:function(e){e?Z.readyWait++:Z.ready(!0)},ready:function(e){(e===!0?--Z.readyWait:Z.isReady)||(Z.isReady=!0,e!==!0&&--Z.readyWait>0||(me.resolveWith(J,[Z]),Z.fn.triggerHandler&&(Z(J).triggerHandler("ready"),Z(J).off("ready"))))}}),Z.ready.promise=function(t){return me||(me=Z.Deferred(),"complete"===J.readyState?setTimeout(Z.ready):(J.addEventListener("DOMContentLoaded",s,!1),e.addEventListener("load",s,!1))),me.promise(t)},Z.ready.promise();var _e=Z.access=function(e,t,i,n,r,o,s){var a=0,l=e.length,c=null==i;if("object"===Z.type(i)){r=!0;for(a in i)Z.access(e,t,a,i[a],!0,o,s)}else if(void 0!==n&&(r=!0,Z.isFunction(n)||(s=!0),c&&(s?(t.call(e,n),t=null):(c=t,t=function(e,t,i){return c.call(Z(e),i)})),t))for(;l>a;a++)t(e[a],i,s?n:n.call(e[a],a,t(e[a],i)));return r?e:c?t.call(e):l?t(e[0],i):o};Z.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},a.uid=1,a.accepts=Z.acceptData,a.prototype={key:function(e){if(!a.accepts(e))return 0;var t={},i=e[this.expando];if(!i){i=a.uid++;try{t[this.expando]={value:i},Object.defineProperties(e,t)}catch(n){t[this.expando]=i,Z.extend(e,t)}}return this.cache[i]||(this.cache[i]={}),i},set:function(e,t,i){var n,r=this.key(e),o=this.cache[r];if("string"==typeof t)o[t]=i;else if(Z.isEmptyObject(o))Z.extend(this.cache[r],t);else for(n in t)o[n]=t[n];return o},get:function(e,t){var i=this.cache[this.key(e)];return void 0===t?i:i[t]},access:function(e,t,i){var n;return void 0===t||t&&"string"==typeof t&&void 0===i?(n=this.get(e,t),void 0!==n?n:this.get(e,Z.camelCase(t))):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,n,r,o=this.key(e),s=this.cache[o];if(void 0===t)this.cache[o]={};else{Z.isArray(t)?n=t.concat(t.map(Z.camelCase)):(r=Z.camelCase(t),t in s?n=[t,r]:(n=r,n=n in s?[n]:n.match(he)||[])),i=n.length;for(;i--;)delete s[n[i]]}},hasData:function(e){return!Z.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var ve=new a,ge=new a,ye=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,be=/([A-Z])/g;Z.extend({hasData:function(e){return ge.hasData(e)||ve.hasData(e)},data:function(e,t,i){return ge.access(e,t,i)},removeData:function(e,t){ge.remove(e,t)},_data:function(e,t,i){return ve.access(e,t,i)},_removeData:function(e,t){ve.remove(e,t)}}),Z.fn.extend({data:function(e,t){var i,n,r,o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(r=ge.get(o),1===o.nodeType&&!ve.get(o,"hasDataAttrs"))){for(i=s.length;i--;)s[i]&&(n=s[i].name,0===n.indexOf("data-")&&(n=Z.camelCase(n.slice(5)),l(o,n,r[n])));ve.set(o,"hasDataAttrs",!0)}return r}return"object"==typeof e?this.each(function(){ge.set(this,e)}):_e(this,function(t){var i,n=Z.camelCase(e);if(o&&void 0===t){if(i=ge.get(o,e),void 0!==i)return i;if(i=ge.get(o,n),void 0!==i)return i;if(i=l(o,n,void 0),void 0!==i)return i}else this.each(function(){var i=ge.get(this,n);ge.set(this,n,t),-1!==e.indexOf("-")&&void 0!==i&&ge.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){ge.remove(this,e)})}}),Z.extend({queue:function(e,t,i){var n;return e?(t=(t||"fx")+"queue",n=ve.get(e,t),i&&(!n||Z.isArray(i)?n=ve.access(e,t,Z.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(e,t){t=t||"fx";var i=Z.queue(e,t),n=i.length,r=i.shift(),o=Z._queueHooks(e,t),s=function(){Z.dequeue(e,t)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===t&&i.unshift("inprogress"),delete o.stop,r.call(e,s,o)),!n&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return ve.get(e,i)||ve.access(e,i,{empty:Z.Callbacks("once memory").add(function(){ve.remove(e,[t+"queue",i])})})}}),Z.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?Z.queue(this[0],e):void 0===t?this:this.each(function(){var i=Z.queue(this,e,t);Z._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&Z.dequeue(this,e)})},dequeue:function(e){return this.each(function(){Z.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,n=1,r=Z.Deferred(),o=this,s=this.length,a=function(){--n||r.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)i=ve.get(o[s],e+"queueHooks"),i&&i.empty&&(n++,i.empty.add(a));return a(),r.promise(t)}});var we=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Se=["Top","Right","Bottom","Left"],Ce=function(e,t){return e=t||e,"none"===Z.css(e,"display")||!Z.contains(e.ownerDocument,e)},xe=/^(?:checkbox|radio)$/i;!function(){var e=J.createDocumentFragment(),t=e.appendChild(J.createElement("div")),i=J.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),t.appendChild(i),K.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",K.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Ee="undefined";K.focusinBubbles="onfocusin"in e;var Me=/^key/,Oe=/^(?:mouse|pointer|contextmenu)|click/,Te=/^(?:focusinfocus|focusoutblur)$/,$e=/^([^.]*)(?:\.(.+)|)$/;Z.event={global:{},add:function(e,t,i,n,r){var o,s,a,l,c,d,u,p,h,f,m,_=ve.get(e);if(_)for(i.handler&&(o=i,i=o.handler,r=o.selector),i.guid||(i.guid=Z.guid++),(l=_.events)||(l=_.events={}),(s=_.handle)||(s=_.handle=function(t){return typeof Z!==Ee&&Z.event.triggered!==t.type?Z.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(he)||[""],c=t.length;c--;)a=$e.exec(t[c])||[],h=m=a[1],f=(a[2]||"").split(".").sort(),h&&(u=Z.event.special[h]||{},h=(r?u.delegateType:u.bindType)||h,u=Z.event.special[h]||{},d=Z.extend({type:h,origType:m,data:n,handler:i,guid:i.guid,selector:r,needsContext:r&&Z.expr.match.needsContext.test(r),namespace:f.join(".")},o),(p=l[h])||(p=l[h]=[],p.delegateCount=0,u.setup&&u.setup.call(e,n,f,s)!==!1||e.addEventListener&&e.addEventListener(h,s,!1)),u.add&&(u.add.call(e,d),d.handler.guid||(d.handler.guid=i.guid)),r?p.splice(p.delegateCount++,0,d):p.push(d),Z.event.global[h]=!0)},remove:function(e,t,i,n,r){var o,s,a,l,c,d,u,p,h,f,m,_=ve.hasData(e)&&ve.get(e);if(_&&(l=_.events)){for(t=(t||"").match(he)||[""],c=t.length;c--;)if(a=$e.exec(t[c])||[],h=m=a[1],f=(a[2]||"").split(".").sort(),h){for(u=Z.event.special[h]||{},h=(n?u.delegateType:u.bindType)||h,p=l[h]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=p.length;o--;)d=p[o],!r&&m!==d.origType||i&&i.guid!==d.guid||a&&!a.test(d.namespace)||n&&n!==d.selector&&("**"!==n||!d.selector)||(p.splice(o,1),d.selector&&p.delegateCount--,u.remove&&u.remove.call(e,d));s&&!p.length&&(u.teardown&&u.teardown.call(e,f,_.handle)!==!1||Z.removeEvent(e,h,_.handle),delete l[h])}else for(h in l)Z.event.remove(e,h+t[c],i,n,!0);Z.isEmptyObject(l)&&(delete _.handle,ve.remove(e,"events"))}},trigger:function(t,i,n,r){var o,s,a,l,c,d,u,p=[n||J],h=X.call(t,"type")?t.type:t,f=X.call(t,"namespace")?t.namespace.split("."):[];if(s=a=n=n||J,3!==n.nodeType&&8!==n.nodeType&&!Te.test(h+Z.event.triggered)&&(h.indexOf(".")>=0&&(f=h.split("."),h=f.shift(),f.sort()),c=h.indexOf(":")<0&&"on"+h,t=t[Z.expando]?t:new Z.Event(h,"object"==typeof t&&t),t.isTrigger=r?2:3,t.namespace=f.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),i=null==i?[t]:Z.makeArray(i,[t]),u=Z.event.special[h]||{},r||!u.trigger||u.trigger.apply(n,i)!==!1)){if(!r&&!u.noBubble&&!Z.isWindow(n)){for(l=u.delegateType||h,Te.test(l+h)||(s=s.parentNode);s;s=s.parentNode)p.push(s),a=s;a===(n.ownerDocument||J)&&p.push(a.defaultView||a.parentWindow||e)}for(o=0;(s=p[o++])&&!t.isPropagationStopped();)t.type=o>1?l:u.bindType||h,d=(ve.get(s,"events")||{})[t.type]&&ve.get(s,"handle"),d&&d.apply(s,i),d=c&&s[c],d&&d.apply&&Z.acceptData(s)&&(t.result=d.apply(s,i),t.result===!1&&t.preventDefault());return t.type=h,r||t.isDefaultPrevented()||u._default&&u._default.apply(p.pop(),i)!==!1||!Z.acceptData(n)||c&&Z.isFunction(n[h])&&!Z.isWindow(n)&&(a=n[c],a&&(n[c]=null),Z.event.triggered=h,n[h](),Z.event.triggered=void 0,a&&(n[c]=a)),t.result}},dispatch:function(e){e=Z.event.fix(e);var t,i,n,r,o,s=[],a=F.call(arguments),l=(ve.get(this,"events")||{})[e.type]||[],c=Z.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(s=Z.event.handlers.call(this,e,l),t=0;(r=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=r.elem,i=0;(o=r.handlers[i++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,n=((Z.event.special[o.origType]||{}).handle||o.handler).apply(r.elem,a),void 0!==n&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,t){var i,n,r,o,s=[],a=t.delegateCount,l=e.target;if(a&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!==this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==e.type){for(n=[],i=0;a>i;i++)o=t[i],r=o.selector+" ",void 0===n[r]&&(n[r]=o.needsContext?Z(r,this).index(l)>=0:Z.find(r,this,null,[l]).length),n[r]&&n.push(o);n.length&&s.push({elem:l,handlers:n})}return a<t.length&&s.push({elem:this,handlers:t.slice(a)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var i,n,r,o=t.button;return null==e.pageX&&null!=t.clientX&&(i=e.target.ownerDocument||J,n=i.documentElement,r=i.body,e.pageX=t.clientX+(n&&n.scrollLeft||r&&r.scrollLeft||0)-(n&&n.clientLeft||r&&r.clientLeft||0),e.pageY=t.clientY+(n&&n.scrollTop||r&&r.scrollTop||0)-(n&&n.clientTop||r&&r.clientTop||0)),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0),e}},fix:function(e){if(e[Z.expando])return e;var t,i,n,r=e.type,o=e,s=this.fixHooks[r];for(s||(this.fixHooks[r]=s=Oe.test(r)?this.mouseHooks:Me.test(r)?this.keyHooks:{}),n=s.props?this.props.concat(s.props):this.props,e=new Z.Event(o),t=n.length;t--;)i=n[t],e[i]=o[i];return e.target||(e.target=J),3===e.target.nodeType&&(e.target=e.target.parentNode),s.filter?s.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==u()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===u()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&Z.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return Z.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,i,n){var r=Z.extend(new Z.Event,i,{type:e,isSimulated:!0,originalEvent:{}});n?Z.event.trigger(r,null,t):Z.event.dispatch.call(t,r),r.isDefaultPrevented()&&i.preventDefault()}},Z.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)},Z.Event=function(e,t){return this instanceof Z.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?c:d):this.type=e,t&&Z.extend(this,t),this.timeStamp=e&&e.timeStamp||Z.now(),void(this[Z.expando]=!0)):new Z.Event(e,t)},Z.Event.prototype={isDefaultPrevented:d,isPropagationStopped:d,isImmediatePropagationStopped:d,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=c,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=c,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=c,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},Z.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){Z.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=this,r=e.relatedTarget,o=e.handleObj;return(!r||r!==n&&!Z.contains(n,r))&&(e.type=o.origType,i=o.handler.apply(this,arguments),e.type=t),i}}}),K.focusinBubbles||Z.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){Z.event.simulate(t,e.target,Z.event.fix(e),!0)};Z.event.special[t]={setup:function(){var n=this.ownerDocument||this,r=ve.access(n,t);r||n.addEventListener(e,i,!0),ve.access(n,t,(r||0)+1)},teardown:function(){var n=this.ownerDocument||this,r=ve.access(n,t)-1;r?ve.access(n,t,r):(n.removeEventListener(e,i,!0),ve.remove(n,t))}}}),Z.fn.extend({on:function(e,t,i,n,r){var o,s;if("object"==typeof e){"string"!=typeof t&&(i=i||t,t=void 0);for(s in e)this.on(s,t,i,e[s],r);return this}if(null==i&&null==n?(n=t,i=t=void 0):null==n&&("string"==typeof t?(n=i,i=void 0):(n=i,i=t,t=void 0)),n===!1)n=d;else if(!n)return this;return 1===r&&(o=n,n=function(e){return Z().off(e),o.apply(this,arguments)},n.guid=o.guid||(o.guid=Z.guid++)),this.each(function(){Z.event.add(this,e,n,i,t)})},one:function(e,t,i,n){return this.on(e,t,i,n,1)},off:function(e,t,i){var n,r;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,Z(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof e){for(r in e)this.off(r,t,e[r]);return this}return(t===!1||"function"==typeof t)&&(i=t,t=void 0),i===!1&&(i=d),this.each(function(){Z.event.remove(this,e,i,t)})},trigger:function(e,t){return this.each(function(){Z.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];return i?Z.event.trigger(e,t,i,!0):void 0}});var Ae=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ie=/<([\w:]+)/,Ne=/<|&#?\w+;/,De=/<(?:script|style|link)/i,ke=/checked\s*(?:[^=]|=\s*.checked.)/i,Pe=/^$|\/(?:java|ecma)script/i,je=/^true\/(.*)/,Ve=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Re={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Re.optgroup=Re.option,Re.tbody=Re.tfoot=Re.colgroup=Re.caption=Re.thead,Re.th=Re.td,Z.extend({clone:function(e,t,i){var n,r,o,s,a=e.cloneNode(!0),l=Z.contains(e.ownerDocument,e);if(!(K.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||Z.isXMLDoc(e)))for(s=v(a),o=v(e),n=0,r=o.length;r>n;n++)g(o[n],s[n]);if(t)if(i)for(o=o||v(e),s=s||v(a),n=0,r=o.length;r>n;n++)_(o[n],s[n]);else _(e,a);return s=v(a,"script"),s.length>0&&m(s,!l&&v(e,"script")),a},buildFragment:function(e,t,i,n){for(var r,o,s,a,l,c,d=t.createDocumentFragment(),u=[],p=0,h=e.length;h>p;p++)if(r=e[p],r||0===r)if("object"===Z.type(r))Z.merge(u,r.nodeType?[r]:r);else if(Ne.test(r)){for(o=o||d.appendChild(t.createElement("div")),s=(Ie.exec(r)||["",""])[1].toLowerCase(),a=Re[s]||Re._default,o.innerHTML=a[1]+r.replace(Ae,"<$1></$2>")+a[2],c=a[0];c--;)o=o.lastChild;Z.merge(u,o.childNodes),o=d.firstChild,o.textContent=""}else u.push(t.createTextNode(r));for(d.textContent="",p=0;r=u[p++];)if((!n||-1===Z.inArray(r,n))&&(l=Z.contains(r.ownerDocument,r),o=v(d.appendChild(r),"script"),l&&m(o),i))for(c=0;r=o[c++];)Pe.test(r.type||"")&&i.push(r);return d},cleanData:function(e){for(var t,i,n,r,o=Z.event.special,s=0;void 0!==(i=e[s]);s++){if(Z.acceptData(i)&&(r=i[ve.expando],r&&(t=ve.cache[r]))){if(t.events)for(n in t.events)o[n]?Z.event.remove(i,n):Z.removeEvent(i,n,t.handle);ve.cache[r]&&delete ve.cache[r]}delete ge.cache[i[ge.expando]]}}}),Z.fn.extend({text:function(e){return _e(this,function(e){return void 0===e?Z.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=p(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=p(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var i,n=e?Z.filter(e,this):this,r=0;null!=(i=n[r]);r++)t||1!==i.nodeType||Z.cleanData(v(i)),i.parentNode&&(t&&Z.contains(i.ownerDocument,i)&&m(v(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(Z.cleanData(v(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return Z.clone(this,e,t)})},html:function(e){return _e(this,function(e){var t=this[0]||{},i=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!De.test(e)&&!Re[(Ie.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Ae,"<$1></$2>");try{for(;n>i;i++)t=this[i]||{},1===t.nodeType&&(Z.cleanData(v(t,!1)),t.innerHTML=e);t=0}catch(r){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,Z.cleanData(v(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=H.apply([],e);var i,n,r,o,s,a,l=0,c=this.length,d=this,u=c-1,p=e[0],m=Z.isFunction(p);if(m||c>1&&"string"==typeof p&&!K.checkClone&&ke.test(p))return this.each(function(i){var n=d.eq(i);m&&(e[0]=p.call(this,i,n.html())),n.domManip(e,t)});if(c&&(i=Z.buildFragment(e,this[0].ownerDocument,!1,this),n=i.firstChild,1===i.childNodes.length&&(i=n),n)){for(r=Z.map(v(i,"script"),h),o=r.length;c>l;l++)s=i,l!==u&&(s=Z.clone(s,!0,!0),o&&Z.merge(r,v(s,"script"))),t.call(this[l],s,l);if(o)for(a=r[r.length-1].ownerDocument,Z.map(r,f),l=0;o>l;l++)s=r[l],Pe.test(s.type||"")&&!ve.access(s,"globalEval")&&Z.contains(a,s)&&(s.src?Z._evalUrl&&Z._evalUrl(s.src):Z.globalEval(s.textContent.replace(Ve,"")))}return this}}),Z.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){Z.fn[e]=function(e){for(var i,n=[],r=Z(e),o=r.length-1,s=0;o>=s;s++)i=s===o?this:this.clone(!0),Z(r[s])[t](i),B.apply(n,i.get());return this.pushStack(n)}});var Le,qe={},Ge=/^margin/,Ue=new RegExp("^("+we+")(?!px)[a-z%]+$","i"),Fe=function(t){return t.ownerDocument.defaultView.opener?t.ownerDocument.defaultView.getComputedStyle(t,null):e.getComputedStyle(t,null)};!function(){function t(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",s.innerHTML="",r.appendChild(o);var t=e.getComputedStyle(s,null);i="1%"!==t.top,n="4px"===t.width,r.removeChild(o)}var i,n,r=J.documentElement,o=J.createElement("div"),s=J.createElement("div");s.style&&(s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",K.clearCloneStyle="content-box"===s.style.backgroundClip,o.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",o.appendChild(s),e.getComputedStyle&&Z.extend(K,{pixelPosition:function(){return t(),i},boxSizingReliable:function(){return null==n&&t(),n},reliableMarginRight:function(){var t,i=s.appendChild(J.createElement("div"));return i.style.cssText=s.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",s.style.width="1px",r.appendChild(o),t=!parseFloat(e.getComputedStyle(i,null).marginRight),r.removeChild(o),s.removeChild(i),t}}))}(),Z.swap=function(e,t,i,n){var r,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];r=i.apply(e,n||[]);for(o in t)e.style[o]=s[o];return r};var He=/^(none|table(?!-c[ea]).+)/,Be=new RegExp("^("+we+")(.*)$","i"),We=new RegExp("^([+-])=("+we+")","i"),ze={position:"absolute",visibility:"hidden",display:"block"},Ye={letterSpacing:"0",fontWeight:"400"},Xe=["Webkit","O","Moz","ms"];Z.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=w(e,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,i,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,o,s,a=Z.camelCase(t),l=e.style;return t=Z.cssProps[a]||(Z.cssProps[a]=C(l,a)),s=Z.cssHooks[t]||Z.cssHooks[a],void 0===i?s&&"get"in s&&void 0!==(r=s.get(e,!1,n))?r:l[t]:(o=typeof i,"string"===o&&(r=We.exec(i))&&(i=(r[1]+1)*r[2]+parseFloat(Z.css(e,t)),o="number"),void(null!=i&&i===i&&("number"!==o||Z.cssNumber[a]||(i+="px"),K.clearCloneStyle||""!==i||0!==t.indexOf("background")||(l[t]="inherit"),s&&"set"in s&&void 0===(i=s.set(e,i,n))||(l[t]=i))))}},css:function(e,t,i,n){var r,o,s,a=Z.camelCase(t);return t=Z.cssProps[a]||(Z.cssProps[a]=C(e.style,a)),s=Z.cssHooks[t]||Z.cssHooks[a],s&&"get"in s&&(r=s.get(e,!0,i)),void 0===r&&(r=w(e,t,n)),"normal"===r&&t in Ye&&(r=Ye[t]),""===i||i?(o=parseFloat(r),i===!0||Z.isNumeric(o)?o||0:r):r}}),Z.each(["height","width"],function(e,t){Z.cssHooks[t]={get:function(e,i,n){return i?He.test(Z.css(e,"display"))&&0===e.offsetWidth?Z.swap(e,ze,function(){return M(e,t,n)}):M(e,t,n):void 0},set:function(e,i,n){var r=n&&Fe(e);return x(e,i,n?E(e,t,n,"border-box"===Z.css(e,"boxSizing",!1,r),r):0)}}}),Z.cssHooks.marginRight=S(K.reliableMarginRight,function(e,t){return t?Z.swap(e,{display:"inline-block"},w,[e,"marginRight"]):void 0}),Z.each({margin:"",padding:"",border:"Width"},function(e,t){Z.cssHooks[e+t]={expand:function(i){for(var n=0,r={},o="string"==typeof i?i.split(" "):[i];4>n;n++)r[e+Se[n]+t]=o[n]||o[n-2]||o[0];return r}},Ge.test(e)||(Z.cssHooks[e+t].set=x)}),Z.fn.extend({css:function(e,t){return _e(this,function(e,t,i){var n,r,o={},s=0;if(Z.isArray(t)){for(n=Fe(e),r=t.length;r>s;s++)o[t[s]]=Z.css(e,t[s],!1,n);return o}return void 0!==i?Z.style(e,t,i):Z.css(e,t)},e,t,arguments.length>1)},show:function(){return O(this,!0)},hide:function(){return O(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Ce(this)?Z(this).show():Z(this).hide()})}}),Z.Tween=T,T.prototype={constructor:T,init:function(e,t,i,n,r,o){this.elem=e,this.prop=i,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=o||(Z.cssNumber[i]?"":"px")},cur:function(){var e=T.propHooks[this.prop];return e&&e.get?e.get(this):T.propHooks._default.get(this)},run:function(e){var t,i=T.propHooks[this.prop];return this.options.duration?this.pos=t=Z.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):T.propHooks._default.set(this),this}},T.prototype.init.prototype=T.prototype,T.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=Z.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){Z.fx.step[e.prop]?Z.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[Z.cssProps[e.prop]]||Z.cssHooks[e.prop])?Z.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},T.propHooks.scrollTop=T.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},Z.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},Z.fx=T.prototype.init,Z.fx.step={};var Ke,Je,Qe=/^(?:toggle|show|hide)$/,Ze=new RegExp("^(?:([+-])=|)("+we+")([a-z%]*)$","i"),et=/queueHooks$/,tt=[N],it={"*":[function(e,t){var i=this.createTween(e,t),n=i.cur(),r=Ze.exec(t),o=r&&r[3]||(Z.cssNumber[e]?"":"px"),s=(Z.cssNumber[e]||"px"!==o&&+n)&&Ze.exec(Z.css(i.elem,e)),a=1,l=20;if(s&&s[3]!==o){o=o||s[3],r=r||[],s=+n||1;do a=a||".5",s/=a,Z.style(i.elem,e,s+o);while(a!==(a=i.cur()/n)&&1!==a&&--l)}return r&&(s=i.start=+s||+n||0,i.unit=o,i.end=r[1]?s+(r[1]+1)*r[2]:+r[2]),i}]};Z.Animation=Z.extend(k,{tweener:function(e,t){Z.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var i,n=0,r=e.length;r>n;n++)i=e[n],it[i]=it[i]||[],it[i].unshift(t)},prefilter:function(e,t){t?tt.unshift(e):tt.push(e)}}),Z.speed=function(e,t,i){var n=e&&"object"==typeof e?Z.extend({},e):{complete:i||!i&&t||Z.isFunction(e)&&e,duration:e,easing:i&&t||t&&!Z.isFunction(t)&&t};return n.duration=Z.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in Z.fx.speeds?Z.fx.speeds[n.duration]:Z.fx.speeds._default,(null==n.queue||n.queue===!0)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){Z.isFunction(n.old)&&n.old.call(this),n.queue&&Z.dequeue(this,n.queue)},n},Z.fn.extend({fadeTo:function(e,t,i,n){return this.filter(Ce).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var r=Z.isEmptyObject(e),o=Z.speed(t,i,n),s=function(){var t=k(this,Z.extend({},e),o);(r||ve.get(this,"finish"))&&t.stop(!0)};return s.finish=s,r||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(e,t,i){var n=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,r=null!=e&&e+"queueHooks",o=Z.timers,s=ve.get(this);if(r)s[r]&&s[r].stop&&n(s[r]);else for(r in s)s[r]&&s[r].stop&&et.test(r)&&n(s[r]);for(r=o.length;r--;)o[r].elem!==this||null!=e&&o[r].queue!==e||(o[r].anim.stop(i),t=!1,o.splice(r,1));(t||!i)&&Z.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,i=ve.get(this),n=i[e+"queue"],r=i[e+"queueHooks"],o=Z.timers,s=n?n.length:0;for(i.finish=!0,Z.queue(this,e,[]),
r&&r.stop&&r.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;s>t;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish})}}),Z.each(["toggle","show","hide"],function(e,t){var i=Z.fn[t];Z.fn[t]=function(e,n,r){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(A(t,!0),e,n,r)}}),Z.each({slideDown:A("show"),slideUp:A("hide"),slideToggle:A("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){Z.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}}),Z.timers=[],Z.fx.tick=function(){var e,t=0,i=Z.timers;for(Ke=Z.now();t<i.length;t++)e=i[t],e()||i[t]!==e||i.splice(t--,1);i.length||Z.fx.stop(),Ke=void 0},Z.fx.timer=function(e){Z.timers.push(e),e()?Z.fx.start():Z.timers.pop()},Z.fx.interval=13,Z.fx.start=function(){Je||(Je=setInterval(Z.fx.tick,Z.fx.interval))},Z.fx.stop=function(){clearInterval(Je),Je=null},Z.fx.speeds={slow:600,fast:200,_default:400},Z.fn.delay=function(e,t){return e=Z.fx?Z.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,i){var n=setTimeout(t,e);i.stop=function(){clearTimeout(n)}})},function(){var e=J.createElement("input"),t=J.createElement("select"),i=t.appendChild(J.createElement("option"));e.type="checkbox",K.checkOn=""!==e.value,K.optSelected=i.selected,t.disabled=!0,K.optDisabled=!i.disabled,e=J.createElement("input"),e.value="t",e.type="radio",K.radioValue="t"===e.value}();var nt,rt,ot=Z.expr.attrHandle;Z.fn.extend({attr:function(e,t){return _e(this,Z.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){Z.removeAttr(this,e)})}}),Z.extend({attr:function(e,t,i){var n,r,o=e.nodeType;return e&&3!==o&&8!==o&&2!==o?typeof e.getAttribute===Ee?Z.prop(e,t,i):(1===o&&Z.isXMLDoc(e)||(t=t.toLowerCase(),n=Z.attrHooks[t]||(Z.expr.match.bool.test(t)?rt:nt)),void 0===i?n&&"get"in n&&null!==(r=n.get(e,t))?r:(r=Z.find.attr(e,t),null==r?void 0:r):null!==i?n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:(e.setAttribute(t,i+""),i):void Z.removeAttr(e,t)):void 0},removeAttr:function(e,t){var i,n,r=0,o=t&&t.match(he);if(o&&1===e.nodeType)for(;i=o[r++];)n=Z.propFix[i]||i,Z.expr.match.bool.test(i)&&(e[n]=!1),e.removeAttribute(i)},attrHooks:{type:{set:function(e,t){if(!K.radioValue&&"radio"===t&&Z.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}}}),rt={set:function(e,t,i){return t===!1?Z.removeAttr(e,i):e.setAttribute(i,i),i}},Z.each(Z.expr.match.bool.source.match(/\w+/g),function(e,t){var i=ot[t]||Z.find.attr;ot[t]=function(e,t,n){var r,o;return n||(o=ot[t],ot[t]=r,r=null!=i(e,t,n)?t.toLowerCase():null,ot[t]=o),r}});var st=/^(?:input|select|textarea|button)$/i;Z.fn.extend({prop:function(e,t){return _e(this,Z.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[Z.propFix[e]||e]})}}),Z.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,i){var n,r,o,s=e.nodeType;return e&&3!==s&&8!==s&&2!==s?(o=1!==s||!Z.isXMLDoc(e),o&&(t=Z.propFix[t]||t,r=Z.propHooks[t]),void 0!==i?r&&"set"in r&&void 0!==(n=r.set(e,i,t))?n:e[t]=i:r&&"get"in r&&null!==(n=r.get(e,t))?n:e[t]):void 0},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||st.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),K.optSelected||(Z.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),Z.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){Z.propFix[this.toLowerCase()]=this});var at=/[\t\r\n\f]/g;Z.fn.extend({addClass:function(e){var t,i,n,r,o,s,a="string"==typeof e&&e,l=0,c=this.length;if(Z.isFunction(e))return this.each(function(t){Z(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(he)||[];c>l;l++)if(i=this[l],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(at," "):" ")){for(o=0;r=t[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");s=Z.trim(n),i.className!==s&&(i.className=s)}return this},removeClass:function(e){var t,i,n,r,o,s,a=0===arguments.length||"string"==typeof e&&e,l=0,c=this.length;if(Z.isFunction(e))return this.each(function(t){Z(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(he)||[];c>l;l++)if(i=this[l],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(at," "):"")){for(o=0;r=t[o++];)for(;n.indexOf(" "+r+" ")>=0;)n=n.replace(" "+r+" "," ");s=e?Z.trim(n):"",i.className!==s&&(i.className=s)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):this.each(Z.isFunction(e)?function(i){Z(this).toggleClass(e.call(this,i,this.className,t),t)}:function(){if("string"===i)for(var t,n=0,r=Z(this),o=e.match(he)||[];t=o[n++];)r.hasClass(t)?r.removeClass(t):r.addClass(t);else(i===Ee||"boolean"===i)&&(this.className&&ve.set(this,"__className__",this.className),this.className=this.className||e===!1?"":ve.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",i=0,n=this.length;n>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(at," ").indexOf(t)>=0)return!0;return!1}});var lt=/\r/g;Z.fn.extend({val:function(e){var t,i,n,r=this[0];return arguments.length?(n=Z.isFunction(e),this.each(function(i){var r;1===this.nodeType&&(r=n?e.call(this,i,Z(this).val()):e,null==r?r="":"number"==typeof r?r+="":Z.isArray(r)&&(r=Z.map(r,function(e){return null==e?"":e+""})),t=Z.valHooks[this.type]||Z.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,r,"value")||(this.value=r))})):r?(t=Z.valHooks[r.type]||Z.valHooks[r.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(i=t.get(r,"value"))?i:(i=r.value,"string"==typeof i?i.replace(lt,""):null==i?"":i)):void 0}}),Z.extend({valHooks:{option:{get:function(e){var t=Z.find.attr(e,"value");return null!=t?t:Z.trim(Z.text(e))}},select:{get:function(e){for(var t,i,n=e.options,r=e.selectedIndex,o="select-one"===e.type||0>r,s=o?null:[],a=o?r+1:n.length,l=0>r?a:o?r:0;a>l;l++)if(i=n[l],!(!i.selected&&l!==r||(K.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&Z.nodeName(i.parentNode,"optgroup"))){if(t=Z(i).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var i,n,r=e.options,o=Z.makeArray(t),s=r.length;s--;)n=r[s],(n.selected=Z.inArray(n.value,o)>=0)&&(i=!0);return i||(e.selectedIndex=-1),o}}}}),Z.each(["radio","checkbox"],function(){Z.valHooks[this]={set:function(e,t){return Z.isArray(t)?e.checked=Z.inArray(Z(e).val(),t)>=0:void 0}},K.checkOn||(Z.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),Z.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){Z.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),Z.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}});var ct=Z.now(),dt=/\?/;Z.parseJSON=function(e){return JSON.parse(e+"")},Z.parseXML=function(e){var t,i;if(!e||"string"!=typeof e)return null;try{i=new DOMParser,t=i.parseFromString(e,"text/xml")}catch(n){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&Z.error("Invalid XML: "+e),t};var ut=/#.*$/,pt=/([?&])_=[^&]*/,ht=/^(.*?):[ \t]*([^\r\n]*)$/gm,ft=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,mt=/^(?:GET|HEAD)$/,_t=/^\/\//,vt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,gt={},yt={},bt="*/".concat("*"),wt=e.location.href,St=vt.exec(wt.toLowerCase())||[];Z.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:wt,type:"GET",isLocal:ft.test(St[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":bt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":Z.parseJSON,"text xml":Z.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?V(V(e,Z.ajaxSettings),t):V(Z.ajaxSettings,e)},ajaxPrefilter:P(gt),ajaxTransport:P(yt),ajax:function(e,t){function i(e,t,i,s){var l,d,v,g,b,S=t;2!==y&&(y=2,a&&clearTimeout(a),n=void 0,o=s||"",w.readyState=e>0?4:0,l=e>=200&&300>e||304===e,i&&(g=R(u,w,i)),g=L(u,g,w,l),l?(u.ifModified&&(b=w.getResponseHeader("Last-Modified"),b&&(Z.lastModified[r]=b),b=w.getResponseHeader("etag"),b&&(Z.etag[r]=b)),204===e||"HEAD"===u.type?S="nocontent":304===e?S="notmodified":(S=g.state,d=g.data,v=g.error,l=!v)):(v=S,(e||!S)&&(S="error",0>e&&(e=0))),w.status=e,w.statusText=(t||S)+"",l?f.resolveWith(p,[d,S,w]):f.rejectWith(p,[w,S,v]),w.statusCode(_),_=void 0,c&&h.trigger(l?"ajaxSuccess":"ajaxError",[w,u,l?d:v]),m.fireWith(p,[w,S]),c&&(h.trigger("ajaxComplete",[w,u]),--Z.active||Z.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r,o,s,a,l,c,d,u=Z.ajaxSetup({},t),p=u.context||u,h=u.context&&(p.nodeType||p.jquery)?Z(p):Z.event,f=Z.Deferred(),m=Z.Callbacks("once memory"),_=u.statusCode||{},v={},g={},y=0,b="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(2===y){if(!s)for(s={};t=ht.exec(o);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===y?o:null},setRequestHeader:function(e,t){var i=e.toLowerCase();return y||(e=g[i]=g[i]||e,v[e]=t),this},overrideMimeType:function(e){return y||(u.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>y)for(t in e)_[t]=[_[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||b;return n&&n.abort(t),i(0,t),this}};if(f.promise(w).complete=m.add,w.success=w.done,w.error=w.fail,u.url=((e||u.url||wt)+"").replace(ut,"").replace(_t,St[1]+"//"),u.type=t.method||t.type||u.method||u.type,u.dataTypes=Z.trim(u.dataType||"*").toLowerCase().match(he)||[""],null==u.crossDomain&&(l=vt.exec(u.url.toLowerCase()),u.crossDomain=!(!l||l[1]===St[1]&&l[2]===St[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(St[3]||("http:"===St[1]?"80":"443")))),u.data&&u.processData&&"string"!=typeof u.data&&(u.data=Z.param(u.data,u.traditional)),j(gt,u,t,w),2===y)return w;c=Z.event&&u.global,c&&0===Z.active++&&Z.event.trigger("ajaxStart"),u.type=u.type.toUpperCase(),u.hasContent=!mt.test(u.type),r=u.url,u.hasContent||(u.data&&(r=u.url+=(dt.test(r)?"&":"?")+u.data,delete u.data),u.cache===!1&&(u.url=pt.test(r)?r.replace(pt,"$1_="+ct++):r+(dt.test(r)?"&":"?")+"_="+ct++)),u.ifModified&&(Z.lastModified[r]&&w.setRequestHeader("If-Modified-Since",Z.lastModified[r]),Z.etag[r]&&w.setRequestHeader("If-None-Match",Z.etag[r])),(u.data&&u.hasContent&&u.contentType!==!1||t.contentType)&&w.setRequestHeader("Content-Type",u.contentType),w.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+("*"!==u.dataTypes[0]?", "+bt+"; q=0.01":""):u.accepts["*"]);for(d in u.headers)w.setRequestHeader(d,u.headers[d]);if(u.beforeSend&&(u.beforeSend.call(p,w,u)===!1||2===y))return w.abort();b="abort";for(d in{success:1,error:1,complete:1})w[d](u[d]);if(n=j(yt,u,t,w)){w.readyState=1,c&&h.trigger("ajaxSend",[w,u]),u.async&&u.timeout>0&&(a=setTimeout(function(){w.abort("timeout")},u.timeout));try{y=1,n.send(v,i)}catch(S){if(!(2>y))throw S;i(-1,S)}}else i(-1,"No Transport");return w},getJSON:function(e,t,i){return Z.get(e,t,i,"json")},getScript:function(e,t){return Z.get(e,void 0,t,"script")}}),Z.each(["get","post"],function(e,t){Z[t]=function(e,i,n,r){return Z.isFunction(i)&&(r=r||n,n=i,i=void 0),Z.ajax({url:e,type:t,dataType:r,data:i,success:n})}}),Z._evalUrl=function(e){return Z.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},Z.fn.extend({wrapAll:function(e){var t;return Z.isFunction(e)?this.each(function(t){Z(this).wrapAll(e.call(this,t))}):(this[0]&&(t=Z(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(Z.isFunction(e)?function(t){Z(this).wrapInner(e.call(this,t))}:function(){var t=Z(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=Z.isFunction(e);return this.each(function(i){Z(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(){return this.parent().each(function(){Z.nodeName(this,"body")||Z(this).replaceWith(this.childNodes)}).end()}}),Z.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},Z.expr.filters.visible=function(e){return!Z.expr.filters.hidden(e)};var Ct=/%20/g,xt=/\[\]$/,Et=/\r?\n/g,Mt=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;Z.param=function(e,t){var i,n=[],r=function(e,t){t=Z.isFunction(t)?t():null==t?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=Z.ajaxSettings&&Z.ajaxSettings.traditional),Z.isArray(e)||e.jquery&&!Z.isPlainObject(e))Z.each(e,function(){r(this.name,this.value)});else for(i in e)q(i,e[i],t,r);return n.join("&").replace(Ct,"+")},Z.fn.extend({serialize:function(){return Z.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=Z.prop(this,"elements");return e?Z.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!Z(this).is(":disabled")&&Ot.test(this.nodeName)&&!Mt.test(e)&&(this.checked||!xe.test(e))}).map(function(e,t){var i=Z(this).val();return null==i?null:Z.isArray(i)?Z.map(i,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:i.replace(Et,"\r\n")}}).get()}}),Z.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Tt=0,$t={},At={0:200,1223:204},It=Z.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in $t)$t[e]()}),K.cors=!!It&&"withCredentials"in It,K.ajax=It=!!It,Z.ajaxTransport(function(e){var t;return K.cors||It&&!e.crossDomain?{send:function(i,n){var r,o=e.xhr(),s=++Tt;if(o.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(r in e.xhrFields)o[r]=e.xhrFields[r];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(r in i)o.setRequestHeader(r,i[r]);t=function(e){return function(){t&&(delete $t[s],t=o.onload=o.onerror=null,"abort"===e?o.abort():"error"===e?n(o.status,o.statusText):n(At[o.status]||o.status,o.statusText,"string"==typeof o.responseText?{text:o.responseText}:void 0,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=$t[s]=t("abort");try{o.send(e.hasContent&&e.data||null)}catch(a){if(t)throw a}},abort:function(){t&&t()}}:void 0}),Z.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return Z.globalEval(e),e}}}),Z.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),Z.ajaxTransport("script",function(e){if(e.crossDomain){var t,i;return{send:function(n,r){t=Z("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&r("error"===e.type?404:200,e.type)}),J.head.appendChild(t[0])},abort:function(){i&&i()}}}});var Nt=[],Dt=/(=)\?(?=&|$)|\?\?/;Z.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Nt.pop()||Z.expando+"_"+ct++;return this[e]=!0,e}}),Z.ajaxPrefilter("json jsonp",function(t,i,n){var r,o,s,a=t.jsonp!==!1&&(Dt.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Dt.test(t.data)&&"data");return a||"jsonp"===t.dataTypes[0]?(r=t.jsonpCallback=Z.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(Dt,"$1"+r):t.jsonp!==!1&&(t.url+=(dt.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return s||Z.error(r+" was not called"),s[0]},t.dataTypes[0]="json",o=e[r],e[r]=function(){s=arguments},n.always(function(){e[r]=o,t[r]&&(t.jsonpCallback=i.jsonpCallback,Nt.push(r)),s&&Z.isFunction(o)&&o(s[0]),s=o=void 0}),"script"):void 0}),Z.parseHTML=function(e,t,i){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(i=t,t=!1),t=t||J;var n=se.exec(e),r=!i&&[];return n?[t.createElement(n[1])]:(n=Z.buildFragment([e],t,r),r&&r.length&&Z(r).remove(),Z.merge([],n.childNodes))};var kt=Z.fn.load;Z.fn.load=function(e,t,i){if("string"!=typeof e&&kt)return kt.apply(this,arguments);var n,r,o,s=this,a=e.indexOf(" ");return a>=0&&(n=Z.trim(e.slice(a)),e=e.slice(0,a)),Z.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(r="POST"),s.length>0&&Z.ajax({url:e,type:r,dataType:"html",data:t}).done(function(e){o=arguments,s.html(n?Z("<div>").append(Z.parseHTML(e)).find(n):e)}).complete(i&&function(e,t){s.each(i,o||[e.responseText,t,e])}),this},Z.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){Z.fn[t]=function(e){return this.on(t,e)}}),Z.expr.filters.animated=function(e){return Z.grep(Z.timers,function(t){return e===t.elem}).length};var Pt=e.document.documentElement;Z.offset={setOffset:function(e,t,i){var n,r,o,s,a,l,c,d=Z.css(e,"position"),u=Z(e),p={};"static"===d&&(e.style.position="relative"),a=u.offset(),o=Z.css(e,"top"),l=Z.css(e,"left"),c=("absolute"===d||"fixed"===d)&&(o+l).indexOf("auto")>-1,c?(n=u.position(),s=n.top,r=n.left):(s=parseFloat(o)||0,r=parseFloat(l)||0),Z.isFunction(t)&&(t=t.call(e,i,a)),null!=t.top&&(p.top=t.top-a.top+s),null!=t.left&&(p.left=t.left-a.left+r),"using"in t?t.using.call(e,p):u.css(p)}},Z.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){Z.offset.setOffset(this,e,t)});var t,i,n=this[0],r={top:0,left:0},o=n&&n.ownerDocument;return o?(t=o.documentElement,Z.contains(t,n)?(typeof n.getBoundingClientRect!==Ee&&(r=n.getBoundingClientRect()),i=G(o),{top:r.top+i.pageYOffset-t.clientTop,left:r.left+i.pageXOffset-t.clientLeft}):r):void 0},position:function(){if(this[0]){var e,t,i=this[0],n={top:0,left:0};return"fixed"===Z.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),Z.nodeName(e[0],"html")||(n=e.offset()),n.top+=Z.css(e[0],"borderTopWidth",!0),n.left+=Z.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-Z.css(i,"marginTop",!0),left:t.left-n.left-Z.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Pt;e&&!Z.nodeName(e,"html")&&"static"===Z.css(e,"position");)e=e.offsetParent;return e||Pt})}}),Z.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var n="pageYOffset"===i;Z.fn[t]=function(r){return _e(this,function(t,r,o){var s=G(t);return void 0===o?s?s[i]:t[r]:void(s?s.scrollTo(n?e.pageXOffset:o,n?o:e.pageYOffset):t[r]=o)},t,r,arguments.length,null)}}),Z.each(["top","left"],function(e,t){Z.cssHooks[t]=S(K.pixelPosition,function(e,i){return i?(i=w(e,t),Ue.test(i)?Z(e).position()[t]+"px":i):void 0})}),Z.each({Height:"height",Width:"width"},function(e,t){Z.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,n){Z.fn[n]=function(n,r){var o=arguments.length&&(i||"boolean"!=typeof n),s=i||(n===!0||r===!0?"margin":"border");return _e(this,function(t,i,n){var r;return Z.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(r=t.documentElement,Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])):void 0===n?Z.css(t,i,s):Z.style(t,i,n,s)},t,o?n:void 0,o,null)}})}),Z.fn.size=function(){return this.length},Z.fn.andSelf=Z.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return Z});var jt=e.jQuery,Vt=e.$;return Z.noConflict=function(t){return e.$===Z&&(e.$=Vt),t&&e.jQuery===Z&&(e.jQuery=jt),Z},typeof t===Ee&&(e.jQuery=e.$=Z),Z}),function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function n(e){G=e}function r(e){B=e}function o(){return function(){process.nextTick(d)}}function s(){return function(){q(d)}}function a(){var e=0,t=new Y(d),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}function l(){var e=new MessageChannel;return e.port1.onmessage=d,function(){e.port2.postMessage(0)}}function c(){return function(){setTimeout(d,1)}}function d(){for(var e=0;H>e;e+=2){var t=J[e],i=J[e+1];t(i),J[e]=void 0,J[e+1]=void 0}H=0}function u(){try{var e=require,t=e("vertx");return q=t.runOnLoop||t.runOnContext,s()}catch(i){return c()}}function p(){}function h(){return new TypeError("You cannot resolve a promise with itself")}function f(){return new TypeError("A promises callback cannot return that same promise.")}function m(e){try{return e.then}catch(t){return te.error=t,te}}function _(e,t,i,n){try{e.call(t,i,n)}catch(r){return r}}function v(e,t,i){B(function(e){var n=!1,r=_(i,t,function(i){n||(n=!0,t!==i?b(e,i):S(e,i))},function(t){n||(n=!0,C(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&r&&(n=!0,C(e,r))},e)}function g(e,t){t._state===Z?S(e,t._result):t._state===ee?C(e,t._result):x(t,void 0,function(t){b(e,t)},function(t){C(e,t)})}function y(e,i){if(i.constructor===e.constructor)g(e,i);else{var n=m(i);n===te?C(e,te.error):void 0===n?S(e,i):t(n)?v(e,i,n):S(e,i)}}function b(t,i){t===i?C(t,h()):e(i)?y(t,i):S(t,i)}function w(e){e._onerror&&e._onerror(e._result),E(e)}function S(e,t){e._state===Q&&(e._result=t,e._state=Z,0!==e._subscribers.length&&B(E,e))}function C(e,t){e._state===Q&&(e._state=ee,e._result=t,B(w,e))}function x(e,t,i,n){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+Z]=i,r[o+ee]=n,0===o&&e._state&&B(E,e)}function E(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var n,r,o=e._result,s=0;s<t.length;s+=3)n=t[s],r=t[s+i],n?T(i,n,r,o):r(o);e._subscribers.length=0}}function M(){this.error=null}function O(e,t){try{return e(t)}catch(i){return ie.error=i,ie}}function T(e,i,n,r){var o,s,a,l,c=t(n);if(c){if(o=O(n,r),o===ie?(l=!0,s=o.error,o=null):a=!0,i===o)return void C(i,f())}else o=r,a=!0;i._state!==Q||(c&&a?b(i,o):l?C(i,s):e===Z?S(i,o):e===ee&&C(i,o))}function $(e,t){try{t(function(t){b(e,t)},function(t){C(e,t)})}catch(i){C(e,i)}}function A(e,t){var i=this;i._instanceConstructor=e,i.promise=new e(p),i._validateInput(t)?(i._input=t,i.length=t.length,i._remaining=t.length,i._init(),0===i.length?S(i.promise,i._result):(i.length=i.length||0,i._enumerate(),0===i._remaining&&S(i.promise,i._result))):C(i.promise,i._validationError())}function I(e){return new ne(this,e).promise}function N(e){function t(e){b(r,e)}function i(e){C(r,e)}var n=this,r=new n(p);if(!F(e))return C(r,new TypeError("You must pass an array to race.")),r;for(var o=e.length,s=0;r._state===Q&&o>s;s++)x(n.resolve(e[s]),void 0,t,i);return r}function D(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var i=new t(p);return b(i,e),i}function k(e){var t=this,i=new t(p);return C(i,e),i}function P(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function j(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function V(e){this._id=le++,this._state=void 0,this._result=void 0,this._subscribers=[],p!==e&&(t(e)||P(),this instanceof V||j(),$(this,e))}function R(){var e;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var i=e.Promise;(!i||"[object Promise]"!==Object.prototype.toString.call(i.resolve())||i.cast)&&(e.Promise=ce)}var L;L=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var q,G,U,F=L,H=0,B=({}.toString,function(e,t){J[H]=e,J[H+1]=t,H+=2,2===H&&(G?G(d):U())}),W="undefined"!=typeof window?window:void 0,z=W||{},Y=z.MutationObserver||z.WebKitMutationObserver,X="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),K="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,J=new Array(1e3);U=X?o():Y?a():K?l():void 0===W&&"function"==typeof require?u():c();var Q=void 0,Z=1,ee=2,te=new M,ie=new M;A.prototype._validateInput=function(e){return F(e)},A.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},A.prototype._init=function(){this._result=new Array(this.length)};var ne=A;A.prototype._enumerate=function(){for(var e=this,t=e.length,i=e.promise,n=e._input,r=0;i._state===Q&&t>r;r++)e._eachEntry(n[r],r)},A.prototype._eachEntry=function(e,t){var n=this,r=n._instanceConstructor;i(e)?e.constructor===r&&e._state!==Q?(e._onerror=null,n._settledAt(e._state,t,e._result)):n._willSettleAt(r.resolve(e),t):(n._remaining--,n._result[t]=e)},A.prototype._settledAt=function(e,t,i){var n=this,r=n.promise;r._state===Q&&(n._remaining--,e===ee?C(r,i):n._result[t]=i),0===n._remaining&&S(r,n._result)},A.prototype._willSettleAt=function(e,t){var i=this;x(e,void 0,function(e){i._settledAt(Z,t,e)},function(e){i._settledAt(ee,t,e)})};var re=I,oe=N,se=D,ae=k,le=0,ce=V;V.all=re,V.race=oe,V.resolve=se,V.reject=ae,V._setScheduler=n,V._setAsap=r,V._asap=B,V.prototype={constructor:V,then:function(e,t){var i=this,n=i._state;if(n===Z&&!e||n===ee&&!t)return this;var r=new this.constructor(p),o=i._result;if(n){var s=arguments[n-1];B(function(){T(n,r,s,o)})}else x(i,r,e,t);return r},"catch":function(e){return this.then(null,e)}};var de=R,ue={Promise:ce,polyfill:de};"function"==typeof define&&define.amd?define("Promise",[],function(){return ue}):"undefined"!=typeof module&&module.exports?module.exports=ue:"undefined"!=typeof this&&(this.ES6Promise=ue),de()}.call(this),function(){function e(e){function t(t,i,n,r,o,s){for(;o>=0&&s>o;o+=e){var a=r?r[o]:o;n=i(n,t[a],a,t)}return n}return function(i,n,r,o){n=y(n,o,4);var s=!M(i)&&g.keys(i),a=(s||i).length,l=e>0?0:a-1;return arguments.length<3&&(r=i[s?s[l]:l],l+=e),t(i,n,r,s,l,a)}}function t(e){return function(t,i,n){i=b(i,n);for(var r=E(t),o=e>0?0:r-1;o>=0&&r>o;o+=e)if(i(t[o],o,t))return o;return-1}}function i(e,t,i){return function(n,r,o){var s=0,a=E(n);if("number"==typeof o)e>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(i&&o&&a)return o=i(n,r),n[o]===r?o:-1;if(r!==r)return o=t(d.call(n,s,a),g.isNaN),o>=0?o+s:-1;for(o=e>0?s:a-1;o>=0&&a>o;o+=e)if(n[o]===r)return o;return-1}}function n(e,t){var i=I.length,n=e.constructor,r=g.isFunction(n)&&n.prototype||a,o="constructor";for(g.has(e,o)&&!g.contains(t,o)&&t.push(o);i--;)o=I[i],o in e&&e[o]!==r[o]&&!g.contains(t,o)&&t.push(o)}var r=this,o=r._,s=Array.prototype,a=Object.prototype,l=Function.prototype,c=s.push,d=s.slice,u=a.toString,p=a.hasOwnProperty,h=Array.isArray,f=Object.keys,m=l.bind,_=Object.create,v=function(){},g=function(e){return e instanceof g?e:this instanceof g?void(this._wrapped=e):new g(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=g),exports._=g):r._=g,g.VERSION="1.8.3";var y=function(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,r){return e.call(t,i,n,r)};case 4:return function(i,n,r,o){return e.call(t,i,n,r,o)}}return function(){return e.apply(t,arguments)}},b=function(e,t,i){return null==e?g.identity:g.isFunction(e)?y(e,t,i):g.isObject(e)?g.matcher(e):g.property(e)};g.iteratee=function(e,t){return b(e,t,1/0)};var w=function(e,t){return function(i){var n=arguments.length;if(2>n||null==i)return i;for(var r=1;n>r;r++)for(var o=arguments[r],s=e(o),a=s.length,l=0;a>l;l++){var c=s[l];t&&void 0!==i[c]||(i[c]=o[c])}return i}},S=function(e){if(!g.isObject(e))return{};if(_)return _(e);v.prototype=e;var t=new v;return v.prototype=null,t},C=function(e){return function(t){return null==t?void 0:t[e]}},x=Math.pow(2,53)-1,E=C("length"),M=function(e){var t=E(e);return"number"==typeof t&&t>=0&&x>=t};g.each=g.forEach=function(e,t,i){t=y(t,i);var n,r;if(M(e))for(n=0,r=e.length;r>n;n++)t(e[n],n,e);else{var o=g.keys(e);for(n=0,r=o.length;r>n;n++)t(e[o[n]],o[n],e)}return e},g.map=g.collect=function(e,t,i){t=b(t,i);for(var n=!M(e)&&g.keys(e),r=(n||e).length,o=Array(r),s=0;r>s;s++){var a=n?n[s]:s;o[s]=t(e[a],a,e)}return o},g.reduce=g.foldl=g.inject=e(1),g.reduceRight=g.foldr=e(-1),g.find=g.detect=function(e,t,i){var n;return n=M(e)?g.findIndex(e,t,i):g.findKey(e,t,i),void 0!==n&&-1!==n?e[n]:void 0},g.filter=g.select=function(e,t,i){var n=[];return t=b(t,i),g.each(e,function(e,i,r){t(e,i,r)&&n.push(e)}),n},g.reject=function(e,t,i){return g.filter(e,g.negate(b(t)),i)},g.every=g.all=function(e,t,i){t=b(t,i);for(var n=!M(e)&&g.keys(e),r=(n||e).length,o=0;r>o;o++){var s=n?n[o]:o;if(!t(e[s],s,e))return!1}return!0},g.some=g.any=function(e,t,i){t=b(t,i);for(var n=!M(e)&&g.keys(e),r=(n||e).length,o=0;r>o;o++){var s=n?n[o]:o;if(t(e[s],s,e))return!0}return!1},g.contains=g.includes=g.include=function(e,t,i,n){return M(e)||(e=g.values(e)),("number"!=typeof i||n)&&(i=0),g.indexOf(e,t,i)>=0},g.invoke=function(e,t){var i=d.call(arguments,2),n=g.isFunction(t);return g.map(e,function(e){var r=n?t:e[t];return null==r?r:r.apply(e,i)})},g.pluck=function(e,t){return g.map(e,g.property(t))},g.where=function(e,t){return g.filter(e,g.matcher(t))},g.findWhere=function(e,t){return g.find(e,g.matcher(t))},g.max=function(e,t,i){var n,r,o=-1/0,s=-1/0;if(null==t&&null!=e){e=M(e)?e:g.values(e);for(var a=0,l=e.length;l>a;a++)n=e[a],n>o&&(o=n)}else t=b(t,i),g.each(e,function(e,i,n){r=t(e,i,n),(r>s||r===-1/0&&o===-1/0)&&(o=e,s=r)});return o},g.min=function(e,t,i){var n,r,o=1/0,s=1/0;if(null==t&&null!=e){e=M(e)?e:g.values(e);for(var a=0,l=e.length;l>a;a++)n=e[a],o>n&&(o=n)}else t=b(t,i),g.each(e,function(e,i,n){r=t(e,i,n),(s>r||1/0===r&&1/0===o)&&(o=e,s=r)});return o},g.shuffle=function(e){for(var t,i=M(e)?e:g.values(e),n=i.length,r=Array(n),o=0;n>o;o++)t=g.random(0,o),t!==o&&(r[o]=r[t]),r[t]=i[o];return r},g.sample=function(e,t,i){return null==t||i?(M(e)||(e=g.values(e)),e[g.random(e.length-1)]):g.shuffle(e).slice(0,Math.max(0,t))},g.sortBy=function(e,t,i){return t=b(t,i),g.pluck(g.map(e,function(e,i,n){return{value:e,index:i,criteria:t(e,i,n)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return e.index-t.index}),"value")};var O=function(e){return function(t,i,n){var r={};return i=b(i,n),g.each(t,function(n,o){var s=i(n,o,t);e(r,n,s)}),r}};g.groupBy=O(function(e,t,i){g.has(e,i)?e[i].push(t):e[i]=[t]}),g.indexBy=O(function(e,t,i){e[i]=t}),g.countBy=O(function(e,t,i){g.has(e,i)?e[i]++:e[i]=1}),g.toArray=function(e){return e?g.isArray(e)?d.call(e):M(e)?g.map(e,g.identity):g.values(e):[]},g.size=function(e){return null==e?0:M(e)?e.length:g.keys(e).length},g.partition=function(e,t,i){t=b(t,i);var n=[],r=[];return g.each(e,function(e,i,o){(t(e,i,o)?n:r).push(e)}),[n,r]},g.first=g.head=g.take=function(e,t,i){return null==e?void 0:null==t||i?e[0]:g.initial(e,e.length-t)},g.initial=function(e,t,i){return d.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))},g.last=function(e,t,i){return null==e?void 0:null==t||i?e[e.length-1]:g.rest(e,Math.max(0,e.length-t))},g.rest=g.tail=g.drop=function(e,t,i){return d.call(e,null==t||i?1:t)},g.compact=function(e){return g.filter(e,g.identity)};var T=function(e,t,i,n){for(var r=[],o=0,s=n||0,a=E(e);a>s;s++){var l=e[s];if(M(l)&&(g.isArray(l)||g.isArguments(l))){
t||(l=T(l,t,i));var c=0,d=l.length;for(r.length+=d;d>c;)r[o++]=l[c++]}else i||(r[o++]=l)}return r};g.flatten=function(e,t){return T(e,t,!1)},g.without=function(e){return g.difference(e,d.call(arguments,1))},g.uniq=g.unique=function(e,t,i,n){g.isBoolean(t)||(n=i,i=t,t=!1),null!=i&&(i=b(i,n));for(var r=[],o=[],s=0,a=E(e);a>s;s++){var l=e[s],c=i?i(l,s,e):l;t?(s&&o===c||r.push(l),o=c):i?g.contains(o,c)||(o.push(c),r.push(l)):g.contains(r,l)||r.push(l)}return r},g.union=function(){return g.uniq(T(arguments,!0,!0))},g.intersection=function(e){for(var t=[],i=arguments.length,n=0,r=E(e);r>n;n++){var o=e[n];if(!g.contains(t,o)){for(var s=1;i>s&&g.contains(arguments[s],o);s++);s===i&&t.push(o)}}return t},g.difference=function(e){var t=T(arguments,!0,!0,1);return g.filter(e,function(e){return!g.contains(t,e)})},g.zip=function(){return g.unzip(arguments)},g.unzip=function(e){for(var t=e&&g.max(e,E).length||0,i=Array(t),n=0;t>n;n++)i[n]=g.pluck(e,n);return i},g.object=function(e,t){for(var i={},n=0,r=E(e);r>n;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},g.findIndex=t(1),g.findLastIndex=t(-1),g.sortedIndex=function(e,t,i,n){i=b(i,n,1);for(var r=i(t),o=0,s=E(e);s>o;){var a=Math.floor((o+s)/2);i(e[a])<r?o=a+1:s=a}return o},g.indexOf=i(1,g.findIndex,g.sortedIndex),g.lastIndexOf=i(-1,g.findLastIndex),g.range=function(e,t,i){null==t&&(t=e||0,e=0),i=i||1;for(var n=Math.max(Math.ceil((t-e)/i),0),r=Array(n),o=0;n>o;o++,e+=i)r[o]=e;return r};var $=function(e,t,i,n,r){if(!(n instanceof t))return e.apply(i,r);var o=S(e.prototype),s=e.apply(o,r);return g.isObject(s)?s:o};g.bind=function(e,t){if(m&&e.bind===m)return m.apply(e,d.call(arguments,1));if(!g.isFunction(e))throw new TypeError("Bind must be called on a function");var i=d.call(arguments,2),n=function(){return $(e,n,t,this,i.concat(d.call(arguments)))};return n},g.partial=function(e){var t=d.call(arguments,1),i=function(){for(var n=0,r=t.length,o=Array(r),s=0;r>s;s++)o[s]=t[s]===g?arguments[n++]:t[s];for(;n<arguments.length;)o.push(arguments[n++]);return $(e,i,this,this,o)};return i},g.bindAll=function(e){var t,i,n=arguments.length;if(1>=n)throw new Error("bindAll must be passed function names");for(t=1;n>t;t++)i=arguments[t],e[i]=g.bind(e[i],e);return e},g.memoize=function(e,t){var i=function(n){var r=i.cache,o=""+(t?t.apply(this,arguments):n);return g.has(r,o)||(r[o]=e.apply(this,arguments)),r[o]};return i.cache={},i},g.delay=function(e,t){var i=d.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},g.defer=g.partial(g.delay,g,1),g.throttle=function(e,t,i){var n,r,o,s=null,a=0;i||(i={});var l=function(){a=i.leading===!1?0:g.now(),s=null,o=e.apply(n,r),s||(n=r=null)};return function(){var c=g.now();a||i.leading!==!1||(a=c);var d=t-(c-a);return n=this,r=arguments,0>=d||d>t?(s&&(clearTimeout(s),s=null),a=c,o=e.apply(n,r),s||(n=r=null)):s||i.trailing===!1||(s=setTimeout(l,d)),o}},g.debounce=function(e,t,i){var n,r,o,s,a,l=function(){var c=g.now()-s;t>c&&c>=0?n=setTimeout(l,t-c):(n=null,i||(a=e.apply(o,r),n||(o=r=null)))};return function(){o=this,r=arguments,s=g.now();var c=i&&!n;return n||(n=setTimeout(l,t)),c&&(a=e.apply(o,r),o=r=null),a}},g.wrap=function(e,t){return g.partial(t,e)},g.negate=function(e){return function(){return!e.apply(this,arguments)}},g.compose=function(){var e=arguments,t=e.length-1;return function(){for(var i=t,n=e[t].apply(this,arguments);i--;)n=e[i].call(this,n);return n}},g.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},g.before=function(e,t){var i;return function(){return--e>0&&(i=t.apply(this,arguments)),1>=e&&(t=null),i}},g.once=g.partial(g.before,2);var A=!{toString:null}.propertyIsEnumerable("toString"),I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];g.keys=function(e){if(!g.isObject(e))return[];if(f)return f(e);var t=[];for(var i in e)g.has(e,i)&&t.push(i);return A&&n(e,t),t},g.allKeys=function(e){if(!g.isObject(e))return[];var t=[];for(var i in e)t.push(i);return A&&n(e,t),t},g.values=function(e){for(var t=g.keys(e),i=t.length,n=Array(i),r=0;i>r;r++)n[r]=e[t[r]];return n},g.mapObject=function(e,t,i){t=b(t,i);for(var n,r=g.keys(e),o=r.length,s={},a=0;o>a;a++)n=r[a],s[n]=t(e[n],n,e);return s},g.pairs=function(e){for(var t=g.keys(e),i=t.length,n=Array(i),r=0;i>r;r++)n[r]=[t[r],e[t[r]]];return n},g.invert=function(e){for(var t={},i=g.keys(e),n=0,r=i.length;r>n;n++)t[e[i[n]]]=i[n];return t},g.functions=g.methods=function(e){var t=[];for(var i in e)g.isFunction(e[i])&&t.push(i);return t.sort()},g.extend=w(g.allKeys),g.extendOwn=g.assign=w(g.keys),g.findKey=function(e,t,i){t=b(t,i);for(var n,r=g.keys(e),o=0,s=r.length;s>o;o++)if(n=r[o],t(e[n],n,e))return n},g.pick=function(e,t,i){var n,r,o={},s=e;if(null==s)return o;g.isFunction(t)?(r=g.allKeys(s),n=y(t,i)):(r=T(arguments,!1,!1,1),n=function(e,t,i){return t in i},s=Object(s));for(var a=0,l=r.length;l>a;a++){var c=r[a],d=s[c];n(d,c,s)&&(o[c]=d)}return o},g.omit=function(e,t,i){if(g.isFunction(t))t=g.negate(t);else{var n=g.map(T(arguments,!1,!1,1),String);t=function(e,t){return!g.contains(n,t)}}return g.pick(e,t,i)},g.defaults=w(g.allKeys,!0),g.create=function(e,t){var i=S(e);return t&&g.extendOwn(i,t),i},g.clone=function(e){return g.isObject(e)?g.isArray(e)?e.slice():g.extend({},e):e},g.tap=function(e,t){return t(e),e},g.isMatch=function(e,t){var i=g.keys(t),n=i.length;if(null==e)return!n;for(var r=Object(e),o=0;n>o;o++){var s=i[o];if(t[s]!==r[s]||!(s in r))return!1}return!0};var N=function(e,t,i,n){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof g&&(e=e._wrapped),t instanceof g&&(t=t._wrapped);var r=u.call(e);if(r!==u.call(t))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var o="[object Array]"===r;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(g.isFunction(s)&&s instanceof s&&g.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}i=i||[],n=n||[];for(var l=i.length;l--;)if(i[l]===e)return n[l]===t;if(i.push(e),n.push(t),o){if(l=e.length,l!==t.length)return!1;for(;l--;)if(!N(e[l],t[l],i,n))return!1}else{var c,d=g.keys(e);if(l=d.length,g.keys(t).length!==l)return!1;for(;l--;)if(c=d[l],!g.has(t,c)||!N(e[c],t[c],i,n))return!1}return i.pop(),n.pop(),!0};g.isEqual=function(e,t){return N(e,t)},g.isEmpty=function(e){return null==e?!0:M(e)&&(g.isArray(e)||g.isString(e)||g.isArguments(e))?0===e.length:0===g.keys(e).length},g.isElement=function(e){return!(!e||1!==e.nodeType)},g.isArray=h||function(e){return"[object Array]"===u.call(e)},g.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},g.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){g["is"+e]=function(t){return u.call(t)==="[object "+e+"]"}}),g.isArguments(arguments)||(g.isArguments=function(e){return g.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(g.isFunction=function(e){return"function"==typeof e||!1}),g.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},g.isNaN=function(e){return g.isNumber(e)&&e!==+e},g.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===u.call(e)},g.isNull=function(e){return null===e},g.isUndefined=function(e){return void 0===e},g.has=function(e,t){return null!=e&&p.call(e,t)},g.noConflict=function(){return r._=o,this},g.identity=function(e){return e},g.constant=function(e){return function(){return e}},g.noop=function(){},g.property=C,g.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},g.matcher=g.matches=function(e){return e=g.extendOwn({},e),function(t){return g.isMatch(t,e)}},g.times=function(e,t,i){var n=Array(Math.max(0,e));t=y(t,i,1);for(var r=0;e>r;r++)n[r]=t(r);return n},g.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},g.now=Date.now||function(){return(new Date).getTime()};var D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},k=g.invert(D),P=function(e){var t=function(t){return e[t]},i="(?:"+g.keys(e).join("|")+")",n=RegExp(i),r=RegExp(i,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(r,t):e}};g.escape=P(D),g.unescape=P(k),g.result=function(e,t,i){var n=null==e?void 0:e[t];return void 0===n&&(n=i),g.isFunction(n)?n.call(e):n};var j=0;g.uniqueId=function(e){var t=++j+"";return e?e+t:t},g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var V=/(.)^/,R={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\u2028|\u2029/g,q=function(e){return"\\"+R[e]};g.template=function(e,t,i){!t&&i&&(t=i),t=g.defaults({},t,g.templateSettings);var n=RegExp([(t.escape||V).source,(t.interpolate||V).source,(t.evaluate||V).source].join("|")+"|$","g"),r=0,o="__p+='";e.replace(n,function(t,i,n,s,a){return o+=e.slice(r,a).replace(L,q),r=a+t.length,i?o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(o+="';\n"+s+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=new Function(t.variable||"obj","_",o)}catch(a){throw a.source=o,a}var l=function(e){return s.call(this,e,g)},c=t.variable||"obj";return l.source="function("+c+"){\n"+o+"}",l},g.chain=function(e){var t=g(e);return t._chain=!0,t};var G=function(e,t){return e._chain?g(t).chain():t};g.mixin=function(e){g.each(g.functions(e),function(t){var i=g[t]=e[t];g.prototype[t]=function(){var e=[this._wrapped];return c.apply(e,arguments),G(this,i.apply(g,e))}})},g.mixin(g),g.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=s[e];g.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!==e&&"splice"!==e||0!==i.length||delete i[0],G(this,i)}}),g.each(["concat","join","slice"],function(e){var t=s[e];g.prototype[e]=function(){return G(this,t.apply(this._wrapped,arguments))}}),g.prototype.value=function(){return this._wrapped},g.prototype.valueOf=g.prototype.toJSON=g.prototype.value,g.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return g})}.call(this),function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(i,n,r){t.Backbone=e(t,r,i,n)});else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(r){}e(t,exports,n,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(function(e,t,i,n){var r=e.Backbone,o=Array.prototype.slice;t.VERSION="1.3.3",t.$=n,t.noConflict=function(){return e.Backbone=r,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s=function(e,t,n){switch(e){case 1:return function(){return i[t](this[n])};case 2:return function(e){return i[t](this[n],e)};case 3:return function(e,r){return i[t](this[n],l(e,this),r)};case 4:return function(e,r,o){return i[t](this[n],l(e,this),r,o)};default:return function(){var e=o.call(arguments);return e.unshift(this[n]),i[t].apply(i,e)}}},a=function(e,t,n){i.each(t,function(t,r){i[r]&&(e.prototype[r]=s(t,r,n))})},l=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?c(e):i.isString(e)?function(t){return t.get(e)}:e},c=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}},d=t.Events={},u=/\s+/,p=function(e,t,n,r,o){var s,a=0;if(n&&"object"==typeof n){void 0!==r&&"context"in o&&void 0===o.context&&(o.context=r);for(s=i.keys(n);a<s.length;a++)t=p(e,t,s[a],n[s[a]],o)}else if(n&&u.test(n))for(s=n.split(u);a<s.length;a++)t=e(t,s[a],r,o);else t=e(t,n,r,o);return t};d.on=function(e,t,i){return h(this,e,t,i)};var h=function(e,t,i,n,r){if(e._events=p(f,e._events||{},t,i,{context:n,ctx:e,listening:r}),r){var o=e._listeners||(e._listeners={});o[r.id]=r}return e};d.listenTo=function(e,t,n){if(!e)return this;var r=e._listenId||(e._listenId=i.uniqueId("l")),o=this._listeningTo||(this._listeningTo={}),s=o[r];if(!s){var a=this._listenId||(this._listenId=i.uniqueId("l"));s=o[r]={obj:e,objId:r,id:a,listeningTo:o,count:0}}return h(e,t,n,this,s),this};var f=function(e,t,i,n){if(i){var r=e[t]||(e[t]=[]),o=n.context,s=n.ctx,a=n.listening;a&&a.count++,r.push({callback:i,context:o,ctx:o||s,listening:a})}return e};d.off=function(e,t,i){return this._events?(this._events=p(m,this._events,e,t,{context:i,listeners:this._listeners}),this):this},d.stopListening=function(e,t,n){var r=this._listeningTo;if(!r)return this;for(var o=e?[e._listenId]:i.keys(r),s=0;s<o.length;s++){var a=r[o[s]];if(!a)break;a.obj.off(t,n,this)}return this};var m=function(e,t,n,r){if(e){var o,s=0,a=r.context,l=r.listeners;if(t||n||a){for(var c=t?[t]:i.keys(e);s<c.length;s++){t=c[s];var d=e[t];if(!d)break;for(var u=[],p=0;p<d.length;p++){var h=d[p];n&&n!==h.callback&&n!==h.callback._callback||a&&a!==h.context?u.push(h):(o=h.listening,o&&0===--o.count&&(delete l[o.id],delete o.listeningTo[o.objId]))}u.length?e[t]=u:delete e[t]}return e}for(var f=i.keys(l);s<f.length;s++)o=l[f[s]],delete l[o.id],delete o.listeningTo[o.objId]}};d.once=function(e,t,n){var r=p(_,{},e,t,i.bind(this.off,this));return"string"==typeof e&&null==n&&(t=void 0),this.on(r,t,n)},d.listenToOnce=function(e,t,n){var r=p(_,{},t,n,i.bind(this.stopListening,this,e));return this.listenTo(e,r)};var _=function(e,t,n,r){if(n){var o=e[t]=i.once(function(){r(t,o),n.apply(this,arguments)});o._callback=n}return e};d.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),i=Array(t),n=0;t>n;n++)i[n]=arguments[n+1];return p(v,this._events,e,void 0,i),this};var v=function(e,t,i,n){if(e){var r=e[t],o=e.all;r&&o&&(o=o.slice()),r&&g(r,n),o&&g(o,[t].concat(n))}return e},g=function(e,t){var i,n=-1,r=e.length,o=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++n<r;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s);return;case 3:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s,a);return;default:for(;++n<r;)(i=e[n]).callback.apply(i.ctx,t);return}};d.bind=d.on,d.unbind=d.off,i.extend(t,d);var y=t.Model=function(e,t){var n=e||{};t||(t={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var r=i.result(this,"defaults");n=i.defaults(i.extend({},r,n),r),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(y.prototype,d,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!i.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var r;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;var o=n.unset,s=n.silent,a=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={});var c=this.attributes,d=this.changed,u=this._previousAttributes;for(var p in r)t=r[p],i.isEqual(c[p],t)||a.push(p),i.isEqual(u[p],t)?delete d[p]:d[p]=t,o?delete c[p]:c[p]=t;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!s){a.length&&(this._pending=n);for(var h=0;h<a.length;h++)this.trigger("change:"+a[h],this,c[a[h]],n)}if(l)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?i.clone(this.changed):!1;var t=this._changing?this._previousAttributes:this.attributes,n={};for(var r in e){var o=e[r];i.isEqual(t[r],o)||(n[r]=o)}return i.size(n)?n:!1},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,n=e.success;return e.success=function(i){var r=e.parse?t.parse(i,e):i;return t.set(r,e)?(n&&n.call(e.context,t,i,e),void t.trigger("sync",t,i,e)):!1},G(this,e),this.sync("read",this,e)},save:function(e,t,n){var r;null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t,n=i.extend({validate:!0,parse:!0},n);var o=n.wait;if(r&&!o){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;var s=this,a=n.success,l=this.attributes;n.success=function(e){s.attributes=l;var t=n.parse?s.parse(e,n):e;return o&&(t=i.extend({},r,t)),t&&!s.set(t,n)?!1:(a&&a.call(n.context,s,e,n),void s.trigger("sync",s,e,n))},G(this,n),r&&o&&(this.attributes=i.extend({},l,r));var c=this.isNew()?"create":n.patch?"patch":"update";"patch"!==c||n.attrs||(n.attrs=r);var d=this.sync(c,this,n);return this.attributes=l,d},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,r=e.wait,o=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){r&&o(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var s=!1;return this.isNew()?i.defer(e.success):(G(this,e),s=this.sync("delete",this,e)),r||o(),s},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||q();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1):!0}});var b={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};a(y,b,"attributes");var w=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},S={add:!0,remove:!0,merge:!0},C={add:!0,remove:!1},x=function(e,t,i){i=Math.min(Math.max(i,0),e.length);var n,r=Array(e.length-i),o=t.length;for(n=0;n<r.length;n++)r[n]=e[n+i];for(n=0;o>n;n++)e[n+i]=t[n];for(n=0;n<r.length;n++)e[n+o+i]=r[n]};i.extend(w.prototype,d,{model:y,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,C))},remove:function(e,t){t=i.extend({},t);var n=!i.isArray(e);e=n?[e]:e.slice();var r=this._removeModels(e,t);return!t.silent&&r.length&&(t.changes={added:[],merged:[],removed:r},this.trigger("update",this,t)),n?r[0]:r},set:function(e,t){if(null!=e){t=i.extend({},S,t),t.parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var n=!i.isArray(e);e=n?[e]:e.slice();var r=t.at;null!=r&&(r=+r),r>this.length&&(r=this.length),0>r&&(r+=this.length+1);var o,s,a=[],l=[],c=[],d=[],u={},p=t.add,h=t.merge,f=t.remove,m=!1,_=this.comparator&&null==r&&t.sort!==!1,v=i.isString(this.comparator)?this.comparator:null;for(s=0;s<e.length;s++){o=e[s];var g=this.get(o);if(g){if(h&&o!==g){var y=this._isModel(o)?o.attributes:o;t.parse&&(y=g.parse(y,t)),g.set(y,t),c.push(g),_&&!m&&(m=g.hasChanged(v))}u[g.cid]||(u[g.cid]=!0,a.push(g)),e[s]=g}else p&&(o=e[s]=this._prepareModel(o,t),o&&(l.push(o),this._addReference(o,t),u[o.cid]=!0,a.push(o)))}if(f){for(s=0;s<this.length;s++)o=this.models[s],u[o.cid]||d.push(o);d.length&&this._removeModels(d,t)}var b=!1,w=!_&&p&&f;if(a.length&&w?(b=this.length!==a.length||i.some(this.models,function(e,t){return e!==a[t]}),this.models.length=0,x(this.models,a,0),this.length=this.models.length):l.length&&(_&&(m=!0),x(this.models,l,null==r?this.length:r),this.length=this.models.length),m&&this.sort({silent:!0}),!t.silent){for(s=0;s<l.length;s++)null!=r&&(t.index=r+s),o=l[s],o.trigger("add",o,this,t);(m||b)&&this.trigger("sort",this,t),(l.length||d.length||c.length)&&(t.changes={added:l,removed:d,merged:c},this.trigger("update",this,t))}return n?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return o.apply(this.models,arguments)},get:function(e){return null!=e?this._byId[e]||this._byId[this.modelId(e.attributes||e)]||e.cid&&this._byId[e.cid]:void 0},has:function(e){return null!=this.get(e)},at:function(e){return 0>e&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var n=t.length;return i.isFunction(t)&&(t=i.bind(t,this)),1===n||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){e=i.extend({parse:!0},e);var t=e.success,n=this;return e.success=function(i){var r=e.reset?"reset":"set";n[r](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},G(this,e),this.sync("read",this,e)},create:function(e,t){t=t?i.clone(t):{};var n=t.wait;if(e=this._prepareModel(e,t),!e)return!1;n||this.add(e,t);var r=this,o=t.success;return t.success=function(e,t,i){n&&r.add(e,i),o&&o.call(i.context,e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?i.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeModels:function(e,t){for(var i=[],n=0;n<e.length;n++){var r=this.get(e[n]);if(r){var o=this.indexOf(r);this.models.splice(o,1),this.length--,delete this._byId[r.cid];var s=this.modelId(r.attributes);null!=s&&delete this._byId[s],t.silent||(t.index=o,r.trigger("remove",r,this,t)),i.push(r),this._removeReference(r,t)}}return i},_isModel:function(e){return e instanceof y},_addReference:function(e,t){this._byId[e.cid]=e;var i=this.modelId(e.attributes);null!=i&&(this._byId[i]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var i=this.modelId(e.attributes);null!=i&&delete this._byId[i],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){if(t){if(("add"===e||"remove"===e)&&i!==this)return;if("destroy"===e&&this.remove(t,n),"change"===e){var r=this.modelId(t.previousAttributes()),o=this.modelId(t.attributes);r!==o&&(null!=r&&delete this._byId[r],null!=o&&(this._byId[o]=t))}}this.trigger.apply(this,arguments)}});var E={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};a(w,E,"models");var M=t.View=function(e){this.cid=i.uniqueId("view"),i.extend(this,i.pick(e,T)),this._ensureElement(),this.initialize.apply(this,arguments)},O=/^(\S+)\s*(.*)$/,T=["model","collection","el","id","attributes","className","tagName","events"];i.extend(M.prototype,d,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;this.undelegateEvents();for(var t in e){var n=e[t];if(i.isFunction(n)||(n=this[n]),n){var r=t.match(O);this.delegate(r[1],r[2],i.bind(n,this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e["class"]=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,n,r){var o=$[e];i.defaults(r||(r={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:o,dataType:"json"};if(r.url||(s.url=i.result(n,"url")||q()),null!=r.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),r.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){s.type="POST",r.emulateJSON&&(s.data._method=o);var a=r.beforeSend;r.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",o),a?a.apply(this,arguments):void 0}}"GET"===s.type||r.emulateJSON||(s.processData=!1);var l=r.error;r.error=function(e,t,i){r.textStatus=t,r.errorThrown=i,l&&l.call(r.context,e,t,i)};var c=r.xhr=t.ajax(i.extend(s,r));return n.trigger("request",n,c,r),c};var $={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var A=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},I=/\((.*?)\)/g,N=/(\(\?)?:\w+/g,D=/\*\w+/g,k=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(A.prototype,d,{initialize:function(){},route:function(e,n,r){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var o=this;return t.history.route(e,function(i){var s=o._extractParameters(e,i);o.execute(r,s,n)!==!1&&(o.trigger.apply(o,["route:"+n].concat(s)),o.trigger("route",n,s),t.history.trigger("route",o,n,s))}),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(k,"\\$&").replace(I,"(?:$1)?").replace(N,function(e,t){return t?e:"([^/?]+)"}).replace(D,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var P=t.History=function(){this.handlers=[],this.checkUrl=i.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},j=/^[#\/]|\s+$/g,V=/^\/+|\/+$/g,R=/#.*$/;P.started=!1,i.extend(P.prototype,d,{interval:50,atRoot:function(){var e=this.location.pathname.replace(/[^\/]$/,"$&/");return e===this.root&&!this.getSearch()},matchRoot:function(){var e=this.decodeFragment(this.location.pathname),t=e.slice(0,this.root.length-1)+"/";return t===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(j,"")},start:function(e){if(P.started)throw new Error("Backbone.history has already been started");if(P.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(V,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,r=n.insertBefore(this.iframe,n.firstChild).contentWindow;r.document.open(),r.document.close(),r.location.hash="#"+this.fragment}var o=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};return this._usePushState?o("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?o("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.options.silent?void 0:this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),P.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment?!1:(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(e){return this.matchRoot()?(e=this.fragment=this.getFragment(e),i.some(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})):!1},navigate:function(e,t){if(!P.started)return!1;t&&t!==!0||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;(""===e||"?"===e.charAt(0))&&(i=i.slice(0,-1)||"/");var n=i+e;if(e=this.decodeFragment(e.replace(R,"")),this.fragment!==e){if(this.fragment=e,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{
if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;t.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new P;var L=function(e,t){var n,r=this;return n=e&&i.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},i.extend(n,r,t),n.prototype=i.create(r.prototype,e),n.prototype.constructor=n,n.__super__=r.prototype,n};y.extend=w.extend=A.extend=M.extend=P.extend=L;var q=function(){throw new Error('A "url" property or function must be specified')},G=function(e,t){var i=t.error;t.error=function(n){i&&i.call(t.context,e,n,t),e.trigger("error",e,n,t)}};return t}),function(e){"function"==typeof require&&"undefined"!=typeof module&&module.exports?module.exports=e(require("underscore")):"function"==typeof define?define("Cocktail",["underscore"],e):this.Cocktail=e(_)}(function(e){var t={},i={boon:null};t.end_with=function(e){return[i,e]},t.mixins={},t.mixin=function(n){var r=e.chain(arguments).toArray().slice(1).flatten().value(),o=n.prototype||n,s={};return e.each(r,function(i){e.isString(i)&&(i=t.mixins[i]),e.each(i,function(t,i){if(e.isFunction(t)){if(o[i]===t)return;o[i]&&(s[i]=s.hasOwnProperty(i)?s[i]:[o[i]],s[i].push(t)),o[i]=t}else e.isArray(t)?o[i]=e.union(t,o[i]||[]):e.isObject(t)?o[i]=e.extend({},t,o[i]||{}):i in o||(o[i]=t)})}),e.each(s,function(t,n){o[n]=function(){var n=this,r=arguments,o=void 0,s=!1;return e.each(t,function(t){if(!s){var a=e.isFunction(t)?t.apply(n,r):t;"undefined"!=typeof a&&("object"==typeof a&&a[0]&&a.splice&&a[0]===i?(o="undefined"!=typeof a[1]?a[1]:o,s=!0):o=a)}}),o}}),n};var n;return t.patch=function(i){n=i.Model.extend;var r=function(e,i){var r=n.call(this,e,i),o=r.prototype.mixins;return o&&r.prototype.hasOwnProperty("mixins")&&t.mixin(r,o),r};e.each([i.Model,i.Collection,i.Router,i.View],function(i){i.mixin=function(){t.mixin(this,e.toArray(arguments))},i.extend=r})},t.unpatch=function(t){e.each([t.Model,t.Collection,t.Router,t.View],function(e){e.mixin=void 0,e.extend=n})},t});var Sm={};require(["require","jquery","Cocktail","backbone"],function(e,t,i,n){window.Sm=Sm||{};var r=document.getElementById("drag_n_drop"),o=!!r&&r.checked,s=document.getElementById("d_l"),a=document.getElementById("i_e"),l=a?a.value:!1,c=s?s.value:!1,d=document.getElementById("spwashi_config");Sm.spwashi_config=d?JSON.parse(d.textContent):{},Sm.rbt=Sm.rbt||{},Sm.CONFIG={DRAG_MODE:o,EDIT:l,DEBUG:parseInt(c)+1},Sm.loaded={_loaded:{},_unloaded:{},_waiting:{},_correct_name:function(e){return e.toLowerCase().trim().replace(/(\s|_|-)/g,"_")},_correct_dependencies:function(e){var t=[];e.constructor!==Array&&(e=[e]);for(var i=0;i<e.length;i++){var n=e[i];n=this._correct_name(n),this.is_loaded(n)||t.push(n)}return t},add:function(e,t,i){if(e=e.toLowerCase().trim(),this._loaded[e])return!0;this._loaded[e]=!0,this.resolve(e,i||!1,t);var n=this._unloaded[e],r=!1;if(n){for(var o=n.length,s=0;o>s;s++){var a=n[s];a=this._correct_name(a);var l=this._waiting[a];"object"==typeof l&&l.timeout!==!1&&(r=l.dependencies,l.dependencies=this._correct_dependencies(l.dependencies),l.dependencies.length||this.add(a,e,r))}delete this._unloaded[e]}return this._waiting[e]&&delete this._waiting[e],!0},resolve:function(e,t,i){var n=this._waiting[e];if(!n||n.timeout===!1)return!1;clearTimeout(n.timeout);var r=n.fn;delete this._waiting[e],r(t||!1)},_bb:{},when_loaded:function(e,t,i,n){var r=Sm.loaded;i&&(this._bb[i]=!0);var o=!1;return new Promise(function(s,a){o=e,e=r._correct_dependencies(e),i||(i=e.join?e.join(",")+"-boonman":e+"-boonman"),i=r._correct_name(i),r.is_loaded(i)&&s([]);var l=function(e,t){s(i,t||o||!1);var n=e(t||o||!1);return n},c=function(e){a(),Sm.CONFIG.DEBUG&&console.log("rejecting ",i," because of ",e)},d=e.indexOf(i);d>-1&&e.splice(d,1);var u=t;if("function"!=typeof t&&(t=function(){return Sm.CONFIG.DEBUG&&console.log("no_fn "+i),u}),!e.length){var p=l(t,"_");return r.add(i,"when_loaded",o),p}for(var h=0;h<e.length;h++){var f=e[h];r._unloaded[f]=r._unloaded[f]||[],r._unloaded[f].push(i)}r._waiting[i]={timeout:setTimeout(function(){var e=r._waiting[i];if(e&&e.timeout!==!1){o=e.dependencies;var n=r._correct_dependencies(e.dependencies);if(!n.length||1===n.length&&n[0]==i){var s=l(t,o);return r.add(i,"timeout",o),s}return r._waiting[i].timeout=!1,Sm.CONFIG.DEBUG&&console.log("timeout -- ",n," -- ",i),c(n)}},n||1e4),fn:l.bind(null,t,o),dependencies:e}})},is_loaded:function(e){if(e.constructor===Array){for(var t=0;t<e.length;t++){var i=e[t];if(!this.is_loaded(i))return!1}return!0}return e=e.toLowerCase().trim(),!!this._loaded[e]}},window.Sm.Extras=window.Sm.Extras||{},Sm.Extras.visual_debug=function(e,t){var i=document.getElementById("debug_el");if(i){var n=document.createElement("li");n.innerHTML=""+e,i.appendChild(n)}},window.Sm.Core={},e(["Sm-Core-Core"]),e(["tooltipster"]),e(["SmHighlight"]),e(["Cocktail"]),e(["Sm-Entities-Abstraction-SmEntity"]),e(["Sm-Entities-Abstraction-Garage"]),i.patch(n),Sm.Entities=Sm.Entities||{},Sm.Entities.Abstraction=Sm.Entities.Abstraction||{},Sm.Entities.Abstraction.mixins=Sm.Entities.Abstraction.mixins||{};var u=function(e){this.name="NonexistentModelError",this.message=e||"Model does not exist",this.stack=(new Error).stack};u.prototype=new Error,Sm.Errors={},Sm.Errors.NonexistentModelError=u,Sm.loaded.add("Errors"),Sm.CONFIG.DEBUG&&Sm.loaded.when_loaded("Core_Identifier",function(){var e=document.getElementById("debug_identifier");if(e){var t=document.getElementById("debug_identifier_button");if(t){var i=function(){var t=e.value;if(t=t.trim(),t.indexOf("MvWrapper")>-1){var i=t.split(".");i.shift(),i.length?Sm.CONFIG.DEBUG&&console.log(Sm.Core.MvWrapper[i.join(".")]):Sm.CONFIG.DEBUG&&console.log(Sm.Core.MvWrapper)}else Sm.CONFIG.DEBUG&&console.log(Sm.Core.Identifier.retrieve(t))};t.addEventListener("click",i),e.addEventListener("keyup",function(e){13==e.keyCode&&i()})}}},"Sm_debug_handler"),r&&r.addEventListener("change",function(){Sm.CONFIG.DRAG_MODE=this.checked})}),define("Sm",function(){});var initializing=!1,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,Class=function(){};if(Class.extend=function(e){function t(){!initializing&&this.init&&this.init.apply(this,arguments)}var i=this.prototype;initializing=!0;var n=new this;initializing=!1;for(var r in e)n[r]="function"==typeof e[r]&&"function"==typeof i[r]&&fnTest.test(e[r])?function(e,t){return function(){var n=this._super;this._super=i[e];var r=t.apply(this,arguments);return this._super=n,r}}(r,e[r]):e[r];return t.prototype=n,t.prototype.constructor=t,t.extend=arguments.callee,t},define("Class",[],function(){return Class}),define("Sm-Core-RelationshipIndex",["Class","Sm"],function(e){var t=window.Sm;t.Core.RelationshipIndex=e.extend({init:function(e){e=e||{},this._meta={_key:"",_index:e.index||null,_list:[]},this.parent_type=e.parent_type,this.is_reciprocal=!!e.is_reciprocal;var i=this.linked_entities=e.linked_entities||[];this.deleted_items={},this.items={},this._meta._key=e._key||(this.is_reciprocal?i[0]:i[1])||!1,this.operations={},this.contexts={},this.add_new_context(0),this.MvCombo=e.MvCombo,this.status={last_fetched:!1};var n=this;this.Identity=t.Core.Identifier.get_or_init({id:!1,ent_id:!1,type:"RelationshipIndex",Resource:n}),this.r_id_map={},this._to_delete={}},get_relationship_type_obj_index:function(){if(this.info_index)return this.info_index;var e=this._meta._index;if(!e)return{error:"No index"};var i=this.parent_type,n=t.Entities[i];if(!n)return{error:"no self Sm"};var r=n.Meta;if(!r)return{error:"No info object for type "+this.parent_type};if(!r.relationship_type_obj)return{error:"No info object relationship type obj"};if(!r.relationship_type_obj[e])return{error:"No info object for index "+e+'"'};var o=r.relationship_type_obj[e];return o.index=e,this.info_index=o,o},fetch:function(){var e=this.get_relationship_type_obj_index();if(e.error)return Promise.reject(e);var i,n=e.model_type,r=this.is_reciprocal;t.Entities[n]&&t.Entities[n].Meta&&(i=t.Entities[n].Meta.lower_plural[n]);var o=t.urls.api.generate({MvCombo:this.MvCombo,fetch:i||n,find_usages:r,relationship_type:e.index});return o&&o.length?(this.status.last_fetched=new Date,Promise.resolve($.ajax({url:o,contentType:"application/json; charset=UTF-8",method:"GET"})).then(function(e){if("object"==typeof e&&e.error&&e.error.length)throw e.error;"[object Array]"!==Object.prototype.toString.call(e)&&(e=[e]);for(var i=[],n=0;n<e.length;n++){var r=e[n];t.CONFIG.DEBUG&&console.log(r);var o=r._model_type;if(o){var s=t.Entities[o];if(s){var a=s.Wrapper.init_MvCombo({model:r});i.push(a)}}}return i})):Promise.reject({error:"No URL"})},toJSON:function(e){var i=this.get_relationship_type_obj_index();if("string"==typeof i)return Promise.reject(i);var n=this.contexts[e]||this,r=n._meta,o=n.items,s=n.operations||{},a={_meta:r,maps:{},identities:{},operations:s,context_id:e},l=this._meta._key;n._meta._index=this._meta._index;for(var c in s)if(s.hasOwnProperty(c)){var d=c in o?o:n.deleted_items,u=d[c].relationship||d[c];if(u.map){var p=u.get_Identity_at_index(l);p?(a.maps[c]=u.map,a.identities[c]=p):t.CONFIG.DEBUG&&console.log(u)}else t.CONFIG.DEBUG&&console.log(u,o,c,c in o,d[c])}return a},save:function(e){e=e||{};var i,n=e.context_id;if(i=null!==n&&"undefined"!==n?this.contexts[n]:this,!i)return Promise.reject({error:"No Context"});if(this.is_reciprocal)return Promise.resolve(!0);var r=t.urls.api.generate({MvCombo:this.MvCombo});if(!r||!r.length)return Promise.reject({error:"No URL"});var o=this;return Promise.resolve($.ajax({url:r,data:JSON.stringify(i),contentType:"application/json; charset=UTF-8",method:"PATCH"})).then(function(e){t.CONFIG.DEBUG&&console.log(e);var r,s=o.deleted_items;if("object"==typeof e){var a=(e.message,e.success,e.data);for(r in a)if(a.hasOwnProperty(r)){var l=a[r];if(l.data.map=l.data.map||{},l.success===!0||0===l.success){var c=i.items[r];c.setMap(l.data.map),i.operations[r]=[]}else r in s&&o.add_item(s[r],r,n,!1,!0)}}else for(r in s)s.hasOwnProperty(r)&&o.add_item(s[r],r,n,!1,!0);o.deleted_items={}})},add_new_context:function(e){var t=this._meta.index,i=this._meta._key,n=this;return this.contexts[e]||(this.contexts[e]={_meta:{_list:[],_index:t||null,_key:i||!1},deleted_items:{},items:{},operations:{},toJSON:n.toJSON.bind(n,e)})},locate:function(e,t){if(!e)return-1;if("string"==typeof e){var i;return i=null===t?this:this.contexts[t],t=t||0,i&&i._meta&&i._meta._list?i._meta._list.indexOf(e):-1}return e.r_id?this.locate(e.r_id,t):e.Identity?this.locate(e.Identity):-1},sort_incoming:function(e,t){},add_item:function(e,t,i,n,r){var o=e.map||{};if(!o)return!1;e.relationshipIndexRIDs.indexOf(this.Identity.r_id)<0&&e.relationshipIndexRIDs.push(this.Identity.r_id);var s=o.position||1;s=parseInt(s),n=!!n,i=i||0;var a=this.contexts[i]||this.add_new_context(i),l=!1,c=!1;this.r_id_map[e.Identity.r_id]=t,0>s&&(s=0),a._meta._list.indexOf(t)>-1&&(l=!0),this._meta._list.indexOf(t)>-1&&(c=!0);var d,u=a._meta._list.length,p=this._meta._list.length;return c||(d=s,d>p&&(d=p),!p||d>=p?this._meta._list.push(t):this._meta._list.splice(d-1,0,t)),l||(d=s,d>u&&(d=u),!u||d>=u?a._meta._list.push(t):(d||(d=1),a._meta._list.splice(d-1,0,t)),a.items[t]=e),this.items[t]=e,r||(a.operations[t]=a.operations[t]||[],a.operations[t].push("add"),this.operations[t]=this.operations[t]||[],this.operations[t].push("add")),n&&this.update_indices(i),this.sort_incoming(e,t),!0},get_listed_items:function(e){e=e||0;for(var i=this.contexts[e+""],n=i._meta._list,r=i.items,o={relationships:[],items:[],count:0},s=0;s<n.length;s++){var a=n[s];if(r[a]){var l=r[a],c=t.Core.Identifier.retrieve({r_id:a});c&&(c=c.getResource(),o.items.push(c),o.relationships.push(l))}}return o.count=o.items.length,o},update_indices:function(e){if(e||!e)return!0;if(e=e||0,!this.contexts[e])return!1;var t=this.contexts[e],i=t.items,n=(t._meta._list,[]);for(var r in i)if(i.hasOwnProperty(r)){var o=i[r],s=o.position||o.map.position||1;s&&n.push({item:o,r_id:r,position:s})}n.sort(function(e,t){return e.position-t.position});var a=n.length;a&&(t._meta._list=[]);for(var l=0;a>l;l++){var c=n[l];t._meta._list.push(c.r_id),i[c.r_id].map.position=l+1}},remove_item:function(e,t,i){var n,r=this.contexts;if(null==t){var o,s=!0;for(n in r)r.hasOwnProperty(n)&&(s=(o=this.remove_item(e,n,i))&&s);return s?o:!1}if(t=t||0,"object"==typeof e&&(e.setMap?e=this.r_id_map[e.Identity.r_id]:e.r_id&&(e=e.r_id),t=t||e.context_id||0),!this.contexts[t])return!1;var a=this.contexts[t],l=a.items,c=a._meta._list;if(!e in c)return!1;var d=this.locate(e,t);c.splice(d,1);var u=!1;for(n in r)if(r.hasOwnProperty(n)&&this.locate(e,n)>-1){u=!0;break}u&&this._meta._list.splice(this.locate(e,null),1);var p=l[e];return delete l[e],i&&this.update_indices(t),a.operations[e]=a.operations[e]||[],a.operations[e].push("delete"),u&&(this.operations[e]=this.operations[e]||[],this.operations[e].push("delete")),this.MvCombo&&e in this.MvCombo.relationship_map&&delete this.MvCombo.relationship_map[e],a.deleted_items[e]={relationship:p,index:d},p||!1},move_item:function(e,t,i,n){if(!e)return!1;i=i||0;var r=this.locate(e,i);if(-1===r)return!1;var o=this.contexts[i];return r==t?!0:(r>t?(o._meta._list.splice(r,1),o._meta._list.splice(t,1,e)):(o._meta._list.splice(t,1,e),o._meta._list.splice(r,1)),n&&this.update_indices(i),o.operations[e]=o.operations[e]||[],o.operations[e].push("move"),i||(this.operations[e]=this.operations[e]||[],this.operations[e].push("move")),!0)},has_relationships_in_context:function(e){return e=e||0,this.contexts[e]&&this.contexts[e]._meta._list.length?!0:this.status.last_fetched?!1:0}}),t.loaded.add("Core_RelationshipIndex")}),define("Sm-Core-Relationship",["Class","Sm"],function(e){Sm.Core.Relationship=e.extend({number_of_links:2,init:function(e){e=e||{},this.relationshipIndexRIDs=[],this.map=this._get_default_map_properties(),this._to_delete={},this._map_links={},this._view_associations={},this.linked_entities=e.linked_entities||this.linked_entities||["",""],this.rel_indexes=e.rel_indexes||this.rel_indexes||["",""];var t=this;this.Identity=Sm.Core.Identifier.get_or_init({type:"Relationship",Resource:t}),this.context_id=e.context_id||this.map.context_id||0},get_Identity_at_index:function(e){return this._map_links[e]||!1},setMap:function(e){return e=e||{},this.map=Sm.Core.util.merge_objects(this.map,e),this.map.id&&this.Identity.refresh({id:this.map.id}),this},toJSON:function(){return{map:this.map,_meta:this._meta}},save:function(e){var t=Sm.urls.api.generate({Relationship:this});Sm.CONFIG.DEBUG&&console.log(t);var i=this;return Promise.resolve($.ajax({url:t,data:JSON.stringify(this),contentType:"application/json; charset=UTF-8",method:this.map&&this.map.id?"PATCH":"POST"})).then(function(e){Sm.CONFIG.DEBUG&&console.log(e),e&&e.success&&e.data&&e.data.map&&(e.data.map.id&&i.setMap(e.data.map),Sm.CONFIG.DEBUG&&console.log(i.map))})},destroy:function(e){e=e||{};var t=("silent"in e?e.silent:!0,this._view_associations),i=e.secondary_key||this.rel_indexes[1];if(i&&i.length)for(var n in t)t.hasOwnProperty(n)&&(this._to_delete[n]=t[n][i]);var r=this.relationshipIndexRIDs,o=Sm.urls.api.generate({Relationship:this}),s=this;return Promise.resolve($.ajax({url:o,data:JSON.stringify(this),contentType:"application/json; charset=UTF-8",method:"DELETE"})).then(function(e){if(Sm.CONFIG.DEBUG&&console.log(e),!e||!e.success)throw e.error;for(var t=0;t<r.length;t++){var i=Sm.Core.Identifier.retrieve(r[t]);if(i){var n=i.getResource();n&&n.remove_item(s,s.context_id,!0)}}})},link_Mv:function(e,t){return e&&t?(this.linked_entities.length<2&&this.linked_entities.push(e.type),this._map_links[t]=e.Identity,this):this},get_Mv:function(e){var t=e.map_index;$.isArray(t)||(t=(t||"").split("|"));for(var i=e.SelfMvCombo?e.SelfMvCombo.Identity:e.Identity,n=0;n<t.length;n++){var r=t[n];if(r&&r.length&&this._map_links[r])return this._map_links[r].getResource()}if(i&&2==this.number_of_links){var o=this._map_links;for(var s in o)if(o.hasOwnProperty(s)&&o[s]&&o[s]!=i)return o[s].getResource()}return!1},get_map_index_of_Mv:function(e){var t=e.SelfMvCombo?e.SelfMvCombo.Identity:e.Identity;if(t&&2==this.number_of_links){var i=this._map_links;for(var n in i)if(i.hasOwnProperty(n)&&i[n]&&i[n]==t)return n}return!1},_get_default_map_properties:function(){return{id:null}},register_view_relationship:function(e){e=e||{};for(var t=this.rel_indexes,i=0;i<t.length;i++){var n=t[i];e[n]=e[n]||!1}for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];o&&o.cid&&(this._view_associations[o.cid]=e)}},getView:function(e,t,i){var n=e.cid;if(!t){var r=e.MvCombo;t=this.get_map_index_of_Mv(this.get_Mv({SelfMvCombo:r}))}if(!n||!t||i&&!this._view_associations[n])return!1;if(this._view_associations[n]&&this._view_associations[n][t])return this._view_associations[n][t];if(i)return!1;var o,s=this.rel_indexes;if(2==s.length)for(var a=0;a<s.length;a++){var l=s[a];if(l!=t){o=l;break}}if(o){var c=this.get_Mv({SelfMvCombo:e.MvCombo,map_index:t}),d={};return d[o]=e,d[t]=c.getView({reference_element:e.referenceElement,strict:i}),this.register_view_relationship(d),this.getView(e,t,!0)}return Sm.CONFIG.DEBUG&&console.log(t,o),!1}}),Sm.loaded.add("Core_Relationship")}),"undefined"==typeof global)var global="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};var raf=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;if(define("Sm-Core-util",["jquery","Sm"],function(e){Sm.Core.util={getBrowserPrefix:function(){if(!this.browserPrefix)return this.browserPrefix;var e,t,i=navigator.appName,n=navigator.userAgent,r=n.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);r&&null!=(t=n.match(/version\/([\.\d]+)/i))&&(r[2]=t[1]),r=r?[r[1],r[2]]:[i,navigator.appVersion,"-?"],r=r[0],"Chrome"==r&&(e="webkit"),"Firefox"==r&&(e="moz"),"Safari"==r&&(e="webkit"),"MSIE"==r&&(e="ms"),this.browserPrefix=e},follow_link:function(e,t){if(t)window.location=e;else{var i=window.open(e,"_blank");i.focus()}},isElement:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},merge_objects:function(e,t){var i={};if(e&&"object"==typeof e)for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);if(t&&"object"==typeof t)for(var r in t)t.hasOwnProperty(r)&&(i[r]=t[r]);return i},merge_objects_recursive:function(e,t){for(var i in t)if(t.hasOwnProperty(i))try{t[i].constructor==Object?e[i]=this.merge_objects_recursive(e[i],t[i]):e[i]=t[i]}catch(n){e[i]=t[i]}return e},switch_:function(e){for(var t=0;t<e.length;t++){var i=e[t];if(i&&"object"==typeof i){var n=i.c,r=i.f;if(n&&"function"==typeof r)return r()}}},isChildOf:function(e,t){for(;(e=e.parentNode)&&e!==t;);return!!e},insertAfter:function(e,t){t.nextSibling&&t&&e&&t.parentNode.insertBefore(e,t.nextSibling)},_recurseGetChildElements:function(t,i,n){for(var r=0;r<t.childNodes.length;r++){var o=t.childNodes[r];if(e(o).hasClass(i)){n.push(t.childNodes[r]);break}this._recurseGetChildElements(t.childNodes[r],i,n)}},getChildElementsByClassName:function(e,t){if("string"!=typeof t||!this.isElement(e))return[];var i=[];return this._recurseGetChildElements(e,t,i),i},createElement:function(e,t){var i;i=document.createElement("div"),i.innerHTML=e;var n=i.childNodes[0];return t&&document.body.appendChild(n),n},camelize:function(e,t){return e=e.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(e,t){return 0===+e?"":0==t?e.toLowerCase():e.toUpperCase()}),t?e.replace(/\b[a-z]/g,function(e){return e.toUpperCase()}):e},uc_first:function(e){return e&&e[0].toUpperCase()+e.slice(1)},isEmpty:function(t){return t=e(t),!e.trim(t.html())},hasClass:function(e,t){return this.isElement(e)?!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)")):String(e).match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},getCaretCharacterOffsetWithin:function(e){var t,i=0,n=e.ownerDocument||e.document,r=n.defaultView||n.parentWindow;if("undefined"!=typeof r.getSelection){if(t=r.getSelection(),t.rangeCount>0){var o=r.getSelection().getRangeAt(0),s=o.cloneRange();s.selectNodeContents(e),s.setEnd(o.endContainer,o.endOffset),i=s.toString().length}}else if((t=n.selection)&&"Control"!=t.type){var a=t.createRange(),l=n.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",a),i=l.text.length}return i},get_rect_width:function(e){return e.width||e.right-e.left},get_rect_height:function(e){return e.height||e.bottom-e.top},get_scroll:function(e,t){return"undefined"!=typeof global[t]?global[t]:document.clientHeight?document[e]:document.body[e]},randomString:function(e,t){t=t||"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";for(var i="",n=e;n>0;--n)i+=t[Math.floor(Math.random()*t.length)];return i},requestAnimationFrame:raf,create_animation_loop:function(e,t){function i(s){if(n!==!1){o?o(i,t):setTimeout(i,16),s=s&&s>1e4?s:+new Date;var a=s-r;160>a&&(n=e(a,s)),r=s}}var n=!0,r=+new Date,o=this.requestAnimationFrame;i()}},Sm.loaded.add("Core_util")}),require(["require","Class","Sm-Core-util"],function(e){var t=Sm.Core.util,i=Sm.Core.Identifier=Class.extend({toJSON:function(){var e=Sm.Core.util.merge_objects(this,{});return"Resource"in e&&delete e.Resource,e},init:function(e){return e=e||{},e.Resource=e.Resource||e.MvCombo||!1,this.ent_id=this.ent_id||e.ent_id||!1,this.id=this.id||e.id||!1,this.id=this.id?parseInt(this.id):!1,this.r_id=e.r_id||this.r_id||!1,this.type=this.type||e.type||i.guess_type(this.ent_id)||null,this.typed_id=this.typed_id||(this.type&&this.type.length?this.type+"|"+this.id:null),this.r_id=this.r_id||this.ent_id||this.generate_r_id(),this.Resource=this.Resource||e.Resource||null,this.ent_id||delete this.ent_id,this.id||(delete this.typed_id,delete this.id),i.register(this.r_id,this).register(this.typed_id,this).register(this.ent_id,this),this},generate_r_id:function(){return t.randomString(15)},refresh:function(e){return"object"!=typeof e?this:(!this.id&&e.id&&(e.type||this.type)&&(this.id=e.id,this.typed_id=(e.type||this.type)+"|"+this.id,i.register(this.typed_id,this)),!this.ent_id&&e.ent_id&&(this.ent_id=e.ent_id,i.register(this.ent_id,this)),(!this.Resource&&e.Resource||e.MvCombo)&&(this.Resource=e.Resource||e.MvCombo),this)},getResource:function(){return this.Resource||!1}});i.registry={},i.register=function(e,t){return e&&t&&e.length?(i.registry=i.registry||{},i.registry[e]=t,i):i},i.get_or_init=function(e){return i.retrieve(e)||new i(e)},i.is_ent_id=function(e){var t=25;return"string"==typeof e&&e.length===t&&/[0-9]{6}/.test(e.substr(4,6))},i.normalize_identifier=function(e,t){if(!e)return{};var n={};return"object"==typeof e?e:"string"==typeof e&&e.indexOf("|")?{typed_id:e}:i.is_ent_id(e)?{ent_id:e,type:t}:($.isNumeric(e)&&(n.id=parseInt(e),n.type=t,"string"==typeof t&&(n.typed_id=t+"|"+e)),n)},i.retrieve=function(e){var t,n=!1,r=i.registry;if("string"==typeof e){if(n=!0,e in r)return r[e];t=e,e={},i.is_ent_id(t)?e.ent_id=t:e.r_id=t}e=i.normalize_identifier(e,e.type||!1)||{},n&&Sm.CONFIG.DEBUG&&console.log(e);var o=e.ent_id||!1;if(t=t||e.r_id,t&&t in r)return r[t].refresh(e);if(o&&o in r)return r[o].refresh(e);var s=e.id||!1;s=s?parseInt(s):!1;var a=e.type||i.guess_type(o)||"",l=a&&a.length&&s?a+"|"+s:null;return l&&l in r?r[l].refresh(e):void 0},i.identify=function(e){var t=i.retrieve(e);return t?t.getResource():!1},i.guess_type=function(e){if(!e||!e.length)return!1;var t=e.substr(0,4);switch(t){case"sec_":return"Section";case"dim_":return"Dimension";case"page":return"Page";case"coll":return"Collection";case"dic_":return"Dictionary";default:return!1}},Sm.loaded.add("Core_Identifier")}),define("Sm-Core-Identifier",function(){}),require(["require","Class","Sm","Sm-Core-Identifier"],function(e,t){e("Sm"),e("Sm-Core-Identifier"),Sm.Core.MvWrapper=t.extend({type:null,parentType:null,init:function(e){e=e||{},this.MvMaps={loaded_MVs:{},focused_MVs:{},selected_MVs:{},active_MVs:{},destroyed_MVs:{}},this.CONFIG=e.CONFIG||{},this.CONFIG.EDIT=this.CONFIG.EDIT||Sm.CONFIG.EDIT||!1,this.CONFIG.DRAG_MODE=this.CONFIG.DRAG_MODE||Sm.CONFIG.DRAG_MODE,this.CONFIG.DEBUG=this.CONFIG.DEBUG||Sm.CONFIG.DEBUG,this._callbacks={},this.events=[],this.loaded_ent_ids={}},get_MVs:function(e){return/loaded|active|focused|selected|destroyed/.test(e)?this.MvMaps[e]:void 0},hydrate:function(e){e=e||{};var t=e.models;if(t)if(t.constructor===Array)for(var i=0;i<t.length;i++){var n=t[i];this.init_MvCombo({model:n})}else this.init_MvCombo({model:t});var r=e.elements||!1;if(!r||!r.length)return this;var o,s,a,l;for(s=0;s<r.length;s++){o=r[s],l=$(o),a=o.dataset||{id:null,ent_id:null,model:null};var c=a.model;if(c){var d=$.parseJSON(c);delete a.model;var u=this.init_MvCombo({model:d,view:o}),p=l.hasClass("active")?"active":"loaded";this.add_MV_as(p,u.Identity),"model"in o.dataset&&delete o.dataset.model}}return this},init_MvCombo:function(e){var t=e.model||e.Model||(e.id?{id:e.id}:{});t||Sm.CONFIG.DEBUG&&console.log("no mi - ",_.clone(e)),e=e||{},e.CONFIG=this.CONFIG,e.Wrapper=this,e.type=this.type;var i=e.Identifier||Sm.Core.Identifier.retrieve({id:t.id||!1,ent_id:t.ent_id||!1,MvCombo:t.MvCombo||!1,type:this.type}),n=e.model||e.Model||e;if(i&&i.r_id in this.MvMaps.loaded_MVs){var r=i.getResource();i.refresh({id:n.id||!1,ent_id:n.ent_id||!1}),r.refresh_model(n),r.setStatus("completed",!0);var o=e.View||e.view;return r.addView(o),r}var s=Sm.Entities[this.type];if(!s)return!1;e.type=this.type;var a=s.MvCombo;if(!a)return!1;var l=new a(e);if(l.type=this.type,!l.Identity)return!1;if(!l.queryStatus("init"))return!1;for(var c=["blur","destroy","focus","select","deselect","edit","activate","deactivate"],d=0;d<c.length;d++){var u=c[d],p=u+"_MV";this[p]&&l.on(u,this[p])}return l.type==this.type&&this.add_MV_as("loaded",l),l},MV_is:function(e,t){if(!t)return!1;t.Identity?t=t.Identity:t.MvCombo&&(t=t.MvCombo.Identity);var i=t.r_id;return i?(e+="_MVs",this[e]&&this[e][i]):!1},add_MV_as:function(e,t){if(!t)return this;t.Identity?t=t.Identity:t.MvCombo&&(t=t.MvCombo.Identity);var i=t.r_id;if(!i)return this;var n=Sm.Entities[this.type];n&&n.Meta&&n.Meta.add_MV_as(e,t);var r=this.MvMaps;switch(e){case"destroyed":r.destroyed_MVs[i]=!0;break;case"loaded":r.loaded_MVs[i]=t;break;case"active":case"focused":case"selected":if(!(e+"_MVs"in r))return Sm.CONFIG.DEBUG&&console.log(e,r),this;r[e+"_MVs"][i]=t,!(i in r.loaded_MVs)&&(r.loaded_MVs[i]=t)}var o=t.ent_id;if(t.getResource&&(o=o||(t.getResource()||{}).ent_id||!1),!!o&&"destroyed"!=e&&(this.loaded_ent_ids[o]=t),this.parentType){var s=Sm.Entities[this.parentType];if(!s)return this;var a=s.Wrapper;a.add_MV_as(e,t)}return this},remove_MV_as:function(e,t){if(!t)return this;t.Identity?t=t.Identity:t.MvCombo&&(t=t.MvCombo.Identity);var i=Sm.Entities[this.type];i&&i.Meta&&i.Meta.remove_MV_as(e,t);var n=t.r_id;if(!n)return this;var r=e+"_MVs",o=this.MvMaps;if(!o[r])return!1;if(n in this.MvMaps[r]&&delete this.MvMaps[r][n],"loaded"==r&&(n in this.MvMaps.active_MVs&&delete this.MvMaps.active_MVs[n],n in this.MvMaps.selected_MVs&&delete this.MvMaps.selected_MVs[n],n in this.MvMaps.focused_MVs&&delete this.MvMaps.focused_MVs[n]),this.parentType){var s=Sm.Entities[this.parentType];if(!s)return this;var a=s.Wrapper;a.remove_MV_as(e,t)}return!0},get_arbitrary:function(){var e=this.MvMaps.loaded_MVs;for(var t in e)if(e.hasOwnProperty(t))return e[t].getResource();return!1},focus_MV:function(e){e=e||{};var t=e.MvCombo,i=(this.MvMaps.focused_MVs,e.View);if(this.MV_is("focused",t))return new Promise(function(e){e()});this.blur_MV(),i&&i.focus(),this.add_MV_as("focused",{MvCombo:t});var n=new Promise(function(e){e()});return n},activate_MV:function(e){e=e||{};var t=e.MvCombo;t&&this.add_MV_as("active",{MvCombo:t});var i=new Promise(function(e){e()});return i},select_MV:function(e){e=e||{};var t=e.MvCombo;t&&this.add_MV_as("selected",{MvCombo:t});var i=new Promise(function(e){e()});return i},deselect_MV:function(e){e=e||{};var t=e.MvCombo;t&&this.remove_MV_as("selected",{MvCombo:t});var i=new Promise(function(e){e()});return i},blur_MV:function(e){e=e||{};var t=e.MvCombo;if(t&&this.remove_MV_as("focused",{MvCombo:t}),!t){var i=this.MvMaps.focused_MVs;for(var n in i)if(i.hasOwnProperty(n)){var r=i[n],o=r.getResource();o.blur()}}var s=new Promise(function(e){e()});return s},deactivate_MV:function(e){e=e||{};var t=e.MvCombo;t&&this.remove_MV_as("active",{MvCombo:t});var i=new Promise(function(e){e()});return i},build_MV:function(e){e=e&&"object"==typeof e?e:{};var t=!!e.prompt;return t?this._prompt_build_MV(e):this._continue_build_MV(e)},destroy_MV:function(e){if(!e)return Promise.reject();var t=this.MvMaps;return this.add_MV_as("destroyed",e),this.remove_MV_as("loaded",e),Sm.CONFIG.DEBUG&&console.log(t,t.destroyed_MVs),Promise.resolve(!0)},_prompt_build_MV:function(e){e=e||{};Promise.reject();return this._continue_build_MV(e)},_continue_build_MV:function(e){e=e||{};var t=this,i=Sm.Entities[this.type];if(!i)return Promise.reject("No SmType to accompany "+this.type);var n=i.Model;if(!n)return Promise.reject("No Model type");var r=new n({});r.type=this.type;var o=Sm.Core.util.merge_objects(r.attributes,e.model_properties||{});return r.set(o),Promise.resolve(r.save()).then(function(i){if(i.success=i.success||!1,!i.success)throw i.message||"Unknown error occurred";i.data=i.data||{};var n=t.init_MvCombo({Wrapper:t,model:i.data.model,CONFIG:t.CONFIG});return n?(n.getView({}).render(),t.add_MV_as("loaded",{MvCombo:n,id:r.get("id"),ent_id:r.get("ent_id")}),e.MvCombo=n,n):Promise.reject("No new Mv")})}}),Sm.Core.MvWrapper.replacements={replaced_MVs:{},replacement_MVs:{}},Sm.Core.MvWrapper.convert_to_MvCombo=function(e){if(!e)return!1;if(e.constructor==Array)return e.map(function(e){return Sm.Core.MvWrapper.convert_to_MvCombo(e)});if(e.r_id&&(e=e.r_id),e.Identity&&(e=e.Identity.r_id),"string"==typeof e){if(e in Sm.Core.Meta.MvMaps.loaded_MVs)return Sm.Core.Meta.MvMaps.loaded_MVs[e].getResource();var t=Sm.Core.Identifier.retrieve(e);if(!t)return!1;var i=t.getResource();if(!i)return!1;if(i.addView)return i;if(i.MvCombo)return i.MvCombo}return!1},Sm.Core.MvWrapper.get_effective_MV=function(e,t,i,n){n=n||{};var r=Sm.Core.MvWrapper;t=!!t;var o;if("string"==typeof e)o=e;else{var s=r.convert_to_MvCombo(e);if(!s)return i?!1:{MVs:e,replacement_indices:{}};o=s.Identity.r_id}var a,l=t?r.replacements.replacement_MVs:r.replacements.replaced_MVs,c=l[o];if(a=c?c.MVs:!1,!a||!a.length||1===a.length&&a[0]==o)return i?!1:{MVs:[o],replacement_indices:{}};var d,u=c.replacement_indices;for(var p in u)u.hasOwnProperty(p)&&(d||(d=u[p]));for(var h=[],f={},m=0;m<a.length;m++){var _=a[m];if(n[_])delete l[o],a.splice(m,1),m--;else{n[_]=n;var v=Sm.Core.MvWrapper.get_effective_MV(_,t,!0,n);if(v||f[_]){var g=v.MVs,y=v.replacement_indices;if(!d)for(var b in y)y.hasOwnProperty(b)&&(d||(d=y[b]));for(var w=0;w<g.length;w++){var S=g[w];f[S]||S==o||(f[S]=!0,h.push(S))}}else{if(_==o)continue;h.push(_),f[_]=!0}}}return{MVs:h,replacement_indices:d}},Sm.Core.MvWrapper.register_MV_replacement=function(e,t,i){if(!i)return!1;if(!t||!e)return!1;var n=Sm.Core.MvWrapper;e.Identity&&(e=[e.Identity.r_id]),t.Identity&&(t=[t.Identity.r_id]),e=e.sort(),t=t.sort();var r={},o={},s=n.replacements.replaced_MVs,a=n.replacements.replacement_MVs,l=e.join(","),c=t.join(","),d=[];for(var u in s)if(s.hasOwnProperty(u)){var p=s[u].MVs.join(",");l==p&&t.indexOf(u)>-1&&(delete s[u],d.push(u))}var h=d.join(",");if(h==c){for(var f=0;f<e.length;f++){var m=e[f];a[m]&&delete a[m]}d=!1}if(!d)return!0;for(var _,v=0;v<e.length;v++){_=e[v],o[_]=i;var g=n.get_effective_MV(_,!1,!0),y=g?g.MVs:!1;if(y)Sm.CONFIG.DEBUG&&console.log("reps",y),n.register_MV_replacement(y,t,i);else{var b=t.indexOf(_);_>0&&t.splice(b,1),t.length?s[_]={MVs:t,replacement_indices:r}:s[_]&&delete s[_];
}}var w=[];t.forEach(function(e){r[e]=i;var t=n.get_effective_MV(e),o=t.MVs;if(o)for(var s=0;s<o.length;s++){var a=o[s];w.push(a)}else w.push(e)});for(var S=0;S<w.length;S++)_=w[S],a[_]={MVs:e,replacement_indices:o};return!0},Sm.loaded.when_loaded("Core_Identifier",function(){Sm.loaded.add("Core_MvWrapper")},"Core_MvWrapper")}),define("Sm-Core-MvWrapper",function(){}),define("Emitter",["Class"],function(e){var t=Array.prototype.slice,i=e.extend({init:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.events=[],this._callbacks={}},on:function(e,t){return!this._callbacks&&(this._callbacks={}),!this._callbacks[e]&&(this._callbacks[e]=[]),"function"==typeof t&&this._callbacks[e].push(t),this},off:function(e,t){if(!this._callbacks||0===arguments.length)return this._callbacks={},this;var i=this._callbacks[e];if(!i)return this;if(1===arguments.length)return delete this._callbacks[e],this;var n,r,o,s;for(n=r=0,o=i.length;o>r;n=++r)if(s=i[n],s===t){i.splice(n,1);break}return this},emit:function(e){for(var t=this._prepare_event.apply(this,arguments),i=0;i<t.length;i++){var n=t[i];n()}return this},_prepare_event:function(e){var i=arguments.length>=2?t.call(arguments,1):[];if(!this._callbacks)return this._callbacks={},[];var n,r=this._callbacks[e],o=[];if(r)for(var s=0,a=r.length;a>s;s++)n=r[s],n&&(o[s]=Function.prototype.bind.apply(n,[this].concat(i)));return o||[]},resolve:function(e){var t=0;return Promise.all(this._prepare_event.apply(this,arguments).map(function(e){return t++,e?e():!1})).then(function(e){return 1===t?e[0]:e})},removeListener:function(e,t){this.off(e,t)},removeAllListeners:function(){this.off()},add_bound:function(e,t,i){return this._fns=this._fns||{},"function"!=typeof t?(Sm.CONFIG.DEBUG&&console.log(e,t),function(){}):this._fns[e]=this._fns[e]||t.bind(i||this)},get_bound:function(e){return this._fns[e]?this._fns[e]:function(){}.bind(this)}});return i}),require(["require","Sm","Sm-Core-util","Emitter"],function(e){var t=e("Emitter");Sm.Core.MvCombo=t.extend({init:function(e){this.type=e.type||this.type||"MvCombo",this.object_type="MvCombo",e=e||{},this._callbacks={},this.status={},this._relationships_to_add=null,this._permissions={},this.Views={},this.ViewMaps={selected_Views:{},active_Views:{},focused_Views:{}},this.ViewList=[],this.defaultViewList=[],this.Model=null,this.relationship_map={},this.relationships={},this.reciprocal_relationships={},this.relationships=this._create_relationship_holder()||{},this.reciprocal_relationships=this._create_relationship_holder(!0)||{},this.CONFIG=Sm.CONFIG,this.Wrapper=e.Wrapper||null,this.addView(e.view||e.View||null);var t=e.model||e.Model||null;t=this.Model=this._initModel(t);var i=this,n=this.type||e.type;this._cache={ids:{}};var r=this.Identity=e.Identifier||Sm.Core.Identifier.get_or_init({id:t.id||e.id||!1,ent_id:t.ent_id||e.ent_id||!1,type:n,Resource:i});this.Model.Identity=r;var o=function(e){return function(){e._prepare_known_relationships(e._relationships_to_add),!Sm.CONFIG.DEBUG&&(e._relationships_to_add=null)}}(this);Sm.loaded.is_loaded("entities_"+this.type)?o():Sm.loaded.when_loaded(["entities_"+this.type],o,"prepare_"+r.ent_id+"_relationships");var s=function(e){return function(){return i._cache.ids[e]?i._cache.ids[e]:i._cache.ids[e]=i.Identity&&i.Identity[e]?i.Identity[e]:!1}};Object.defineProperties(i,{ent_id:{get:s("ent_id")},id:{get:s("id")},r_id:{get:s("r_id")}}),this.ent_id&&this.setStatus("has_ent_id",!0),this.setStatus("completed",!!(r.id&&r.ent_id&&r.ent_id.length));var a=this.add_bound("_destroy",this.destroy),l=this.add_bound("_focus",this.focus);this.on("destroy",a).on("focus",l),this.setStatus("init",!0)},_create_relationship_holder:function(e){var t={};if(!Sm.Entities[this.type])return!1;var i=Sm.Entities[this.type].Meta;if(!i)return!1;var n=i.relationship_type_obj;if(!n)return!1;var r=this.type,o=this;e=!!e;for(var s=e?i.reciprocal_relationship_type_list:i.relationship_type_list,a=0;a<s.length;a++){var l=s[a];if(n.hasOwnProperty(l)){var c=n[l];if(!c.is_only_reciprocal||e){var d=i.get_relationship_type({type:"index"},l),u=!1;Sm.Entities[this.type].Abstraction&&Sm.Entities[this.type].Abstraction.Relationship&&(u=Sm.Entities[this.type].Abstraction.Relationship[d+"_RelationshipIndex"]),u=u||Sm.Core.RelationshipIndex,t[l]=new u({_key:e?c.primary_key:c.secondary_key,is_reciprocal:e,index:d,parent_type:r,linked_entities:c.linked_entities,MvCombo:o})}}}return t},_initModel:function(e){var t=Sm.Entities[this.type];if(!t)return!1;var i=t.Model;if(!i)return!1;var n,r;if(e instanceof i)e.MvCombo=this,n=e.get("id"),r=e.get("ent_id");else{"string"==typeof e?e=$.parseJSON(e):e||(e={});var o={};if(n=e.id,r=e.ent_id,e.id&&(o=_.clone(e)),o._permissions){var s=o._permissions;this.setPermission(s)}o.relationships&&o.relationships&&(this._relationships_to_add=o.relationships,delete o.relationships),o.MvCombo=this,e=new i(o),e.MvCombo=this}return this.id=n||!1,this.ent_id=r||!1,e||{}},refresh_model:function(e){e=e||{};var t=this.Model;e._permissions&&(this.setPermission(e._permissions),delete e._permissions),t.set(e,{silent:!0})},setPermission:function(e,t){if("string"==typeof e)this._permissions[e]=t;else if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&this.setPermission(i,e[i])},queryPermission:function(e){return e&&this._permissions[e]?this._permissions[e]:null},setStatus:function(e,t){if("string"==typeof e)this.status[e]=t;else if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&this.setStatus(i,e[i])},queryStatus:function(e){return e&&this.status[e]?this.status[e]:null},_prepare_known_relationships:function(e){e=e||{};var t=this.type;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if(n&&"object"==typeof n)if(n._meta){if(n.items){var r=n.items;for(var o in r)if(r.hasOwnProperty(o)&&$.isNumeric(o)){var s=r[o];if(s&&"object"==typeof s){var a=s._map||!1;if(a){var l,c=s.model;if(c&&c._model_type&&(l=c._model_type),!l&&n._meta._linked_entities){var d=n._meta._linked_entities;if(1===d.length)l=d[0];else{l=d[0];for(var u=0;u<d.length;u++){var p=d[u];p!=t&&(l=p)}}}if(l){var h=this,f=function(e,t,i,n,r,o){return function(){var s=Sm.Entities[e];if(!s)return void(Sm.CONFIG.DEBUG&&console.log("mvcombo,pkn,wlfn,omt",Sm.Entities,e));var a=s.Wrapper;if(!a)return void(Sm.CONFIG.DEBUG&&console.log("mvcombo,pkn,wlfn,owt",Sm.Entities,e));var l=a.init_MvCombo({model:t,id:i});l&&l.Identity&&Sm.loaded.when_loaded(["entities_"+n.type,"entities_"+l.type],function(){n.add_relationship(l,{map:r,relationship_index:o,position:r.position||1,silent:!0})["catch"](function(e){Sm.CONFIG.DEBUG&&console.log(e)})},"add_rel_to_"+n.type)}}(l,c,o,h,a,i);Sm.loaded.is_loaded("entities_"+l)?f():Sm.loaded.when_loaded("entities_"+l,f,"add_rel_to_other_")}else Sm.CONFIG.DEBUG&&console.log("mvcombo,pkn,omt",c)}else Sm.CONFIG.DEBUG&&console.log("mvcombo,pkn,nomap,",s)}}}}else Sm.CONFIG.DEBUG&&console.log("mvcombo,pkn,0-",n);else Sm.CONFIG.DEBUG&&console.log("mvcombo,pkn,-1",n)}return e},addView:function(e,t,i){i=i||{};var n=Sm.Entities[this.type],r=n.View;if(!r)return!1;var o=this,s=this.Model;if(e&&"object"==typeof e&&e.cid){if(!t&&document.body.contains(e.el.parentNode)&&(t=e.el.parentNode),e.referenceElement=t||e.referenceElement||!1,this.ViewList.indexOf(e.cid)>-1){var a=this.defaultViewList.indexOf(e.cid);return a>-1&&this.defaultViewList.splice(a,1),e}e.model=s,e.MvCombo||e.setMvCombo(o)}else{var l={model:s,el:!1,display_type:i.display_type||"full"};if(Sm.Core.util.isElement(e))l.el=e,e=new r(l),e.setMvCombo(o),e.referenceElement||(!t&&document.body.contains(e.el.parentNode)&&(t=e.el.parentNode),e.referenceElement=t||!1),this.defaultViewList&&this.defaultViewList.length&&this.removeView(this.defaultViewList[0]);else{if(!this.defaultViewList&&(this.defaultViewList=[]),this.defaultViewList.length)return this.defaultViewList[0];if(e=new r(l),t&&this.ViewList.length)for(var c=!1,d=this.ViewList,u=0;u<d.length;u++){var p=d[u],h=this.Views[p];if(h.referenceElement==t)return c=!0,h}this.defaultViewList.push(e.cid),e.setMvCombo&&e.setMvCombo(o),!t&&document.body.contains(e.el.parentNode)&&(t=e.el.parentNode),e.referenceElement=t}}return this.ViewList.indexOf(e.cid)>-1||(this.Views[e.cid]=e,this.ViewList.push(e.cid)),e},removeView:function(e){e in this.Views&&delete this.Views[e];var t;this.defaultViewList&&(t=this.defaultViewList.indexOf(e))>-1&&this.defaultViewList.splice(t,1),this.ViewList&&(t=this.ViewList.indexOf(e))>-1&&this.ViewList.splice(t,1)},getView:function(e){e=e||{};var t,i=e.cid||!1,n=e.reference_element||!1,r=!!e.strict,o=e.display_type;if(i){if(this.Views[i])return this.Views[i];if(r)return!1}var s=!1;if(n&&this.ViewList.length){var a=!1,l=this;if(this.forEachView(function(){r&&l.defaultViewList.indexOf(this.cid)>=0||(t||this.referenceElement!=n||(t=this),this.referenceElement||(a=this))}),t)s=t;else{if(t||r)return!1;s=a?a:this.addView(null,n,{display_type:o})}}return s=s?s:this.addView(null,n,{display_type:o}),"string"==typeof s?this.getView({cid:s,strict:!0}):s},forEachView:function(e,t){if("function"==typeof e)for(var i=this.ViewList,n=0;n<i.length;n++){var r=i[n];!!this.Views[r]&&e.apply(this.Views[r],t)}},focus:function(e,t){this.do_standard_interaction("focus",e,t)},blur:function(e,t){this.do_standard_interaction("blur",e,t)},activate:function(e,t){this.do_standard_interaction("activate",e,t)},select:function(e,t){this.do_standard_interaction("select",e,t)},deselect:function(e,t){this.do_standard_interaction("deselect",e,t)},deactivate:function(e,t){this.do_standard_interaction("deactivate",e,t)},do_standard_interaction:function(e,t,i){e=e||"focus";var n,r=!1,o=e,s=e;switch(e){case"blur":r=!0;case"focus":s="focus",o="focused_Views",n="focused";break;case"deselect":r=!0;case"select":s="select",o="selected_Views",n="selected";break;case"deactivate":r=!0;case"activate":s="activate",o="activated_Views",n="active";break;default:return!1}2!=arguments.length&&"undefined"!=typeof i||"object"!=typeof t||!t.cid||(i=t);var a=this.type,l=this.Wrapper||Sm.Entities[a].Wrapper,c=this,d={MvCombo:c};this.ViewMaps[o]=this.ViewMaps[o]||{};var u=this.ViewMaps[o],p=0;for(var h in u)u.hasOwnProperty(h)&&p++;var f=function(){if(this[e]){var t=this.queryPermission(s);if(null===t&&(t=this.queryPermission("view")),!t&&null!==t)return Sm.CONFIG.DEBUG&&console.log(s,t),!1;if("focus"==e&&i&&i!=this)return c.blur(this);r?u[this.cid]&&(p--,delete u[this.cid]):(u[this.cid]=this.Identity,p++),this[e]()}};if(i?f.call(i):this.forEachView(f),this.queryStatus(n)!==!!p&&(this.setStatus(n,!!p),l[e+"_MV"])){if("focus"==e){var m=l.MvMaps.focused_MVs;for(var _ in m)if(m.hasOwnProperty(_)&&_!=this.Identity.r_id){var v=m[_].getResource();v&&v.blur()}}l[e+"_MV"](d)}},getRelationship:function(e){if(!e)return!1;e.Identity&&(e=e.Identity);var t="string"==typeof e?e:e.r_id;return this.relationship_map[t]||!1},_get_relationship_details:function(e){e=e||{};var t,i,n,r=e.MvCombo,o=r.type,s=this.type,a=!!e.is_reciprocal,l=e.map||{},c=o.toLowerCase(),d=this._relationship_detail_hook(o,e,l,c),u=!!d.reciprocity_matters,p=d.self_index,h=d.other_index;return a&&u?(t=h,i=p):(t=p,i=h),t&&i&&(n=new Sm.Core.Relationship({linked_entities:[s,o],rel_indexes:[t,i]}),l[t]=this.Identity.id,l[i]=r.Identity.id),{relationship:n||!1,self_map_index:t||!1,secondary_map_index:i||!1}},_relationship_detail_hook:function(e,t,i,n){var r=!1,o=n+"_id",s=this.type.toLowerCase()+"_id";return o==s&&(r=!0,t.is_reciprocal?(s="secondary_"+s,o="primary_"+o):(s="primary_"+s,o="secondary_"+o)),{map:i,reciprocity_matters:r,self_index:s,other_index:o}},add_relationship:function(e,t,i){this.relationship_map=this.relationship_map||{},t=t||{};var n=!!t.silent,r=t.map||{},o=t.relationship_index,s=t.prompt||!e||!o,a="undefined"!=typeof t.update_indices?!!t.update_indices:!0;if(s)return this._prompt_relationship_add(e,t);var l=!!t.is_reciprocal,c=!1,d=this.type,u=Sm.Entities[d];if(e&&e.r_id&&e.getResource&&(e=e.getResource()),!u)throw"No Sm for "+this.type;var p;if(p=u.Meta,!p)throw"No Meta for "+this.type+" trying to add relationship";p.relationship_aliases[o]&&(o=p.relationship_aliases[o]);var h=p.get_possible_relationship_indices({is_reciprocal:l,OtherMvCombo:e});if(1==h.length)o||(o=h[0]);else if(h.length&&!h[0]){o=o||h[1];var f=p.get_possible_relationship_indices({is_reciprocal:!l,OtherMvCombo:e});l&&null===h[0]&&f.length&&1==f.length&&(c=f[0])}if(!u)throw"No Sm for "+this.type;if(!p)throw"No Meta for "+this.type+" trying to add relationship";if(!r)throw"No Map for "+this.type;if(!o)throw"No RelationshipIndex for "+this.type;if(!e)throw"No OtherMvCombo for "+this.type;0===o.indexOf("reciprocal_")&&(l=!0,t.relationship_index=o=o.split("_")[1]);var m=l?this.reciprocal_relationships:this.relationships,_=l?this.relationships:this.reciprocal_relationships,v=m[o];if(!e.Identity)return Promise.reject("There is no Identity to accompany the MvCombo");if(!v)return Promise.reject("No relationship index to match "+o+" in "+this.type);var g,y=this,b={result:!1,SelfMvCombo:y,OtherMvCombo:e,RelationshipIndex:v,OtherView:t.OtherView,map_indices:[]};if(c&&(g=_[c]),i)return b.result=!!v.add_item(i,e.Identity.r_id,t.context_r_id||0,a,n),g&&g.add_item(i,e.Identity.r_id,t.context_r_id||0,a,n),this.relationship_map[e.Identity.r_id]=this.relationship_map[e.Identity.r_id]||[],this.relationship_map[e.Identity.r_id].push(i),b.Relationship=i,Promise.resolve(b);var w=this._get_relationship_details({map:r,MvCombo:e,is_reciprocal:l,relationship_index:o}),S=w.relationship||new Sm.Core.Relationship,C=w.self_map_index,x=w.secondary_map_index;if(e.Identity===this.Identity){var E=this.Identity.ent_id;return Sm.CONFIG.DEBUG&&console.log(E,arguments),Promise.reject("Cannot add the same MV - ::"+E)}r.position=t.position||r.position,S.setMap(r).link_Mv(this,C).link_Mv(e,x),b.Relationship=S,b.map_indices=[C,x];var M=b.result=!!v.add_item(S,e.Identity.r_id,t.context_r_id||0,a,n);return g&&g.add_item(S,e.Identity.r_id,t.context_r_id||0,a,n),t.is_reciprocal=!l,this.relationship_map[e.Identity.r_id]=this.relationship_map[e.Identity.r_id]||[],this.relationship_map[e.Identity.r_id].push(S),e.add_relationship(this,t,S).then(function(e){if(y.emit("add_relationship",b),M&&e.result)return b;throw Sm.CONFIG.DEBUG&&console.log(e,M),"Could not add relationship index"})},_build_other_MV:function(e,t){return e.build_MV(t)},_prompt_relationship_add:function(e,t){t=t||{},t.map=t.map||{},t.position=t.map.position=t.position||t.map.position;var i=this;t.prompt=!1,i.blur();var n,r=new Promise(function(e,t){var r=i,o=Sm.Entities[i.type].Abstraction&&Sm.Entities[i.type].Abstraction.Modal&&Sm.Entities[i.type].Abstraction.Modal.AddRelationship?Sm.Entities[i.type].Abstraction.Modal.AddRelationship:Sm.Entities.Abstraction.Modal.AddRelationship;n=new o({MvCombo:[r],self_type:r.type,display_type:"full",promise_object:{resolve:e,reject:t}});try{n.open()}catch(s){Sm.CONFIG.DEBUG&&console.log("core_MvCombo,pra,-1",s)}}),o=Sm.Entities[this.type];if(!o)return Promise.reject("No SM");var s=o.Meta,a=!1;return Sm.CONFIG.DEBUG&&console.log(arguments),r["catch"](function(e){throw Sm.CONFIG.DEBUG&&console.log("core_MvCombo,pra,0",e),e}).then(function(e){t.map=t.map||{},t.map.relationship_subtype=s.get_relationship_type({type:"id",sub:!0},e.relationship_subindex);var i=e.relationship_index||!1;return(0===i.indexOf("reciprocal_")||0===i.indexOf("!"))&&(i=i.replace("reciprocal_","").replace("!",""),a=!0),t.relationship_index=s.get_relationship_type({type:"index"},i),t.OtherMvComboType=s.get_relationship_type({type:"model_type"},i),e.relationship_subindex&&delete e.relationship_subindex,e.relationship_index&&delete e.relationship_index,t.position=parseInt(e.position||0),t.map=Sm.Core.util.merge_objects(t.map,e),t})["catch"](function(e){throw Sm.CONFIG.DEBUG&&console.log("core_MvCombo,pra,1",e),e}).then(function(r){Sm.CONFIG.DEBUG&&console.log(r,a);var o,s=r.OtherMvComboType||!1;if(e)o=Promise.resolve(e);else{var l=Sm.Entities[s];o=l&&l.Wrapper?i._build_other_MV(l.Wrapper,t):Promise.reject("Could not resolve the MvCombo type "+s)}return n&&n.close(),o.then(function(e){return Sm.CONFIG.DEBUG&&console.log("core_MvCombo,pra,1.5",e),r&&a?(Sm.CONFIG.DEBUG&&console.log(r,e),e.add_relationship(i,r)):i.add_relationship(e,r)})})["catch"](function(e){throw Sm.CONFIG.DEBUG&&console.log("core_MvCombo,pra,2",e),e})},_prompt_destroy:function(e){var t,i=this,n=new Promise(function(n,r){var o=i,s=Sm.Entities[i.type].Abstraction&&Sm.Entities[i.type].Abstraction.Modal&&Sm.Entities[i.type].Abstraction.Modal.Destroy?Sm.Entities[i.type].Abstraction.Modal.Destroy:Sm.Entities.Abstraction.Modal.Destroy;t=new s({MvCombo:[o],self_type:o.type,display_type:e.display_type,promise_object:{resolve:n,reject:r}}),t.open()});return n["catch"](function(e){throw Sm.CONFIG.DEBUG&&console.log("core_MvCombo,destroy",e),e}).then(function(n){return Sm.CONFIG.DEBUG&&console.log(n),t.close(),i._continue_destroy(e)})["catch"](function(e){throw t.close(),Sm.CONFIG.DEBUG&&console.log(e),Sm.CONFIG.DEBUG&&console.log("Rejected the promise"),e})},_prompt_save:function(e){return confirm("Are you sure you want to save "+this.type+" "+this.Identity.ent_id)?this._continue_save(e):Promise.reject("Canceled save")},_continue_save:function(e){var t=this.Model;if(!t)return Promise.reject(Sm.Errors.NonexistentModelError);var i=t.save(null,{patch:!0,wait:!0,silent:!!e.silent}).then(function(e){return Sm.CONFIG.DEBUG&&console.log(e),e});return i?i:Promise.reject("Could not save the model")},_continue_destroy:function(e){var t=this.Model;if(!t)return Promise.reject(Sm.Errors.NonexistentModelError);var i=Sm.Entities[this.type].Wrapper,n=t.destroy(),r=this;return(n?n:Promise.reject()).then(function(e){if(e&&e.success)return e;throw e.error}).then(i.destroy_MV.bind(i,this)).then(function(){r.setStatus("destroyed",!0)})},save:function(e){try{e=e||{};var t=!!e.prompt,i=Sm.Entities[this.type].Wrapper;return i?t?this._prompt_save(e):this._continue_save(e):Promise.reject("No Wrapper to match "+this.type)}catch(n){return Sm.CONFIG.DEBUG&&console.log(n),Promise.reject(n)}},destroy:function(e,t){var i=!!e.prompt,n=(Sm.Entities[this.type].Wrapper,this);return Sm.Entities[this.type].Wrapper?(i?this._prompt_destroy({View:t}):this._continue_destroy(e)).then(function(e){return n.forEachView(function(){this.destroy()}),e}):Promise.reject("No Wrapper to match "+this.type)},fetch:function(){var e=this.Identity,t=this.type,i=Sm.Entities[this.type].Wrapper;return Promise.resolve($.ajax({method:"GET",url:Sm.urls.api.generate({type:t,MvCombo:this,id:e.id})})).then(function(e){if(e&&e.success){var t=i.init_MvCombo({model:e.data});return Promise.resolve(t)}return Promise.reject("Could not save model")})["catch"](function(e){Sm.CONFIG.DEBUG&&console.log(e)})},getRelationshipIndex:function(e,t){t=!!t,e.indexOf("reciprocal")>-1&&(t=!0,e=e.replace("reciprocal_",""),Sm.CONFIG.DEBUG&&console.log(e));var i=t?this.reciprocal_relationships:this.relationships;return i[e]?i[e]:!1},toJSON:function(){var e=this.Model;return e.attributes}}),Sm.Core.MvCombo.replace_MV=function(e){var t,i,n,r=e.MvCombo,o=e.replace_effective,s=!!e.is_reciprocal,a=e.relationship,l=e.list_items_fn||function(){};e.replaced_MVs=e.replaced_MVs||[],e.replacement_MVs=e.replacement_MVs||[],e.items=e.items||{};var c=e.is_not_first||!1,d=e.replaced_relationships||[],u=e.replacement_relationships||[],p=function(t){var i={items:e.items,replacement_MVs:s?e.replaced_MVs:e.replacement_MVs,replaced_MVs:s?e.replacement_MVs:e.replaced_MVs,replacement_relationships:s?d:u,replaced_relationships:s?u:d};if(t&&!c){if(o&&i.replaced_MVs.length>1){var n=r.r_id,a=i.replaced_MVs.indexOf(n);a>-1&&(i.replaced_MVs.splice(a,1),i.replaced_relationships.splice(a,1))}Sm.Core.MvWrapper.register_MV_replacement(i.replaced_MVs,i.replacement_MVs,e.replacement_indices)}return Promise.resolve(i)};if(e.iterations>10)return p();var h=l(r,s,p()),f=h.relationships||[],m=h.items||[];if(n=s?e.replaced_MVs:e.replacement_MVs,i=s?e.replacement_MVs:e.replaced_MVs,t=s?u:d,o){e.replace_effective=!1;for(var _=Sm.Core.MvWrapper.get_effective_MV(r),v=_.MVs,g=0;g<v.length;g++){var y=v[g];e.items[y]||(i.push(y),e.items[y]=Sm.Core.MvWrapper.convert_to_MvCombo(y),t.push(a||null))}}else e.items[r.r_id]=r,i.push(r.r_id),t.push(a||null);for(var b=[],w=0;w<m.length;w++){var S=m[w];n.indexOf(S.Identity.r_id)<0&&(e.MvCombo=S,e.is_reciprocal=!s,e.relationship=f[w],e.is_not_first=!0,b.push(Sm.Core.MvCombo.replace_MV(e)))}return Promise.all(b).then(p.bind(this,!0))},Sm.loaded.when_loaded("Core_MvWrapper",function(){Sm.loaded.add("Core_MvCombo")},"Core_MvCombo")}),define("Sm-Core-MvCombo",function(){}),define("Sm/urls/api",["require","Sm","Sm/urls/main"],function(e){var t=function(e,t){var i="";return e.user_id&&(i+="users/"+e.user_id+"/"),e.page_id&&(i+="pages/"+e.page_id+"/"),e.concept_id&&(i+="concepts/"+e.concept_id+"/"),e.dimension_id&&(i+="dimensions/"+e.dimension_id+"/"),e.collection_id&&(i+="collections/"+e.collection_id+"/"),e.dictionary_id&&(i+="dictionaries/"+e.dictionary_id+"/"),e.primary_id&&e.primary_id!=id&&(i+=t+"/"+e.primary_id+"/"),e.secondary_id&&e.secondary_id!=id&&(i+=t+"/"+e.secondary_id+"/"),i};return Sm.urls=Sm.urls||{},Sm.urls.api={generate:function(e){try{e=e&&"object"==typeof e?e:{};var i=Sm.urls.base_url+"api/";if(e.Relationship){var n=e.Relationship,r=n._map_links,o=[];for(var s in r)if(r.hasOwnProperty(s)){var a=r[s];a.type&&a.id&&o.push(a.type+"/"+a.id)}return i+o.join("/")}if(e.url)return i+e.url.replace("//","/");var l=e.MvCombo,c=e.id;!c&&l&&(c=l.id),c=c||null;var d=e.fetch,u=e.context||{page_id:null,section_id:null,concept_id:null,primary_id:null,secondary_id:null,collection_id:null,dimension_id:null,dictionary_id:null},p=l?l.type:e.type,h="",f=!!e.find_usages,m=Sm.Entities[p];if(!m)return!1;var _=m.Meta.lower_plural[p];if(h+=t(u,_),h+=d?d.toLowerCase()+"/":_+"/"+(c?c+"/":""),!h.length)return!1;var v=[];return f&&v.push("usages=1"),!!e.relationship_type&&v.push("relationship_type="+e.relationship_type),v.length&&(h+="?"+v.join("&")),i+h.replace("//","/")}catch(g){return Sm.CONFIG.DEBUG&&console.log("api - ",g),""}}},Sm.urls.api}),define("Sm/urls/main",["require","Sm/urls/api"],function(e){Sm.urls=Sm.urls||{},Sm.urls.base_url="http://s.dev.spwashi.com/",Sm.urls.entity_urls={page:function(e,t){var i=arguments.join("/");return i&&i.length?Sm.urls.base_url+"p/"+i.replace(/^\/|\/+$/gm,""):!1}},Sm.loaded.add("urls"),e("Sm/urls/api")}),define("Sm-Core-SmModel",["backbone","Sm/urls/main"],function(e){Sm.Core.SmModel=e.Model.extend({defaults:{_permissions:{edit:!1,view:!1,destroy:!1}},initialize:function(e){e=e||{},this.object_type="SmModel",this.MvCombo=e.MvCombo||null,"MvCombo"in this.attributes&&(delete this.attributes.MvCombo,delete e.MvCombo),Object.defineProperties(this,{id:{get:function(){return this.attributes.id}},ent_id:{get:function(){return this.attributes.ent_id}}})},toJSON:function(){var e=Sm.Core.util.merge_objects({},this.attributes);return"MvCombo"in e&&delete e.MvCombo,e},url:function(){var e=this,t=this.context;return Sm.urls.api.generate({MvCombo:e,context:t})}}),Sm.loaded.add("Core_SmModel")}),require(["require","Emitter","Sm"],function(e,t){e("Sm"),e(["require","Sm/Extras/ViewAid"],function(){}),Sm.loaded.when_loaded("Extras_ViewAid",function(){"use strict";var e=function(){},t={template_string:'<div class="modal">\n    <div class="modal-content"></div>\n</div>',content_element_selector:".modal-content",click_events:[],events:{save:e,open:e,close:e,edit:e,add:e},closeKey:27},i=function(e){var t=Sm.Extras.Modal.open_modals[Sm.Extras.Modal.open_modals.length-1];if(!t)return!0;if("number"!=typeof t.settings.closeKey&&(t.settings.closeKey=27),27==e.which)t.close();else if(e.ctrlKey&&83==e.which)return e.stopPropagation(),e.preventDefault(),Sm.Extras.Modal.sm_modal_save?!1:(Sm.Extras.Modal.sm_modal_save=!0,t.emit("save",t,t.content_element),window.setTimeout(function(){Sm.Extras.Modal.sm_modal_save=!1},1500),!1)};Sm.Extras.Modal=Sm.Extras.ViewAid.extend({init:function(e){try{e=e||{},this.self_type=e.self_type||!1,this.events_to_trigger=e.events_to_trigger||[];var i=e.MvCombo;i&&i.constructor!==Array&&(i=[i]),this.EntityArr=i||!1,e.relationship_object&&(this.relationship_object=e.relationship_object),this.display_type=this.display_type||(e.display_type||"full")+".modal",this.promise_object=e.promise_object||{},this.promise_object.resolve=this.promise_object.resolve||function(){return!0},this.promise_object.reject=this.promise_object.reject||function(){return!1},this.ViewArr=[],this.element=null,t.click_events=[],this.settings=Sm.Core.util.merge_objects(t,e),this.settings.action_classname="modal-button",Sm.Extras.Modal.open_modals=Sm.Extras.Modal.open_modals||[],Sm.Extras.ViewAid.prototype.init.apply(this,arguments);for(var n=0;n<this.events_to_trigger.length;n++){var r=this.events_to_trigger[n],o=this["on_"+r]||function(){};this.on(r,o.bind(this))}this.create_modal_element()["catch"](function(e){throw Sm.CONFIG.DEBUG&&console.log("modal,init,0",e),e}),this.changed_attributes={}}catch(s){Sm.CONFIG.DEBUG&&console.log("modal,init,1",s)}},init_events:function(){Sm.Extras.ViewAid.prototype.init_events.apply(this,arguments)&&document.addEventListener("keydown",i)},get_content_element:function(e){return this.$content_element=this.$content_element||$(this.content_element),e?this.$content_element:this.content_element},close:function(){$("body").removeClass("modal-blur"),this.element.removeEventListener("click",this.get_bound("click_handler")),this.element&&this.element.parentNode.removeChild(this.element),this.emit("before_close",this,this.content_element),this.element=this.content_element=null,this.status.is_open=!1,Sm.Extras.Modal.open_modals.splice(Sm.Extras.Modal.open_modals.indexOf(this),1),Sm.Extras.Modal.open_modals.length||document.removeEventListener("keydown",i),this.emit("close",this,this.content_element)},get_info_from_form:function(e){var t=this.get_content_element(!0);if(1===this.EntityArr.length)for(var i=(this.EntityArr[0].Model,t.find(e)),n={},r=0;r<i.length;r++){var o=$(i[r]),s=i[r],a=o.val();a.trim&&(a=a.trim());var l=o.attr("name");"has_title"==l&&(a=s.checked?1:0),l&&(n[l]=a);var c={};c[l]=a+""}return this.changed_attributes=n},create_modal_element:function(){var e=this;this.self_type;try{return this.generate_element()["catch"](function(e){throw Sm.CONFIG.DEBUG&&console.log("modal,CMA,0",e),e}).then(function(t){return e.status.is_open?e._changeElement(t):(e.element=t,e.setElement(t)),e.element})["catch"](function(e){throw Sm.CONFIG.DEBUG&&console.log("modal,CMA,1",e),e})}catch(t){throw Sm.CONFIG.DEBUG&&console.log("modal,cme,0",t),t}},generate_element:function(e){try{if(1===this.EntityArr.length){var t=this.EntityArr[0],i=this.self_type;return Sm.Entities[i].Garage.generate(this.display_type,t,{config:e})}}catch(n){return Sm.CONFIG.DEBUG&&console.log("Modal,ge,0",n),Promise.reject(n)}return Promise.reject("Could not figure out how to generate this element")},open:function(){if(this.element="string"==typeof this.settings.template_string?Sm.Core.util.createElement(_.template(this.settings.template_string)(),!0):!1,!this.element)return Sm.CONFIG.DEBUG&&console.log("no open"),!1;$("body").addClass("modal-blur");var e=$(this.element),t=this.content_element=e.find(this.settings.content_element_selector)[0];if(t&&(this.content_element.innerHTML=this.html),Sm.Extras.Modal.open_modals.push(this),!this.content_element)return!1;this.init_events(),this.status.is_open=!0,this.emit("before_open",this);try{document.documentElement.appendChild(this.element)}catch(i){console.log(i)}this.emit("open",this,this.content_element)},success:function(){return Promise.reject("There is no implementation for this method - Modal.success")},update:function(){},set_errors:function(e,t,i){var n=this.get_content_element(!0);if(void 0!=i)for(var r=n.find("[data-attribute="+e+"]"),o=0;o<r.length;o++){var s=r[o],a=s.parentNode,l=$(a).find(".error"),c=l[0];s.hasOwnProperty("checked")?s.checked=!!i:($(s).val(i),s.innerHTML&&(s.innerHTML=i)),c&&(c.innerHTML=t)}},clear_errors:function(){for(var e=this.get_content_element(!0).find(".error"),t=0;t<e.length;t++){var i=e[t];i&&(i.innerHTML="")}}}),Sm.loaded.add("Extras_Modal")},"Extras_Modal")}),define("Sm/Extras/Modal",function(){}),require(["require","Class","Sm","Sm/Extras/Modal"],function(e,t){Sm.loaded.when_loaded(["Extras_Modal"],function(){Sm.Entities.Abstraction.Modal=Sm.Entities.Abstraction.Modal||{},Sm.Entities.Abstraction.Modal.Edit=Sm.Extras.Modal.extend({init:function(e){return e=e||{},e.events_to_trigger=["save","before_save","after_save","open","close","view_relationships","add_entity","select"],this.display_type=(e.display_type||"full")+".modal[edit]",Sm.Extras.Modal.prototype.init.apply(this,arguments)},update:function(){},success:function(e,t){var i=(this.get_content_element(!0),this.EntityArr);if(1===i.length){var n=i[0],r=this.ViewArr[0];e=e||{message:{text:"Undefined error",changed:[],defaulted:[],deferred:[],errors:[]},success:!1},e.message=e.message||{};var o=e.message.changed||[],s=e.message.model||{},a=e.message.defaulted||{},l=e.message.errors||{},c=n.Model||{};c.clear({silent:!0}),c.set(s,{silent:!0}),this.update();var d=[];for(var u in t)if(t.hasOwnProperty(u))if(o.indexOf(u)<0){var p="Unknown error (1)";a[u]?p=a[u]:l[u]&&(p=l[u]);var h=s[u];this.set_errors(u,p,h)}else d.push(u);var f=this;return n.forEachView(function(){var e=this;!e||r&&f.cid==e.cid||(e.update(d),e.refresh_all())}),Promise.resolve(d)}return Promise.reject("Not sure what to do with multiple MvCombos")},get_info_from_form:function(e){e=e||".model.edit";var t=Sm.Extras.Modal.prototype.get_info_from_form.call(this,e);if(1===this.EntityArr.length){var i=this.EntityArr[0].Model;for(var n in t)t.hasOwnProperty(n)&&t[n]==i.get(n)&&delete t[n];return i.set(t),this.changed_attributes=i.changedAttributes()}return t},on_before_save:function(){this.clear_errors();var e=this.get_content_element(!0);e.addClass("saving"),this.changed_attributes=this.get_info_from_form()},on_save:function(){this.emit("before_save",this,this.content_element);var e=this,t=this.EntityArr;if(1===t.length){var i=t[0];return i.save({silent:!0,patch:!0}).then(function(t){return e.resolve("after_save",t)})}return Promise.reject("Not sure what to do with multiple MvCombos yet")},on_after_save:function(e){return this.$content_element.removeClass("saving"),this.success(e,this.changed_attributes),this.changed_attributes={},e},on_open:function(){var e=this.content_element,t=this;this.EntityArr.forEach(function(i,n){t.ViewArr.push(i.addView(e,!1,{display_type:t.display_type}))})},on_close:function(){for(var e=this.ViewArr,t=0;t<e.length;t++){var i=e[t];i&&i.destroy()}},on_view_relationships:function(){if(!this.self_type)return void(Sm.CONFIG.DEBUG&&console.log("No self type in this modal!"));if(1!==this.EntityArr.length)return void(Sm.CONFIG.DEBUG&&console.log("Not sure what to do in this situation!"));var e=this.self_type,t=this.EntityArr[0],i=this.get_content_element(!0),n=i.find(".view_relationship-container")[0];Sm.Entities[e]&&Sm.Entities[e].Garage.generate("relationships",t)["catch"](function(e){Sm.CONFIG.DEBUG&&console.log(e)}).then(function(e){if(n)if("string"==typeof e)n.innerHTML="<hr>"+e;else{n.innerHTML="<hr>";try{n.appendChild(e)}catch(t){Sm.CONFIG.DEBUG&&console.log(t)}}})["catch"](function(e){Sm.CONFIG.DEBUG&&console.log(e)})},on_add_entity:function(){Sm.CONFIG.DEBUG&&console.log(arguments)},on_select:function(){var e=this;this.resolve("save").then(function(t){e.create_modal_element()})["catch"](function(e){Sm.CONFIG.DEBUG&&console.log(e)})}})},"Entities_Abstraction_Modal_ModalEdit")}),define("Sm-Entities-Abstraction-Modal-ModalEdit",function(){}),require(["require","Class","Sm","Sm/Extras/Modal"],function(e,t){Sm.loaded.when_loaded(["Extras_Modal"],function(){Sm.Entities.Abstraction.Modal=Sm.Entities.Abstraction.Modal||{},Sm.Entities.Abstraction.Modal.AddRelationship=Sm.Extras.Modal.extend({init:function(e){return e=e||{},e.data=this.display_type=(e.display_type||"full")+".modal[add_relationship]",
e.events_to_trigger=["open","close","choose","select"],Sm.Extras.Modal.prototype.init.apply(this,arguments)},generate_element:function(e){if(1===this.EntityArr.length){e=e||{};var t=this.EntityArr[0],i=this.self_type,n=Sm.Entities[i].Meta.get_named_relationship_indices(),r=Sm.Core.util.merge_objects(t.Model.attributes,{relationship_indices:n});try{return Sm.Entities[i].Garage.generate(this.display_type,r,{config:e})["catch"](function(e){Sm.CONFIG.DEBUG&&console.log("ar_gen_el,0",e)})}catch(o){throw Sm.CONFIG.DEBUG&&console.log("ar_gen_el,1",o),o}}return Promise.reject("Could not figure out how to generate this element")},on_open:function(){var e=this.content_element,t=this;this.EntityArr.forEach(function(i,n){t.ViewArr.push(i.addView(e,!1,{display_type:t.display_type}))})},on_select:function(e,t,i){var n=i.target,r=$(n);if(!r.hasClass("relationship_index"))return Promise.resolve();var o=(this.get_content_element(!0),e),s=this.display_type.replace(/(add_relationship)/gi,"$1_type")+"("+o+")",a=this.EntityArr[0],l=a.getRelationshipIndex(o),c={items:[],relationships:[]};l&&(c=l.get_listed_items());var d=Sm.Core.Meta.get_named_relationship_indices({sub:!0});return Sm.Entities[this.self_type].Garage.generate(s,{items:c.items,position:c.count||0,relationship_subindices:d}).then(function(e){var t=$(e),i=$("#modal-continue-2");i[0]?i.replaceWith(t):t.insertAfter(r.parent())})["catch"](function(e){throw Sm.CONFIG.DEBUG&&console.log("AddRelationship,os,1",e),e})},get_info_from_form:function(e){return Sm.Extras.Modal.prototype.get_info_from_form.call(this,".relationship-attribute")},on_choose:function(e){$(this.element);this.get_info_from_form(),this.promise_object.resolve(this.changed_attributes),this.changed_attributes={}},on_close:function(){for(var e=this.ViewArr,t=0;t<e.length;t++){var i=e[t];i&&i.destroy()}}})},"Entities_Abstraction_Modal_AddRelationship")}),define("Sm-Entities-Abstraction-Modal-AddRelationship",function(){}),require(["require","Class","Sm","Sm/Extras/Modal"],function(e,t){Sm.loaded.when_loaded(["Extras_Modal"],function(){Sm.Entities.Abstraction.Modal=Sm.Entities.Abstraction.Modal||{},Sm.Entities.Abstraction.Modal.Destroy=Sm.Extras.Modal.extend({init:function(e){return e=e||{},this.display_type=(e.display_type||"full")+".modal[destroy]",e.events_to_trigger=["before_open","open","close","choose"],this.self_type=this.self_type||"Abstraction",Sm.Extras.Modal.prototype.init.apply(this,arguments)},generate_element:function(){return Sm.Entities[this.self_type].Garage.generate(this.display_type)["catch"](function(e){throw Sm.CONFIG.DEBUG&&console.log("OK,m_dest,gme,1",e),e})},on_before_open:function(){var e=this,t=e.EntityArr,i=$(e.element),n=i.find(".spwashi-entities-list");Sm.CONFIG.DEBUG&&console.log(e.element,n);for(var r=0;r<t.length;r++){var o=t[r],s=o.getView({reference_element:e.element});s.render({synchronous:!0,display_type:"tag"}),s.setPermission("focus",!1);var a=document.createElement("li");a.appendChild(s.el),n.append(a)}},on_open:function(){var e=this.content_element,t=this;this.EntityArr.forEach(function(i,n){t.ViewArr.push(i.addView(e,!1,{display_type:t.display_type}))})},on_choose:function(e){return Sm.CONFIG.DEBUG&&console.log(e),"true"==e?this.promise_object.resolve(!0):this.promise_object.reject(!1)},on_close:function(){for(var e=this.ViewArr,t=0;t<e.length;t++){var i=e[t];i&&i.destroy()}}})},"Entities_Abstraction_Modal_Destroy")}),define("Sm-Entities-Abstraction-Modal-ModalDestroy",function(){}),require(["require","backbone","jquery","underscore","Cocktail","Sm-Entities-Abstraction-Modal-ModalEdit","Sm-Entities-Abstraction-Modal-AddRelationship","Sm-Entities-Abstraction-Modal-ModalDestroy"],function(e,t,i,n,r){e(["require","Sm/Extras/DraggableMixin"],function(){}),e(["require","Sm/Extras/Modal"],function(){});var o=window.Sm;o.Core.SmView=t.View.extend({type:"",identifier:".spwashi-entity",relationship_index_obj:{collections:!1,children:"child_holder",composition:"composition",micros:!1,pivots:!1},elements:{},initial_events:{click:function(){o.CONFIG.DEBUG&&console.log(this)}},additional_events:{click:function(){o.CONFIG.DEBUG&&console.log(this)}},setPermission:function(e,t){if("string"==typeof e)this._permissions[e]=t;else if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&this.setPermission(i,e[i])},setStatus:function(e,t){if(this.status=this.status||{},"string"==typeof e)this.status[e]=t;else if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&this.setStatus(i,e[i])},queryPermission:function(e){if(!this.MvCombo)return!1;if("relate"==e&&(e="edit"),e in this._permissions)return this._permissions[e];var t=this.MvCombo.queryPermission(e);return null!=t&&(this._permissions[e]=t),e in this._permissions?this._permissions[e]:null},queryStatus:function(e){if(!this.MvCombo)return null;if("relate"==e&&(e="edit"),e in this.status)return this.status[e];var t=this.MvCombo.queryStatus(e);return null!=t&&(this.status[e]=t),e in this.status?this.status[e]:null},outerHTML:function(){return this.get_rendered("Element").outerHTML},init_permissions:function(e){return this.MvCombo?(e=e||{},this.status.is_permissions_init&&e.if_not_init?this:(this.queryPermission("destroy")&&this.$el.addClass("can-delete"),this.queryPermission("view")&&this.$el.addClass("can-view"),this.queryPermission("relate")&&this.$el.addClass("can-relate"),this.queryPermission("edit")&&this.$el.addClass("can-edit"),this.queryPermission("edit")&&this.$el.addClass("can-drag"),this.queryPermission("focus")&&this.$el.addClass("can-focus"),this.status.is_permissions_init=!0,this)):this},initialize:function(e){e=e||{},this.object_type="SmView",n.extend(this,t.Events),this.elements={},this._rendering_callbacks=this._rendering_callbacks||{},this._permissions={},this._cache={},this.status={},this.reference_to=[];var i=this,r=this.type;this.Identity=o.Core.Identifier.get_or_init({id:!1,r_id:i.cid,type:r+"View",Resource:i}),e.el&&(this.setStatus({rendered:!0,up_to_date:!0,init_from_el:!0}),e.el.sm_View=this,e.el.parentNode&&(this.referenceElement=e.el.parentNode),this.old_el=e.el,this.init_elements(),this.Identity&&(e.el.dataset.view_r_id=this.Identity.r_id)),e.model&&this.setStatus("has_model",!0),this._to_update=[],this._relationships={},this._reciprocal_relationships={},this.MvCombo=e.MvCombo||null,this.display_type=e.display_type?e.display_type:this.display_type?this.display_type:"full",this.setStatus("modal",this.display_type.indexOf("modal")>=0),n.extend(this,t.Events),o.loaded.when_loaded("Extras_Draggable",function(){o.Extras.Draggable.mixin.call(i,{can_start:function(){return o.CONFIG.DRAG_MODE&&!i.queryStatus("modal")},can_accept:function(e,t){return!0},data:i});e.el||i.el;i.makeElementDraggable&&i.makeElementDraggable(e.el||i.el,!0)},"_SmView_Init",2e4),this.init_button_control_events()},init_elements:function(){var e=this._rendering_callbacks;for(var t in e)e.hasOwnProperty(t)&&this.get_rendered(t)},events:function(){return this.initial_events=this.initial_events||{},this.additional_events=this.additional_events||{},o.Core.util.merge_objects(this.initial_events,this.additional_events)},setMvCombo:function(e){e&&(this.MvCombo=e)},delegateEvents:function(){return t.View.prototype.delegateEvents.apply(this,arguments)},remove:function(){return this.MvCombo.blur(this),this.setStatus("rendered",!1),this.mark_unrendered(),this.undelegateEvents(),t.View.prototype.remove.apply(this,arguments)},refresh_all:function(e,t){e=e||{},t=t||[];var i=this.get_rendered("Element");this.delegateEvents(this.events());var n=this,r=this.MvCombo;if(!r)return this;var s=function(i,r){if(i&&r){r.innerHTML="";for(var s=i._meta._list.length;s--;){var a=i._meta._list[s];n.add_relationship({render:!0,Relationship:i.items[a],RelationshipIndex:i}).then(function(i){i.OtherView&&(i.OtherView.refresh_element(i.otherElement),i.OtherView.refresh_all(e,t))})["catch"](function(e){o.CONFIG.DEBUG&&console.log("error - ",e)})}}else o.CONFIG.DEBUG&&console.log("refresh no",i,r)};this.refresh_element(i);var a=r.relationships;for(var l in a)if(a.hasOwnProperty(l)){var c=a[l],d=this.get_rendered(this.relationship_index_obj[l]);d&&s(c,d)}return this},mark_unrendered:function(){this.setStatus({rendered:!1,permissions_init:!1});var e=this.elements;for(var t in e)e.hasOwnProperty(t)&&(e[t]=null)},mark_added:function(){this.setStatus({rendered:!0}),this.MvCombo.addView(this),this.post_add_hook()},refresh_element:function(e){e&&(this.undelegateEvents(),this.setElement(e),this.init_elements(),this.setStatus({rendered:!0,up_to_date:!0}),this.delegateEvents(this.events()),this.init_button_control_events(),this.post_add_hook())},post_add_hook:function(){var e=this;o.loaded.when_loaded("Vendor_MathJax",function(){e.setStatus&&e.setStatus("math_init",!0),MathJax.Hub.Queue(["Typeset",MathJax.Hub])}),o.loaded.when_loaded("Entities_Dictionary_Wrapper",function(){o.Entities.Dictionary.Wrapper.highlight_word(null,{element:e.get_rendered("Element")})})},render:function(e){e=e||{};var t=!!e.synchronous;if(!this.MvCombo||this.queryStatus("destroyed"))return t?!1:Promise.reject("There is no longer an existent MvCombo for this View");if(this.queryStatus("rendered")&&e.if_not_rendered||this.queryStatus("rendering"))return o.CONFIG.DEBUG&&console.log("ignore"),t?this.el:Promise.resolve(this.el);this.setStatus("rendering",!0);var n=this.MvCombo,r=this.type,s=this,a=function(e){var t=i(e);return s.old_el=s.el,s.setElement(t,"render"),s.setStatus({rendered:!0,rendering:!1,up_to_date:!0}),s.init_elements(),s.delegateEvents(s.events()),n.addView(this),t[0]},l=o.Entities[r].Garage;return this.display_type=e.display_type||this.display_type||"full",this.setStatus("modal",this.display_type.indexOf("modal")>=0),t?a(l.generate(this.display_type,n,{synchronous:!0})):l.generate(this.display_type,n).then(a)["catch"](function(e){o.CONFIG.DEBUG&&console.log(e)})},get_rendered:function(e,t){if(!e)return!1;if("Element"==e)return this.queryStatus("rendered")||this.render({synchronous:!0,if_not_rendered:!0}),this.el;if("$Element"==e)return this.$el=i(this.get_rendered("Element"));if(this._rendering_callbacks[e]){var n=e.replace(/rendered_|_element/,"");return this.elements[n]&&t&&delete this.elements[n],this._rendering_callbacks[e].call(this)}return e.indexOf("_element")<0&&(e+="_element"),this._rendering_callbacks[e]?this._rendering_callbacks[e].call(this):(e.indexOf("rendered_")<0&&(e="rendered_"+e),this._rendering_callbacks[e]?this._rendering_callbacks[e].call(this):!1)},begin_add_relationship:function(e){e=e||{};var t,i;e.View?(t=e.View,i=e.MvCombo||t.MvCombo):e.MvCombo&&(i=e.MvCombo,t=i.getView({reference_element:this.referenceElement}));var n=this;return this.MvCombo.add_relationship(i,{type:e.type,OtherView:t,prompt:!!e.prompt})["catch"](function(e){throw o.CONFIG.DEBUG&&console.log("SmView,bar,1",e),e}).then(function(e){if(e&&e.RelationshipIndex){var i=(e.SelfMvCombo,e.OtherMvCombo,e.OtherView),r=e.Relationship,s=e.RelationshipIndex,a=e.map_indices[0],l=e.map_indices[1];if(r){var c={};c[a]=n,c[l]=i||t,r.register_view_relationship(c),n.add_relationship({render:!0,Relationship:r,RelationshipIndex:s})["catch"](function(e){o.CONFIG.DEBUG&&console.log("error - ",e)})}return e}})["catch"](function(e){throw o.CONFIG.DEBUG&&console.log(e),e}).then(function(e){if(e&&e.RelationshipIndex){if(e.Relationship)return e.Relationship.save();var t=e.RelationshipIndex,i=0;t.save({context_id:i})["catch"](function(e){throw o.CONFIG.DEBUG&&console.log(e),e})}})["catch"](function(e){throw console.log(e),e})},add_relationship:function(e){var t,n=!!e.render,r=e.relationship_type_index||!1,s=e.map_index||!1,a=e.self_map_index||!1,l=e.Relationship||!1,c=this.MvCombo,d=e.RelationshipIndex||!1,u=!!e.is_reciprocal,p=e.container_template||!1;if(l&&d&&(!r&&d._meta&&d._meta._index&&(r=d._meta._index),t=e.MvCombo||l.get_Mv({SelfMvCombo:c,map_index:s}),!s&&t&&(s=l.get_map_index_of_Mv(t)),!a&&c&&(a=l.get_map_index_of_Mv(c))),!(s&&a&&r&&l&&c))return Promise.reject("Could not identify details");var h=this,f=e.relationship_obj||{};if(f[s]=null,f[a]=this,t=t||e.MvCombo||l.get_Mv({SelfMvCombo:c,map_index:s}),t.queryStatus("destroyed"))return Promise.reject(t.r_id," - does not exist");if(!t)return Promise.reject("There is no other MV");var m=l.getView(this,s);if(!m){if(m=t.getView({reference_element:h.referenceElement}),!m)return Promise.reject("There is no other View");f[s]=m,l.register_view_relationship(f)}this[r]=this[r]||{},this[r][t.Identity.r_id]=m,e.is_reciprocal?(this._reciprocal_relationships[r]=this._reciprocal_relationships[r]||{},this._reciprocal_relationships[r][t.Identity.r_id]=m):(e.is_reciprocal=!0,e.render=!1,e.map_index=s,e.self_map_index=a,this._relationships[r]=this._relationships[r]||{},this._relationships[r][t.Identity.r_id]=m,m.add_relationship(e)["catch"](console.log));var _=u?c.reciprocal_relationships[r]:c.relationships[r];if(!_)return Promise.reject("There is no index to match "+r+" in "+c.type);var v=_.locate(t.Identity,e.context_r_id||0);v=v||0;var g=Promise.resolve([null]);if(!n)return g;var y=this.wrap_element_for_relationship(m,r,l,p),b=(this.get_rendered("Element"),this.relationship_index_obj[r]),w=this.get_rendered(b);if(!y)return Promise.reject("There is no other element");if(w){var S=i(w),C=S.children(".content");C[0]&&(S=i(C[0]));var x,E,M=S.children(),O=M.length;if(O&&O>v)E=M,x=E[v],x.parentNode.insertBefore(y,x),m.mark_added();else try{w.appendChild(y),m.mark_added()}catch(T){throw o.CONFIG.DEBUG&&console.log(T),T}}return Promise.resolve({self_index_element:w,OtherView:m,otherElement:y}).then(function(e){var i=t.r_id,n=o.Core.MvWrapper.get_effective_MV(i,!1,!0);return o.CONFIG.DEBUG&&console.log(n,i),e})},accept_drop:function(e){return this.begin_add_relationship({View:e})},init_button_control_events:function(){var e=this,t=this.get_rendered("button_control",!0);t&&"object"==typeof t&&(t.onclick=function(t){var n=t.target,r=i(n),s=e.find_closest_relationship(),a=s.Relationship,l=s.el,c=s.other_MV_type;if(e.queryPermission("edit")&&r.hasClass("edit")&&r.hasClass("button")){var d={};a&&(d.display_type="preview",d.relationship_object={Relationship:a,other_MV_type:c}),e.prompt_edit(d)}else r.hasClass("debug")&&r.hasClass("button")&&o.CONFIG.DEBUG?o.CONFIG.DEBUG&&console.log(e.cid," -- ",e.MvCombo,e.MvCombo.Identity.r_id,e.MvCombo.Model.attributes):e.queryPermission("relate")&&r.hasClass("add")&&r.hasClass("button")?e.begin_add_relationship():e.queryPermission("destroy")&&r.hasClass("delete")&&r.hasClass("button")&&(a?a.destroy({silent:!1}).then(function(){a.linked_entities&&(e.destroy(),l&&l.parentNode.removeChild(l),"Section"==a.linked_entities[0]&&"Section"==a.linked_entities[1]||"Dictionary"==a.linked_entities[0]||"Dictionary"==a.linked_entities[1])}):e.MvCombo.destroy({prompt:!0},e))})},clone:function(){var e=this.get_rendered("Element").cloneNode(!0),t=this.prototype?this.prototype.constructor:this.constructor,i=this.MvCombo,n=this.type,r=new t({type:n,MvCombo:i,el:e}),s=this;return o.loaded.when_loaded("Extras_Draggable",function(){s.setDraggingStatus(!1)}),i.addView(r,this.referenceElement),r},handle:!0,setElement:function(e){e&&(e=e[0]||e),e&&(e.sm_View=this),this.Identity&&(e.dataset||(o.CONFIG.DEBUG&&console.log(e),e.dataset={}),e.dataset.view_r_id=this.Identity.r_id),this.referenceElement=e.parentNode?e.parentNode:null;var i=this;t.View.prototype.setElement.apply(this,arguments),this.init_permissions(),o.loaded.when_loaded("Extras_Draggable",function(){i.makeElementDraggable&&i.makeElementDraggable(null,i.handle||void 0===i.handle?i.handle:!0)},"_SmView_SetElement",2e4)},renderDragMirror:function(e){if(this.queryStatus("modal"))return!1;var t=e.cloneNode(!0),i=t.getBoundingClientRect(),n=document.createElement("div");return n.style.position="absolute",t.style.width=i.width+"px",n.appendChild(t),n.className="sm-mirror",n},wrap_element_for_relationship:function(e,t,i,n){return e.get_rendered("Element")},find_closest_relationship:function(){var e=this.$el.closest("[data-relationship-r_id]"),t=!1;if(e.length){var i=e.data("relationship-r_id");t=o.Core.Identifier.identify({r_id:i})}var n=!1;return t&&(t.linked_entities[0]!=this.type?n=t.linked_entities[0]:t.linked_entities[1]&&t.linked_entities[1]!=this.type&&(n=t.linked_entities[1])),{Relationship:t,el:e[0],other_MV_type:n}},replaceOldElement:function(){var e=this.el,t=this.render({display_type:this.display_type,synchronous:!0});return this.old_el&&this.old_el!=t&&this.old_el.parentNode&&this.old_el.parentNode.replaceChild(t,this.old_el),this.old_el=e,this.refresh_element(t),this.refresh_all(),this.queryStatus("focused")&&this.focus(),this.queryStatus("selected")&&this.select(),[this.el,t,e]},focus:function(){return this.init_permissions({if_not_init:!0}),this.setStatus("focused",!0),this.get_rendered("$Element").addClass("focused"),this},blur:function(){return this.setStatus("focused",!1),this.$el.removeClass("focused"),this},select:function(){return this.setStatus("selected",!0),this.get_rendered("$Element").addClass("selected"),this},deselect:function(){return this.setStatus("selected",!1),this.get_rendered("$Element").removeClass("selected"),this},activate:function(){return this.setStatus("active",!0),this.get_rendered("$Element").addClass("activated"),this},deactivate:function(){return this.setStatus("active",!1),this.get_rendered("$Element").removeClass("activated"),this},destroy:function(){return this.undelegateEvents(),o.CONFIG.DEBUG&&console.log("removing - ",this.cid),this.$el.removeData().unbind(),this.remove(),this.MvCombo.removeView(this.cid),t.View.prototype.remove.call(this),this},prompt_edit:function(e){e=e||{},e.display_type=e.display_type||"full";var t=this.MvCombo;if(t){var i=o.Core.Meta.get_MVs("selected"),n=[];for(var r in i)if(i.hasOwnProperty(r)){var s=i[r];n.push(s.getResource())}var a=o.Entities[this.type].Abstraction&&o.Entities[this.type].Abstraction.Modal&&o.Entities[this.type].Abstraction.Modal.Edit?o.Entities[this.type].Abstraction.Modal.Edit:o.Entities.Abstraction.Modal.Edit,l=new a({MvCombo:[t],self_type:t.type,display_type:e.display_type,relationship_object:e.relationship_object});this.blur(),l.open()}},update:function(e){if(this.display_type.indexOf("modal")>-1)return this;if(!this.MvCombo)return this;if(this.model=this.model||this.MvCombo.Model,!this.model)return o.CONFIG.DEBUG&&console.log("There was no model!"),this;e||(this.init_elements(),e=Object.keys(this.elements)),o.CONFIG.DEBUG&&console.log("SmView,update,2",e);var t=this.type.toLowerCase(),i=t+"_type";if(o.CONFIG.DEBUG&&console.log("SmView,update,2",i),e.indexOf(i)>-1)return this.mark_unrendered(),this.replaceOldElement(),this;for(var n=0;n<e.length;n++){var r=e[n];this._updateElementFromModelProperty(r,this.get_rendered(r))}return this},_updateElementFromModelProperty:function(e,t){if(t){var i=this.model.get(e);void 0!=i&&(t.innerHTML=this.model.escape(e))}},add_bound:function(e,t,i){return this._fns=this._fns||{},"function"==typeof t||this._fns[e]?this._fns[e]=this._fns[e]||t.bind(i||this):(o.CONFIG.DEBUG&&console.log(t,e),function(){})},get_bound:function(e,t){return this._fns=this._fns||{},this._fns[e]?this._fns[e]:t?!1:function(){}.bind(this)}}),o.Core.SmView.replace_with_elements=function(e){var t=e.referenceElement,i=e.replaced_MVs||[],n=e.replacement_MVs||[],r=(e.replaced_relationships||[],e.replacement_relationships||[],e.items||{}),s="function"==typeof e.forEachView?e.forEachView:!1;if(!n.length)return Promise.reject("No replacement Views specified");for(var a,l=i.length;l--;){var c=i[l],d=r[c]||o.Core.Identifier.identify(c);if(d){var u=d.getView({strict:!0,reference_element:t});u&&(a||!u?u.remove():a=u)}}var p,h=Promise.resolve(a),f=!1,m=function(e,i,n){if(!n&&!i)return e;if("string"==typeof i)if(r[i])i=r[i];else{var l=o.Core.Identifier.retrieve(i);l&&(i=l.getResource())}if(!i||!i.getView)return e;var c=i.getView({reference_element:t});if(!c)return e;var d=function(e){return c.render({if_not_rendered:!0,synchronous:!1}).then(function(t){c.refresh_all(),e||o.CONFIG.DEBUG&&console.log("Previous View does not exist ",e,c);var i=e.el;return o.Core.util.insertAfter(c.el,i),c.referenceElement=t.parentNode,c.mark_added(),f||e.cid!=a.cid||(a.remove(),f=!0),p||(p=c),s&&s.call(c),c})["catch"](function(t){return o.CONFIG.DEBUG&&console.log("smview,arf,ftw,3",t,e),e})};return e.then(d)};return n.reduce(m,h).then(function(){return p&&p.MvCombo.focus(p),!0})},o.loaded.add("Core_SmView"),function(e){var t=!1,i=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];t.push(n.ent_id?n.type+": "+n.ent_id:n.type+": "+(n.id?n.id:n.r_id))}return t.length&&confirm("Are you sure you want to delete "+t.join(", "))?Promise.resolve():Promise.reject()},n=function(){var e=o.Core.Meta.MvMaps.selected_MVs,t=[];for(var n in e)if(e.hasOwnProperty(n)){var r=e[n].getResource(),s=r.ViewMaps.selected_Views,a=!1;for(var l in s)if(s.hasOwnProperty(l)){var c,d=s[l].getResource(),u=d.find_closest_relationship();u&&(c=u.Relationship)?t.push(c.Identity):a||t.push(r.Identity)}}i(t).then(function(){for(var e=0;e<t.length;e++){var i=t[e],n=i.getResource();n.destroy({silent:!1})}}),o.CONFIG.DEBUG&&console.log(t)};e.addEventListener("keydown",function(e){76==e.keyCode&&e.shiftKey?0==t?t=setTimeout(function(){t=!1},500):(t=!1,clearTimeout(t),o.CONFIG.DEBUG&&console.log(" ---------------------------------------- "),o.CONFIG.DEBUG&&console.log(" ")):46==e.keyCode&&n()}),e.addEventListener("keyup",function(e){16==e.keyCode&&t!==!1&&(clearTimeout(t),t=!1)})}(document)}),define("Sm-Core-SmView",function(){}),define("Sm-Core-Meta",["Emitter"],function(e){var t=e.extend({CONFIG:{DEBUG:!1,EDIT:!1,DRAG_N_DROP:!1},MvMaps:{},init:function(e){this.events=[],this._callbacks={},this.MvMaps={loaded_MVs:{},focused_MVs:{},selected_MVs:{},active_MVs:{},destroyed_MVs:{}},this.loaded_ent_ids={},e=e||{},this.type=e.type,this.lower_plural=this.lower_plural||{},this.lower_singular=this.lower_singular||{};var t=Sm.Entities;for(var i in t)t.hasOwnProperty(i)&&(this.lower_singular[i]=this.lower_singular[i]||i.toLowerCase(),this.lower_plural[i]=this.lower_plural[i]||(t[i].plural||i+"s").toLowerCase())},configure:function(e){this.relationship_type_obj=Sm.Core.util.merge_objects_recursive(e.relationships||{},e.reciprocal_relationships||{});this.reciprocal_relationship_type_list=Object.keys(e.reciprocal_relationships||{}),this.relationship_type_list=Object.keys(e.relationships||{});var t=this.properties=e.properties||{all:{ent_id:null,id:null}};t.all=t.all||{},t.api_settable=t.api_settable||{},t.api_settable=t.api_settable||{},this.prefix=e.prefix||null;var i=e.relationship_subtypes||!1;if(i)for(var n in i)if(i.hasOwnProperty(n)){var r=i[n];r&&r.id&&(this.relationship_subtypes[n]=r)}},get_defaults_of:function(e){var t=Sm.spwashi_config.entities,i=t[e];return i?(t.properties||{}).all||{}:{}},relationship_types:{children:1,composition:2,macros:3,micros:4,pivots:5},relationship_subtypes:{eli5:1,thing_explainer:2,image:3,video:4,audio:5,text:6},relationship_subtype_obj:{eli5:{name:"ELI5",id:1},thing_explainer:{name:"Thing Explainer",id:2},image:{name:"Image",id:3},video:{name:"Video",id:4},audio:{name:"Audio",id:5},text:{name:"Text",id:6}},types:{standard:1},relationship_aliases:{},get_type:function(e,t){var i=this.types;if(i[e])return"index"==t?e:i[e];for(var n in i)if(i.hasOwnProperty(n)&&(n==e||i[n]==e))return"index"==t?n:i[n];return!1},get_named_relationship_indices:function(e){e=e||{};var t=!!e.sub,i=t?this.relationship_subtype_obj:this.relationship_type_obj,n={};for(var r in i)if(i.hasOwnProperty(r)){var o=i[r],s=o.name||o.index_singular||!1;s=Sm.Core.util.uc_first(s),s&&!o.is_only_reciprocal&&(n[s]=r)}return n},get_possible_relationship_indices:function(e){return[]},get_relationship_type:function(e,t){var i=this.type||!1,n=!!e.is_reciprocal,r=e.type||"index";t=t||e.identifier||!1;var o,s=e.map||{},a=e.sub?this.relationship_subtypes:this.relationship_type_obj;t=t||s.relationship_type||!1;var l=Sm.Entities;if(!t)return!1;for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];if("id"==r?(o=d.id||!1,o=d.id?d.id:parseInt(d)):"model_type"==r?o=d.model_type||i||!1:"name"==r?(o=d.name||d.index_singular||!1,o=Sm.Core.util.uc_first(o)):o=c,d==t)return o;if(t==c)return o;if("object"==typeof d){d.index_singular=d.index_singular||"",d.id=d.id||"";var u=d.index_singular.constructor===Array?d.index_singular.join("|"):d.index_singular;if(u=(u||"").toLowerCase(),t==u||u.toLowerCase().search(new RegExp("\\|?"+t.toLowerCase()+"\\|?"))>-1)return o;if(d.id&&t==d.id)return o}}for(var p in l)if(l.hasOwnProperty(p)&&p==this.type){var h=this.lower_singular[p]+"_id";if(h in s)return"id"==r?!1:"model_type"==r||"name"==r?p:(n?this.lower_plural[p]:this.lower_plural[this.type])||!1}return e.sub&&Sm.CONFIG.DEBUG&&console.log("core_meta,grt,0",d),!1},get_MVs:function(e){return/loaded|active|focused|selected|destroyed/.test(e)?this.MvMaps[e+"_MVs"]:void 0},MV_is:function(e,t){if(!t)return!1;t.Identity?t=t.Identity:t.MvCombo&&(t=t.MvCombo.Identity);var i=t.r_id;return i?(e+="_MVs",this[e]&&this[e][i]):!1},add_MV_as:function(e,t){if(!t)return this;var i=t.ent_id||t.getResource().ent_id,n=t.r_id;if(!n)return this;var r=this.MvMaps;switch(this.type!==!1&&Sm.Core.Meta.add_MV_as(e,t),e){case"destroyed":return r.destroyed_MVs[n]=!0,this;case"loaded":r.loaded_MVs[n]=t;break;case"active":case"focused":case"selected":if(!(e+"_MVs"in r))return Sm.CONFIG.DEBUG&&console.log(e,r),this;r[e+"_MVs"][n]=t,!(n in r.loaded_MVs)&&(r.loaded_MVs[n]=t),!(n in r.active_MVs)&&(r.active_MVs[n]=t)}return!!i&&(this.loaded_ent_ids[i]=t),this},remove_MV_as:function(e,t){var i=t.r_id;if(!i)return this;var n=e+"_MVs",r=this.MvMaps;return r[n]?(this.type!==!1&&Sm.Core.Meta.remove_MV_as(e,t),i in this.MvMaps[n]&&delete this.MvMaps[n][i],"loaded"==n?(i in this.MvMaps.active_MVs&&delete this.MvMaps.active_MVs[i],i in this.MvMaps.selected_MVs&&delete this.MvMaps.selected_MVs[i],i in this.MvMaps.focused_MVs&&delete this.MvMaps.focused_MVs[i]):"active"==n&&(i in this.MvMaps.selected_MVs&&delete this.MvMaps.selected_MVs[i],i in this.MvMaps.focused_MVs&&delete this.MvMaps.focused_MVs[i]),!0):!1}});Sm.Core.Meta=new t({type:!1}),Sm.Core.Meta.Proto=t,Sm.loaded.add("Core_Meta")}),require(["require","Sm-Core-RelationshipIndex","Sm-Core-Relationship","Sm-Core-MvWrapper","Sm-Core-MvCombo","Sm-Core-Identifier","Sm-Core-SmModel","Sm-Core-SmView","Sm-Core-Meta"],function(e){e(["Sm-Core-RelationshipIndex"],function(){}),e(["Sm-Core-Relationship"],function(){}),e(["Sm-Core-MvWrapper"],function(){}),e(["Sm-Core-MvCombo"],function(){}),e(["Sm-Core-Identifier"],function(){}),e(["Sm-Core-SmModel"],function(){}),e(["Sm-Core-SmView"],function(){}),e(["Sm-Core-Meta"],function(){}),Sm.loaded.when_loaded(["Core_Identifier","Core_Meta","Core_MvCombo","Core_MvWrapper","Core_Relationship","Core_RelationshipIndex","Core_SmModel","Core_SmView"],function(){},"Core").then()["catch"](function(e){Sm.CONFIG.DEBUG&&console.log("ERROR:",e)})}),define("Sm-Core-Core",function(){}),"undefined"==typeof global)var global="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};var event_map=[],regex_on=/^on/;for(var event_name in global)regex_on.test(event_name)&&event_map.push(event_name.slice(2));require(["require","Sm"],function(e){e("Sm");var t,i;global.addEventListener?(t=function(e,t,i,n){return e?e.addEventListener(t,i,n):!1},i=function(e,t,i,n){return e?e.removeEventListener(t,i,n):(console.log(arguments),!1)}):(t=function(e,t,i){return e.attachEvent("on"+t,s(e,t,i))},i=function(e,t,i){var n=a(e,t,i);return n?e.detachEvent("on"+t,n):void 0});var n=[],r=function(e,t,i){var n;-1===event_map.indexOf(t)?n=new CustomEvent(t,{detail:i}):doc.createEvent?(n=doc.createEvent("Event"),n.initEvent(t,!0,!0)):doc.createEventObject&&(n=doc.createEventObject()),e.dispatchEvent?e.dispatchEvent(n):e.fireEvent("on"+t,n)},o=function(e,t,i){return function(t){var n=t||global.event;n.target=n.target||n.srcElement,n.preventDefault=n.preventDefault||function(){n.returnValue=!1},n.stopPropagation=n.stopPropagation||function(){n.cancelBubble=!0},n.which=n.which||n.keyCode,i.call(e,n)}},s=function(e,t,i){var r=a(e,t,i)||o(e,t,i);return n.push({wrapper:r,element:e,type:t,fn:i}),r},a=function(e,t,i){var r=l(e,t,i);if(r){var o=n[r].wrapper;return n.splice(r,1),o}},l=function(e,t,i){var r,o;for(r=0;r<n.length;r++)if(o=n[r],o.element===e&&o.type===t&&o.fn===i)return r};Sm.loaded.when_loaded("core_util",function(){Sm.Core.util.crossvent={add:t,remove:i,fabricate:r},Sm.loaded.add("Core_util_crossvent")},"Core_util_crossvent")}),define("crossvent",function(){}),function(e,t,i){function n(t,i){this.bodyOverflowX,this.callbacks={hide:[],show:[]},this.checkInterval=null,this.Content,this.$el=e(t),this.$elProxy,this.elProxyPosition,this.enabled=!0,this.options=e.extend({},l,i),this.mouseIsOverProxy=!1,this.namespace="tooltipster-"+Math.round(1e5*Math.random()),this.Status="hidden",this.timerHide=null,this.timerShow=null,this.$tooltip,this.options.iconTheme=this.options.iconTheme.replace(".",""),this.options.theme=this.options.theme.replace(".",""),this._init()}function r(t,i){var n=!0;return e.each(t,function(e,r){return"undefined"==typeof i[e]||t[e]!==i[e]?(n=!1,!1):void 0}),n}function o(){return!d&&c}function s(){var e=i.body||i.documentElement,t=e.style,n="transition";if("string"==typeof t[n])return!0;v=["Moz","Webkit","Khtml","O","ms"],n=n.charAt(0).toUpperCase()+n.substr(1);for(var r=0;r<v.length;r++)if("string"==typeof t[v[r]+n])return!0;return!1}var a="tooltipster",l={animation:"fade",arrow:!0,arrowColor:"",autoClose:!0,content:null,contentAsHTML:!1,contentCloning:!0,debug:!0,delay:200,minWidth:0,maxWidth:null,functionInit:function(e,t){},functionBefore:function(e,t){t()},functionReady:function(e,t){},functionAfter:function(e){},hideOnClick:!1,icon:"(?)",iconCloning:!0,iconDesktop:!1,iconTouch:!1,iconTheme:"tooltipster-icon",interactive:!1,interactiveTolerance:350,multiple:!1,offsetX:0,offsetY:0,onlyOne:!1,position:"top",positionTracker:!1,positionTrackerCallback:function(e){"hover"==this.option("trigger")&&this.option("autoClose")&&this.hide()},restoration:"current",speed:350,timer:0,theme:"tooltipster-default",touchDevices:!0,trigger:"hover",updateAnimation:!0};n.prototype={_init:function(){var t=this;if(i.querySelector){var n=null;void 0===t.$el.data("tooltipster-initialTitle")&&(n=t.$el.attr("title"),void 0===n&&(n=null),t.$el.data("tooltipster-initialTitle",n)),null!==t.options.content?t._content_set(t.options.content):t._content_set(n);var r=t.options.functionInit.call(t.$el,t.$el,t.Content);"undefined"!=typeof r&&t._content_set(r),t.$el.removeAttr("title").addClass("tooltipstered"),!c&&t.options.iconDesktop||c&&t.options.iconTouch?("string"==typeof t.options.icon?(t.$elProxy=e('<span class="'+t.options.iconTheme+'"></span>'),t.$elProxy.text(t.options.icon)):t.options.iconCloning?t.$elProxy=t.options.icon.clone(!0):t.$elProxy=t.options.icon,t.$elProxy.insertAfter(t.$el)):t.$elProxy=t.$el,"hover"==t.options.trigger?(t.$elProxy.on("mouseenter."+t.namespace,function(){(!o()||t.options.touchDevices)&&(t.mouseIsOverProxy=!0,t._show())}).on("mouseleave."+t.namespace,function(){(!o()||t.options.touchDevices)&&(t.mouseIsOverProxy=!1)}),c&&t.options.touchDevices&&t.$elProxy.on("touchstart."+t.namespace,function(){t._showNow()})):"click"==t.options.trigger&&t.$elProxy.on("click."+t.namespace,function(){(!o()||t.options.touchDevices)&&t._show()})}},_show:function(){var e=this;"shown"!=e.Status&&"appearing"!=e.Status&&(e.options.delay?e.timerShow=setTimeout(function(){("click"==e.options.trigger||"hover"==e.options.trigger&&e.mouseIsOverProxy)&&e._showNow()},e.options.delay):e._showNow())},_showNow:function(i){var n=this;n.options.functionBefore.call(n.$el,n.$el,function(){if(n.enabled&&null!==n.Content){i&&n.callbacks.show.push(i),n.callbacks.hide=[],clearTimeout(n.timerShow),n.timerShow=null,clearTimeout(n.timerHide),n.timerHide=null,n.options.onlyOne&&e(".tooltipstered").not(n.$el).each(function(t,i){var n=e(i),r=n.data("tooltipster-ns");
e.each(r,function(e,t){var i=n.data(t),r=i.status(),o=i.option("autoClose");"hidden"!==r&&"disappearing"!==r&&o&&i.hide()})});var r=function(){n.Status="shown",e.each(n.callbacks.show,function(e,t){t.call(n.$el)}),n.callbacks.show=[]};if("hidden"!==n.Status){var o=0;"disappearing"===n.Status?(n.Status="appearing",s()?(n.$tooltip.clearQueue().removeClass("tooltipster-dying").addClass("tooltipster-"+n.options.animation+"-show"),n.options.speed>0&&n.$tooltip.delay(n.options.speed),n.$tooltip.queue(r)):n.$tooltip.stop().fadeIn(r)):"shown"===n.Status&&r()}else{n.Status="appearing";var o=n.options.speed;n.bodyOverflowX=e("body").css("overflow-x"),e("body").css("overflow-x","hidden");var a="tooltipster-"+n.options.animation,l="-webkit-transition-duration: "+n.options.speed+"ms; -webkit-animation-duration: "+n.options.speed+"ms; -moz-transition-duration: "+n.options.speed+"ms; -moz-animation-duration: "+n.options.speed+"ms; -o-transition-duration: "+n.options.speed+"ms; -o-animation-duration: "+n.options.speed+"ms; -ms-transition-duration: "+n.options.speed+"ms; -ms-animation-duration: "+n.options.speed+"ms; transition-duration: "+n.options.speed+"ms; animation-duration: "+n.options.speed+"ms;",d=n.options.minWidth?"min-width:"+Math.round(n.options.minWidth)+"px;":"",u=n.options.maxWidth?"max-width:"+Math.round(n.options.maxWidth)+"px;":"",p=n.options.interactive?"pointer-events: auto;":"";if(n.$tooltip=e('<div class="tooltipster-base '+n.options.theme+'" style="'+d+" "+u+" "+p+" "+l+'"><div class="tooltipster-content"></div></div>'),s()&&n.$tooltip.addClass(a),n._content_insert(),n.$tooltip.appendTo("body"),n.reposition(),n.options.functionReady.call(n.$el,n.$el,n.$tooltip),s()?(n.$tooltip.addClass(a+"-show"),n.options.speed>0&&n.$tooltip.delay(n.options.speed),n.$tooltip.queue(r)):n.$tooltip.css("display","none").fadeIn(n.options.speed,r),n._interval_set(),e(t).on("scroll."+n.namespace+" resize."+n.namespace,function(){n.reposition()}),n.options.autoClose)if(e("body").off("."+n.namespace),"hover"==n.options.trigger){if(c&&setTimeout(function(){e("body").on("touchstart."+n.namespace,function(){n.hide()})},0),n.options.interactive){c&&n.$tooltip.on("touchstart."+n.namespace,function(e){e.stopPropagation()});var h=null;n.$elProxy.add(n.$tooltip).on("mouseleave."+n.namespace+"-autoClose",function(){clearTimeout(h),h=setTimeout(function(){n.hide()},n.options.interactiveTolerance)}).on("mouseenter."+n.namespace+"-autoClose",function(){clearTimeout(h)})}else n.$elProxy.on("mouseleave."+n.namespace+"-autoClose",function(){n.hide()});n.options.hideOnClick&&n.$elProxy.on("click."+n.namespace+"-autoClose",function(){n.hide()})}else"click"==n.options.trigger&&(setTimeout(function(){e("body").on("click."+n.namespace+" touchstart."+n.namespace,function(){n.hide()})},0),n.options.interactive&&n.$tooltip.on("click."+n.namespace+" touchstart."+n.namespace,function(e){e.stopPropagation()}))}n.options.timer>0&&(n.timerHide=setTimeout(function(){n.timerHide=null,n.hide()},n.options.timer+o))}})},_interval_set:function(){var t=this;t.checkInterval=setInterval(function(){if(0===e("body").find(t.$el).length||0===e("body").find(t.$elProxy).length||"hidden"==t.Status||0===e("body").find(t.$tooltip).length)("shown"==t.Status||"appearing"==t.Status)&&t.hide(),t._interval_cancel();else if(t.options.positionTracker){var i=t._repositionInfo(t.$elProxy),n=!1;r(i.dimension,t.elProxyPosition.dimension)&&("fixed"===t.$elProxy.css("position")?r(i.position,t.elProxyPosition.position)&&(n=!0):r(i.offset,t.elProxyPosition.offset)&&(n=!0)),n||(t.reposition(),t.options.positionTrackerCallback.call(t,t.$el))}},200)},_interval_cancel:function(){clearInterval(this.checkInterval),this.checkInterval=null},_content_set:function(e){"object"==typeof e&&null!==e&&this.options.contentCloning&&(e=e.clone(!0)),this.Content=e},_content_insert:function(){var e=this,t=this.$tooltip.find(".tooltipster-content");"string"!=typeof e.Content||e.options.contentAsHTML?t.empty().append(e.Content):t.text(e.Content)},_update:function(e){var t=this;t._content_set(e),null!==t.Content?"hidden"!==t.Status&&(t._content_insert(),t.reposition(),t.options.updateAnimation&&(s()?(t.$tooltip.css({width:"","-webkit-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-moz-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-o-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-ms-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms",transition:"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms"}).addClass("tooltipster-content-changing"),setTimeout(function(){"hidden"!=t.Status&&(t.$tooltip.removeClass("tooltipster-content-changing"),setTimeout(function(){"hidden"!==t.Status&&t.$tooltip.css({"-webkit-transition":t.options.speed+"ms","-moz-transition":t.options.speed+"ms","-o-transition":t.options.speed+"ms","-ms-transition":t.options.speed+"ms",transition:t.options.speed+"ms"})},t.options.speed))},t.options.speed)):t.$tooltip.fadeTo(t.options.speed,.5,function(){"hidden"!=t.Status&&t.$tooltip.fadeTo(t.options.speed,1)}))):t.hide()},_repositionInfo:function(e){return{dimension:{height:e.outerHeight(!1),width:e.outerWidth(!1)},offset:e.offset(),position:{left:parseInt(e.css("left")),top:parseInt(e.css("top"))}}},hide:function(i){var n=this;i&&n.callbacks.hide.push(i),n.callbacks.show=[],clearTimeout(n.timerShow),n.timerShow=null,clearTimeout(n.timerHide),n.timerHide=null;var r=function(){e.each(n.callbacks.hide,function(e,t){t.call(n.$el)}),n.callbacks.hide=[]};if("shown"==n.Status||"appearing"==n.Status){n.Status="disappearing";var o=function(){n.Status="hidden","object"==typeof n.Content&&null!==n.Content&&n.Content.detach(),n.$tooltip.remove(),n.$tooltip=null,e(t).off("."+n.namespace),e("body").off("."+n.namespace).css("overflow-x",n.bodyOverflowX),e("body").off("."+n.namespace),n.$elProxy.off("."+n.namespace+"-autoClose"),n.options.functionAfter.call(n.$el,n.$el),r()};s()?(n.$tooltip.clearQueue().removeClass("tooltipster-"+n.options.animation+"-show").addClass("tooltipster-dying"),n.options.speed>0&&n.$tooltip.delay(n.options.speed),n.$tooltip.queue(o)):n.$tooltip.stop().fadeOut(n.options.speed,o)}else"hidden"==n.Status&&r();return n},show:function(e){return this._showNow(e),this},update:function(e){return this.content(e)},content:function(e){return"undefined"==typeof e?this.Content:(this._update(e),this)},reposition:function(){function i(){var i=e(t).scrollLeft();0>T-i&&(o=T-i,T=i),T+l-i>s&&(o=T-(s+i-l),T=s+i-l)}function n(i,n){a.offset.top-e(t).scrollTop()-c-I-12<0&&n.indexOf("top")>-1&&(D=i),a.offset.top+a.dimension.height+c+12+I>e(t).scrollTop()+e(t).height()&&n.indexOf("bottom")>-1&&(D=i,A=a.offset.top-c-I-12)}var r=this;if(0!==e("body").find(r.$tooltip).length){r.$tooltip.css("width",""),r.elProxyPosition=r._repositionInfo(r.$elProxy);var o=null,s=e(t).width(),a=r.elProxyPosition,l=r.$tooltip.outerWidth(!1),c=(r.$tooltip.innerWidth()+1,r.$tooltip.outerHeight(!1));if(r.$elProxy.is("area")){var d=r.$elProxy.attr("shape"),u=r.$elProxy.parent().attr("name"),p=e('img[usemap="#'+u+'"]'),h=p.offset().left,f=p.offset().top,m=void 0!==r.$elProxy.attr("coords")?r.$elProxy.attr("coords").split(","):void 0;if("circle"==d){var _=parseInt(m[0]),v=parseInt(m[1]),g=parseInt(m[2]);a.dimension.height=2*g,a.dimension.width=2*g,a.offset.top=f+v-g,a.offset.left=h+_-g}else if("rect"==d){var _=parseInt(m[0]),v=parseInt(m[1]),y=parseInt(m[2]),b=parseInt(m[3]);a.dimension.height=b-v,a.dimension.width=y-_,a.offset.top=f+v,a.offset.left=h+_}else if("poly"==d){for(var w=0,S=0,C=0,x=0,E="even",M=0;M<m.length;M++){var O=parseInt(m[M]);"even"==E?(O>C&&(C=O,0===M&&(w=C)),w>O&&(w=O),E="odd"):(O>x&&(x=O,1==M&&(S=x)),S>O&&(S=O),E="even")}a.dimension.height=x-S,a.dimension.width=C-w,a.offset.top=f+S,a.offset.left=h+w}else a.dimension.height=p.outerHeight(!1),a.dimension.width=p.outerWidth(!1),a.offset.top=f,a.offset.left=h}var T=0,$=0,A=0,I=parseInt(r.options.offsetY),N=parseInt(r.options.offsetX),D=r.options.position;if("top"==D){var k=a.offset.left+l-(a.offset.left+a.dimension.width);T=a.offset.left+N-k/2,A=a.offset.top-c-I-12,i(),n("bottom","top")}if("top-left"==D&&(T=a.offset.left+N,A=a.offset.top-c-I-12,i(),n("bottom-left","top-left")),"top-right"==D&&(T=a.offset.left+a.dimension.width+N-l,A=a.offset.top-c-I-12,i(),n("bottom-right","top-right")),"bottom"==D){var k=a.offset.left+l-(a.offset.left+a.dimension.width);T=a.offset.left-k/2+N,A=a.offset.top+a.dimension.height+I+12,i(),n("top","bottom")}if("bottom-left"==D&&(T=a.offset.left+N,A=a.offset.top+a.dimension.height+I+12,i(),n("top-left","bottom-left")),"bottom-right"==D&&(T=a.offset.left+a.dimension.width+N-l,A=a.offset.top+a.dimension.height+I+12,i(),n("top-right","bottom-right")),"left"==D){T=a.offset.left-N-l-12,$=a.offset.left+N+a.dimension.width+12;var P=a.offset.top+c-(a.offset.top+a.dimension.height);if(A=a.offset.top-P/2-I,0>T&&$+l>s){var j=2*parseFloat(r.$tooltip.css("border-width")),V=l+T-j;r.$tooltip.css("width",V+"px"),c=r.$tooltip.outerHeight(!1),T=a.offset.left-N-V-12-j,P=a.offset.top+c-(a.offset.top+a.dimension.height),A=a.offset.top-P/2-I}else 0>T&&(T=a.offset.left+N+a.dimension.width+12,o="left")}if("right"==D){T=a.offset.left+N+a.dimension.width+12,$=a.offset.left-N-l-12;var P=a.offset.top+c-(a.offset.top+a.dimension.height);if(A=a.offset.top-P/2-I,T+l>s&&0>$){var j=2*parseFloat(r.$tooltip.css("border-width")),V=s-T-j;r.$tooltip.css("width",V+"px"),c=r.$tooltip.outerHeight(!1),P=a.offset.top+c-(a.offset.top+a.dimension.height),A=a.offset.top-P/2-I}else T+l>s&&(T=a.offset.left-N-l-12,o="right")}if(r.options.arrow){var R="tooltipster-arrow-"+D;if(r.options.arrowColor.length<1)var L=r.$tooltip.css("background-color");else var L=r.options.arrowColor;if(o?"left"==o?(R="tooltipster-arrow-right",o=""):"right"==o?(R="tooltipster-arrow-left",o=""):o="left:"+Math.round(o)+"px;":o="","top"==D||"top-left"==D||"top-right"==D)var q=parseFloat(r.$tooltip.css("border-bottom-width")),G=r.$tooltip.css("border-bottom-color");else if("bottom"==D||"bottom-left"==D||"bottom-right"==D)var q=parseFloat(r.$tooltip.css("border-top-width")),G=r.$tooltip.css("border-top-color");else if("left"==D)var q=parseFloat(r.$tooltip.css("border-right-width")),G=r.$tooltip.css("border-right-color");else if("right"==D)var q=parseFloat(r.$tooltip.css("border-left-width")),G=r.$tooltip.css("border-left-color");else var q=parseFloat(r.$tooltip.css("border-bottom-width")),G=r.$tooltip.css("border-bottom-color");q>1&&q++;var U="";if(0!==q){var F="",H="border-color: "+G+";";-1!==R.indexOf("bottom")?F="margin-top: -"+Math.round(q)+"px;":-1!==R.indexOf("top")?F="margin-bottom: -"+Math.round(q)+"px;":-1!==R.indexOf("left")?F="margin-right: -"+Math.round(q)+"px;":-1!==R.indexOf("right")&&(F="margin-left: -"+Math.round(q)+"px;"),U='<span class="tooltipster-arrow-border" style="'+F+" "+H+';"></span>'}r.$tooltip.find(".tooltipster-arrow").remove();var B='<div class="'+R+' tooltipster-arrow" style="'+o+'">'+U+'<span style="border-color:'+L+';"></span></div>';r.$tooltip.append(B)}r.$tooltip.css({top:Math.round(A)+"px",left:Math.round(T)+"px"})}return r},enable:function(){return this.enabled=!0,this},disable:function(){return this.hide(),this.enabled=!1,this},destroy:function(){var t=this;t.hide(),t.$el[0]!==t.$elProxy[0]&&t.$elProxy.remove(),t.$el.removeData(t.namespace).off("."+t.namespace);var i=t.$el.data("tooltipster-ns");if(1===i.length){var n=null;"previous"===t.options.restoration?n=t.$el.data("tooltipster-initialTitle"):"current"===t.options.restoration&&(n="string"==typeof t.Content?t.Content:e("<div></div>").append(t.Content).html()),n&&t.$el.attr("title",n),t.$el.removeClass("tooltipstered").removeData("tooltipster-ns").removeData("tooltipster-initialTitle")}else i=e.grep(i,function(e,i){return e!==t.namespace}),t.$el.data("tooltipster-ns",i);return t},elementIcon:function(){return this.$el[0]!==this.$elProxy[0]?this.$elProxy[0]:void 0},elementTooltip:function(){return this.$tooltip?this.$tooltip[0]:void 0},option:function(e,t){return"undefined"==typeof t?this.options[e]:(this.options[e]=t,this)},status:function(){return this.Status}},e.fn[a]=function(){var t=arguments;if(0===this.length){if("string"==typeof t[0]){var i=!0;switch(t[0]){case"setDefaults":e.extend(l,t[1]);break;default:i=!1}return i?!0:this}return this}if("string"==typeof t[0]){var r="#*$~&";return this.each(function(){var i=e(this).data("tooltipster-ns"),n=i?e(this).data(i[0]):null;if(!n)throw new Error("You called Tooltipster's \""+t[0]+'" method on an uninitialized element');if("function"!=typeof n[t[0]])throw new Error('Unknown method .tooltipster("'+t[0]+'")');var o=n[t[0]](t[1],t[2]);return o!==n?(r=o,!1):void 0}),"#*$~&"!==r?r:this}var o=[],s=t[0]&&"undefined"!=typeof t[0].multiple,a=s&&t[0].multiple||!s&&l.multiple,c=t[0]&&"undefined"!=typeof t[0].debug,d=c&&t[0].debug||!c&&l.debug;return this.each(function(){var i=!1,r=e(this).data("tooltipster-ns"),s=null;r?a?i=!0:d&&console.log('Tooltipster: one or more tooltips are already attached to this element: ignoring. Use the "multiple" option to attach more tooltips.'):i=!0,i&&(s=new n(this,t[0]),r||(r=[]),r.push(s.namespace),e(this).data("tooltipster-ns",r),e(this).data(s.namespace,s)),o.push(s)}),a?o:this};var c=!!("ontouchstart"in t),d=!1;e("body").one("mousemove",function(){d=!0})}(jQuery,window,document),define("tooltipster",function(){}),function(e){"function"==typeof define&&define.amd?define("select2",["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){var t=function(){if(e&&e.fn&&e.fn.select2&&e.fn.select2.amd)var t=e.fn.select2.amd;var t;return function(){if(!t||!t.requirejs){t?i=t:t={};var e,i,n;!function(t){function r(e,t){return b.call(e,t)}function o(e,t){var i,n,r,o,s,a,l,c,d,u,p,h=t&&t.split("/"),f=g.map,m=f&&f["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=e.split("/"),s=e.length-1,g.nodeIdCompat&&S.test(e[s])&&(e[s]=e[s].replace(S,"")),e=h.slice(0,h.length-1).concat(e),d=0;d<e.length;d+=1)if(p=e[d],"."===p)e.splice(d,1),d-=1;else if(".."===p){if(1===d&&(".."===e[2]||".."===e[0]))break;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||m)&&f){for(i=e.split("/"),d=i.length;d>0;d-=1){if(n=i.slice(0,d).join("/"),h)for(u=h.length;u>0;u-=1)if(r=f[h.slice(0,u).join("/")],r&&(r=r[n])){o=r,a=d;break}if(o)break;!l&&m&&m[n]&&(l=m[n],c=d)}!o&&l&&(o=l,a=c),o&&(i.splice(0,a,o),e=i.join("/"))}return e}function s(e,i){return function(){var n=w.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),h.apply(t,n.concat([e,i]))}}function a(e){return function(t){return o(t,e)}}function l(e){return function(t){_[e]=t}}function c(e){if(r(v,e)){var i=v[e];delete v[e],y[e]=!0,p.apply(t,i)}if(!r(_,e)&&!r(y,e))throw new Error("No "+e);return _[e]}function d(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function u(e){return function(){return g&&g.config&&g.config[e]||{}}}var p,h,f,m,_={},v={},g={},y={},b=Object.prototype.hasOwnProperty,w=[].slice,S=/\.js$/;f=function(e,t){var i,n=d(e),r=n[0];return e=n[1],r&&(r=o(r,t),i=c(r)),r?e=i&&i.normalize?i.normalize(e,a(t)):o(e,t):(e=o(e,t),n=d(e),r=n[0],e=n[1],r&&(i=c(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:i}},m={require:function(e){return s(e)},exports:function(e){var t=_[e];return"undefined"!=typeof t?t:_[e]={}},module:function(e){return{id:e,uri:"",exports:_[e],config:u(e)}}},p=function(e,i,n,o){var a,d,u,p,h,g,b=[],w=typeof n;if(o=o||e,"undefined"===w||"function"===w){for(i=!i.length&&n.length?["require","exports","module"]:i,h=0;h<i.length;h+=1)if(p=f(i[h],o),d=p.f,"require"===d)b[h]=m.require(e);else if("exports"===d)b[h]=m.exports(e),g=!0;else if("module"===d)a=b[h]=m.module(e);else if(r(_,d)||r(v,d)||r(y,d))b[h]=c(d);else{if(!p.p)throw new Error(e+" missing "+d);p.p.load(p.n,s(o,!0),l(d),{}),b[h]=_[d]}u=n?n.apply(_[e],b):void 0,e&&(a&&a.exports!==t&&a.exports!==_[e]?_[e]=a.exports:u===t&&g||(_[e]=u))}else e&&(_[e]=n)},e=i=h=function(e,i,n,r,o){if("string"==typeof e)return m[e]?m[e](i):c(f(e,i).f);if(!e.splice){if(g=e,g.deps&&h(g.deps,g.callback),!i)return;i.splice?(e=i,i=n,n=null):e=t}return i=i||function(){},"function"==typeof n&&(n=r,r=o),r?p(t,e,i,n):setTimeout(function(){p(t,e,i,n)},4),h},h.config=function(e){return h(e)},e._defined=_,n=function(e,t,i){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(i=t,t=[]),r(_,e)||r(v,e)||(v[e]=[e,t,i])},n.amd={jQuery:!0}}(),t.requirejs=e,t.require=i,t.define=n}}(),t.define("almond",function(){}),t.define("jquery",[],function(){var t=e||$;return null==t&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),t}),t.define("select2/utils",["jquery"],function(e){function t(e){var t=e.prototype,i=[];for(var n in t){var r=t[n];"function"==typeof r&&"constructor"!==n&&i.push(n)}return i}var i={};i.Extend=function(e,t){function i(){this.constructor=e}var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},i.Decorate=function(e,i){function n(){var t=Array.prototype.unshift,n=i.prototype.constructor.length,r=e.prototype.constructor;n>0&&(t.call(arguments,e.prototype.constructor),r=i.prototype.constructor),r.apply(this,arguments)}function r(){this.constructor=n}var o=t(i),s=t(e);i.displayName=e.displayName,n.prototype=new r;for(var a=0;a<s.length;a++){var l=s[a];n.prototype[l]=e.prototype[l]}for(var c=(function(e){var t=function(){};e in n.prototype&&(t=n.prototype[e]);var r=i.prototype[e];return function(){var e=Array.prototype.unshift;return e.call(arguments,t),r.apply(this,arguments)}}),d=0;d<o.length;d++){var u=o[d];n.prototype[u]=c(u)}return n};var n=function(){this.listeners={}};return n.prototype.on=function(e,t){this.listeners=this.listeners||{},e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]},n.prototype.trigger=function(e){var t=Array.prototype.slice,i=t.call(arguments,1);this.listeners=this.listeners||{},null==i&&(i=[]),0===i.length&&i.push({}),i[0]._type=e,e in this.listeners&&this.invoke(this.listeners[e],t.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},n.prototype.invoke=function(e,t){for(var i=0,n=e.length;n>i;i++)e[i].apply(this,t)},i.Observable=n,i.generateChars=function(e){for(var t="",i=0;e>i;i++){var n=Math.floor(36*Math.random());t+=n.toString(36)}return t},i.bind=function(e,t){return function(){e.apply(t,arguments)}},i._convertData=function(e){for(var t in e){var i=t.split("-"),n=e;if(1!==i.length){for(var r=0;r<i.length;r++){var o=i[r];o=o.substring(0,1).toLowerCase()+o.substring(1),o in n||(n[o]={}),r==i.length-1&&(n[o]=e[t]),n=n[o]}delete e[t]}}return e},i.hasScroll=function(t,i){var n=e(i),r=i.style.overflowX,o=i.style.overflowY;return r!==o||"hidden"!==o&&"visible"!==o?"scroll"===r||"scroll"===o?!0:n.innerHeight()<i.scrollHeight||n.innerWidth()<i.scrollWidth:!1},i.escapeMarkup=function(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof e?e:String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})},i.appendMany=function(t,i){if("1.7"===e.fn.jquery.substr(0,3)){var n=e();e.map(i,function(e){n=n.add(e)}),i=n}t.append(i)},i}),t.define("select2/results",["jquery","./utils"],function(e,t){function i(e,t,n){this.$element=e,this.data=n,this.options=t,i.__super__.constructor.call(this)}return t.Extend(i,t.Observable),i.prototype.render=function(){var t=e('<ul class="select2-results__options" role="tree"></ul>');return this.options.get("multiple")&&t.attr("aria-multiselectable","true"),this.$results=t,t},i.prototype.clear=function(){this.$results.empty()},i.prototype.displayMessage=function(t){var i=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var n=e('<li role="treeitem" aria-live="assertive" class="select2-results__option"></li>'),r=this.options.get("translations").get(t.message);n.append(i(r(t.args))),n[0].className+=" select2-results__message",this.$results.append(n)},i.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},i.prototype.append=function(e){this.hideLoading();var t=[];if(null==e.results||0===e.results.length)return void(0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"}));e.results=this.sort(e.results);for(var i=0;i<e.results.length;i++){var n=e.results[i],r=this.option(n);t.push(r)}this.$results.append(t)},i.prototype.position=function(e,t){var i=t.find(".select2-results");i.append(e)},i.prototype.sort=function(e){var t=this.options.get("sorter");return t(e)},i.prototype.highlightFirstItem=function(){var e=this.$results.find(".select2-results__option[aria-selected]"),t=e.filter("[aria-selected=true]");t.length>0?t.first().trigger("mouseenter"):e.first().trigger("mouseenter"),this.ensureHighlightVisible()},i.prototype.setClasses=function(){var t=this;this.data.current(function(i){var n=e.map(i,function(e){return e.id.toString()}),r=t.$results.find(".select2-results__option[aria-selected]");r.each(function(){var t=e(this),i=e.data(this,"data"),r=""+i.id;null!=i.element&&i.element.selected||null==i.element&&e.inArray(r,n)>-1?t.attr("aria-selected","true"):t.attr("aria-selected","false")})})},i.prototype.showLoading=function(e){this.hideLoading();var t=this.options.get("translations").get("searching"),i={disabled:!0,loading:!0,text:t(e)},n=this.option(i);n.className+=" loading-results",this.$results.prepend(n)},i.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},i.prototype.option=function(t){var i=document.createElement("li");i.className="select2-results__option";var n={role:"treeitem","aria-selected":"false"};t.disabled&&(delete n["aria-selected"],n["aria-disabled"]="true"),null==t.id&&delete n["aria-selected"],null!=t._resultId&&(i.id=t._resultId),t.title&&(i.title=t.title),t.children&&(n.role="group",n["aria-label"]=t.text,delete n["aria-selected"]);for(var r in n){var o=n[r];i.setAttribute(r,o)}if(t.children){var s=e(i),a=document.createElement("strong");a.className="select2-results__group";e(a);this.template(t,a);for(var l=[],c=0;c<t.children.length;c++){var d=t.children[c],u=this.option(d);l.push(u)}var p=e("<ul></ul>",{"class":"select2-results__options select2-results__options--nested"});p.append(l),s.append(a),s.append(p)}else this.template(t,i);return e.data(i,"data",t),i},i.prototype.bind=function(t,i){var n=this,r=t.id+"-results";this.$results.attr("id",r),t.on("results:all",function(e){n.clear(),n.append(e.data),t.isOpen()&&(n.setClasses(),n.highlightFirstItem())}),t.on("results:append",function(e){n.append(e.data),t.isOpen()&&n.setClasses()}),t.on("query",function(e){n.hideMessages(),n.showLoading(e)}),t.on("select",function(){t.isOpen()&&(n.setClasses(),n.highlightFirstItem())}),t.on("unselect",function(){t.isOpen()&&(n.setClasses(),n.highlightFirstItem())}),t.on("open",function(){n.$results.attr("aria-expanded","true"),n.$results.attr("aria-hidden","false"),n.setClasses(),n.ensureHighlightVisible()}),t.on("close",function(){n.$results.attr("aria-expanded","false"),n.$results.attr("aria-hidden","true"),n.$results.removeAttr("aria-activedescendant")}),t.on("results:toggle",function(){var e=n.getHighlightedResults();0!==e.length&&e.trigger("mouseup")}),t.on("results:select",function(){var e=n.getHighlightedResults();if(0!==e.length){var t=e.data("data");"true"==e.attr("aria-selected")?n.trigger("close",{}):n.trigger("select",{data:t})}}),t.on("results:previous",function(){var e=n.getHighlightedResults(),t=n.$results.find("[aria-selected]"),i=t.index(e);if(0!==i){var r=i-1;0===e.length&&(r=0);var o=t.eq(r);o.trigger("mouseenter");var s=n.$results.offset().top,a=o.offset().top,l=n.$results.scrollTop()+(a-s);0===r?n.$results.scrollTop(0):0>a-s&&n.$results.scrollTop(l)}}),t.on("results:next",function(){var e=n.getHighlightedResults(),t=n.$results.find("[aria-selected]"),i=t.index(e),r=i+1;if(!(r>=t.length)){var o=t.eq(r);o.trigger("mouseenter");var s=n.$results.offset().top+n.$results.outerHeight(!1),a=o.offset().top+o.outerHeight(!1),l=n.$results.scrollTop()+a-s;0===r?n.$results.scrollTop(0):a>s&&n.$results.scrollTop(l)}}),t.on("results:focus",function(e){e.element.addClass("select2-results__option--highlighted")}),t.on("results:message",function(e){n.displayMessage(e)}),e.fn.mousewheel&&this.$results.on("mousewheel",function(e){var t=n.$results.scrollTop(),i=n.$results.get(0).scrollHeight-t+e.deltaY,r=e.deltaY>0&&t-e.deltaY<=0,o=e.deltaY<0&&i<=n.$results.height();r?(n.$results.scrollTop(0),e.preventDefault(),e.stopPropagation()):o&&(n.$results.scrollTop(n.$results.get(0).scrollHeight-n.$results.height()),e.preventDefault(),e.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(t){var i=e(this),r=i.data("data");return"true"===i.attr("aria-selected")?void(n.options.get("multiple")?n.trigger("unselect",{originalEvent:t,data:r}):n.trigger("close",{})):void n.trigger("select",{originalEvent:t,data:r})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(t){var i=e(this).data("data");n.getHighlightedResults().removeClass("select2-results__option--highlighted"),n.trigger("results:focus",{data:i,element:e(this)})})},i.prototype.getHighlightedResults=function(){var e=this.$results.find(".select2-results__option--highlighted");return e},i.prototype.destroy=function(){this.$results.remove()},i.prototype.ensureHighlightVisible=function(){var e=this.getHighlightedResults();if(0!==e.length){var t=this.$results.find("[aria-selected]"),i=t.index(e),n=this.$results.offset().top,r=e.offset().top,o=this.$results.scrollTop()+(r-n),s=r-n;o-=2*e.outerHeight(!1),2>=i?this.$results.scrollTop(0):(s>this.$results.outerHeight()||0>s)&&this.$results.scrollTop(o)}},i.prototype.template=function(t,i){var n=this.options.get("templateResult"),r=this.options.get("escapeMarkup"),o=n(t,i);null==o?i.style.display="none":"string"==typeof o?i.innerHTML=r(o):e(i).append(o)},i}),t.define("select2/keys",[],function(){var e={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46};return e}),t.define("select2/selection/base",["jquery","../utils","../keys"],function(e,t,i){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return t.Extend(n,t.Observable),n.prototype.render=function(){var t=e('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=this.$element.data("old-tabindex")?this._tabindex=this.$element.data("old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),t.attr("title",this.$element.attr("title")),t.attr("tabindex",this._tabindex),this.$selection=t,t},n.prototype.bind=function(e,t){var n=this,r=(e.id+"-container",e.id+"-results");this.container=e,this.$selection.on("focus",function(e){n.trigger("focus",e)}),this.$selection.on("blur",function(e){n._handleBlur(e)}),this.$selection.on("keydown",function(e){n.trigger("keypress",e),e.which===i.SPACE&&e.preventDefault()}),e.on("results:focus",function(e){n.$selection.attr("aria-activedescendant",e.data._resultId)}),e.on("selection:update",function(e){n.update(e.data)}),e.on("open",function(){n.$selection.attr("aria-expanded","true"),n.$selection.attr("aria-owns",r),n._attachCloseHandler(e)}),e.on("close",function(){n.$selection.attr("aria-expanded","false"),n.$selection.removeAttr("aria-activedescendant"),n.$selection.removeAttr("aria-owns"),n.$selection.focus(),n._detachCloseHandler(e)}),e.on("enable",function(){n.$selection.attr("tabindex",n._tabindex)}),e.on("disable",function(){n.$selection.attr("tabindex","-1")})},n.prototype._handleBlur=function(t){var i=this;window.setTimeout(function(){document.activeElement==i.$selection[0]||e.contains(i.$selection[0],document.activeElement)||i.trigger("blur",t)},1)},n.prototype._attachCloseHandler=function(t){e(document.body).on("mousedown.select2."+t.id,function(t){var i=e(t.target),n=i.closest(".select2"),r=e(".select2.select2-container--open");r.each(function(){var t=e(this);if(this!=n[0]){var i=t.data("element");i.select2("close")}})})},n.prototype._detachCloseHandler=function(t){e(document.body).off("mousedown.select2."+t.id)},n.prototype.position=function(e,t){var i=t.find(".selection");i.append(e)},n.prototype.destroy=function(){this._detachCloseHandler(this.container)},n.prototype.update=function(e){throw new Error("The `update` method must be defined in child classes.")},n}),t.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(e,t,i,n){function r(){r.__super__.constructor.apply(this,arguments)}return i.Extend(r,t),r.prototype.render=function(){var e=r.__super__.render.call(this);return e.addClass("select2-selection--single"),e.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),e},r.prototype.bind=function(e,t){var i=this;r.__super__.bind.apply(this,arguments);var n=e.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",n),this.$selection.attr("aria-labelledby",n),this.$selection.on("mousedown",function(e){1===e.which&&i.trigger("toggle",{originalEvent:e})}),this.$selection.on("focus",function(e){}),this.$selection.on("blur",function(e){}),e.on("focus",function(t){e.isOpen()||i.$selection.focus()}),e.on("selection:update",function(e){i.update(e.data)})},r.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},r.prototype.display=function(e,t){var i=this.options.get("templateSelection"),n=this.options.get("escapeMarkup");return n(i(e,t))},r.prototype.selectionContainer=function(){return e("<span></span>")},r.prototype.update=function(e){if(0===e.length)return void this.clear();var t=e[0],i=this.$selection.find(".select2-selection__rendered"),n=this.display(t,i);i.empty().append(n),i.prop("title",t.title||t.text)},r}),t.define("select2/selection/multiple",["jquery","./base","../utils"],function(e,t,i){function n(e,t){n.__super__.constructor.apply(this,arguments)}return i.Extend(n,t),n.prototype.render=function(){var e=n.__super__.render.call(this);return e.addClass("select2-selection--multiple"),e.html('<ul class="select2-selection__rendered"></ul>'),e},n.prototype.bind=function(t,i){var r=this;n.__super__.bind.apply(this,arguments),this.$selection.on("click",function(e){r.trigger("toggle",{originalEvent:e})}),this.$selection.on("click",".select2-selection__choice__remove",function(t){if(!r.options.get("disabled")){var i=e(this),n=i.parent(),o=n.data("data");r.trigger("unselect",{originalEvent:t,data:o})}})},n.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},n.prototype.display=function(e,t){var i=this.options.get("templateSelection"),n=this.options.get("escapeMarkup");return n(i(e,t))},n.prototype.selectionContainer=function(){var t=e('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>');return t},n.prototype.update=function(e){if(this.clear(),0!==e.length){for(var t=[],n=0;n<e.length;n++){var r=e[n],o=this.selectionContainer(),s=this.display(r,o);o.append(s),o.prop("title",r.title||r.text),o.data("data",r),t.push(o)}var a=this.$selection.find(".select2-selection__rendered");i.appendMany(a,t)}},n}),t.define("select2/selection/placeholder",["../utils"],function(e){function t(e,t,i){this.placeholder=this.normalizePlaceholder(i.get("placeholder")),e.call(this,t,i)}return t.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t
}),t},t.prototype.createPlaceholder=function(e,t){var i=this.selectionContainer();return i.html(this.display(t)),i.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),i},t.prototype.update=function(e,t){var i=1==t.length&&t[0].id!=this.placeholder.id,n=t.length>1;if(n||i)return e.call(this,t);this.clear();var r=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(r)},t}),t.define("select2/selection/allowClear",["jquery","../keys"],function(e,t){function i(){}return i.prototype.bind=function(e,t,i){var n=this;e.call(this,t,i),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(e){n._handleClear(e)}),t.on("keypress",function(e){n._handleKeyboardClear(e,t)})},i.prototype._handleClear=function(e,t){if(!this.options.get("disabled")){var i=this.$selection.find(".select2-selection__clear");if(0!==i.length){t.stopPropagation();for(var n=i.data("data"),r=0;r<n.length;r++){var o={data:n[r]};if(this.trigger("unselect",o),o.prevented)return}this.$element.val(this.placeholder.id).trigger("change"),this.trigger("toggle",{})}}},i.prototype._handleKeyboardClear=function(e,i,n){n.isOpen()||(i.which==t.DELETE||i.which==t.BACKSPACE)&&this._handleClear(i)},i.prototype.update=function(t,i){if(t.call(this,i),!(this.$selection.find(".select2-selection__placeholder").length>0||0===i.length)){var n=e('<span class="select2-selection__clear">&times;</span>');n.data("data",i),this.$selection.find(".select2-selection__rendered").prepend(n)}},i}),t.define("select2/selection/search",["jquery","../utils","../keys"],function(e,t,i){function n(e,t,i){e.call(this,t,i)}return n.prototype.render=function(t){var i=e('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" aria-autocomplete="list" /></li>');this.$searchContainer=i,this.$search=i.find("input");var n=t.call(this);return this._transferTabIndex(),n},n.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("open",function(){r.$search.trigger("focus")}),t.on("close",function(){r.$search.val(""),r.$search.removeAttr("aria-activedescendant"),r.$search.trigger("focus")}),t.on("enable",function(){r.$search.prop("disabled",!1),r._transferTabIndex()}),t.on("disable",function(){r.$search.prop("disabled",!0)}),t.on("focus",function(e){r.$search.trigger("focus")}),t.on("results:focus",function(e){r.$search.attr("aria-activedescendant",e.id)}),this.$selection.on("focusin",".select2-search--inline",function(e){r.trigger("focus",e)}),this.$selection.on("focusout",".select2-search--inline",function(e){r._handleBlur(e)}),this.$selection.on("keydown",".select2-search--inline",function(e){e.stopPropagation(),r.trigger("keypress",e),r._keyUpPrevented=e.isDefaultPrevented();var t=e.which;if(t===i.BACKSPACE&&""===r.$search.val()){var n=r.$searchContainer.prev(".select2-selection__choice");if(n.length>0){var o=n.data("data");r.searchRemoveChoice(o),e.preventDefault()}}});var o=document.documentMode,s=o&&11>=o;this.$selection.on("input.searchcheck",".select2-search--inline",function(e){return s?void r.$selection.off("input.search input.searchcheck"):void r.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(e){if(s&&"input"===e.type)return void r.$selection.off("input.search input.searchcheck");var t=e.which;t!=i.SHIFT&&t!=i.CTRL&&t!=i.ALT&&t!=i.TAB&&r.handleSearch(e)})},n.prototype._transferTabIndex=function(e){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},n.prototype.createPlaceholder=function(e,t){this.$search.attr("placeholder",t.text)},n.prototype.update=function(e,t){var i=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),e.call(this,t),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),i&&this.$search.focus()},n.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var e=this.$search.val();this.trigger("query",{term:e})}this._keyUpPrevented=!1},n.prototype.searchRemoveChoice=function(e,t){this.trigger("unselect",{data:t}),this.$search.val(t.text),this.handleSearch()},n.prototype.resizeSearch=function(){this.$search.css("width","25px");var e="";if(""!==this.$search.attr("placeholder"))e=this.$selection.find(".select2-selection__rendered").innerWidth();else{var t=this.$search.val().length+1;e=.75*t+"em"}this.$search.css("width",e)},n}),t.define("select2/selection/eventRelay",["jquery"],function(e){function t(){}return t.prototype.bind=function(t,i,n){var r=this,o=["open","opening","close","closing","select","selecting","unselect","unselecting"],s=["opening","closing","selecting","unselecting"];t.call(this,i,n),i.on("*",function(t,i){if(-1!==e.inArray(t,o)){i=i||{};var n=e.Event("select2:"+t,{params:i});r.$element.trigger(n),-1!==e.inArray(t,s)&&(i.prevented=n.isDefaultPrevented())}})},t}),t.define("select2/translation",["jquery","require"],function(e,t){function i(e){this.dict=e||{}}return i.prototype.all=function(){return this.dict},i.prototype.get=function(e){return this.dict[e]},i.prototype.extend=function(t){this.dict=e.extend({},t.all(),this.dict)},i._cache={},i.loadPath=function(e){if(!(e in i._cache)){var n=t(e);i._cache[e]=n}return new i(i._cache[e])},i}),t.define("select2/diacritics",[],function(){var e={"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"AA","":"AE","":"AE","":"AE","":"AO","":"AU","":"AV","":"AV","":"AY","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"DZ","":"DZ","":"Dz","":"Dz","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"F","":"F","":"F","":"F","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"J","":"J","":"J","":"J","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"LJ","":"Lj","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"NJ","":"Nj","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"OI","":"OO","":"OU","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"Q","":"Q","":"Q","":"Q","":"Q","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"TZ","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VY","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"aa","":"ae","":"ae","":"ae","":"ao","":"au","":"av","":"av","":"ay","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"dz","":"dz","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"hv","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"j","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"lj","":"m","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"nj","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oi","":"ou","":"oo","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"q","":"q","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"tz","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"vy","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};return e}),t.define("select2/data/base",["../utils"],function(e){function t(e,i){t.__super__.constructor.call(this)}return e.Extend(t,e.Observable),t.prototype.current=function(e){throw new Error("The `current` method must be defined in child classes.")},t.prototype.query=function(e,t){throw new Error("The `query` method must be defined in child classes.")},t.prototype.bind=function(e,t){},t.prototype.destroy=function(){},t.prototype.generateResultId=function(t,i){var n=t.id+"-result-";return n+=e.generateChars(4),n+=null!=i.id?"-"+i.id.toString():"-"+e.generateChars(4)},t}),t.define("select2/data/select",["./base","../utils","jquery"],function(e,t,i){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return t.Extend(n,e),n.prototype.current=function(e){var t=[],n=this;this.$element.find(":selected").each(function(){var e=i(this),r=n.item(e);t.push(r)}),e(t)},n.prototype.select=function(e){var t=this;if(e.selected=!0,i(e.element).is("option"))return e.element.selected=!0,void this.$element.trigger("change");if(this.$element.prop("multiple"))this.current(function(n){var r=[];e=[e],e.push.apply(e,n);for(var o=0;o<e.length;o++){var s=e[o].id;-1===i.inArray(s,r)&&r.push(s)}t.$element.val(r),t.$element.trigger("change")});else{var n=e.id;this.$element.val(n),this.$element.trigger("change")}},n.prototype.unselect=function(e){var t=this;if(this.$element.prop("multiple"))return e.selected=!1,i(e.element).is("option")?(e.element.selected=!1,void this.$element.trigger("change")):void this.current(function(n){for(var r=[],o=0;o<n.length;o++){var s=n[o].id;s!==e.id&&-1===i.inArray(s,r)&&r.push(s)}t.$element.val(r),t.$element.trigger("change")})},n.prototype.bind=function(e,t){var i=this;this.container=e,e.on("select",function(e){i.select(e.data)}),e.on("unselect",function(e){i.unselect(e.data)})},n.prototype.destroy=function(){this.$element.find("*").each(function(){i.removeData(this,"data")})},n.prototype.query=function(e,t){var n=[],r=this,o=this.$element.children();o.each(function(){var t=i(this);if(t.is("option")||t.is("optgroup")){var o=r.item(t),s=r.matches(e,o);null!==s&&n.push(s)}}),t({results:n})},n.prototype.addOptions=function(e){t.appendMany(this.$element,e)},n.prototype.option=function(e){var t;e.children?(t=document.createElement("optgroup"),t.label=e.text):(t=document.createElement("option"),void 0!==t.textContent?t.textContent=e.text:t.innerText=e.text),e.id&&(t.value=e.id),e.disabled&&(t.disabled=!0),e.selected&&(t.selected=!0),e.title&&(t.title=e.title);var n=i(t),r=this._normalizeItem(e);return r.element=t,i.data(t,"data",r),n},n.prototype.item=function(e){var t={};if(t=i.data(e[0],"data"),null!=t)return t;if(e.is("option"))t={id:e.val(),text:e.text(),disabled:e.prop("disabled"),selected:e.prop("selected"),title:e.prop("title")};else if(e.is("optgroup")){t={text:e.prop("label"),children:[],title:e.prop("title")};for(var n=e.children("option"),r=[],o=0;o<n.length;o++){var s=i(n[o]),a=this.item(s);r.push(a)}t.children=r}return t=this._normalizeItem(t),t.element=e[0],i.data(e[0],"data",t),t},n.prototype._normalizeItem=function(e){i.isPlainObject(e)||(e={id:e,text:e}),e=i.extend({},{text:""},e);var t={selected:!1,disabled:!1};return null!=e.id&&(e.id=e.id.toString()),null!=e.text&&(e.text=e.text.toString()),null==e._resultId&&e.id&&null!=this.container&&(e._resultId=this.generateResultId(this.container,e)),i.extend({},t,e)},n.prototype.matches=function(e,t){var i=this.options.get("matcher");return i(e,t)},n}),t.define("select2/data/array",["./select","../utils","jquery"],function(e,t,i){function n(e,t){var i=t.get("data")||[];n.__super__.constructor.call(this,e,t),this.addOptions(this.convertToOptions(i))}return t.Extend(n,e),n.prototype.select=function(e){var t=this.$element.find("option").filter(function(t,i){return i.value==e.id.toString()});0===t.length&&(t=this.option(e),this.addOptions(t)),n.__super__.select.call(this,e)},n.prototype.convertToOptions=function(e){function n(e){return function(){return i(this).val()==e.id}}for(var r=this,o=this.$element.find("option"),s=o.map(function(){return r.item(i(this)).id}).get(),a=[],l=0;l<e.length;l++){var c=this._normalizeItem(e[l]);if(i.inArray(c.id,s)>=0){var d=o.filter(n(c)),u=this.item(d),p=i.extend(!0,{},c,u),h=this.option(p);d.replaceWith(h)}else{var f=this.option(c);if(c.children){var m=this.convertToOptions(c.children);t.appendMany(f,m)}a.push(f)}}return a},n}),t.define("select2/data/ajax",["./array","../utils","jquery"],function(e,t,i){function n(e,t){this.ajaxOptions=this._applyDefaults(t.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),n.__super__.constructor.call(this,e,t)}return t.Extend(n,e),n.prototype._applyDefaults=function(e){var t={data:function(e){return i.extend({},e,{q:e.term})},transport:function(e,t,n){var r=i.ajax(e);return r.then(t),r.fail(n),r}};return i.extend({},t,e,!0)},n.prototype.processResults=function(e){return e},n.prototype.query=function(e,t){function n(){var n=o.transport(o,function(n){var o=r.processResults(n,e);r.options.get("debug")&&window.console&&console.error&&(o&&o.results&&i.isArray(o.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),t(o)},function(){n.status&&"0"===n.status||r.trigger("results:message",{message:"errorLoading"})});r._request=n}var r=this;null!=this._request&&(i.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var o=i.extend({type:"GET"},this.ajaxOptions);"function"==typeof o.url&&(o.url=o.url.call(this.$element,e)),"function"==typeof o.data&&(o.data=o.data.call(this.$element,e)),this.ajaxOptions.delay&&null!=e.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(n,this.ajaxOptions.delay)):n()},n}),t.define("select2/data/tags",["jquery"],function(e){function t(t,i,n){var r=n.get("tags"),o=n.get("createTag");void 0!==o&&(this.createTag=o);var s=n.get("insertTag");if(void 0!==s&&(this.insertTag=s),t.call(this,i,n),e.isArray(r))for(var a=0;a<r.length;a++){var l=r[a],c=this._normalizeItem(l),d=this.option(c);this.$element.append(d)}}return t.prototype.query=function(e,t,i){function n(e,o){for(var s=e.results,a=0;a<s.length;a++){var l=s[a],c=null!=l.children&&!n({results:l.children},!0),d=l.text===t.term;if(d||c)return o?!1:(e.data=s,void i(e))}if(o)return!0;var u=r.createTag(t);if(null!=u){var p=r.option(u);p.attr("data-select2-tag",!0),r.addOptions([p]),r.insertTag(s,u)}e.results=s,i(e)}var r=this;return this._removeOldTags(),null==t.term||null!=t.page?void e.call(this,t,i):void e.call(this,t,n)},t.prototype.createTag=function(t,i){var n=e.trim(i.term);return""===n?null:{id:n,text:n}},t.prototype.insertTag=function(e,t,i){t.unshift(i)},t.prototype._removeOldTags=function(t){var i=(this._lastTag,this.$element.find("option[data-select2-tag]"));i.each(function(){this.selected||e(this).remove()})},t}),t.define("select2/data/tokenizer",["jquery"],function(e){function t(e,t,i){var n=i.get("tokenizer");void 0!==n&&(this.tokenizer=n),e.call(this,t,i)}return t.prototype.bind=function(e,t,i){e.call(this,t,i),this.$search=t.dropdown.$search||t.selection.$search||i.find(".select2-search__field")},t.prototype.query=function(t,i,n){function r(t){var i=s._normalizeItem(t),n=s.$element.find("option").filter(function(){return e(this).val()===i.id});if(!n.length){var r=s.option(i);r.attr("data-select2-tag",!0),s._removeOldTags(),s.addOptions([r])}o(i)}function o(e){s.trigger("select",{data:e})}var s=this;i.term=i.term||"";var a=this.tokenizer(i,this.options,r);a.term!==i.term&&(this.$search.length&&(this.$search.val(a.term),this.$search.focus()),i.term=a.term),t.call(this,i,n)},t.prototype.tokenizer=function(t,i,n,r){for(var o=n.get("tokenSeparators")||[],s=i.term,a=0,l=this.createTag||function(e){return{id:e.term,text:e.term}};a<s.length;){var c=s[a];if(-1!==e.inArray(c,o)){var d=s.substr(0,a),u=e.extend({},i,{term:d}),p=l(u);null!=p?(r(p),s=s.substr(a+1)||"",a=0):a++}else a++}return{term:s}},t}),t.define("select2/data/minimumInputLength",[],function(){function e(e,t,i){this.minimumInputLength=i.get("minimumInputLength"),e.call(this,t,i)}return e.prototype.query=function(e,t,i){return t.term=t.term||"",t.term.length<this.minimumInputLength?void this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:t.term,params:t}}):void e.call(this,t,i)},e}),t.define("select2/data/maximumInputLength",[],function(){function e(e,t,i){this.maximumInputLength=i.get("maximumInputLength"),e.call(this,t,i)}return e.prototype.query=function(e,t,i){return t.term=t.term||"",this.maximumInputLength>0&&t.term.length>this.maximumInputLength?void this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:t.term,params:t}}):void e.call(this,t,i)},e}),t.define("select2/data/maximumSelectionLength",[],function(){function e(e,t,i){this.maximumSelectionLength=i.get("maximumSelectionLength"),e.call(this,t,i)}return e.prototype.query=function(e,t,i){var n=this;this.current(function(r){var o=null!=r?r.length:0;return n.maximumSelectionLength>0&&o>=n.maximumSelectionLength?void n.trigger("results:message",{message:"maximumSelected",args:{maximum:n.maximumSelectionLength}}):void e.call(n,t,i)})},e}),t.define("select2/dropdown",["jquery","./utils"],function(e,t){function i(e,t){this.$element=e,this.options=t,i.__super__.constructor.call(this)}return t.Extend(i,t.Observable),i.prototype.render=function(){var t=e('<span class="select2-dropdown"><span class="select2-results"></span></span>');return t.attr("dir",this.options.get("dir")),this.$dropdown=t,t},i.prototype.bind=function(){},i.prototype.position=function(e,t){},i.prototype.destroy=function(){this.$dropdown.remove()},i}),t.define("select2/dropdown/search",["jquery","../utils"],function(e,t){function i(){}return i.prototype.render=function(t){var i=t.call(this),n=e('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" /></span>');return this.$searchContainer=n,this.$search=n.find("input"),i.prepend(n),i},i.prototype.bind=function(t,i,n){var r=this;t.call(this,i,n),this.$search.on("keydown",function(e){r.trigger("keypress",e),r._keyUpPrevented=e.isDefaultPrevented()}),this.$search.on("input",function(t){e(this).off("keyup")}),this.$search.on("keyup input",function(e){r.handleSearch(e)}),i.on("open",function(){r.$search.attr("tabindex",0),r.$search.focus(),window.setTimeout(function(){r.$search.focus()},0)}),i.on("close",function(){r.$search.attr("tabindex",-1),r.$search.val("")}),i.on("focus",function(){i.isOpen()&&r.$search.focus()}),i.on("results:all",function(e){if(null==e.query.term||""===e.query.term){var t=r.showSearch(e);t?r.$searchContainer.removeClass("select2-search--hide"):r.$searchContainer.addClass("select2-search--hide")}})},i.prototype.handleSearch=function(e){if(!this._keyUpPrevented){var t=this.$search.val();this.trigger("query",{term:t})}this._keyUpPrevented=!1},i.prototype.showSearch=function(e,t){return!0},i}),t.define("select2/dropdown/hidePlaceholder",[],function(){function e(e,t,i,n){this.placeholder=this.normalizePlaceholder(i.get("placeholder")),e.call(this,t,i,n)}return e.prototype.append=function(e,t){t.results=this.removePlaceholder(t.results),e.call(this,t)},e.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},e.prototype.removePlaceholder=function(e,t){for(var i=t.slice(0),n=t.length-1;n>=0;n--){var r=t[n];this.placeholder.id===r.id&&i.splice(n,1)}return i},e}),t.define("select2/dropdown/infiniteScroll",["jquery"],function(e){function t(e,t,i,n){this.lastParams={},e.call(this,t,i,n),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return t.prototype.append=function(e,t){this.$loadingMore.remove(),this.loading=!1,e.call(this,t),this.showLoadingMore(t)&&this.$results.append(this.$loadingMore)},t.prototype.bind=function(t,i,n){var r=this;t.call(this,i,n),i.on("query",function(e){r.lastParams=e,r.loading=!0}),i.on("query:append",function(e){r.lastParams=e,r.loading=!0}),this.$results.on("scroll",function(){var t=e.contains(document.documentElement,r.$loadingMore[0]);if(!r.loading&&t){var i=r.$results.offset().top+r.$results.outerHeight(!1),n=r.$loadingMore.offset().top+r.$loadingMore.outerHeight(!1);i+50>=n&&r.loadMore()}})},t.prototype.loadMore=function(){this.loading=!0;var t=e.extend({},{page:1},this.lastParams);t.page++,this.trigger("query:append",t)},t.prototype.showLoadingMore=function(e,t){return t.pagination&&t.pagination.more},t.prototype.createLoadingMore=function(){var t=e('<li class="select2-results__option select2-results__option--load-more"role="treeitem" aria-disabled="true"></li>'),i=this.options.get("translations").get("loadingMore");return t.html(i(this.lastParams)),t},t}),t.define("select2/dropdown/attachBody",["jquery","../utils"],function(e,t){function i(t,i,n){this.$dropdownParent=n.get("dropdownParent")||e(document.body),t.call(this,i,n)}return i.prototype.bind=function(e,t,i){var n=this,r=!1;e.call(this,t,i),t.on("open",function(){n._showDropdown(),n._attachPositioningHandler(t),r||(r=!0,t.on("results:all",function(){n._positionDropdown(),n._resizeDropdown()}),t.on("results:append",function(){n._positionDropdown(),n._resizeDropdown()}))}),t.on("close",function(){n._hideDropdown(),n._detachPositioningHandler(t)}),this.$dropdownContainer.on("mousedown",function(e){e.stopPropagation()})},i.prototype.destroy=function(e){e.call(this),this.$dropdownContainer.remove()},i.prototype.position=function(e,t,i){t.attr("class",i.attr("class")),t.removeClass("select2"),t.addClass("select2-container--open"),t.css({position:"absolute",top:-999999}),this.$container=i},i.prototype.render=function(t){var i=e("<span></span>"),n=t.call(this);return i.append(n),this.$dropdownContainer=i,i},i.prototype._hideDropdown=function(e){this.$dropdownContainer.detach()},i.prototype._attachPositioningHandler=function(i,n){var r=this,o="scroll.select2."+n.id,s="resize.select2."+n.id,a="orientationchange.select2."+n.id,l=this.$container.parents().filter(t.hasScroll);l.each(function(){e(this).data("select2-scroll-position",{x:e(this).scrollLeft(),y:e(this).scrollTop()})}),l.on(o,function(t){var i=e(this).data("select2-scroll-position");e(this).scrollTop(i.y)}),e(window).on(o+" "+s+" "+a,function(e){r._positionDropdown(),r._resizeDropdown()})},i.prototype._detachPositioningHandler=function(i,n){var r="scroll.select2."+n.id,o="resize.select2."+n.id,s="orientationchange.select2."+n.id,a=this.$container.parents().filter(t.hasScroll);a.off(r),e(window).off(r+" "+o+" "+s)},i.prototype._positionDropdown=function(){var t=e(window),i=this.$dropdown.hasClass("select2-dropdown--above"),n=this.$dropdown.hasClass("select2-dropdown--below"),r=null,o=this.$container.offset();o.bottom=o.top+this.$container.outerHeight(!1);var s={height:this.$container.outerHeight(!1)};s.top=o.top,s.bottom=o.top+s.height;var a={height:this.$dropdown.outerHeight(!1)},l={top:t.scrollTop(),bottom:t.scrollTop()+t.height()},c=l.top<o.top-a.height,d=l.bottom>o.bottom+a.height,u={left:o.left,top:s.bottom},p=this.$dropdownParent;"static"===p.css("position")&&(p=p.offsetParent());var h=p.offset();u.top-=h.top,u.left-=h.left,i||n||(r="below"),d||!c||i?!c&&d&&i&&(r="below"):r="above",("above"==r||i&&"below"!==r)&&(u.top=s.top-h.top-a.height),null!=r&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+r),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+r)),this.$dropdownContainer.css(u)},i.prototype._resizeDropdown=function(){var e={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(e.minWidth=e.width,e.position="relative",e.width="auto"),this.$dropdown.css(e)},i.prototype._showDropdown=function(e){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},i}),t.define("select2/dropdown/minimumResultsForSearch",[],function(){function e(t){for(var i=0,n=0;n<t.length;n++){var r=t[n];r.children?i+=e(r.children):i++}return i}function t(e,t,i,n){this.minimumResultsForSearch=i.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),e.call(this,t,i,n)}return t.prototype.showSearch=function(t,i){return e(i.data.results)<this.minimumResultsForSearch?!1:t.call(this,i)},t}),t.define("select2/dropdown/selectOnClose",[],function(){function e(){}return e.prototype.bind=function(e,t,i){var n=this;e.call(this,t,i),t.on("close",function(e){n._handleSelectOnClose(e)})},e.prototype._handleSelectOnClose=function(e,t){if(t&&null!=t.originalSelect2Event){var i=t.originalSelect2Event;if("select"===i._type||"unselect"===i._type)return}var n=this.getHighlightedResults();if(!(n.length<1)){var r=n.data("data");null!=r.element&&r.element.selected||null==r.element&&r.selected||this.trigger("select",{data:r})}},e}),t.define("select2/dropdown/closeOnSelect",[],function(){function e(){}return e.prototype.bind=function(e,t,i){var n=this;e.call(this,t,i),t.on("select",function(e){n._selectTriggered(e)}),t.on("unselect",function(e){n._selectTriggered(e)})},e.prototype._selectTriggered=function(e,t){var i=t.originalEvent;i&&i.ctrlKey||this.trigger("close",{originalEvent:i,originalSelect2Event:t})},e}),t.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(e){var t=e.input.length-e.maximum,i="Please delete "+t+" character";return 1!=t&&(i+="s"),i},inputTooShort:function(e){var t=e.minimum-e.input.length,i="Please enter "+t+" or more characters";return i},loadingMore:function(){return"Loading more results"},maximumSelected:function(e){var t="You can only select "+e.maximum+" item";return 1!=e.maximum&&(t+="s"),t},noResults:function(){return"No results found"},searching:function(){return"Searching"}}}),t.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(e,t,i,n,r,o,s,a,l,c,d,u,p,h,f,m,_,v,g,y,b,w,S,C,x,E,M,O,T){function $(){this.reset()}$.prototype.apply=function(u){if(u=e.extend(!0,{},this.defaults,u),null==u.dataAdapter){if(null!=u.ajax?u.dataAdapter=f:null!=u.data?u.dataAdapter=h:u.dataAdapter=p,u.minimumInputLength>0&&(u.dataAdapter=c.Decorate(u.dataAdapter,v)),u.maximumInputLength>0&&(u.dataAdapter=c.Decorate(u.dataAdapter,g)),u.maximumSelectionLength>0&&(u.dataAdapter=c.Decorate(u.dataAdapter,y)),u.tags&&(u.dataAdapter=c.Decorate(u.dataAdapter,m)),(null!=u.tokenSeparators||null!=u.tokenizer)&&(u.dataAdapter=c.Decorate(u.dataAdapter,_)),null!=u.query){var T=t(u.amdBase+"compat/query");u.dataAdapter=c.Decorate(u.dataAdapter,T)}if(null!=u.initSelection){var $=t(u.amdBase+"compat/initSelection");u.dataAdapter=c.Decorate(u.dataAdapter,$)}}if(null==u.resultsAdapter&&(u.resultsAdapter=i,
null!=u.ajax&&(u.resultsAdapter=c.Decorate(u.resultsAdapter,C)),null!=u.placeholder&&(u.resultsAdapter=c.Decorate(u.resultsAdapter,S)),u.selectOnClose&&(u.resultsAdapter=c.Decorate(u.resultsAdapter,M))),null==u.dropdownAdapter){if(u.multiple)u.dropdownAdapter=b;else{var A=c.Decorate(b,w);u.dropdownAdapter=A}if(0!==u.minimumResultsForSearch&&(u.dropdownAdapter=c.Decorate(u.dropdownAdapter,E)),u.closeOnSelect&&(u.dropdownAdapter=c.Decorate(u.dropdownAdapter,O)),null!=u.dropdownCssClass||null!=u.dropdownCss||null!=u.adaptDropdownCssClass){var I=t(u.amdBase+"compat/dropdownCss");u.dropdownAdapter=c.Decorate(u.dropdownAdapter,I)}u.dropdownAdapter=c.Decorate(u.dropdownAdapter,x)}if(null==u.selectionAdapter){if(u.multiple?u.selectionAdapter=r:u.selectionAdapter=n,null!=u.placeholder&&(u.selectionAdapter=c.Decorate(u.selectionAdapter,o)),u.allowClear&&(u.selectionAdapter=c.Decorate(u.selectionAdapter,s)),u.multiple&&(u.selectionAdapter=c.Decorate(u.selectionAdapter,a)),null!=u.containerCssClass||null!=u.containerCss||null!=u.adaptContainerCssClass){var N=t(u.amdBase+"compat/containerCss");u.selectionAdapter=c.Decorate(u.selectionAdapter,N)}u.selectionAdapter=c.Decorate(u.selectionAdapter,l)}if("string"==typeof u.language)if(u.language.indexOf("-")>0){var D=u.language.split("-"),k=D[0];u.language=[u.language,k]}else u.language=[u.language];if(e.isArray(u.language)){var P=new d;u.language.push("en");for(var j=u.language,V=0;V<j.length;V++){var R=j[V],L={};try{L=d.loadPath(R)}catch(q){try{R=this.defaults.amdLanguageBase+R,L=d.loadPath(R)}catch(G){u.debug&&window.console&&console.warn&&console.warn('Select2: The language file for "'+R+'" could not be automatically loaded. A fallback will be used instead.');continue}}P.extend(L)}u.translations=P}else{var U=d.loadPath(this.defaults.amdLanguageBase+"en"),F=new d(u.language);F.extend(U),u.translations=F}return u},$.prototype.reset=function(){function t(e){function t(e){return u[e]||e}return e.replace(/[^\u0000-\u007E]/g,t)}function i(n,r){if(""===e.trim(n.term))return r;if(r.children&&r.children.length>0){for(var o=e.extend(!0,{},r),s=r.children.length-1;s>=0;s--){var a=r.children[s],l=i(n,a);null==l&&o.children.splice(s,1)}return o.children.length>0?o:i(n,o)}var c=t(r.text).toUpperCase(),d=t(n.term).toUpperCase();return c.indexOf(d)>-1?r:null}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:c.escapeMarkup,language:T,matcher:i,minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,sorter:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},theme:"default",width:"resolve"}},$.prototype.set=function(t,i){var n=e.camelCase(t),r={};r[n]=i;var o=c._convertData(r);e.extend(this.defaults,o)};var A=new $;return A}),t.define("select2/options",["require","jquery","./defaults","./utils"],function(e,t,i,n){function r(t,r){if(this.options=t,null!=r&&this.fromElement(r),this.options=i.apply(this.options),r&&r.is("input")){var o=e(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=n.Decorate(this.options.dataAdapter,o)}}return r.prototype.fromElement=function(e){var i=["select2"];null==this.options.multiple&&(this.options.multiple=e.prop("multiple")),null==this.options.disabled&&(this.options.disabled=e.prop("disabled")),null==this.options.language&&(e.prop("lang")?this.options.language=e.prop("lang").toLowerCase():e.closest("[lang]").prop("lang")&&(this.options.language=e.closest("[lang]").prop("lang"))),null==this.options.dir&&(e.prop("dir")?this.options.dir=e.prop("dir"):e.closest("[dir]").prop("dir")?this.options.dir=e.closest("[dir]").prop("dir"):this.options.dir="ltr"),e.prop("disabled",this.options.disabled),e.prop("multiple",this.options.multiple),e.data("select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),e.data("data",e.data("select2Tags")),e.data("tags",!0)),e.data("ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),e.attr("ajax--url",e.data("ajaxUrl")),e.data("ajax--url",e.data("ajaxUrl")));var r={};r=t.fn.jquery&&"1."==t.fn.jquery.substr(0,2)&&e[0].dataset?t.extend(!0,{},e[0].dataset,e.data()):e.data();var o=t.extend(!0,{},r);o=n._convertData(o);for(var s in o)t.inArray(s,i)>-1||(t.isPlainObject(this.options[s])?t.extend(this.options[s],o[s]):this.options[s]=o[s]);return this},r.prototype.get=function(e){return this.options[e]},r.prototype.set=function(e,t){this.options[e]=t},r}),t.define("select2/core",["jquery","./options","./utils","./keys"],function(e,t,i,n){var r=function(e,i){null!=e.data("select2")&&e.data("select2").destroy(),this.$element=e,this.id=this._generateId(e),i=i||{},this.options=new t(i,e),r.__super__.constructor.call(this);var n=e.attr("tabindex")||0;e.data("old-tabindex",n),e.attr("tabindex","-1");var o=this.options.get("dataAdapter");this.dataAdapter=new o(e,this.options);var s=this.render();this._placeContainer(s);var a=this.options.get("selectionAdapter");this.selection=new a(e,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,s);var l=this.options.get("dropdownAdapter");this.dropdown=new l(e,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,s);var c=this.options.get("resultsAdapter");this.results=new c(e,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var d=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(e){d.trigger("selection:update",{data:e})}),e.addClass("select2-hidden-accessible"),e.attr("aria-hidden","true"),this._syncAttributes(),e.data("select2",this)};return i.Extend(r,i.Observable),r.prototype._generateId=function(e){var t="";return t=null!=e.attr("id")?e.attr("id"):null!=e.attr("name")?e.attr("name")+"-"+i.generateChars(2):i.generateChars(4),t=t.replace(/(:|\.|\[|\]|,)/g,""),t="select2-"+t},r.prototype._placeContainer=function(e){e.insertAfter(this.$element);var t=this._resolveWidth(this.$element,this.options.get("width"));null!=t&&e.css("width",t)},r.prototype._resolveWidth=function(e,t){var i=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==t){var n=this._resolveWidth(e,"style");return null!=n?n:this._resolveWidth(e,"element")}if("element"==t){var r=e.outerWidth(!1);return 0>=r?"auto":r+"px"}if("style"==t){var o=e.attr("style");if("string"!=typeof o)return null;for(var s=o.split(";"),a=0,l=s.length;l>a;a+=1){var c=s[a].replace(/\s/g,""),d=c.match(i);if(null!==d&&d.length>=1)return d[1]}return null}return t},r.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},r.prototype._registerDomEvents=function(){var t=this;this.$element.on("change.select2",function(){t.dataAdapter.current(function(e){t.trigger("selection:update",{data:e})})}),this.$element.on("focus.select2",function(e){t.trigger("focus",e)}),this._syncA=i.bind(this._syncAttributes,this),this._syncS=i.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=n?(this._observer=new n(function(i){e.each(i,t._syncA),e.each(i,t._syncS)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",t._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",t._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",t._syncS,!1))},r.prototype._registerDataEvents=function(){var e=this;this.dataAdapter.on("*",function(t,i){e.trigger(t,i)})},r.prototype._registerSelectionEvents=function(){var t=this,i=["toggle","focus"];this.selection.on("toggle",function(){t.toggleDropdown()}),this.selection.on("focus",function(e){t.focus(e)}),this.selection.on("*",function(n,r){-1===e.inArray(n,i)&&t.trigger(n,r)})},r.prototype._registerDropdownEvents=function(){var e=this;this.dropdown.on("*",function(t,i){e.trigger(t,i)})},r.prototype._registerResultsEvents=function(){var e=this;this.results.on("*",function(t,i){e.trigger(t,i)})},r.prototype._registerEvents=function(){var e=this;this.on("open",function(){e.$container.addClass("select2-container--open")}),this.on("close",function(){e.$container.removeClass("select2-container--open")}),this.on("enable",function(){e.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){e.$container.addClass("select2-container--disabled")}),this.on("blur",function(){e.$container.removeClass("select2-container--focus")}),this.on("query",function(t){e.isOpen()||e.trigger("open",{}),this.dataAdapter.query(t,function(i){e.trigger("results:all",{data:i,query:t})})}),this.on("query:append",function(t){this.dataAdapter.query(t,function(i){e.trigger("results:append",{data:i,query:t})})}),this.on("keypress",function(t){var i=t.which;e.isOpen()?i===n.ESC||i===n.TAB||i===n.UP&&t.altKey?(e.close(),t.preventDefault()):i===n.ENTER?(e.trigger("results:select",{}),t.preventDefault()):i===n.SPACE&&t.ctrlKey?(e.trigger("results:toggle",{}),t.preventDefault()):i===n.UP?(e.trigger("results:previous",{}),t.preventDefault()):i===n.DOWN&&(e.trigger("results:next",{}),t.preventDefault()):(i===n.ENTER||i===n.SPACE||i===n.DOWN&&t.altKey)&&(e.open(),t.preventDefault())})},r.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.options.get("disabled")?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},r.prototype._syncSubtree=function(e,t){var i=!1,n=this;if(!e||!e.target||"OPTION"===e.target.nodeName||"OPTGROUP"===e.target.nodeName){if(t)if(t.addedNodes&&t.addedNodes.length>0)for(var r=0;r<t.addedNodes.length;r++){var o=t.addedNodes[r];o.selected&&(i=!0)}else t.removedNodes&&t.removedNodes.length>0&&(i=!0);else i=!0;i&&this.dataAdapter.current(function(e){n.trigger("selection:update",{data:e})})}},r.prototype.trigger=function(e,t){var i=r.__super__.trigger,n={open:"opening",close:"closing",select:"selecting",unselect:"unselecting"};if(void 0===t&&(t={}),e in n){var o=n[e],s={prevented:!1,name:e,args:t};if(i.call(this,o,s),s.prevented)return void(t.prevented=!0)}i.call(this,e,t)},r.prototype.toggleDropdown=function(){this.options.get("disabled")||(this.isOpen()?this.close():this.open())},r.prototype.open=function(){this.isOpen()||this.trigger("query",{})},r.prototype.close=function(){this.isOpen()&&this.trigger("close",{})},r.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},r.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},r.prototype.focus=function(e){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},r.prototype.enable=function(e){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),(null==e||0===e.length)&&(e=[!0]);var t=!e[0];this.$element.prop("disabled",t)},r.prototype.data=function(){this.options.get("debug")&&arguments.length>0&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var e=[];return this.dataAdapter.current(function(t){e=t}),e},r.prototype.val=function(t){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==t||0===t.length)return this.$element.val();var i=t[0];e.isArray(i)&&(i=e.map(i,function(e){return e.toString()})),this.$element.val(i).trigger("change")},r.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",this.$element.data("old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},r.prototype.render=function(){var t=e('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return t.attr("dir",this.options.get("dir")),this.$container=t,this.$container.addClass("select2-container--"+this.options.get("theme")),t.data("element",this.$element),t},r}),t.define("jquery-mousewheel",["jquery"],function(e){return e}),t.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults"],function(e,t,i,n){if(null==e.fn.select2){var r=["open","close","destroy"];e.fn.select2=function(t){if(t=t||{},"object"==typeof t)return this.each(function(){var n=e.extend(!0,{},t);new i(e(this),n)}),this;if("string"==typeof t){var n,o=Array.prototype.slice.call(arguments,1);return this.each(function(){var i=e(this).data("select2");null==i&&window.console&&console.error&&console.error("The select2('"+t+"') method was called on an element that is not using Select2."),n=i[t].apply(i,o)}),e.inArray(t,r)>-1?this:n}throw new Error("Invalid arguments for Select2: "+t)}}return null==e.fn.select2.defaults&&(e.fn.select2.defaults=n),i}),{define:t.define,require:t.require}}(),i=t.require("jquery.select2");return e.fn.select2.amd=t,e.fn.select2.amd.require(["select2/selection/search"],function(e){var t=e.prototype.searchRemoveChoice;e.prototype.searchRemoveChoice=function(){t.apply(this,arguments),this.$search.val("")}}),i}),function(e,t){"function"==typeof define&&define.amd?define("inflection",["underscore"],t):"function"==typeof require&&"object"==typeof exports?module.exports=t(require("underscore")):t(e._)}(this,function(e,t){var i=[],n=[],r=[],o={gsub:function(e,t,i){var n=new RegExp(t.source||t,"gi");return n.test(e)?e.replace(n,i):null},plural:function(e,t){i.unshift([e,t])},pluralize:function(n,o,s){var a;if(o!==t)o=parseFloat(o),a=1===o?this.singularize(n):this.pluralize(n),a=s?[o,a].join(" "):a;else{if(e(r).include(n))return n;a=n,e(i).detect(function(e){var t=this.gsub(n,e[0],e[1]);return t?a=t:!1},this)}return a},singular:function(e,t){n.unshift([e,t])},singularize:function(t){if(e(r).include(t))return t;var i=t;return e(n).detect(function(e){var n=this.gsub(t,e[0],e[1]);return n?i=n:!1},this),i},irregular:function(e,t){this.plural("\\b"+e+"\\b",t),this.singular("\\b"+t+"\\b",e)},uncountable:function(e){r.unshift(e)},ordinalize:function(e){if(isNaN(e))return e;e=e.toString();var t=e.slice(-1),i=e.slice(-2);if("11"===i||"12"===i||"13"===i)return e+"th";switch(t){case"1":return e+"st";case"2":return e+"nd";case"3":return e+"rd";default:return e+"th"}},titleize:function(e){return"string"!=typeof e?e:e.replace(/\S+/g,function(e){return e.charAt(0).toUpperCase()+e.slice(1)})},resetInflections:function(){return i=[],n=[],r=[],this.plural(/$/,"s"),this.plural(/s$/,"s"),this.plural(/(ax|test)is$/,"$1es"),this.plural(/(octop|vir)us$/,"$1i"),this.plural(/(octop|vir)i$/,"$1i"),this.plural(/(alias|status)$/,"$1es"),this.plural(/(bu)s$/,"$1ses"),this.plural(/(buffal|tomat)o$/,"$1oes"),this.plural(/([ti])um$/,"$1a"),this.plural(/([ti])a$/,"$1a"),this.plural(/sis$/,"ses"),this.plural(/(?:([^f])fe|([lr])?f)$/,"$1$2ves"),this.plural(/(hive)$/,"$1s"),this.plural(/([^aeiouy]|qu)y$/,"$1ies"),this.plural(/(x|ch|ss|sh)$/,"$1es"),this.plural(/(matr|vert|ind)(?:ix|ex)$/,"$1ices"),this.plural(/([m|l])ouse$/,"$1ice"),this.plural(/([m|l])ice$/,"$1ice"),this.plural(/^(ox)$/,"$1en"),this.plural(/^(oxen)$/,"$1"),this.plural(/(quiz)$/,"$1zes"),this.singular(/s$/,""),this.singular(/(n)ews$/,"$1ews"),this.singular(/([ti])a$/,"$1um"),this.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/,"$1$2sis"),this.singular(/(^analy)ses$/,"$1sis"),this.singular(/([^f])ves$/,"$1fe"),this.singular(/(hive)s$/,"$1"),this.singular(/(tive)s$/,"$1"),this.singular(/([lr])ves$/,"$1f"),this.singular(/([^aeiouy]|qu)ies$/,"$1y"),this.singular(/(s)eries$/,"$1eries"),this.singular(/(m)ovies$/,"$1ovie"),this.singular(/(ss)$/,"$1"),this.singular(/(x|ch|ss|sh)es$/,"$1"),this.singular(/([m|l])ice$/,"$1ouse"),this.singular(/(bus)es$/,"$1"),this.singular(/(o)es$/,"$1"),this.singular(/(shoe)s$/,"$1"),this.singular(/(cris|ax|test)es$/,"$1is"),this.singular(/(octop|vir)i$/,"$1us"),this.singular(/(alias|status)es$/,"$1"),this.singular(/^(ox)en/,"$1"),this.singular(/(vert|ind)ices$/,"$1ex"),this.singular(/(matr)ices$/,"$1ix"),this.singular(/(quiz)zes$/,"$1"),this.singular(/(database)s$/,"$1"),this.irregular("person","people"),this.irregular("man","men"),this.irregular("child","children"),this.irregular("sex","sexes"),this.irregular("move","moves"),this.irregular("cow","kine"),this.uncountable("equipment"),this.uncountable("information"),this.uncountable("rice"),this.uncountable("money"),this.uncountable("species"),this.uncountable("series"),this.uncountable("fish"),this.uncountable("sheep"),this.uncountable("jeans"),this}};return e.mixin(o.resetInflections()),o}),require(["require","Sm-Core-Core"],function(e){return Sm.Entities.Abstraction=Sm.Entities.Abstraction||{},Sm.Entities.Abstraction.templates=Sm.Entities.Abstraction.templates||{},Sm.Entities.Abstraction.templates._template={modal_outer:{edit:'<header>\n    <h3>Edit <%- type ? type : \'Entity\' %></h3>\n</header>\n<div class="content form aligned">\n    __BUTTON_CONTROL__\n    <input type="hidden" value="<%- id %>" name="id">\n\n    __CONTENT__\n\n    <div class="control-group view_relationship-container">\n        <button class="action modal-button" data-action="view_relationships">View Relationships</button>\n    </div>\n</div>',destroy:'<header>\n    <h3>Delete <%- type ? type : \'Entity\' %></h3>\n</header>\n<div class="content form aligned no-button-control">\n    __CONTENT__\n    <ul class="spwashi-entities-list"></ul>\n    <div class="control-group choose-container">\n        <div class="options">\n            <button class="action modal-button" data-action="choose" data-data="true">YES</button>\n            <button class="action modal-button" data-action="choose" data-data="false">NO</button>\n        </div>\n    </div>\n</div>',add_relationship:'<header>\n    <h3>Add relationship to <%- type ? type : \'Entity\' %></h3>\n</header>\n<div class="content form aligned no-button-control">\n    __CONTENT__\n    <div class="control-group choose-container">\n        <button class="action modal-button" data-action="choose" data-data="continue.1">Add relationship</button>\n    </div>\n</div>'},body_outer:{tag:'<div title="<%- subtitle %>" class="spwashi-<%- type ? type.toLowerCase() : \'Entity\' %> tag spwashi-entity <% if(_type){ %>type-<%- _type %><% } %>">\n    __BUTTON_CONTROL__\n__CONTENT__</div>',inline:'<span title="<%- subtitle %>" class="spwashi-<%- type ? type.toLowerCase() : \'Entity\' %> inline spwashi-entity <% if(_type){ %>type-<%- _type %><% } %>">\n    __BUTTON_CONTROL__\n__CONTENT__</span>',full:'<div class="spwashi-entity spwashi-<%- type ? type.toLowerCase() : \' \'%>" data-ent_id="<%- typeof ent_id === \'string\' ?ent_id:\'\'%>" data-id="<%- typeof id === \'string\' ?id:\'\'%>">\n    <%- typeof content === "string"?"c"+content:typeof name === "string"?"n"+name:typeof title === "string"?"t"+title:" "%>\n</div>'},button_control:'<div class="icons button-control">\n    <i class="button edit fa fa-pencil"></i>\n    <i class="button delete close fa fa-remove"></i>\n    <i class="button add fa fa-plus"></i>\n    <i class="button handle fa fa-arrows"></i>\n    <i class="debug button fa fa-question"></i>\n</div>',modal:{destroy:'<div class="content">Are you sure you want to delete these entities?</div>',add_relationship:'<div class="control-group">\n    <label for="relationship_index">Relationship Type: </label>\n    <select class="relationship-attribute relationship_index select" data-attribute="relationship_index" id="relationship_index" name="relationship_index">\n        <% for (var name in relationship_indices) { if (!relationship_indices.hasOwnProperty(name)) continue; %>\n        <option value="<%- relationship_indices[name] %>"><%- name %></option>\n        <% } %>\n    </select>\n</div>',add_relationship_type:'<div class="form" id="modal-continue-2">\n    <div class="control-group">\n        <label for="position">Position:</label>\n        <input id="position" data-attribute="position" class="relationship-attribute position" type="text" name="position"\n               placeholder="Which position should we add the relationship?" title="position" value="<%- typeof position !== \'undefined\' ? position : 0 %>">\n        <span class="error" id="position-error"></span>\n    </div>\n</div>'},relationship_outer:'<section class="relationship-index-container">__CONTENT__</section>',relationship:{relationship_index:'<div class="relationship-container __TYPE__-container" data-Mv-r_id="__R_ID__">\n    <header class="title">__TITLE__</header>\n    <div class="content">__CONTENT__</div>\n</div>',relationship:'<div class="relationship" data-Relationship-r_id="__R_ID__">\n    <div class="content">__CONTENT__</div>\n</div>'}},Sm.loaded.add("Entities_Abstraction_templates"),Sm.loaded.add("Entities_Abstraction_templates__template"),Sm.Entities.Abstraction.templates._template}),define("Sm-Entities-Abstraction-templates-_template",function(){}),require(["require","Class","Sm","Sm-Entities-Abstraction-templates-_template"],function(e,t){e("Sm"),e("Class"),Sm.loaded.when_loaded("Core",function(){Sm.Entities.Abstraction.Garage=t.extend({init:function(e,t){this.type=e,this.subtype_identifier=t},_default:function(e){Sm.CONFIG.DEBUG&&console.log(e);var t=document.createElement("div");return t.className="empty",t},_normalize_data:function(e,t){var i,n,r,o;e&&"object"==typeof e||(e={});var s=e.Model;try{o=s?s.attributes:e.attributes?e.attributes:e,o||(o={}),t=t||{},r=this.type,n=t.display_subtype||o[this.subtype_identifier]||"standard",i=Sm.Entities[r].Meta.get_type(n,"index")||"standard",o=Sm.Core.util.merge_objects(o,{_type:i,type:r})}catch(a){throw Sm.CONFIG.DEBUG&&console.log("abstraction_garage_GDFM",a),a}var l={Model:s,attributes:o,subtype:n,template_type:i};return e.object_type&&"MvCombo"==e.object_type&&(l.MvCombo=e),l},_combine_string:function(e,t){var i=_.template(t);return i(e)},_generate_one:function(e,t,i){i=i||{};var n=!!i.synchronous,r=i.default_value!==!1?i.default_value||"full":!1,o=e[0],s=e[1]||o,a=t,l=[],c=/\((.+)\)/.exec(t),d=c&&c[1]?c[1]:!1;d&&(t=t.replace(c[0],""));var u=/\[(.+)\]/.exec(t),p=u&&u[1]?u[1]:!1;p&&(t=t.replace(u[0],""));var h=/\.(.*)(\b|$)/.exec(t),f=h&&h[1]?h[1]:!1;f&&(t=t.replace(h[0],"")),t=(t.length?t:"full").replace(".",""),!!f&&l.push(f),!!p&&l.push(p),!!d&&l.push(d),t.length&&l.push(t);var m=Sm.Entities.Abstraction.templates._template,_=s||m,v=o||s,g={},y=i.replace||!1;if(y){delete i.replace,i.synchronous=!0;for(var b in y)if(y.hasOwnProperty(b)){var w=a.replace(f,y[b]);g[b]=this._generate_one([v,_],w,i)}}for(var S=function(e,t,i){var n=!1;return"boolean"==typeof e||"number"==typeof e?e:("string"==typeof e&&(n=e),e&&t&&(n="string"==typeof e?e:"function"==typeof e?e():e[t]?e[t]:!1),!n&&r&&i[0]&&t!=r&&(n=S(e,r,i)),n)},C=this,x=function(e){var t=i.attributes?C._combine_string(i.attributes,e):e;for(var r in g)g.hasOwnProperty(r)&&(t=t.replace(r,g[r]));return n?t:Promise.resolve(t)},E=[],M=0;M<l.length;M++){var O=l[M];if(E.splice(0,0,M?l[M-1]:!1),m=S(m,O,E)||!1,_=S(_,O,E)||m||!1,v=S(v,O,E)||_||!1,"string"==typeof v)return x(v)}return x("__CONTENT__")},generate:function(e,t,i){var n;i=i||{},"object"==typeof e&&(i=e,e=i.type,t=i.MvCombo||i.data||{},n=i.config||{});var r=!!i.synchronous||!1,o=this._normalize_data(t,n||{});if("relationships"==e&&(e="full.relationship"),/\.relationship/.test(e))return this._relationships(e,o,i);var s=Sm.Entities[this.type].templates,a=this,l=function(){var t=[s[o.template_type]||s.standard,s._template];e=(e||"").toLowerCase(),e.indexOf(".")<0&&(e+=".body");var i=e.replace(/(body|modal|relationship)/,"$1_outer"),n="__CONTENT__";i!=e&&(n=a._generate_one(t,i,{synchronous:!0,replace:{__BUTTON_CONTROL__:"button_control"}}));var r=a._generate_one(t,e,{synchronous:!0});return a._combine_string(o.attributes,n.replace(/__CONTENT__/gi,r))},c=l();return r?c:Promise.resolve(c)},_relationships:function(e,t,i){var n=t.MvCombo,r=Sm.Entities[this.type].templates,o=Sm.Entities[this.type].Meta,s=[r[t.template_type]||r.standard,r._template],a=i.context_id||0,l=i.relationship_indices||[],c=o.get_named_relationship_indices();if(e=e.replace("ips","ip"),!l.length)for(var d in c)c.hasOwnProperty(d)&&l.push([c[d],d]);var u=e.replace(/(relationship)/,"$1_outer"),p=this._generate_one(s,u,{synchronous:!0}),h={},f=i.display_type||"preview",m={},_=i.on_append||!1;"function"!=typeof _&&(_=!1);for(var v=[],g=0;g<l.length;g++){var y=l[g][0],b=l[g][1],w=e.replace(/(relationship)/,"$1[relationship_index]("+y+")"),S=this._generate_one(s,w,{synchronous:!0});S=S.replace("__TITLE__",b);var C=n.getRelationshipIndex(y);if(C||Sm.CONFIG.DEBUG&&console.log("abs_gar,_el,-1.5",y),C){var x=C.get_listed_items(a);h[y]=[],S=S.replace("__TYPE__",y).replace("__R_ID__",n.r_id).replace("__CONTENT__","");var E=this._populate_relationship_index({$relationship_index_string:$(S),relationship_index:y,relationship_object:x,type:e,display_type:f,appended_views:m,templates:s,MvCombo:n});E&&v.push(E)}}var M=p.replace("__CONTENT__","");M=M.length?M:'<div class="content"></div>';for(var O=$(M),T=0;T<v.length;T++){var A=v[T];O.append(A)}return i.synchronous?O[0]:Promise.resolve(O[0])},_populate_relationship_index:function(e){var t=e.$relationship_index_string,i=e.relationship_index,n=e.relationship_object,r=e.type||".relationships",o=e.display_type||"preview",s=e.templates,a=e.appended_views,l=e.MvCombo,c=t.children(".content").eq(0)||!1;if(c||Sm.CONFIG.DEBUG&&console.log("abs_garage,_rel,-1",t),!c)return!1;var d=n.items||[];if(!d.length)return!1;for(var u=n.relationships||[],p=n.count||0,h=0;p>h;h++){var f=d[h],m=u[h],_=r.replace(/(relationship)/,"$1[relationship]("+i+")"),v=this._generate_one(s,_,{synchronous:!0});v=v.replace("__R_ID__",m.Identity.r_id).replace("__MV_R_ID__",l?l.r_id:"null").replace("__CONTENT__",""),this._append_relationship(f,c,i,v,a,o)}return t},_append_relationship:function(e,t,i,n,r,o){o=o||"full";var s=r[e.r_id]?r[e.r_id].clone():e.getView();s.render({synchronous:!0,display_type:o});var a={View:s,container_element:n,relationship_index:i},l=$(a.container_element),c=l.find(".content");if(c[0]){var d=s.get_rendered("Element");c[0].appendChild(d),t[0].appendChild(l[0]),r[e.r_id]=r[e.r_id]||s,s.mark_added()}else Sm.CONFIG.DEBUG&&console.log(l,c,s);return!0}}),Sm.loaded.add("Entities_Abstraction_Garage")},"Entities_Abstraction_Garage")}),define("Sm-Entities-Abstraction-Garage",function(){}),require(["Sm-Core-Core"],function(){Sm.loaded.when_loaded("Core",function(){var e=Sm.spwashi_config.entities,t=["Meta","MvCombo","Wrapper","View","Garage","Model","Abstraction"],i=function(e){this.type=e;for(var i=0;i<t.length;i++){var n=t[i];this[n]=null}};i.prototype.complete=function(){var t=this.type;this.Model=this.Model||function(e){var t=Sm.Core.SmModel.extend({defaults:Sm.Core.Meta.get_defaults_of(e.type)});return t.tmp=!0,t}(this),this.Model.prototype.type=this.type,this.Wrapper=this.Wrapper||function(e){var t=Sm.Core.MvWrapper.extend({type:e.type,parentType:null,populate_container:function(){}}),i=new t;return i.tmp=!0,i}(this),this.templates=this.templates||{_template:{},standard:{}},this.Garage=this.Garage||function(e){var t=Sm.Entities.Abstraction.Garage.extend({}),i=new t(e.type,e.type.toLowerCase()+"_type");return i.tmp=!0,i}(this),this.View=this.View||function(e){var t=Sm.Core.SmView.extend({type:e.type,identifier:".spwashi-"+e.type.toLowerCase()});return t.tmp=!0,t}(this),this.Meta=this.Meta||function(e){var t=Sm.Core.Meta.Proto.extend(),i=new t({type:e.type});return i.Proto=t,i.tmp=!0,i}(this),this.MvCombo=this.MvCombo||function(e){var t=Sm.Core.MvCombo.extend({});return t.tmp=!0,t}(this);var i=e[this.type.replace("__","|")];i.model_type=t,this.Meta.configure(i)},Sm.Entities.Abstraction.SmEntity=i,Sm.loaded.add("Entities_Abstraction_SmEntity");var n={Section:["templates-_template","templates-standard","Meta","Model","View","Garage","MvCombo","Wrapper","Abstraction-Relationship-pivots_RelationshipIndex","Abstraction-Modal-ModalEdit","templates-definition"],Collection:["templates-_template","templates-standard","Meta","View"],Concept:["templates-_template","templates-standard","Meta","View"],Page:["templates-_template","templates-standard","Meta","View","Garage"],Dictionary:["templates-_template","templates-standard","Meta","View","Garage","MvCombo","Wrapper"],Dimension:["templates-_template","templates-standard","Meta","View","Wrapper"]};for(var r in e)if(e.hasOwnProperty(r)){r=r.replace("|","__"),Sm.Entities[r]=new i(r);for(var o=n[r]||[],s=["Core","Entities-Abstraction-Garage"],a=["Sm-Core-Core","Sm-Entities-Abstraction-Garage"],l=0;l<o.length;l++){var c=o[l],d="Entities_"+r+"_"+c;a.push("Sm-Entities-"+r+"-"+c),s.push(d)}a.length&&require(a),Sm.Entities[r]=Sm.Entities[r]||{},Sm.Entities[r].templates=Sm.Entities[r].templates||{},Sm.Entities[r].Abstraction=Sm.Entities[r].Abstraction||{},Sm.Entities[r].Abstraction.Relationship=Sm.Entities[r].Abstraction.Relationship||{},Sm.loaded.when_loaded(s,function(e){return function(){if(Sm.Entities[e]){Sm.Entities[e].complete();var t=$(document.body),i=e.toLowerCase(),n=".spwashi-"+i,r=document.getElementById(i+"_models");Sm.Entities[e].Wrapper.hydrate({elements:t.find(n),models:r?JSON.parse(r.textContent):null}),-1===e.indexOf("__")&&(Sm.CONFIG.DEBUG&&console.log(e,Sm.Entities[e]),Sm.Extras.visual_debug(e+" has been loaded!"))}}}(r),"entities_"+r).then(function(e,t,i){})["catch"](function(e){Sm.CONFIG.DEBUG&&console.log(e," could not be loaded ")}.bind(null,r))}Sm.CONFIG.DEBUG&&console.log(Sm,Sm.spwashi_config)})}),define("Sm-Entities-Abstraction-SmEntity",function(){});var BASE_URL="/resource/js/",CHI_URL=BASE_URL+"chi/";require.config({paths:{jquery:BASE_URL+"vendor/jquery.min",Promise:BASE_URL+"std/Promise",backbone:BASE_URL+"vendor/backbone",Cocktail:BASE_URL+"vendor/Cocktail",underscore:BASE_URL+"vendor/underscore",crossvent:BASE_URL+"vendor/crossvent",inflection:BASE_URL+"vendor/underscore.inflection",tooltipster:BASE_URL+"vendor/jquery.tooltipster.min",select2:BASE_URL+"vendor/select2",SmHighlight:BASE_URL+"std/sm_highlight",Class:CHI_URL+"abstraction/Class",Emitter:CHI_URL+"abstraction/Emitter",Sm:CHI_URL+"Sm","Sm-Core-View":CHI_URL+"Sm/Core/View","Sm-Core-Core":CHI_URL+"Sm/Core/Core","Sm-Core-Identifier":CHI_URL+"Sm/Core/Identifier",
"Sm-Core-Meta":CHI_URL+"Sm/Core/Meta","Sm-Core-MvCombo":CHI_URL+"Sm/Core/MvCombo","Sm-Core-MvWrapper":CHI_URL+"Sm/Core/MvWrapper","Sm-Core-Relationship":CHI_URL+"Sm/Core/Relationship","Sm-Core-RelationshipIndex":CHI_URL+"Sm/Core/RelationshipIndex","Sm-Core-SmModel":CHI_URL+"Sm/Core/SmModel","Sm-Core-SmView":CHI_URL+"Sm/Core/SmView","Sm-Core-util":CHI_URL+"Sm/Core/util","Sm-Entities-Abstraction-SmEntity":CHI_URL+"Sm/Entities/Abstraction/SmEntity","Sm-Entities-Abstraction-Modal-ModalEdit":CHI_URL+"Sm/Entities/Abstraction/Modal/ModalEdit","Sm-Entities-Abstraction-Modal-AddRelationship":CHI_URL+"Sm/Entities/Abstraction/Modal/AddRelationship","Sm-Entities-Abstraction-Modal-ModalDestroy":CHI_URL+"Sm/Entities/Abstraction/Modal/ModalDestroy","Sm-Entities-Abstraction-mixins-SidebarModule":CHI_URL+"Sm/Entities/Abstraction/SidebarModule","Sm-Entities-Abstraction-templates-_template":CHI_URL+"Sm/Entities/Abstraction/templates/_template","Sm-Entities-Abstraction-Garage":CHI_URL+"Sm/Entities/Abstraction/Garage","Sm-Entities-Page-Garage":CHI_URL+"Sm/Entities/Page/Garage","Sm-Entities-Page-Meta":CHI_URL+"Sm/Entities/Page/Meta","Sm-Entities-Page-View":CHI_URL+"Sm/Entities/Page/View","Sm-Entities-Page-templates-_template":CHI_URL+"Sm/Entities/Page/templates/_template","Sm-Entities-Page-templates-standard":CHI_URL+"Sm/Entities/Page/templates/standard","Sm-Entities-Collection-Meta":CHI_URL+"Sm/Entities/Collection/Meta","Sm-Entities-Collection-View":CHI_URL+"Sm/Entities/Collection/View","Sm-Entities-Collection-templates-_template":CHI_URL+"Sm/Entities/Collection/templates/_template","Sm-Entities-Collection-templates-standard":CHI_URL+"Sm/Entities/Collection/templates/standard","Sm-Entities-Dictionary-Garage":CHI_URL+"Sm/Entities/Dictionary/Garage","Sm-Entities-Dictionary-Meta":CHI_URL+"Sm/Entities/Dictionary/Meta","Sm-Entities-Dictionary-MvCombo":CHI_URL+"Sm/Entities/Dictionary/MvCombo","Sm-Entities-Dictionary-View":CHI_URL+"Sm/Entities/Dictionary/View","Sm-Entities-Dictionary-Wrapper":CHI_URL+"Sm/Entities/Dictionary/Wrapper","Sm-Entities-Dictionary-templates-_template":CHI_URL+"Sm/Entities/Dictionary/templates/_template","Sm-Entities-Dictionary-templates-standard":CHI_URL+"Sm/Entities/Dictionary/templates/standard","Sm-Entities-Dimension-Meta":CHI_URL+"Sm/Entities/Dimension/Meta","Sm-Entities-Dimension-View":CHI_URL+"Sm/Entities/Dimension/View","Sm-Entities-Dimension-Wrapper":CHI_URL+"Sm/Entities/Dimension/Wrapper","Sm-Entities-Dimension-templates-_template":CHI_URL+"Sm/Entities/Dimension/templates/_template","Sm-Entities-Dimension-templates-standard":CHI_URL+"Sm/Entities/Dimension/templates/standard","Sm-Entities-Section-Garage":CHI_URL+"Sm/Entities/Section/Garage","Sm-Entities-Section-Meta":CHI_URL+"Sm/Entities/Section/Meta","Sm-Entities-Section-Model":CHI_URL+"Sm/Entities/Section/Model","Sm-Entities-Section-MvCombo":CHI_URL+"Sm/Entities/Section/MvCombo","Sm-Entities-Section-View":CHI_URL+"Sm/Entities/Section/View","Sm-Entities-Section-Wrapper":CHI_URL+"Sm/Entities/Section/Wrapper","Sm-Entities-Section-templates-_template":CHI_URL+"Sm/Entities/Section/templates/_template","Sm-Entities-Section-templates-standard":CHI_URL+"Sm/Entities/Section/templates/standard","Sm-Entities-Section-templates-definition":CHI_URL+"Sm/Entities/Section/templates/definition","Sm-Entities-Section-templates-image":CHI_URL+"Sm/Entities/Section/templates/image","Sm-Entities-Section-Abstraction-Relationship-pivots_RelationshipIndex":CHI_URL+"Sm/Entities/Section/Abstraction/Relationship/pivots_RelationshipIndex","Sm-Entities-Section-Abstraction-Modal-ModalEdit":CHI_URL+"Sm/Entities/Section/Abstraction/Modal/ModalEdit","Sm-Entities-Concept-Meta":CHI_URL+"Sm/Entities/Concept/Meta","Sm-Entities-Concept-View":CHI_URL+"Sm/Entities/Concept/View","Sm-Entities-Concept-templates-_template":CHI_URL+"Sm/Entities/Concept/templates/_template","Sm-Entities-Concept-templates-standard":CHI_URL+"Sm/Entities/Concept/templates/standard"}}),define("require_config",function(){}),require(["require","Sm","crossvent"],function(e){var t=window.document.documentElement,i=document.body,n=$(window);Sm.loaded.when_loaded(["Core","Core_util_crossvent"],function(){var e=Sm.Core.util.crossvent,r={getNextElement:function(e){function t(){var t=e;do t=t.nextSibling;while(t&&1!==t.nodeType);return t}return e.nextElementSibling||t()},getRectHeight:function(e){return e.width||e.right-e.left},getRectWidth:function(e){return e.height||e.bottom-e.top},getOffset:function(e,t){var i=e.getBoundingClientRect(),n=this,r=n.getScroll("scrollLeft","pageXOffset"),o=n.getScroll("scrollTop","pageYOffset");return t&&(r*=0,o*=0),{left:i.left+r,top:i.top+o}},get_event_host:function(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e},get_coordinate:function(e,t){var i=this.get_event_host(t),n={pageX:"clientX",pageY:"clientY"};return e in n&&!(e in i)&&n[e]in i&&(e=n[e]),i[e]},is_input:function(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName},getScroll:function(e,i){return"undefined"!=typeof global[i]?global[i]:t.clientHeight?t[e]:document.body[e]},getParent:function(e){return e&&e.parentNode&&e.parentNode!=document?e.parentNode:null},which_mouse_button:function(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.buttons)return e.buttons;if(void 0!==e.which)return e.which;var t=e.button;return void 0!==t?1&t?1:2&t?3:4&t?2:0:void 0},getElOffset:function(e){var t=0,i=0;do t+=e.offsetTop||0,i+=e.offsetLeft||0,e=e.offsetParent;while(e);return{top:t,left:i}},always:function(){return!0},never:function(){return!1},pn_touch:function(t,i,n,r){var o={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},s={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};global.navigator.msPointerEnabled&&e[i](t,s[n],r),e[i](t,o[n],r),e[i](t,n,r)}},o=Sm.Extras.Draggable={position:{mouse:{x:0,y:0}},mouse_event_listener:function(e){this.position.mouse.x=e.clientX,this.position.mouse.y=e.clientY},mixin:function(e){e=e||{},this.el=this.el||e.el||null,this.$el=this.$el||$(this.el);var s=this,a=r.never,l=r.never;e.can_start?e.can_start===!0?a=r.always:"function"==typeof e.can_start&&(a=e.can_start):a=r.never,e.can_accept?e.can_accept===!0?l=r.always:"function"==typeof e.can_accept&&(l=e.can_accept):l=r.never;var c=e.data||{};this.makeElementDraggable=function(e,t){var i=e||this.el;this.$el=this.$el||$(i),"boolean"==typeof t?t&&(t=this.$el.find(".handle")[0]):"string"==typeof t?t=this.$el.find(t)[0]:Sm.Core.util.isElement(t)||(t=!1),t="undefined"!=typeof t?t:i,i.sm_Draggable=this,i.dataset.sm_draggable=!0,this._draggable.data=c,t&&r.pn_touch(t,"add","mousedown",this.add_bound("grab",this._draggable.grab,this._draggable))},this.removeElementDraggable=function(e,t){var i=e||this.el;i.sm_Draggable=!1,i.dataset.sm_draggable=!1,this._draggable.data={},"boolean"==typeof t?t&&(t=this.$el.find(".handle")[0]):"string"==typeof t?t=this.$el.find(t)[0]:Sm.Core.util.isElement(t)||(t=!1),t="undefined"!==t?t:i,t&&r.pn_touch(t,"remove","mousedown",this.add_bound("grab",this._draggable.grab,this._draggable))},this.setDraggingStatus=function(e){e?this.$el.addClass("sm-transit"):this.$el.removeClass("sm-transit")},this.renderDragMirror=this.renderDragMirror||function(e){var t=e.cloneNode(!0);return t.style.position="absolute",t.style.width=e.offsetWidth,t.style.height=e.offsetHeight,t},this.add_bound=this.add_bound||function(e,t,i){return this._fns=this._fns||{},"function"!=typeof t?(Sm.CONFIG.DEBUG&&console.log(t,e),function(){}):this._fns[e]=this._fns[e]||t.bind(i||this)},this.get_bound=this.get_bound||function(e){return this._fns[e]?this._fns[e]:function(){}.bind(this)},this._draggable={status:{is_draggable:!1,is_dragging:!1,is_grabbed:!1,_grab_has_been_called:!1,is_animated:!1},position:{offset:{x:0,y:0},latest_mouse:{x:0,y:0}},elements:{last_hover:null,last_drop_target:null},known_droppables:{},data:{},mirror_contains:function(e){if(!e)return!1;if(this.elements.mirror){if(e==this.elements.mirror)return!0;if(e.dataset&&1==e.dataset.sm_drag_is_in_mirror)return!0;for(var t,n=!0;n;){if(t=e.parentNode,t==this.elements.mirror)return e.dataset&&(e.dataset.sm_drag_is_in_mirror=!0),!0;t&&t!==i&&t!==document?e=t:n=!1}}return e.dataset&&(e.dataset.sm_drag_is_in_mirror=!1),!1},find_drop_target:function(){for(var e,t,n=o.position.mouse,r=n.x,s=n.y,a=[],c=[],d=document.elementFromPoint(r,s),u=[];!e&&d&&d!==i&&d!==window&&d!==document&&d!==document.documentElement;)if(a.push(d),c.push(d.style.visibility),d.style.visibility="hidden",d=document.elementFromPoint(r,s),!this.mirror_contains(d)){if(d.dataset.sm_drag_find_drop_rand_id&&(t=d.dataset.sm_drag_find_drop_rand_id,this.known_droppables[t])){e=d;break}d.sm_Draggable&&l&&l.call(d.sm_Draggable,this,this.data)&&(u.push(d),t=d.dataset.sm_drag_find_drop_rand_id=Sm.Core.util.randomString(7),this.known_droppables[t]=d)}for(var p=0;p<a.length;p++)a[p].style.visibility=c[p];return e||!1},find_first_element:function(){var e,n,r=o.position.mouse,s=r.x,a=r.y;(n=this.elements.mirror)&&(e=n.style.visibility)&&(n.style.visibility="hidden");var l=document.elementFromPoint(s,a);!!n&&(n.style.visibility=e);for(var c,d=[],u=[];!c&&l&&l!==i&&l!==window&&l!==document&&l!==t;){if(l=document.elementFromPoint(s,a),!this.mirror_contains(l)){c=l;break}u.push(l.style.visibility),l.style.visibility="hidden",d.push(l)}for(var p=0;p<d.length;p++){var h=d[p];h.style.visibility=u[p]}return c||!1},grab:function(e){if(!this.status._grab_has_been_called){!this.position&&Sm.CONFIG.DEBUG&&console.log(this),this.position.latest_mouse.x=o.position.mouse.x,this.position.latest_mouse.y=o.position.mouse.y;var t=1!==r.which_mouse_button(e)||!!e.metaKey||!!e.ctrlKey;if(!t&&a(e)){if(e.stopPropagation(),"mousedown"===e.type){var i=e.target;if(r.is_input(i))return}this.manual_grab(e)}}},manual_grab:function(e){document.selection&&document.selection.empty&&document.selection.empty(),window.getSelection&&window.getSelection().removeAllRanges(),this.status._grab_has_been_called=!0,this.status.is_grabbed=!0;var i=s.$el,n=s.el,a=this.elements.mirror=s.renderDragMirror(n);if(!a)return this.release(),!1;!!e&&e.preventDefault&&e.preventDefault(),t.appendChild(a),i.addClass("sm-transit");var l=a.offsetWidth,c=a.offsetHeight;a.style.left=o.position.mouse.x-l/2+"px",a.style.top=o.position.mouse.y-c/2+"px",r.pn_touch(t,"add","mousemove",s.add_bound("drag",this.drag,this)),r.pn_touch(t,"add","mouseup",s.add_bound("release",this.release,this))},drag:function(e){r.get_coordinate("clientX",e),r.get_coordinate("clientY",e);this.cache=this.cache||{};var t=this.cache.window_height||n.innerHeight();this.status.is_dragging=!0;var i=this.position.latest_mouse.x,s=this.position.latest_mouse.y,a=o.position.mouse.x,l=o.position.mouse.y,c=a-i,d=l-s;if(!(Math.abs(c)<5&&Math.abs(d)<5)){this.position.latest_mouse.x=a,this.position.latest_mouse.y=l,Math.abs(t-e.clientY)<70?window.scrollBy(e.clientX,20):e.clientY<70&&window.scrollBy(e.clientX,-20);var u=this.elements.mirror;if(u){var p=u.style.left,h=u.style.top;h=parseFloat(h.substring(0,h.length-2)),p=parseFloat(p.substring(0,p.length-2));var f=this.find_drop_target(),m=this.elements.last_drop_target;return f?void(f!=m&&($(u).addClass("sm-dropping"),!this.status.is_animated&&this.animate_droppability(),m&&$(m).removeClass("sm-hover"),this.elements.last_drop_target=f,$(f).addClass("sm-hover"))):void(m&&(m&&$(m).removeClass("sm-hover"),this.elements.last_drop_target=null,$(u).removeClass("sm-dropping")))}}},animate_droppability:function(){var e=this.elements.mirror,t=e.style.left,i=e.style.top;i=parseFloat(i.substring(0,i.length-2)),t=parseFloat(t.substring(0,t.length-2));var n,r,s=this.status,a=e.getBoundingClientRect(),l=a.width,c=a.height,d=t+l/2,u=i-c/2,p=function(a,l){if(!s.is_dragging)return!1;n=o.position.mouse.y,r=o.position.mouse.x;var c=n-u,p=r-d;s.is_animated=!0,a=(a||16)/2;var h=Math.round(p/a),f=Math.round(c/a);t+=h,d+=h,i+=f,u+=f,e.style.top=i+"px",e.style.left=t+"px"};return Sm.Core.util.create_animation_loop(p),!0},drop:function(){var e=this.elements.last_drop_target;if(!e)return!1;var t=e.sm_Draggable;return t?(s.setDraggingStatus(!1),void("function"==typeof t.accept_drop&&t.accept_drop(this.data))):!1},release:function(){t.style.pointer="auto";var e=this.elements.last_drop_target;!!e&&$(e).removeClass("sm-hover"),this.drop(),this.elements.mirror&&this.elements.mirror.parentNode.removeChild(this.elements.mirror),this.elements.mirror=this.elements.last_hover=this.elements.last_drop_target=this.status.is_animated=this.status.is_dragging=this.status._grab_has_been_called=!1;var i=this.known_droppables;for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];o&&o.dataset&&(o.dataset.sm_drag_find_drop_rand_id=!1)}var a=s.$el;a.removeClass("sm-transit"),r.pn_touch(t,"remove","mousemove",s.add_bound("drag",this.drag,this)),r.pn_touch(t,"remove","mouseup",s.add_bound("release",this.release,this))}},this.grabElement=this._draggable.manual_grab.bind(this._draggable)}};Sm.loaded.add("Extras_Draggable"),document.addEventListener("mousemove",o.mouse_event_listener.bind(o))},"Extras_Draggable")}),define("Sm/Extras/DraggableMixin",function(){}),require(["require","Emitter","Sm"],function(e,t){e("Sm"),Sm.loaded.when_loaded("Core",function(){"use strict";Sm.Extras.ViewAid=t.extend({init:function(e){e=e||{},this.settings=this.settings||e,this.html="",this._callbacks=this._callbacks||{},this.status={is_open:!1},this.init_emitter_events(),this.element=e.element,this.action_classname="view_aid-button",Array.isArray(this.settings.click_events)||(this.settings.click_events=[this.settings.click_events]),this.settings.click_events.splice(0,0,this.default_click_handler.bind(this)),this.click_events=this.settings.click_events;var t=this.element;this.html=Sm.Core.util.isElement(t)?t.innerHTML:"string"==typeof t?t:"",e.is_open&&(this.status.is_open=!0,this.init_events())},_click_handler:function(e){if(this.status.is_open)for(var t=this.settings.click_events,i=0;i<t.length;i++){var n=t[i];if("function"==typeof n&&!1===n(e))break}return!0},init_events:function(){if(!this.element)return!1;var e=this.add_bound("outside_click",this._outsideClickHandler);this.element.addEventListener("click",e);var t=this.add_bound("click_handler",this._click_handler);return this.element.addEventListener("click",t,!0),!0},setElement:function(e){this.html=Sm.Core.util.isElement(e)?e.innerHTML:"string"==typeof e?e:""},_changeElement:function(e){this.html=Sm.Core.util.isElement(e)?e.innerHTML:"string"==typeof e?e:"";var t=this.get_content_element();t&&(t.innerHTML=this.html),this.init_events(),this.emit("open")},open:function(){this.emit("before_open",this),this.status.is_open=!0,this.init_events(),this.emit("open",this,this.content_element)},close:function(){this.emit("before_close",this,this.content_element),this.element&&$(this.element).remove(),this.status.is_open=!1,this.emit("close",this,this.content_element)},_outsideClickHandler:function(e){for(var t=e.target;t!=document.body&&t.parentNode;){if(t===this.get_content_element())return;t=t.parentNode}this.close()},default_click_handler:function(e){var t=e.target,i=$(t),n=this,r=!1,o=!1,s=[{c:i.hasClass("edit")&&i.hasClass(this.action_classname),f:function(){n.emit("edit",n,n.get_content_element())}},{c:i.hasClass("save")&&i.hasClass(this.action_classname),f:function(){n.emit("save",n,n.get_content_element())}},{c:i.hasClass("add")&&i.hasClass(this.action_classname),f:function(){n.emit("add",n,n.get_content_element())}},{c:i.hasClass("close")&&i.hasClass(this.action_classname),f:function(){n.close()}},{c:(r=i.hasClass("action"))||(o=i.parents(".action")).length,f:function(){return r||(i=o[0],t=i),t.dataset.action&&n.emit(t.dataset.action,t.dataset.data||"",t.dataset,e),t.dataset.action&&e.stopPropagation(),!0}}];return Sm.Core.util.switch_(s)},get_content_element:function(e){return this.$element=this.$element||$(this.element),e?this.$element:this.element},init_emitter_events:function(){var e=this.settings.events;for(var t in e)if(e.hasOwnProperty(t)){var i,n=e[t];if(n.constructor===Array)for(var r=0;r<n.length;r++)i=n[r],i&&"function"==typeof i.bind?this.on(t,i.bind(this)):Sm.CONFIG.DEBUG&&console.log("ViewAid,iee,0,cannot bind ",i);else{if(i=n,!i||"function"!=typeof i.bind){Sm.CONFIG.DEBUG&&console.log("ViewAid,iee,1,cannot bind "+t,i);continue}this.on(t,i.bind(this))}}var o=this;this.on("open",function(){for(var e=o.get_content_element(),t=$(e).find("select"),i=0;i<t.length;i++){var n=t[i],r=function(e){return function(t){var i=e.options,n=i[e.selectedIndex];o.emit("select",n.value,n.dataset,t)}};n.addEventListener("change",r(n))}})}}),Sm.loaded.add("Extras_ViewAid")},"Extras_ViewAid")}),define("Sm/Extras/ViewAid",function(){}),require(["jquery"],function(e){Sm.Extras.Highlight={highlight:function(t,i){function n(t,i,r,o,s){var l=t.childNodes;if(l&&l.length)for(var c=0;c<l.length;c++){var d=l[c];e(d).hasClass("sm-highlight")&&1===d.childNodes.length&&d.childNodes[0].textContent&&d.childNodes[0].textContent.toLowerCase()==a.toLowerCase()||n(d,i,r,o,s)}else{var p=t.textContent||t.innerHTML;if(!t.splitText||!p||!p.length)return i;i.push(t),r.push(p),o.push(p.length),s[u++]={start:[],end:[],node:p}}return i}function r(e,t){for(var i,n,r,o=e.length,s=new RegExp(e+"\\b","gi"),a=[],l=[];null!=(i=s.exec(t));)n=i.index,r=n+o-1,a.push(n),l.push(r);return[a,l]}t=t&&"object"==typeof t?t:{},i=i&&"object"==typeof i?i:{};var o=t.element||document.body;if(Sm.Core.util.isElement(o)){var s=t.target||!1,a=t.word,l=t.className||"";l+=" sm-highlight";var c=t.dataset||{};c.word=c.word||a,a.trim||Sm.CONFIG.DEBUG&&console.log(a),a=a.trim();var d=a.length,u=0,p=i.on_init&&"function"==typeof i.on_init?i.on_init:!1,h=[],f=[],m=[],_={};n(o,h,f,m,_);var v=f.join(""),g=r(a,v),y=g[0],b=g[1];if(y||b){var w=function(e,t,i,n){var r=0,o=0,s=t[0];if(s)for(var a,l,c=s.length,u=c,p=0;p<e.length;p++){for(a=e[p],l=u-a;a>=u&&t[r];)r++,s=t[r],c=s.length,u+=c,l=u-a;o=c-l,0>o||(n?0>o-d&&i[r].end.push(o):i[r].start.push(o))}};w(y,f,_,0),w(b,f,_,1);for(var S=u-1;S+1;S--){var C,x,E=h[S],M=m[S],O=_[S].start,T=(_[S].end,0);if(O.length)for(var $=O.length-1;$+1;$--){T=O[$];var A;A=T+d>M?M:T+d,E.splitText(A),x=E.splitText(T),E.normalize(),s?(C=document.createElement("a"),C.setAttribute("href",s)):C=document.createElement("span"),C.className=l;var I=x.cloneNode(!0);C.appendChild(I),c.word&&(C.dataset.word=c.word),Sm.CONFIG.DEBUG&&console.log(c.word),x.parentNode.replaceChild(C,x),p&&p(C)}}}}},un_highlight:function(t,i){t=t&&"object"==typeof t?t:{},i=i&&"object"==typeof i?i:{};var n=t.element||document.body;if(Sm.Core.util.isElement(n)){var r=t.word,o=t.dataset||{word:[],dictionary_ids:[]};o.word=o.word||[r],o.dictionary_ids=o.dictionary_ids||[],r=r.trim();for(var s=e(n),a=s.find(".sm-highlight[data-word="+r+"]"),l=0;l<a.length;l++){var c=a[l];e(c).replaceWith(c.childNodes)}return!0}}},Sm.loaded.add("Extras_SmHighlight")}),define("SmHighlight",function(){}),require(["require"],function(e){Sm.Entities.Page.templates._template={relationship:{relationship_index:{concepts:'<div class="relationship-container concepts-container" data-Mv-r_id="__R_ID__">\n    <header class="title"><label for="concept-container">__TITLE__</label></header>\n    <select name="concept-container" id="concept-container" class="content" multiple="multiple"></select>\n</div>'}}},Sm.loaded.add("Entities_Page_templates__template")}),define("Sm-Entities-Page-templates-_template",function(){}),require(["require"],function(e){Sm.Entities.Page.templates.standard={modal:{edit:'<div class="control-group">\n    <label for="title">Title:</label>\n    <input data-attribute="title" class="model edit title" type="text" name="title" placeholder="Section Title" title="title" value="<%- title %>">\n    <span class="error" id="title-error"></span>\n</div>\n<div class="control-group">\n    <label for="subtitle">Subtitle:</label>\n    <input data-attribute="subtitle" class="model edit subtitle" type="text" name="subtitle"\n           placeholder="Section Subtitle" title="subtitle" value="<%- subtitle %>">\n    <span class="error" id="subtitle-error"></span>\n</div>\n<div class="control-group">\n    <label for="description">Description: </label>\n    <textarea data-attribute="description" class="model edit description" name="description" placeholder="Description"><%- description %></textarea>\n    <span class="error" id="description-error"></span>\n</div>'},body:'<div class="page description" ><%- description %></div>'},Sm.loaded.add("Entities_Page_templates_standard")}),define("Sm-Entities-Page-templates-standard",function(){}),require(["require"],function(e){Sm.Entities.Collection.templates._template={body_outer:'<div class="spwashi-collection preview" data-ent_id="<%- ent_id %>" data-id="<%- id %>" data-title=\'<%- title %>\'>\n    __BUTTON_CONTROL__\n    __CONTENT__\n</div>'},Sm.loaded.add("Entities_Collection_templates__template")}),define("Sm-Entities-Collection-templates-_template",function(){}),require(["require"],function(e){Sm.Entities.Collection.templates.standard={body:'<div class="description" ><%- description %></div>',modal:'<div class="control-group">\n    <label for="title">title:</label>\n    <input data-attribute="title" class="model edit title" type="text" name="title"\n           placeholder="Collection title" title="title" value="<%- title %>">\n    <span class="error" id="title-error"></span>\n</div>\n<div class="control-group">\n    <label for="description">Description: </label>\n    <textarea data-attribute="description" class="model edit description" name="description" placeholder="Description"><%- description %></textarea>\n    <span class="error" id="description-error"></span>\n</div>'},Sm.loaded.add("Entities_Collection_templates_standard")}),define("Sm-Entities-Collection-templates-standard",function(){}),require(["require"],function(e){Sm.Entities.Dictionary.templates._template={body_outer:'<div class="spwashi-dictionary preview" data-ent_id="<%- ent_id %>" data-id="<%- id %>" data-title=\'<%- title %>\'>\n    __BUTTON_CONTROL__\n    __CONTENT__\n</div>',modal_outer:'<header>\n    <h3>Edit Dictionary</h3>\n</header>\n<div class="content form aligned">\n    __BUTTON_CONTROL__\n    <input type="hidden" value="<%- id %>" name="id">\n    __CONTENT__\n    <div class="control-group view_relationship-container">\n        <button class="action modal-button" data-action="view_relationships">View Relationships</button>\n    </div>\n</div>',relationship:{relationship:{definitions:'<div class="relationship definition-relationship" data-Mv-r_id="__MV_R_ID__" data-Relationship-r_id="__R_ID__">\n    <header class="relationship-type-title">\n        <h3 class="title">__TITLE__</h3>\n    </header>\n    <div class="content">__CONTENT__</div>\n</div>'}},tooltip_outer:'<div class="tooltip relationship definition-relationship" data-Mv-r_id="__MV_R_ID__" data-Relationship-r_id="__R_ID__">\n    <header>\n        <h3 class="title">__TITLE__</h3>\n        <h3 class="subtitle">__SUBTITLE__</h3>\n    </header>\n    <div class="content">__CONTENT__</div>\n</div>'},Sm.loaded.add("Entities_Dictionary_templates__template")}),define("Sm-Entities-Dictionary-templates-_template",function(){}),require(["require"],function(e){Sm.Entities.Dictionary.templates.standard={body:'<div class="description" ><%- description %></div>',modal:'<div class="control-group">\n    <label for="title">Title:</label>\n    <input data-attribute="title" class="model edit title" type="text" name="title" placeholder="Dictionary Title" title="title" value="<%- title %>">\n    <span class="error" id="title-error"></span>\n</div>\n<div class="control-group">\n    <label for="description">Description: </label>\n    <textarea data-attribute="description" class="model edit description" name="description" placeholder="Dictionary Description"><%- description %></textarea>\n    <span class="error" id="description-error"></span>\n</div>'},Sm.loaded.add("Entities_Dictionary_templates_standard")}),define("Sm-Entities-Dictionary-templates-standard",function(){}),require(["require"],function(e){Sm.Entities.Dimension.templates._template={body:'<div class="title" ><%- title %></div>\n <div class="description" > - <%- description %></div>',body_outer:'<div data-ent_id="<%- ent_id %>" data-id="<%- id %>" class="spwashi-dimension spwashi-entity <% if(_type){ %>type-<%- _type %><% } %> ">\n    __CONTENT__\n</div>'},Sm.loaded.add("Entities_Dimension_templates__template")}),define("Sm-Entities-Dimension-templates-_template",function(){}),require(["require"],function(e){Sm.Entities.Dimension.templates.standard={},Sm.loaded.add("Entities_Dimension_templates_standard")}),define("Sm-Entities-Dimension-templates-standard",function(){}),require(["require"],function(e){Sm.Entities.Section.templates._template={body_outer:{full:'<section title="<%- subtitle %>" class="spwashi-section spwashi-entity  <% if( ! has_title) {%>no-title<% } %> <% if(_type){ %>type-<%- _type %><% } %> " data-ent_id="<%- ent_id %>" data-id="<%- id %>" data-title=\'<%- title %>\'>\n    __BUTTON_CONTROL__\n    <div class="focus upper">\n        <div class="pan left ">\n            <i class="fa left fa-caret-left"></i>\n        </div>\n        <div class="pan right">\n            <i class="fa right fa-caret-right"></i>\n        </div>\n    </div>\n    <header>\n        <div class="dev id"><%- id %></div>\n        <% if(has_title != 0) { %><h3 class="title"><%- title %></h3> <% } %>\n    </header>\n    __CONTENT__\n    <div data-relationship_index="composition" data-ent_id="<%- ent_id %>" class="relationship-container composition-container"></div>\n    <div data-relationship_index="children" data-ent_id="<%- ent_id %>" class="relationship-container children-container"></div>\n</section>',preview:'<section title="<%- subtitle %>" class="spwashi-section preview spwashi-entity  <% if( ! has_title) {%>no-title<% } %> <% if(_type){ %>type-<%- _type %><% } %> " data-ent_id="<%- ent_id %>" data-id="<%- id %>" data-title=\'<%- title %>\'>\n    __BUTTON_CONTROL__\n    <header>\n        <div class="dev id"><%- id %></div>\n        <% if(has_title != 0) { %><h3 class="title"><%- title %></h3> <% } %>\n    </header>\n    __CONTENT__\n</section>',inline:'<span title="<%- subtitle %>" class="spwashi-section inline spwashi-entity <% if(_type){ %>type-<%- _type %><% } %>">\n    __BUTTON_CONTROL__\n    __CONTENT__\n</span>',tag:'<div title="<%- subtitle %>" class="spwashi-section tag spwashi-entity <% if(_type){ %>type-<%- _type %><% } %>">\n    __BUTTON_CONTROL__\n    __CONTENT__\n</div>'},body:{full:'<div class="content" ><%- content %></div>',preview:'<div class="content" ><% if(content.length > 50 ){ %><%- content.substr(0, 50) %> <% } else {%> <%- content %> <% }%></div>',tag:'<div class="content" ><% if(content.length > 50 ){ %><%- content.substr(0, 50) %> <% } else {%> <%- content %> <% }%></div>',inline:'<div class="content" ><%- content && content.trim().length ? content :  "-" %></div>'},modal_outer:{edit:'<header>\n    <h3>Edit <%- _type ? _type : \'Section\' %></h3>\n</header>\n<div class="content form aligned">\n    __BUTTON_CONTROL__\n    <input type="hidden" class="section-type" value="<%- section_type%>">\n    <input type="hidden" value="<%- id %>" name="id">\n\n    __CONTENT__\n\n    <div class="control-group">\n        <label for="has_title">Display Title: </label>\n        <input class="model edit has_title" data-attribute="has_title" type="checkbox" id="has_title" name="has_title" value="1" <% if(has_title == 1) {%>checked<% } %>>\n    </div>\n    <div class="control-group">\n        <label for="section_type">Section Type: </label>\n        <select class="model edit section_type select" data-attribute="section_type" id="section_type" name="section_type">\n            <option value="1"\n            <% if(section_type == 1){%>selected<% } %>>Standard</option>\n            <option value="2"\n            <% if(section_type == 2){%>selected<% } %>>Image</option>\n            <option value="3"\n            <% if(section_type == 3){%>selected<% } %>>Video</option>\n            <option value="4"\n            <% if(section_type == 4){%>selected<% } %>>Audio</option>\n            <option value="5"\n            <% if(section_type == 5){%>selected<% } %>>Definition</option>\n            <option value="6"\n            <% if(section_type == 6){%>selected<% } %>>Table</option>\n            <option value="7"\n            <% if(section_type == 7){%>selected<% } %>>List</option>\n            <option value="8"\n            <% if(section_type == 8){%>selected<% } %>>Embedded Content</option>\n        </select>\n    </div>\n    <div class="control-group view_relationship-container" >\n        <button class="action modal-button" data-action="view_relationships">View Relationships</button>\n    </div>\n</div>'},modal:{add_relationship_type:{pivots:'<div class="form" id="modal-continue-2">\n    <div class="control-group ">\n        <label for="position">Position:</label>\n        <input id="position" data-attribute="position" class="relationship-attribute position" type="text" name="position"\n               placeholder="Which position should we add the relationship?" title="position" value="<%- typeof position !== \'undefined\' ? position : 0 %>">\n        <span class="error" id="position-error"></span>\n    </div>\n\n    <div class="control-group ">\n        <label for="relationship_subindex">Relationship Subtype: </label>\n        <select class="relationship-attribute relationship_subindex select" data-attribute="relationship_subindex" id="relationship_subindex" name="relationship_subindex">\n            <% for (var name in relationship_subindices) { if (!relationship_subindices.hasOwnProperty(name)) continue; %>\n            <option value="<%- relationship_subindices[name] %>"><%- name %></option>\n            <% } %>\n        </select>\n    </div>\n</div>'}},button_control:'<div class="icons button-control">\n    <i class="button edit fa fa-pencil"></i>\n    <i class="button delete close fa fa-remove"></i>\n    <i class="button add fa fa-plus"></i>\n    <i class="button handle fa fa-arrows"></i>\n    <i class="debug button fa fa-question"></i>\n</div>',pivot_display:'<div class="button-dialog relationship-type section-pivot">\n    \n    <% if(typeof(home) !== "undefined") {%>\n    <div class="relationship-subtype-category home clearfix">\n        <div data-action="pivot" data-data="home" class="relationship-subtype action home active" data-relationship_subtype="home"><span>Home</span></div>\n    </div>\n    <% } %>\n    <% if(typeof(text) !== "undefined") {%>\n    <div class="relationship-subtype-category text clearfix">\n        <div data-action="pivot" data-data="text" class="relationship-subtype action text <%= text.indexOf(\'text\') > -1 ? \'active\' : \'not\' %>" data-relationship_subtype="text"><span>Text</span></div>\n        <div data-action="pivot" data-data="eli5" class="relationship-subtype action eli5 <%= text.indexOf(\'eli5\') > -1 ? \'active\' : \'not\' %>" data-relationship_subtype="eli5"><span>ELI5</span></div>\n        <div data-action="pivot" data-data="thing_explainer" class="relationship-subtype action thing_explainer <%= text.indexOf(\'thing_explainer\') > -1 ? \'active\' : \'not\' %>" data-relationship_subtype="thing_explainer">\n            <span>Thing Explainer</span></div>\n    </div>\n    <% } %>\n    <% if(typeof(image) !== "undefined") {%>\n    <div class="relationship-subtype-category image">\n        <div data-action="pivot" data-data="image" class="relationship-subtype action image <%= image.indexOf(\'image\') > -1 ? \'active\' : \'inactive\' %>" data-relationship_subtype="image"><span>Image</span></div>\n    </div>\n    <% } %>\n    <% if(typeof(video) !== "undefined") {%>\n    <div class="relationship-subtype-category video">\n        <div data-action="pivot" data-data="video" class="relationship-subtype action video <%= video.indexOf(\'video\') > -1 ? \'active\' : \'inactive\' %>" data-relationship_subtype="video"><span>Video</span></div>\n    </div>\n    <% } %>\n    <% if(typeof(audio) !== "undefined") {%>\n    <div class="relationship-subtype-category audio">\n        <div data-action="pivot" data-data="audio" class="relationship-subtype action audio <%= audio.indexOf(\'audio\') > -1 ? \'active\' : \'inactive\' %>" data-relationship_subtype="audio"><span>Audio</span></div>\n    </div>\n    <% } %>\n</div>'
},Sm.loaded.add("Entities_Section_templates__template")}),define("Sm-Entities-Section-templates-_template",function(){}),require(["require"],function(e){Sm.Entities.Section.templates.standard={modal:{edit:{full:'<div class="control-group">\n    <label for="title">Title:</label>\n    <input data-attribute="title" class="model edit title" type="text" name="title" placeholder="Section Title" title="title" value="<%- title %>">\n    <span class="error" id="title-error"></span>\n</div>\n<div class="control-group">\n    <label for="subtitle">Subtitle:</label>\n    <input data-attribute="subtitle" class="model edit subtitle" type="text" name="subtitle"\n           placeholder="Section Subtitle" title="subtitle" value="<%- subtitle %>">\n    <span class="error" id="subtitle-error"></span>\n</div>\n<div class="control-group">\n    <label for="content_location">Content Location:</label>\n    <input data-attribute="content_location" class="model edit content_location" type="text" name="content_location"\n           placeholder="Content Location" title="content_location" value="<%- content_location %>">\n    <span class="error" id="content_location-error"></span>\n</div>\n<div class="control-group">\n    <label for="content">Content: </label>\n    <textarea data-attribute="content" class="model edit content" name="content" placeholder="Content"><%- content %></textarea>\n    <span class="error" id="content-error"></span>\n</div>',inline:'<div class="control-group">\n    <label for="title">Title:</label>\n    <input data-attribute="title" class="model edit title" type="text" name="title" placeholder="Section Title" title="title" value="<%- title %>">\n    <span class="error" id="title-error"></span>\n</div>\n<div class="control-group">\n    <label for="content">Content: </label>\n    <textarea data-attribute="content" class="model edit content" name="content" placeholder="Content"><%- content %></textarea>\n    <span class="error" id="content-error"></span>\n</div>'}},cache:{}},Sm.loaded.add("Entities_Section_templates_standard")}),define("Sm-Entities-Section-templates-standard",function(){}),require(["require"],function(e){Sm.Entities.Section.templates.definition={modal_outer:{full:'<header>\n    <h3>Edit Definition!</h3>\n</header>\n<div class="content form aligned">\n    __BUTTON_CONTROL__\n    <input type="hidden" class="section-type" value="<%- section_type%>">\n    <input type="hidden" value="<%- id %>" name="id">\n\n    __CONTENT__\n\n    <div class="control-group">\n        <label for="has_title">Display Title: </label>\n        <input class="model edit has_title" data-attribute="has_title" type="checkbox" id="has_title" name="has_title" value="1" <% if(has_title == 1) {%>checked<% } %>>\n    </div>\n    <div class="control-group">\n        <label for="section_type">Section Type: </label>\n        <select class="model edit section_type select" data-attribute="section_type" id="section_type" name="section_type">\n            <option value="1"\n            <% if(section_type == 1){%>selected<% } %>>Standard</option>\n            <option value="2"\n            <% if(section_type == 2){%>selected<% } %>>Image</option>\n            <option value="3"\n            <% if(section_type == 3){%>selected<% } %>>Video</option>\n            <option value="4"\n            <% if(section_type == 4){%>selected<% } %>>Audio</option>\n            <option value="5"\n            <% if(section_type == 5){%>selected<% } %>>Definition</option>\n            <option value="6"\n            <% if(section_type == 6){%>selected<% } %>>Table</option>\n            <option value="7"\n            <% if(section_type == 7){%>selected<% } %>>List</option>\n            <option value="8"\n            <% if(section_type == 8){%>selected<% } %>>Embedded Content</option>\n        </select>\n    </div>\n    <div class="control-group view_relationship-container" >\n        <button class="action modal-button" data-action="view_relationships">View Relationships</button>\n    </div>\n</div>',inline:'<header>\n    <h3>Edit Definition!</h3>\n</header>\n<div class="content form aligned">\n    __BUTTON_CONTROL__\n    <input type="hidden" class="section-type" value="<%- section_type%>">\n    <input type="hidden" value="<%- id %>" name="id">\n    __CONTENT__\n</div>',preview:!1,tab:!1,tag:!1},modal:{full:'<div class="control-group">\n    <label for="title">Title:</label>\n    <input data-attribute="title" class="model edit title" type="text" name="title" placeholder="Section Title" title="title" value="<%- title %>">\n    <span class="error" id="title-error"></span>\n</div>\n<div class="control-group">\n    <label for="subtitle">Subtitle:</label>\n    <input data-attribute="subtitle" class="model edit subtitle" type="text" name="subtitle"\n           placeholder="Section Subtitle" title="subtitle" value="<%- subtitle %>">\n    <span class="error" id="subtitle-error"></span>\n</div>\n<div class="control-group">\n    <label for="content_location">Content Location:</label>\n    <input data-attribute="content_location" class="model edit content_location" type="text" name="content_location"\n           placeholder="Content Location" title="content_location" value="<%- content_location %>">\n    <span class="error" id="content_location-error"></span>\n</div>\n<div class="control-group">\n    <label for="content">Content: </label>\n    <textarea data-attribute="content" class="model edit content" name="content" placeholder="Content"><%- content %></textarea>\n    <span class="error" id="content-error"></span>\n</div>\n<div class="control-group">\n    <label for="words">Words: </label>\n    <textarea data-attribute="words" class="model edit words" name="words" placeholder="words"><%- words %></textarea>\n    <span class="error" id="words-error"></span>\n</div>',inline:'<div class="control-group">\n    <label for="title">Title:</label>\n    <input data-attribute="title" class="model edit title" type="text" name="title" placeholder="Section Title" title="title" value="<%- title %>">\n    <span class="error" id="title-error"></span>\n</div>\n<div class="control-group">\n    <label for="content">Content: </label>\n    <textarea data-attribute="content" class="model edit content" name="content" placeholder="Content"><%- content %></textarea>\n    <span class="error" id="content-error"></span>\n</div>\n<div class="control-group">\n    <label for="words">Words: </label>\n    <textarea data-attribute="words" class="model edit words" name="words" placeholder="words"><%- words %></textarea>\n    <span class="error" id="words-error"></span>\n</div>'},body:{full:'<div class="content boon <% if(content_location !== undefined && !!content_location && content_location.length) {%>clickable <%}%>" ><%- content %></div>'},cache:{}},Sm.loaded.add("Entities_Section_templates_definition")}),define("Sm-Entities-Section-templates-definition",function(){}),require(["require"],function(e){Sm.Entities.Section.templates.image={modal_outer:{full:'<header>\n    <h3>Edit Image!</h3>\n</header>\n<div class="content form aligned">\n    __BUTTON_CONTROL__\n    <input type="hidden" class="section-type" value="<%- section_type%>">\n    <input type="hidden" value="<%- id %>" name="id">\n\n    __CONTENT__\n\n    <div class="control-group">\n        <label for="has_title">Display Title: </label>\n        <input class="model edit has_title" data-attribute="has_title" type="checkbox" id="has_title" name="has_title" value="1" <% if(has_title == 1) {%>checked<% } %>>\n    </div>\n    <div class="control-group">\n        <label for="section_type">Section Type: </label>\n        <select class="model edit section_type select" data-attribute="section_type" id="section_type" name="section_type">\n            <option value="1"\n            <% if(section_type == 1){%>selected<% } %>>Standard</option>\n            <option value="2"\n            <% if(section_type == 2){%>selected<% } %>>Image</option>\n            <option value="3"\n            <% if(section_type == 3){%>selected<% } %>>Video</option>\n            <option value="4"\n            <% if(section_type == 4){%>selected<% } %>>Audio</option>\n            <option value="5"\n            <% if(section_type == 5){%>selected<% } %>>Image</option>\n            <option value="6"\n            <% if(section_type == 6){%>selected<% } %>>Table</option>\n            <option value="7"\n            <% if(section_type == 7){%>selected<% } %>>List</option>\n            <option value="8"\n            <% if(section_type == 8){%>selected<% } %>>Embedded Content</option>\n        </select>\n    </div>\n    <div class="control-group view_relationship-container" >\n        <button class="action modal-button" data-action="view_relationships">View Relationships</button>\n    </div>\n</div>',inline:'<header>\n    <h3>Edit Image!</h3>\n</header>\n<div class="content form aligned">\n    __BUTTON_CONTROL__\n    <input type="hidden" class="section-type" value="<%- section_type%>">\n    <input type="hidden" value="<%- id %>" name="id">\n    __CONTENT__\n</div>'},modal:{full:'<div class="control-group">\n    <label for="title">Title:</label>\n    <input data-attribute="title" class="model edit title" type="text" name="title" placeholder="Section Title" title="title" value="<%- title %>">\n    <span class="error" id="title-error"></span>\n</div>\n<div class="control-group">\n    <label for="subtitle">Subtitle:</label>\n    <input data-attribute="subtitle" class="model edit subtitle" type="text" name="subtitle"\n           placeholder="Section Subtitle" title="subtitle" value="<%- subtitle %>">\n    <span class="error" id="subtitle-error"></span>\n</div>\n<div class="control-group">\n    <label for="content_location">Content Location:</label>\n    <input data-attribute="content_location" class="model edit content_location" type="text" name="content_location"\n           placeholder="Content Location" title="content_location" value="<%- content_location %>">\n    <span class="error" id="content_location-error"></span>\n</div>\n<div class="control-group">\n    <label for="content">Content: </label>\n    <textarea data-attribute="content" class="model edit content" name="content" placeholder="Content"><%- content %></textarea>\n    <span class="error" id="content-error"></span>\n</div>\n<div class="control-group">\n    <label for="words">Content: </label>\n    <textarea data-attribute="words" class="model edit words" name="words" placeholder="words"><%- words %></textarea>\n    <span class="error" id="words-error"></span>\n</div>',inline:'<div class="control-group">\n    <label for="title">Title:</label>\n    <input data-attribute="title" class="model edit title" type="text" name="title" placeholder="Section Title" title="title" value="<%- title %>">\n    <span class="error" id="title-error"></span>\n</div>\n<div class="control-group">\n    <label for="content">Content: </label>\n    <textarea data-attribute="content" class="model edit content" name="content" placeholder="Content"><%- content %></textarea>\n    <span class="error" id="content-error"></span>\n</div>\n<div class="control-group">\n    <label for="words">Content: </label>\n    <textarea data-attribute="words" class="model edit words" name="words" placeholder="words"><%- words %></textarea>\n    <span class="error" id="words-error"></span>\n</div>'},body:{full:'<div class="content-container entity-container">\n    <img class="content-location" src="<%- content_location %>" alt="<%- subtitle %>" title="">\n    <div class="content" ><%- content %></div>\n</div>'},cache:{}},Sm.loaded.add("Entities_Section_templates_image")}),define("Sm-Entities-Section-templates-image",function(){}),require(["require"],function(e){Sm.Entities.Concept.templates._template={body_outer:'<div class="spwashi-concept preview" data-ent_id="<%- ent_id %>" data-id="<%- id %>" data-title=\'<%- title %>\'>\n    __BUTTON_CONTROL__\n    __CONTENT__\n</div>',modal_outer:'<header>\n    <h3>Edit Concept </h3>\n</header>\n<div class="content form aligned">\n    __BUTTON_CONTROL__\n    <input type="hidden" value="<%- id %>" name="id">\n\n    __CONTENT__\n\n    <div class="control-group view_relationship-container">\n        <button class="action modal-button" data-action="view_relationships">View Relationships</button>\n    </div>\n</div>'},Sm.loaded.add("Entities_Concept_templates__template")}),define("Sm-Entities-Concept-templates-_template",function(){}),require(["require"],function(e){Sm.Entities.Concept.templates.standard={modal:'<div class="control-group">\n    <label for="title">Title:</label>\n    <input data-attribute="title" class="model edit title" type="text" name="title" placeholder="Section Title" title="title" value="<%- title %>">\n    <span class="error" id="title-error"></span>\n</div>\n<div class="control-group">\n    <label for="subtitle">Subtitle:</label>\n    <input data-attribute="subtitle" class="model edit subtitle" type="text" name="subtitle"\n           placeholder="Section Subtitle" title="subtitle" value="<%- subtitle %>">\n    <span class="error" id="subtitle-error"></span>\n</div>\n<div class="control-group">\n    <label for="description">Description: </label>\n    <textarea data-attribute="description" class="model edit description" name="description" placeholder="Description"><%- description %></textarea>\n    <span class="error" id="description-error"></span>\n</div>',body:'<div class="description" ><%- description %></div>'},Sm.loaded.add("Entities_Concept_templates_standard")}),define("Sm-Entities-Concept-templates-standard",function(){}),require(["require","select2","Sm","Sm-Entities-Page-templates-_template","Sm-Entities-Page-templates-standard"],function(e,t){e("Sm"),e("Sm-Entities-Page-templates-_template"),e("Sm-Entities-Page-templates-standard"),Sm.loaded.when_loaded(["Entities_Abstraction_Garage","Entities_Page_Meta","Entities_Page_templates__template"],function(){var e=Sm.Entities.Abstraction.Garage.extend({_populate_relationship_index:function(e){if("concepts"==e.relationship_index){for(var t=e.$relationship_index_string.children(".content"),i=e.relationship_object,n=i.items,r=i.relationships,o=[],s=[],a=0;a<n.length;a++){var l=n[a],c=r[a],d=l.r_id,u={};u.text=l.Model.get("title"),u.id=d,u.Relationship=c,o.push(u),s.push(d)}return t.select2({tags:!0,tokenSeparators:["|"],data:o,width:"300px"}),t.val(s).trigger("change"),t.on("click",function(){t.select2("data",[{id:4,text:"boonman"}],!0),t.select2("updateResults")}),Sm.CONFIG.DEBUG&&console.log(t.val()),e.$relationship_index_string}return Sm.Entities.Abstraction.Garage.prototype._populate_relationship_index.call(this,e)},_append_relationship:function(e,t,i,n,r,o){return Sm.Entities.Abstraction.Garage.prototype._append_relationship.apply(this,arguments)}});Sm.Entities.Page.Garage=new e("Page","page_type"),Sm.loaded.add("Entities_Page_Garage")},"Entities_Page_Garage")}),define("Sm-Entities-Page-Garage",function(){}),require(["require","Sm-Core-Meta"],function(e){var t=Sm.Core.Meta.Proto.extend({get_possible_relationship_indices:function(e){if(!e)return[];e=e||{};var t=e.OtherMvCombo,i=(t?t.type:e.type)||!1,n=!!e.is_reciprocal;return n?[null,"pages"]:"Page"==i?["pages"]:"Collection"==i?["collections"]:"Section"==i?["sections"]:"Dimension"==i?["dimensions"]:"Concept"==i?["concepts"]:[]}});Sm.Entities.Page.Meta=new t({type:"Page"}),Sm.Entities.Page.Meta.Proto=t;var i="Page";Sm.loaded.add("Entities_"+i+"_Meta")}),define("Sm-Entities-Page-Meta",function(){}),require(["require"],function(e){Sm.loaded.when_loaded("Core_SmView",function(){Sm.Entities.Page.View=Sm.Core.SmView.extend({type:"Page",identifier:".spwashi-page",_rendering_callbacks:{button_control:function(){if(this.elements.button_control)return this.elements.button_control;var e=this.get_rendered("$Element").children(".button-control");return this.elements.button_control=e[0]?e[0]:!1}},additional_events:{click:function(e){this.MvCombo&&(this.handle_click(e.target),e.stopPropagation())}},handle_click:function(e){var t=$(e);if(!this.MvCombo)return!1;var i=this.find_closest_relationship(),n=i.Relationship;if(this.queryPermission("edit")&&t.hasClass("edit")&&t.hasClass("button"))this.prompt_edit({display_type:"inline"});else if(this.queryPermission("relate")&&t.hasClass("add")&&t.hasClass("button"))this.begin_add_relationship({type:"Dictionary"});else if(t.hasClass("add-section-button")){var r=Sm.Entities.Dimension.Wrapper.get_active();if(r){var o=r.getView();o.begin_add_relationship({type:"Section"})}}else t.hasClass("debug")&&t.hasClass("button")&&Sm.CONFIG.DEBUG?console.log(this.cid," -- ",this.MvCombo,this.MvCombo.Model.attributes):this.queryPermission("destroy")&&t.hasClass("delete")&&t.hasClass("button")&&(n?n.destroy({silent:!1}):this.MvCombo.destroy({prompt:!0},this))}}),Sm.loaded.add("Entities_Page_View")},"Entities_Page_View")}),define("Sm-Entities-Page-View",function(){}),require(["require","Sm-Core-Meta"],function(e){var t=Sm.Core.Meta.Proto.extend({get_possible_relationship_indices:function(e){if(!e)return[];e=e||{};var t=e.OtherMvCombo,i=(t?t.type:e.type)||!1;return"Section"==i?["sections"]:[]}});Sm.Entities.Collection.Meta=new t({type:"Collection"}),Sm.Entities.Collection.Meta.Proto=t;var i="Collection";Sm.loaded.add("Entities_"+i+"_Meta")}),define("Sm-Entities-Collection-Meta",function(){}),require(["require","backbone","jquery","underscore","Cocktail","Sm-Entities-Abstraction-Modal-ModalEdit"],function(e,t,i,n,r){Sm.Entities.Abstraction.mixins.SidebarModule={focus:function(){if(this.status.is_focused)return this;var e=this.MvCombo,t=e.Model,i=(t.get("description")||"",this),n=i.elements.description_container||this.get_rendered("description_container");return n?Sm.Entities[this.type].Garage.generate("preview",e).then(function(e){i.elements.description_container.innerHTML=e,i.init_button_control_events()}):Sm.CONFIG.DEBUG&&console.log(this.type,this.elements.description_container,n),Sm.Core.SmView.prototype.focus.apply(this,arguments)},blur:function(){return this.MvCombo.queryStatus("focused")?(this.elements.description_container&&(this.elements.description_container.innerHTML=""),this.elements.button_control=!1,Sm.Core.SmView.prototype.blur.apply(this,arguments)):this},_rendering_callbacks:{button_control:function(){return this.elements.button_control=this.elements.button_control||i(this.get_rendered("description_container")).find(".button-control")[0]},container:function(){if(this.elements.container)return this.elements.container;var e=this.type.toLowerCase();return this.elements.container=this.elements.container||i("."+e+"-container")[0]||!1},description_container:function(){return this.elements.description_container=this.elements.description_container||i(this.get_rendered("container")).parent().find(".description-container")[0]},title_element:function(){if(this.elements.title)return this.elements.title;var e=this.get_rendered("$Element").find(".title");return this.elements.title=e[0]?e[0]:!1},description_element:function(){if(this.elements.description)return this.elements.description;var e=this.get_rendered("$Element").find(".description");return this.elements.description=e[0]?e[0]:!1}}},Sm.loaded.add("Sm_Entities_Abstraction_mixins_SidebarModule")}),define("Sm-Entities-Abstraction-mixins-SidebarModule",function(){}),require(["require","Sm-Core-SmView","Sm-Entities-Abstraction-mixins-SidebarModule"],function(e){e(),Sm.loaded.when_loaded(["Core_SmView","Sm_Entities_Abstraction_mixins_SidebarModule"],function(){Sm.Entities.Collection.View=Sm.Core.SmView.extend({type:"Collection",mixins:[Sm.Entities.Abstraction.mixins.SidebarModule],identifier:".spwashi-collection",additional_events:{click:function(e){var t=e.target,i=$(t);this.MvCombo;i.hasClass("spwashi-collection")&&(this.MvCombo.queryStatus("focused")?this.MvCombo.blur(this):this.MvCombo.focus(this),e.stopPropagation())}}}),Sm.loaded.add("Entities_Collection_View")},"Entities_Collection_View")}),define("Sm-Entities-Collection-View",function(){}),require(["require","Sm","Sm-Entities-Dictionary-templates-_template","Sm-Entities-Dictionary-templates-standard"],function(e){e("Sm"),e("Sm-Entities-Dictionary-templates-_template"),e("Sm-Entities-Dictionary-templates-standard"),Sm.loaded.when_loaded(["Entities_Abstraction_Garage","Entities_Dictionary_Meta","Entities_Dictionary_templates__template"],function(){var e=Sm.Entities.Abstraction.Garage.extend({_append_relationship:function(e,t,i,n,r,o){if(Sm.CONFIG.DEBUG&&console.log(e),i&&"definitions"==i){var s=e.Model.get("title")||" - ";arguments[3]=n.replace("__TITLE__",s)}return Sm.Entities.Abstraction.Garage.prototype._append_relationship.apply(this,arguments)},definition_tooltip:function(e,t,i){i=i||{};var n=i.word||!1,r=i.title||n,o=this,s=Sm.Entities.Dictionary.templates._template.tooltip_outer||"";s=s.replace("__CONTENT__","").replace("__TITLE__","").replace("__SUBTITLE__","");var a=$(s),l=a.find(".content");l=l[0]||!1;var c=function(e){return l&&l.appendChild(e),a[0]};if("[object Array]"===Object.prototype.toString.call(e)){!n&&e[0]&&e[0].Model&&(n=e[0].Model.get("title"));var d=a.find(".title");return d=d[0]||!1,d&&(d.innerHTML=r),e.reduce(function(e,t){return e.then(function(){return o.generate("relationships",t).then(c)})},Promise.resolve())}return o.generate("relationships",e).then(c)}});Sm.Entities.Dictionary.Garage=new e("Dictionary","dictionary_type"),Sm.loaded.add("Entities_Dictionary_Garage")},"Entities_Dictionary_Garage")}),define("Sm-Entities-Dictionary-Garage",function(){}),require(["require","Sm-Core-Meta"],function(e){var t=Sm.Core.Meta.Proto.extend({relationship_type_obj:{definitions:{model_type:"Section",index_singular:"definition",id:null,primary_key:"dictionary_id",secondary_key:"section_id",is_only_reciprocal:!1,linked_entities:["Dictionary","Section"]},dictionaries:{model_type:"Page|Section",index_singular:"page|section",id:null,primary_key:"page_id|section_id",secondary_key:"dictionary_id",is_only_reciprocal:!0,linked_entities:["Section|Page","Dictionary"]}},relationship_aliases:{sections:"definitions"},get_possible_relationship_indices:function(e){if(!e)return[];e=e||{};var t=e.OtherMvCombo,i=(t?t.type:e.type)||!1,n=!!e.is_reciprocal;return n?[null,"dictionaries"]:"Section"==i?["definitions"]:"Page"==i?["pages"]:[]}});Sm.Entities.Dictionary.Meta=new t({type:"Dictionary"}),Sm.Entities.Dictionary.Meta.Proto=t;var i="Dictionary";Sm.loaded.add("Entities_"+i+"_Meta")}),define("Sm-Entities-Dictionary-Meta",function(){}),require(["require","Sm","Sm-Core-MvCombo"],function(e){Sm.loaded.when_loaded("Core_MvCombo",function(){Sm.Entities.Dictionary.MvCombo=Sm.Core.MvCombo.extend({words:{},check_words:function(e,t){e||(e=""),e="object"==typeof e&&e.constructor===Array?e.slice(0):e.split(",");for(var i=[],n=[],r=0;r<e.length;r++){var o=e[r]=e[r].toLowerCase().trim();o.length&&(this.words[o]?t&&-1===this.words[o].indexOf(t)&&n.push(o):n.push(o))}if(t)if(this.definition_word_map[t])for(var s=0;s<this.definition_word_map[t].length;s++){var a=this.definition_word_map[t][s];e.indexOf(a)<0&&i.push(a)}else this.definition_word_map[t]=[];return{nonexistent_words:n,since_deleted_words:i}},add_definition:function(e){for(var t=e.Model,i=t.get_words(),n=this.check_words(i,e.Identity.r_id),r=n.nonexistent_words,o=n.since_deleted_words,s=0;s<r.length;s++){var a=r[s];this.add_word(a,e)}for(var l=0;l<o.length;l++){var c=o[l];this.remove_word(c,e)}},add_word:function(e,t){if(e.length&&(e=e.toLowerCase().trim(),e.length)){this.words[e]=this.words[e]||[];var i=t.Identity.r_id;if(this.words[e].indexOf(i)<0){this.words[e].push(i);var n=this.definition_word_map[i]=this.definition_word_map[i]||[];n.indexOf(e)<0&&n.push(e)}Sm.Entities.Dictionary.Wrapper.add_word(e,this)}},remove_word:function(e,t){if(!e||"string"!=typeof e||!e.length)return!1;if(e=e.toLowerCase().trim(),!e.length)return!1;if(!(e in this.words))return!1;var i=this.words[e];i.length&&t&&t.Identity?i.indexOf(t.Identity.r_id)>-1&&i.splice(i.indexOf(t.Identity.r_id),1):(delete this.words[e],Sm.Entities.Dictionary.Wrapper.remove_word(e,this))},init:function(){Sm.Core.MvCombo.prototype.init.apply(this,arguments),this.words={},this.definition_word_map={},this.on("add_relationship",function(e){e=e||{};var t=e.SelfMvCombo,i=e.OtherMvCombo;e.Relationship,e.RelationshipIndex,e.OtherView,e.map_indices;if("Section"==i.type&&i.Model){var n=i.Model.get("words")||"";if(n.length)for(var r=n.split(","),o=0;o<r.length;o++){var s=r[o];t.add_word(s,i)}}})},_build_other_MV:function(e,t){return t.model_properties=t.model_properties||{},"Section"==e.type&&(t.model_properties.section_type=Sm.Entities.Section.Meta.types.definition,t.prompt=!0),e.build_MV(t)},define_word:function(e,t){t=!!t,e=(t?e:e.toLowerCase()).trim();var i=this.words[e],n=[],r=[];if(i)for(var o=0;o<i.length;o++){var s=i[o],a=Sm.Core.Identifier.retrieve(s).getResource(),l=this.getRelationship(s);l&&a&&(n.push(l),r.push(a))}return{items:r,relationships:n}}}),Sm.loaded.add("Entities_Dictionary_MvCombo")},"Entities_Dictionary_MvCombo")}),define("Sm-Entities-Dictionary-MvCombo",function(){}),require(["require","Sm-Core-SmView","Sm-Entities-Abstraction-mixins-SidebarModule"],function(e){e("Sm-Core-SmView"),e("Sm-Entities-Abstraction-mixins-SidebarModule"),Sm.loaded.when_loaded(["Core","Sm_Entities_Abstraction_mixins_SidebarModule"],function(){Sm.Entities.Dictionary.View=Sm.Core.SmView.extend({type:"Dictionary",mixins:[Sm.Entities.Abstraction.mixins.SidebarModule],identifier:".spwashi-dictionary",additional_events:{click:function(e){var t=e.target,i=$(t),n=this.MvCombo;"INPUT"==t.tagName&&"checkbox"==t.type?!n.queryStatus("active")&&t.checked?(Sm.CONFIG.DEBUG&&console.log("activate"),n.activate(this),Sm.CONFIG.DEBUG&&console.log(n.words)):n.deactivate(this):i.hasClass("spwashi-dictionary")&&(this.MvCombo.queryStatus("focused")?this.MvCombo.blur(this):this.MvCombo.focus(this),e.stopPropagation()),this.queryPermission("edit")&&i.hasClass("edit")&&i.hasClass("button")&&this.prompt_edit()}},relationship_index_obj:{definitions:"definitions_container"},_rendering_callbacks:{definitions_container_element:function(){if(this.elements.definitions_container)return this.elements.definitions_container;var e,t=this.get_rendered("$Element").find(".definitions-container");if(t[0])return this.elements.definitions_container=t[0];if(e=this.get_rendered("description")){var i=document.createElement("div");return i.className="definitions-container",Sm.Core.util.insertAfter(i,e),this.elements.definitions_container=i,this.elements.definitions_container}return!1}},handle:void 0}),Sm.loaded.add("Entities_Dictionary_View")},"Entities_Dictionary_View")}),define("Sm-Entities-Dictionary-View",function(){}),require(["require","Sm-Core-MvWrapper"],function(e){Sm.loaded.when_loaded("Core_MvWrapper",function(){var e=Sm.Core.MvWrapper.extend({type:"Dictionary",parentType:null,highlighted_words:{},words:{},hydrate:function(e){var t=Sm.Core.MvWrapper.prototype.hydrate.apply(this,arguments);e=e||{};for(var i=e.elements||[],n=0;n<i.length;n++){var r=i[n],o=$(r),s=o.find("input[type=checkbox]")[0];if(s&&s.checked){var a=Sm.Core.Identifier.retrieve(r.dataset.ent_id);if(a){var l=a.getResource();l&&l.activate()}}}return t},add_word:function(e,t){e=e.toLowerCase().trim(),this.words[e]=this.words[e]||[];var i=t.Identity.r_id;this.words[e].length||this.highlight_word(e,{element:document.getElementById("main")}),this.words[e].indexOf(i)<0&&this.words[e].push(i)},remove_word:function(e,t){if(e=e.toLowerCase().trim(),!(e in this.words))return!1;var i=this.words[e];e.length&&t&&t.Identity?i.splice(i.indexOf(t.Identity.r_id),1):(delete this.words[e],this.unhighlight_word(e,{element:document.getElementById("main")}))},init_tooltips:function(e){var t=$(e),i=Sm.Entities.Dictionary.Garage,n=Sm.Entities.Dictionary.templates;return i&&n?void t.find(".sm-highlight").each(function(){var e=$(this);e.tooltipster({content:"Loading",interactive:!0,animation:"grow",speed:0,debug:!1,touchDevices:!1,trigger:"click",functionBefore:function(e,t){Sm.CONFIG.DEBUG&&console.log("attempt"),e.parent().hasClass("tooltipstered")&&e.parent().tooltipster("hide");var i=Sm.Entities.Dictionary.Wrapper.MvMaps.active_MVs;if(i){var n=[];for(var r in i)if(i.hasOwnProperty(r)){var o=i[r];o&&n.push(o.getResource())}n.length&&(t(),Sm.Entities.Dictionary.Garage.definition_tooltip(n,!1,{word:e.data("word"),title:e.text()}).then(function(t){e.tooltipster("content",$(t))}))}}})}):!1},unhighlight_word:function(e,t){if(t=t||{},"object"==typeof e&&e.constructor===Array)for(var i=0;i<e.length;i++){var n=e[i];this.unhighlight_word(n)}else{if(!e||!e.length)var r=t.element||document.body;Sm.CONFIG.DEBUG&&console.log(e),this.highlighted_words=this.highlighted_words||{},this.highlighted_words[e]=!1,Sm.Extras.Highlight.un_highlight({word:e,element:r})}},highlight_word:function(e,t){if(t=t||{},null===e&&(e=Object.keys(this.highlighted_words)),e.constructor===Array)for(var i=0;i<e.length;i++){var n=e[i];this.highlight_word(n,t)}else{var r=t.element||document.body;this.highlighted_words[e]=!0,Sm.Extras.Highlight.highlight({word:e,element:r}),this.init_tooltips(r)}},change_word_highlight_status:function(e,t,i){if(t=t.trim().toLowerCase(),e=!!e,!t||!i||!t.trim().length)return!1;var n=i.Identity.r_id,r=this.highlighted_words[t]=this.highlighted_words[t]||[];if(e)return r.indexOf(n)<0&&r.push(n),!0;var o;return r&&(o=r.indexOf(n))>-1?(r.splice(o,1),!0):!1}});Sm.Entities.Dictionary.Wrapper=new e,Sm.loaded.add("Entities_Dictionary_Wrapper")},"Entities_Dictionary_Wrapper")}),define("Sm-Entities-Dictionary-Wrapper",function(){}),require(["require","Sm-Core-Meta"],function(e){var t=Sm.Core.Meta.Proto.extend({get_possible_relationship_indices:function(e){if(!e)return[];e=e||{};var t=e.OtherMvCombo,i=(t?t.type:e.type)||!1,n=!!e.is_reciprocal;return n?[null,"dimensions"]:"Section"==i?["sections"]:"Page"==i?["pages"]:[]}});Sm.Entities.Dimension.Meta=new t({type:"Dimension"}),Sm.Entities.Dimension.Meta.Proto=t;var i="Dimension";Sm.loaded.add("Entities_"+i+"_Meta")}),define("Sm-Entities-Dimension-Meta",function(){}),require(["require"],function(e){Sm.loaded.when_loaded("Core_SmView",function(){Sm.Entities.Dimension.View=Sm.Core.SmView.extend({type:"Dimension",identifier:".spwashi-dimension",relationship_index_obj:{sections:"section_holder"},initialize:function(e){this._touch_data={start:{x:0,y:0,time:0},threshold:150,allowed_time:200};Sm.Core.SmView.prototype.initialize.apply(this,arguments),this.elements=Sm.Core.util.merge_objects({title:null,description:null,content:null,section_holder:null},this.elements)},_rendering_callbacks:{title_element:function(){if(this.elements.title)return this.elements.title;var e=Sm.Core.util.getChildElementsByClassName(this.el,"title");return e.length?this.elements.title=e[0]:!1},content_element:function(){if(this.elements.content)return this.elements.content;var e=Sm.Core.util.getChildElementsByClassName(this.el,"content");return e.length?this.elements.content=e[0]:!1},description_element:function(){if(this.elements.description)return this.elements.description;var e=Sm.Core.util.getChildElementsByClassName(this.el,"description");return e.length?this.elements.description=e[0]:!1},section_holder_element:function(){if(this.elements.section_holder)return this.elements.section_holder;if(!this.MvCombo||!this.MvCombo.Identity.ent_id||!this.MvCombo.Identity.ent_id.length)return!1;var e=$(".section-container[data-ent_id="+this.MvCombo.Identity.ent_id+"]");return e.length?this.elements.section_holder=e[0]:!1}},focus:function(){var e=document.getElementsByClassName("add-section-button");return e.length&&e[0].addEventListener("click",this.add_bound("begin_add_rel",this.begin_add_relationship.bind(this,{type:"Section"}))),Sm.Core.SmView.prototype.focus.apply(this,arguments)}}),Sm.loaded.add("Entities_Dimension_View")},"Entities_Dimension_View")}),define("Sm-Entities-Dimension-View",function(){}),require(["require","Sm-Core-MvWrapper"],function(e){Sm.loaded.when_loaded("Core_MvWrapper",function(){
var e=Sm.Core.MvWrapper.extend({type:"Dimension",parentType:null,populate_container:function(e){},hydrate:function(e){var t=Sm.Core.MvWrapper.prototype.hydrate.call(this,e),i=this.get_active();for(var n in i)if(i.hasOwnProperty(n)&&i[n].MvCombo){i[n].MvCombo.focus();break}return t},get_active:function(){var e=this.MvMaps.active_MVs;for(var t in e)if(e.hasOwnProperty(t))return e[t].getResource()}});Sm.Entities.Dimension.Wrapper=new e,Sm.loaded.add("Entities_Dimension_Wrapper")},"Entities_Dimension_Wrapper")}),define("Sm-Entities-Dimension-Wrapper",function(){}),require(["require","underscore","Sm","Sm-Entities-Section-templates-_template","Sm-Entities-Section-templates-standard","Sm-Entities-Section-templates-definition","Sm-Entities-Section-templates-image"],function(e){e("Sm"),e("Sm-Entities-Section-templates-_template"),e("Sm-Entities-Section-templates-standard"),e("Sm-Entities-Section-templates-definition"),e("Sm-Entities-Section-templates-image"),Sm.loaded.when_loaded(["Entities_Abstraction_Garage","Entities_Section_Meta","Entities_Section_templates__template"],function(){var e=Sm.Entities.Abstraction.Garage.extend({relationships:function(e,t,i){return i=i||{},i.display_type="preview",i.relationship_index_list=i.relationship_index_list||["children","micros","pivots","composition","concepts"],Sm.Entities.Abstraction.Garage.prototype.relationships.apply(this,[e,t,i])}});return Sm.Entities.Section.Garage=new e("Section","section_type"),"Entities_Section_Garage"},"Entities_Section_Garage")}),define("Sm-Entities-Section-Garage",function(){}),require(["require","Sm-Core-Meta"],function(e){var t=Sm.Core.Meta.Proto.extend({relationship_type_obj:{children:{model_type:"Section",index_singular:"child",id:1,primary_key:"primary_section_id",secondary_key:"secondary_section_id",is_only_reciprocal:!1,linked_entities:["Section","Section"]},composition:{model_type:"Section",index_singular:"composition",id:2,primary_key:"primary_section_id",secondary_key:"secondary_section_id",is_only_reciprocal:!1,linked_entities:["Section","Section"]},micros:{model_type:"Section",index_singular:"micro",id:4,primary_key:"primary_section_id",secondary_key:"secondary_section_id",is_only_reciprocal:!1,linked_entities:["Section","Section"]},pivots:{model_type:"Section",index_singular:"pivot",id:5,primary_key:"primary_section_id",secondary_key:"secondary_section_id",is_only_reciprocal:!1,linked_entities:["Section","Section"]},pages:{model_type:"Page",index_singular:"page",primary_key:"section_id",secondary_key:"page_id",is_only_reciprocal:!1,linked_entities:["Section","Page"]},collections:{model_type:"Collection",index_singular:"collection",primary_key:"section_id",secondary_key:"collection_id",is_only_reciprocal:!1,linked_entities:["Section","Collection"]},dictionaries:{model_type:"Dictionary",index_singular:"dictionary",primary_key:"section_id",secondary_key:"dictionary_id",is_only_reciprocal:!1,linked_entities:["Section","Dictionary"]},dimensions:{model_type:"Dimension",index_singular:"dimension",primary_key:"section_id",secondary_key:"dimension_id",is_only_reciprocal:!1,linked_entities:["Section","Dimension"]},definitions:{model_type:"Dictionary",index_singular:"definition",secondary_key:"dictionary_id",primary_key:"section_id",is_only_reciprocal:!0,linked_entities:["Section","Dictionary"]},sections:{model_type:"Collection|Dimension|Concept",index_singular:"collection|dimension|concept",primary_key:"collection_id|dimension_id|concept_id",secondary_key:"section_id",is_only_reciprocal:!0,linked_entities:["Section","Collection|Dimension|Concept"]},concepts:{model_type:"Concept",index:"concept",id:null,primary_key:"section_id",secondary_key:"concept_id",is_only_reciprocal:!1,linked_entities:["Section","Concept"]}},types:{standard:1,image:2,video:3,audio:4,definition:5,table:6,list:7,mirror:8},get_named_relationship_indices:function(e){var t=Sm.Core.Meta.Proto.prototype.get_named_relationship_indices.apply(this,arguments);return t.Macro="reciprocal_micros",t},get_possible_relationship_indices:function(e){if(!e)return[null];e=e||{};var t=e.OtherMvCombo,i=(t?t.type:e.type)||!1,n=!!e.is_reciprocal;return"Dictionary"==i&&n?[null,"definitions"]:"Section"==i?["children","composition","micros","pivots"]:"Page"==i?["pages"]:"Collection"==i?["collections"]:"Dimension"==i?["dimensions"]:"Concept"==i?["concepts"]:"Dictionary"==i?["dictionaries"]:[]}});try{Sm.Entities.Section.Meta=new t({type:"Section"}),Sm.Entities.Section.Meta.Proto=t;var i="Section";Sm.loaded.add("Entities_"+i+"_Meta")}catch(n){Sm.CONFIG.DEBUG&&console.log(n)}}),define("Sm-Entities-Section-Meta",function(){}),require(["require","Sm-Core-SmModel"],function(e){e("Sm-Core-SmModel"),Sm.Entities.Section.Model=Sm.Core.SmModel.extend({defaults:Sm.Core.Meta.get_defaults_of("Section"),set:function(e,t){if(Sm.Core.SmModel.prototype.set.call(this,e,t),this.init_words(),("string"==typeof e&&"words"==e||"object"==typeof e&&e.words)&&this.get("section_type")==Sm.Entities.Section.Meta.types.definition&&this.MvCombo){var i=this.MvCombo.getRelationshipIndex("dictionaries");if(!i)return;var n=i.get_listed_items(),r=n.items;if(n.count)for(var o=0;o<r.length;o++){var s=r[o];s&&s.add_definition&&s.add_definition(this.MvCombo)}}},init_words:function(){var e=[],t=this.get("section_type");if(t==Sm.Entities.Section.Meta.types.definition){e=this.get("words")||"","string"==typeof e&&e.trim().length?e=e.split(","):e.constructor!==Array&&(e=[]);for(var i=0;i<e.length;i++){var n=e[i];e[i]=n.trim()}this._words=e}return e},get_words:function(){return this.init_words(),this._words||[]},initialize:function(){this._words=[],Sm.Core.SmModel.prototype.initialize.apply(this,arguments)}}),Sm.Entities.Section.Model.prototype.type="Section",Sm.loaded.add("Entities_Section_Model")}),define("Sm-Entities-Section-Model",function(){}),require(["require","Sm","Sm-Core-MvCombo"],function(e){Sm.loaded.when_loaded("Core_MvCombo",function(){Sm.Entities.Section.MvCombo=Sm.Core.MvCombo.extend({scale:function(e,t){var i=[],n=Sm.Entities.Section.MvCombo.generate_standard_get_listed_items_fn("micros",t,!1,i),r=Sm.Core.MvCombo.replace_MV({MvCombo:this,is_reciprocal:!e,list_items_fn:n,replacement_indices:"micros"}).then(function(e){return e&&(e.found=i),e});return r&&(r.found=i),Promise.resolve(r)},pivot:function(e,t){var i=e.constructor===Array&&"home"==e[0];e=i?e[1]||!1:Sm.Entities.Section.Meta.get_relationship_type({sub:!0,type:"index"},e);var n=[],r=Sm.Entities.Section.MvCombo.generate_standard_get_listed_items_fn("pivots",t,e,n),o=Sm.Core.MvCombo.replace_MV({MvCombo:this,replace_effective:!0,is_reciprocal:i,list_items_fn:r,replacement_indices:"pivots"}).then(function(e){return e&&(e.found=n),e});return Promise.resolve(o||{})},get_relationship_subtypes:function(e,t){var i={},n=this.relationships.pivots;if(!n)return{};var r=n.relationship_subtype_map,o=!1;if(r&&r[t]){var s;for(s in r[t])r[t].hasOwnProperty(s)&&s!=e&&(/eli5|thing_explainer|text/.test(s)?(i.text=i.text||[],i.text.push(s)):/audio|video|image/.test(s)&&(i[s]=i[s]||[],i[s].push(s),o=!0))}return"home"!=e&&(i.home=["home"],o=!0),i.max=i.text&&3||(o?1:!1),i},_build_other_MV:function(e,t){return t.model_properties=t.model_properties||{},"Section"==e.type&&(t.model_properties.section_type=this.Model.attributes.section_type),e.build_MV(t)},_relationship_detail_hook:function(e,t,i,n){var r,o,s;switch(e){case"Section":r=!0,o="secondary_section_id",s="primary_section_id",i.relationship_type=Sm.Entities.Section.Meta.get_relationship_type({type:"id"},t.relationship_index);break;case"Collection":case"Concept":case"Dictionary":case"Dimension":o=n+"_id",s="section_id"}return{map:i,reciprocity_matters:r,self_index:s,other_index:o}}}),Sm.Entities.Section.MvCombo.generate_standard_get_listed_items_fn=function(e,t,i,n){return function(i,r,o){var s=i.getRelationshipIndex(e,r);if(!s)return{relationships:[],items:[]};for(var a="pivots"==e?s.get_listed_subtype_items(relationship_subindex,t):s.get_listed_items(t),l=0;l<a.items.length;l++){var c=a.items[l];c.queryStatus("completed")||(n.push(c),c.fetch().then(function(e){e&&e.forEachView(function(){Promise.resolve(this.replaceOldElement())})}))}return a}},Sm.loaded.add("Entities_Section_MvCombo")},"Entities_Section_MvCombo")}),define("Sm-Entities-Section-MvCombo",function(){}),require(["require"],function(e){Sm.loaded.when_loaded("Core_SmView",function(){Sm.Entities.Section.View=Sm.Core.SmView.extend({relationship_index_obj:{collections:!1,children:"child_holder",composition:"composition",micros:!1,pivots:"pivot_holder"},type:"Section",identifier:".spwashi-section",setElement:function(e){return e&&(e=e[0]||e),e&&e.addEventListener?Sm.Core.SmView.prototype.setElement.apply(this,arguments):!1},_rendering_callbacks:{button_control:function(){if(this.elements.button_control)return this.elements.button_control;var e=this.get_rendered("$Element").children(".button-control");return this.elements.button_control=e[0]?e[0]:!1},title_element:function(){if(this.elements.title)return this.elements.title;var e=this.get_rendered("$Element").children(".title");return this.elements.title=e[0]?e[0]:!1},subtitle_element:function(){if(this.elements.subtitle)return this.elements.subtitle;var e=this.get_rendered("$Element").children(".subtitle");return this.elements.subtitle=e[0]?e[0]:!1},content_element:function(){if(this.elements.content)return this.elements.content;var e=this.get_rendered("$Element").children(".content");return this.elements.content=e[0]?e[0]:!1},description_element:function(){if(this.elements.description)return this.elements.description;var e=this.get_rendered("$Element").children(".description");return this.elements.description=e[0]?e[0]:!1},content_location_element:function(){if(this.elements.content_location)return this.elements.content_location;var e=this.get_rendered("$Element").children(".content_location");return this.elements.content_location=e[0]?e[0]:!1},child_holder_element:function(){if(this.elements.child_holder)return this.elements.child_holder;var e,t=this.get_rendered("$Element").children(".children-container");if(t[0])return this.elements.child_holder=t[0];if(e=this.get_rendered("content_element")){var i=document.createElement("div");return i.className="children-container",Sm.Core.util.insertAfter(i,e),this.elements.child_holder=i,this.elements.child_holder}return!1},pivot_holder_element:function(){if(this.elements.pivot_holder)return this.elements.pivot_holder;var e=this.find_closest_relationship(),t=(e.Relationship,e.el),i=$(t),n=!1;return i.hasClass("definition-relationship")&&(i.addClass("pivot-container"),n=t),this.elements.pivot_holder=n,this.elements.pivot_holder},composition_element:function(){if(this.elements.composition_holder)return this.elements.composition_holder;var e,t=this.get_rendered("$Element").children(".composition-container");if(t[0])return this.elements.composition_holder=t[0];if(e=this.get_rendered("content_element")){var i=document.createElement("div");return i.className="composition-container",Sm.Core.util.insertAfter(i,e),this.elements.composition_holder=i,this.elements.composition_holder}return!1},focus_element:function(){if(this.elements.focus)return this.elements.focus;var e=this.$el.children(".focus");if(!e.length){var t=document.createElement("div");t.className="focus upper";var i=this.el;if(!i)return!1;var n=i.childNodes[0];return n?(i.insertBefore(t,n),this.elements.focus=t):!1}return this.elements.focus=e[0]}},initialize:function(e){this._touch_data={start:{x:0,y:0,time:0},threshold:150,allowed_time:200},this.what_we_on="home",Sm.Core.SmView.prototype.initialize.apply(this,arguments)},update:function(e){if(this.display_type.indexOf("modal")>-1)return this;var t=["section_type","content_location"];Sm.CONFIG.DEBUG&&console.log(e);for(var i=0;i<t.length;i++){var n=t[i];if(e.indexOf(n)>-1)return this.mark_unrendered(),this.replaceOldElement(),this}return Sm.Core.SmView.prototype.update.apply(this,arguments)},handle:!0,handle_click:function(e,t){var i=$(e);if(!this.MvCombo)return!1;var n=this.find_closest_relationship(),r=n.Relationship,o=(n.el,n.other_MV_type);if(r=r&&null!==r&&void 0!==r?r:!1,this.queryStatus("modal"))return!0;if(i.closest(".pan")[0]){var s=i.hasClass("left")?!0:i.hasClass("right")?!1:null;"boolean"==typeof s&&this.scale(s)}else if(t.ctrlKey)this.MvCombo.queryStatus("selected")?this.MvCombo.deselect(this):this.MvCombo.select(this);else{if(null!==r&&r&&"Dictionary"==o){var a=this.MvCombo.Model.get("content_location");a&&a.length&&Sm.Core.util.follow_link(a,!1)}this.MvCombo.focus(this)}},init_button_control_events:function(){var e=this.el,t=this.type,i=(Sm.Entities[t],$(e));if(!i[0])return!1;var n=$(this.get_rendered("button_control",!0));this.PivotViewAid=null;var r={$pivot_display:!1,on:!1,original:{},what_we_on:"home"},o=this;return n.on({mouseenter:o._get_pd_creation_fn(r,n,"0"),mouseleave:o._get_pd_close_fn(r)}),Sm.Core.SmView.prototype.init_button_control_events.apply(this,arguments)},_get_pd_creation_fn:function(e,t,i){var n=this,r=Sm.Entities.Section,o=!1,s=this.what_we_on||"home";return i=i||0,function(a){if(a.stopPropagation(),n.PivotViewAid&&n.PivotViewAid.status.is_open&&(o=!0),o)return!0;var l=Sm.Core.MvWrapper.get_effective_MV(n.MvCombo.r_id,!0,!0)||{},c=l.MVs||!1;"string"==typeof l.replacement_indices&&"pivots"!=l.replacement_indices&&(c=!1);var d=!1;s=n.what_we_on,c?(c=Sm.Core.MvWrapper.convert_to_MvCombo(c)[0],d=!0):(s="home",c=n.MvCombo),e.on=!0;var u=$(this),p=!1,h=c.get_relationship_subtypes(s,i)||{};for(var f in h)if(h.hasOwnProperty(f)){var m=h[f].length;e.original[f]!=m&&(p=!0,e.original[f]=m)}var _=r.Garage.generate({type:"pivot_display.",synchronous:!0,data:h});e.$pivot_display=e.$pivot_display?e.$pivot_display:$($(_)[0]);var v=h.max||1,g=e.$pivot_display.find(".relationship-subtype"),y=$(g[0]);if(y[0]){var b=75,w=e.$pivot_display.find(".relationship-subtype-category");if(w[0]){var S=$(w[0]),C=b*v;S.width(C)}}n.PivotViewAid&&p&&delete n.PivotViewAid,n.PivotViewAid||(n.PivotViewAid=new Sm.Extras.ViewAid({element:e.$pivot_display[0],events:{pivot:function(e,t){var r=n;d&&"home"!==e?(r=c.getView({reference_element:n.referenceElement,strict:!0}),Sm.CONFIG.DEBUG&&console.log("-------------------"),r?r.pivot(e,!1,i):Sm.CONFIG.DEBUG&&console.log(c)):("home"==e&&(e=["home",s]),n.pivot(e,!1,i))},open:function(){if(h.max){var i=$(window).width()-(u.offset().left+u.outerWidth());200>i&&e.$pivot_display.addClass("left"),t.append(e.$pivot_display)}}}})),n.PivotViewAid.open()}},_get_pd_close_fn:function(e){var t=this;return function(){e.on=!1,e.$pivot_display&&setTimeout(function(){!e.on&&t.PivotViewAid.status.is_open&&t.PivotViewAid.close()},250)}},remove:function(){return this.PivotViewAid&&this.PivotViewAid.status.is_open&&this.PivotViewAid.close(),Sm.Core.SmView.prototype.remove.apply(this,arguments)},scale:function(e,t){if(this.queryStatus("modal"))return Promise.reject("Cannot scale Modal Dialogs");var i=this,n=this.MvCombo;return n.scale(e,t||0).then(function(t){Sm.Core.SmView.replace_with_elements({items:t.items||[],referenceElement:i.referenceElement,replacement_MVs:t.replacement_MVs||[],replaced_MVs:t.replaced_MVs||[]})["catch"](function(t){Sm.CONFIG.DEBUG&&console.log(t);var n=e?"can-pan-left":"can-pan-right";i.get_rendered("focus_element")&&$(i.get_rendered("focus_element")).removeClass(n).removeClass("maybe-"+n)})})},pivot:function(e,t,i){if(this.queryStatus("modal"))return Promise.reject("Cannot scale Modal Dialogs");i=i||0;var n=this;return this.MvCombo.pivot(e,i||0).then(function(t){Sm.Core.SmView.replace_with_elements({referenceElement:n.referenceElement,items:t.items||{},replacement_MVs:t.replacement_MVs||[],replaced_MVs:t.replaced_MVs||[],replacement_relationships:t.replacement_relationships||[],replaced_relationships:t.replaced_relationships||[],name:"pivots."+e,forEachView:function(){this.what_we_on=e}})["catch"](function(e){Sm.CONFIG.DEBUG&&console.log(e)})})},additional_events:{touchstart:function(e){var t=e.changedTouches||e.originalEvent.changedTouches,i=t[0];this._touch_data.start.x=i.pageX,this._touch_data.start.y=i.pageY,this._touch_data.start.time=(new Date).getTime(),e.preventDefault()},touchend:function(e){var t=e.changedTouches||e.originalEvent.changedTouches,i=t[0],n=i.pageX-this._touch_data.start.x,r=(new Date).getTime()-this._touch_data.start.time;if(r<=this._touch_data.allowed_time&&Math.abs(i.pageY-this._touch_data.start.y)<=100&&Math.abs(n)>=this._touch_data.threshold){var o=!0;0>n&&(o=!1),this.scale(!!o)}else this.MvCombo&&(e.stopPropagation(),this.handle_click(e.target,e));this._touch_data.start={x:0,y:0,time:0},e.preventDefault(),e.stopPropagation()},click:function(e){var t=e.which&&3==e.which||e.button&&2==e.button;t&&Sm.CONFIG.DEBUG&&console.log(this),this.MvCombo&&(this.handle_click(e.target,e),e.stopPropagation())}},renderDragMirror:function(e){var t=this.MvCombo;if(!t)return!1;var i=e.cloneNode(!0),n=document.createElement("div");return n.style.position="absolute",n.appendChild(i),n.className="sm-mirror",n.style.cursor="grabbing",n},blur:function(){return this.queryStatus("focused")?(this.add_bound&&document.removeEventListener("click",this.add_bound("blur",this.MvCombo.blur.bind(this.MvCombo,{},this))),document.removeEventListener("keydown",this.get_bound("scale_handler")),Sm.Core.SmView.prototype.blur.apply(this,arguments)):this},focus:function(){var e=this,t=function(t){if(!e.queryStatus("focused"))return Sm.CONFIG.DEBUG&&console.log("View is not focused, will not scale"),!1;var i=t.which,n=37==i?!0:39==i?!1:null;"boolean"==typeof n&&(e.scale(n)["catch"](function(e){Sm.CONFIG.DEBUG&&console.log(e)}),t.stopPropagation())};this.add_bound&&document.addEventListener("click",this.add_bound("blur",this.MvCombo.blur.bind(this.MvCombo,{},this))),document.addEventListener("keydown",this.add_bound("scale_handler",t));var i=this.$el.children(".focus");if(i[0]){var n=0,r=this.MvCombo,o=r.relationships.micros,s=r.reciprocal_relationships.micros,a=o&&o.has_relationships_in_context(n),l=s&&s.has_relationships_in_context(n);a?i.addClass("can-pan-left"):0===a?i.addClass("maybe-can-pan-left"):i.removeClass("maybe-can-pan-left").removeClass("can-pan-left"),l?i.addClass("can-pan-right"):0===l?i.addClass("maybe-can-pan-right"):i.removeClass("maybe-can-pan-right").removeClass("can-pan-right")}return Sm.Core.SmView.prototype.focus.apply(this,arguments)},undelegateEvents:function(){Sm.Core.SmView.prototype.undelegateEvents.apply(this,arguments)},wrap_element_for_relationship:function(e,t,i,n){var r=n||"<div></div>";if(i.linked_entities&&"Dictionary"in i.linked_entities){r=r.replace("__R_ID__",i.Identity.r_id);var o=$(r);if(o[0])return o[0].appendChild(OtherView.get_rendered("Element")),o[0]}return e.get_rendered("Element")}}),Sm.loaded.add("Entities_Section_View")},"Entities_Section_View")}),define("Sm-Entities-Section-View",function(){}),require(["require"],function(e){Sm.loaded.when_loaded("Core_MvWrapper",function(){var e=Sm.Core.MvWrapper.extend({type:"Section",parentType:null,populate_container:function(e){}});Sm.Entities.Section.Wrapper=new e,Sm.loaded.add("Entities_Section_Wrapper")},"Entities_Section_Wrapper")}),define("Sm-Entities-Section-Wrapper",function(){}),require(["require","Emitter","Sm"],function(e,t){e("Sm"),e(["require","Sm/Extras/ViewAid"],function(){}),Sm.loaded.when_loaded("Core_RelationshipIndex",function(){Sm.Entities.Section.Abstraction=Sm.Entities.Section.Abstraction||{},Sm.Entities.Section.Abstraction.Relationship=Sm.Entities.Section.Abstraction.Relationship||{},Sm.Entities.Section.Abstraction.Relationship.pivots_RelationshipIndex=Sm.Core.RelationshipIndex.extend({relationship_subtype_map:{},init:function(e){return this.relationship_subtype_map={},Sm.Core.RelationshipIndex.prototype.init.apply(this,arguments)},get_listed_subtype_items:function(e,t){var i=this.relationship_subtype_map[t];if(!i||!i[e])return!1;var n=i[e],r={relationships:[],items:[]};for(var o in n)if(n.hasOwnProperty(o)){var s=n[o],a=Sm.Core.Identifier.retrieve(o);a&&(a=a.getResource(),r.items.push(a),r.relationships.push(s))}return r},sort_incoming:function(e,t,i){i=i||0;var n;if(n=e.map.relationship_subindex){if(n=Sm.Entities.Section.Meta.get_relationship_type({sub:!0,type:"index"},n),!n)return;this.relationship_subtype_map[i]=this.relationship_subtype_map[i]||{},this.relationship_subtype_map[i][n]=this.relationship_subtype_map[i][n]||{},this.relationship_subtype_map[i][n][t]=e}},remove_item:function(e,t,i){t=t||0;var n=this.relationship_subtype_map[t]&&Sm.Core.RelationshipIndex.prototype.remove_item.apply(this,arguments);if(!n)return!1;var r=this.relationship_subtype_map[t];"object"==typeof e&&(e.setMap?e=this.r_id_map[e.Identity.r_id]:e.r_id&&(e=e.r_id));for(var o in r)if(r.hasOwnProperty(o)&&r[o][e]){var s=r[o];delete s[e];var a=!1;for(var l in s)if(a=s.hasOwnProperty(l))break;a||delete r[o]}}}),Sm.loaded.add("Entities_Section_Abstraction_Relationship_pivots_RelationshipIndex")},"Entities_Section_Abstraction_Relationship_pivots_RelationshipIndex")}),define("Sm-Entities-Section-Abstraction-Relationship-pivots_RelationshipIndex",function(){}),require(["require","Class","Sm","Sm/Extras/Modal","Sm-Entities-Abstraction-Modal-ModalEdit"],function(e,t){Sm.loaded.when_loaded("Entities_Abstraction_Modal_ModalEdit",function(){Sm.Entities.Section.Abstraction=Sm.Entities.Section.Abstraction||{},Sm.Entities.Section.Abstraction.Modal=Sm.Entities.Section.Abstraction.Modal||{},Sm.Entities.Section.Abstraction.Modal.Edit=Sm.Entities.Abstraction.Modal.Edit.extend({init:function(e){return e=e||{},e.relationship_object&&(e.display_type="inline"),Sm.Entities.Abstraction.Modal.Edit.prototype.init.apply(this,arguments)},generate_element:function(e){var t=e||{};if(1===this.EntityArr.length){var i=(this.EntityArr[0],this.self_type,this);i.relationship_object&&"Dictionary"==i.relationship_object.other_MV_type&&(t.change={section_type:!1},t.display_subtype=Sm.Entities.Section.Meta.get_type("definition","index"))}return Sm.Entities.Abstraction.Modal.Edit.prototype.generate_element.call(this,t)}})},"Entities_Section_Abstraction_Modal_ModalEdit")}),define("Sm-Entities-Section-Abstraction-Modal-ModalEdit",function(){}),require(["require","Sm-Core-Meta"],function(e){var t=Sm.Core.Meta.Proto.extend({get_possible_relationship_indices:function(e){if(!e)return[];e=e||{};var t=e.OtherMvCombo,i=(t?t.type:e.type)||!1,n=!!e.is_reciprocal;return n?[null,"concepts"]:"Page"==i?["pages"]:"Collection"==i?["collections"]:"Section"==i?["sections"]:"Dimension"==i?["dimensions"]:"Concept"==i?["concepts"]:[]}});Sm.Entities.Concept.Meta=new t({type:"Concept"}),Sm.Entities.Concept.Meta.Proto=t;var i="Concept";Sm.loaded.add("Entities_"+i+"_Meta")}),define("Sm-Entities-Concept-Meta",function(){}),require(["require","Sm-Entities-Abstraction-mixins-SidebarModule"],function(e){Sm.loaded.when_loaded(["Core_SmView","Sm_Entities_Abstraction_mixins_SidebarModule"],function(){Sm.Entities.Concept.View=Sm.Core.SmView.extend({type:"Concept",mixins:[Sm.Entities.Abstraction.mixins.SidebarModule],identifier:".spwashi-concept",additional_events:{click:function(e){var t=e.target,i=$(t);this.MvCombo;i.hasClass("spwashi-concept")&&(this.MvCombo.queryStatus("focused")?this.MvCombo.blur(this):this.MvCombo.focus(this),e.stopPropagation())}}}),Sm.loaded.add("Entities_Concept_View")},"Entities_Concept_View")}),define("Sm-Entities-Concept-View",function(){});